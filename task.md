# Tâches

- [x] Finaliser le plan de couverture de tests <!-- id: 0 -->
    - [x] Vérifier la couverture actuelle <!-- id: 1 -->
    - [x] Mettre à jour `docs/test-coverage-plan.md` <!-- id: 2 -->
    - [x] Confirmer la fin de la Phase 1 <!-- id: 3 -->
- [x] Préparer la migration Signal <!-- id: 4 -->
- [ ] Phase 2 : Migration UI vers Signal <!-- id: 5 -->
    - [x] Identifier un composant pilote <!-- id: 6 -->
    - [x] Migrer le composant pilote <!-- id: 7 -->
    - [x] Vérifier le fonctionnement <!-- id: 8 -->
    - [x] Migrer `ag-menu.ts` <!-- id: 9 -->
    - [x] Déboguer et corriger le problème undo/redo (HistoryManager non importé)
- [x] Continuer la migration des composants UI
    - [x] Migrer `canvas-container.ts` <!-- id: 10 -->
    - [x] Migrer `ag-app.ts` (root component)
    - [x] Phase 2 terminée avec succès ✅
- [x] Phase 3 : Optimisation et Nettoyage (Documentation)
    - [x] Créer guide de migration pour développeurs
    - [x] Documenter les patterns et best practices
    - [ ] Ajouter tests unitaires pour composants migrés (optionnel)
- [x] Refactoring Tools (Audit Recommendations)
    - [x] Refactor BaseShapeCreationTool to use Signals
    - [x] Standardize Tool Instantiation (Declarative UI)
    - [x] Refactor CreateLineTool to use Signals
    - [x] Test manual des outils refactorisés ✅
- [x] Corriger les 7 Tests Échouants (Audit Recommendations) ✅ 100%
    - [x] Améliorer mocks IndexedDB dans test/setup.ts (fake-indexeddb installé)
    - [x] Valider que fake-indexeddb résout les tests IndexedDB
    - [x] Corriger canvas-layer.test.js (résolu par fake-indexeddb)
    - [x] Corriger help-popup.test.ts (résolu par fake-indexeddb)
    - [x] Corriger sync-optimization.test.ts (résolu par fake-indexeddb)
    - [x] Corriger cache.service.test.ts (résolu par fake-indexeddb)
    - [x] Corriger ag-main.test.js (mise à jour pour Signals)
    - [x] Corriger historyActions.test.js (assertions Vitest)
    - [x] Corriger CreateTriangleTool.test.js (mise à jour pour tool refactoring)
- [x] Corriger les erreurs eqeqeq (Audit Recommendations) ✅
    - [x] Analyser les erreurs avec configuration stricte (9 erreurs trouvées, toutes des null checks valides)
    - [x] Confirmer la conformité avec la règle 'smart' (aucune action requise)
- [ ] Améliorer la couverture de tests (Objectif: 40%)
- [x] Analyse du bundle (Optimisation) ✅
    - [x] Rapport généré dans `docs/bundle-analysis.md`
    - [x] Identification du chunk Firebase (541kB) comme principal point d'optimisation
    - [x] Lazy Loading implémenté pour `open-server-popup` (Gain: 40kB sur le chunk initial, Firebase différé) ✅
    - [x] Optimisation du splitting (`manualChunks`) : `ag-app` réduit à 0.2kB, création de chunks dédiés (`controllers`, `components`) ✅
    - [x] Suppression des imports statiques de Firebase dans les popups et lazy-loading complet (Gain: 518kB sur le chargement initial) ✅
