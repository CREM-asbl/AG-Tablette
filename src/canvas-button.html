<link rel="import" href="../bower_components/polymer/polymer-element.html">

<dom-module id="canvas-button">
    <template>
        <style>
             :host {
                display: block;
            }

            svg {
                width: 100%;
                height: 100%;
                background: #fff;
                border: 1px solid black;
            }

            svg[active] {
                border: 1px solid red;
            }
        </style>

        <svg width="50" height="50" on-click="_clickHandle">
            <defs>
                <g id="standardTriangle">
                    <polygon points="25,5 45,45 5,45" stroke="black" stroke-width="2" fill="yellow" />
                </g>
                <g id="standardCarre">
                    <rect x="5" y="5" width="40" height="40" stroke="black" stroke-width="2" fill="red" />
                </g>
                <g id="standardCircle">
                    <circle cx="25" cy="25" r="20" stroke="black" stroke-width="2" fill="green" />
                </g>
            </defs>
            <use href$="[[_ref(family)]]"></use>
        </svg>
    </template>

    <script>
        class CanvasButton extends Polymer.Element {
            static get is() { return 'canvas-button' }

            static get properties() {
                return {
                    family: Number
                }
            }

            _ref(family) {
                switch (family) {
                    case 1:
                        return "#standardTriangle"
                    case 2:
                        return "#standardCarre"
                    case 3:
                        return "#standardCircle"

                }
            }

            _clickHandle() {
                window.currentAction = {
                    name: "constructShape",
                    family: this.family,
                    click(event) {
                        let element = {}
                        switch (this.family) {
                            case 1:
                                element = document.createElementNS('http://www.w3.org/2000/svg', 'polygon')
                                element.setAttribute('points', event.x + ',' + event.y + ' ' + (event.x + 25) + ',' + (event.y - 50) + ' ' + (event.x + 50) + ',' + event.y)
                                element.setAttribute('fill', 'yellow')
                                break
                            case 2:
                                element = document.createElementNS('http://www.w3.org/2000/svg', 'rect')
                                element.setAttribute('x', event.x)
                                element.setAttribute('y', event.y)
                                element.setAttribute('width', 50)
                                element.setAttribute('height', 50)
                                element.setAttribute('fill', 'red')
                                break
                            case 3:
                                element = document.createElementNS('http://www.w3.org/2000/svg', 'circle')
                                element.setAttribute('cx', event.x)
                                element.setAttribute('cy', event.y)
                                element.setAttribute('r', 25)
                                element.setAttribute('fill', 'green')
                                break
                        }
                        element.setAttribute('stroke-width', 2)
                        element.setAttribute('stroke', 'black')
                        element.setAttribute('opacity', .75)
                        //il faut remplacer par main-canvas mais comment récupérer ???
                        //une idée est de créer un événement dont le parent commun intercepte pour envoyer sur min-canvas
                        //ex.: this.dispatchEvent('add-shape', { detail: element }) 
                        event.target.appendChild(element)
                    }
                }
                window.currentFamily = this.family
            }

        }
        customElements.define(CanvasButton.is, CanvasButton)
    </script>
</dom-module>