<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-resizable-behavior/iron-resizable-behavior.html">
<link rel="import" href="formes-standard.html">

<dom-module id="main-canvas">
    <template>
        <style>
            :host {
                display: block;
            }
            
            canvas {
                width: 100%;
                height: 100%;
            }
        </style>
        <formes-standard id="shape" family="[[family]]"></formes-standard>
        <canvas id="mainCanvas" on-tap="paint">Votre navigateur ne supporte pas canvas</canvas>
    </template>
    <script>
        Polymer({
            is: 'main-canvas',
            properties: {
                graphic: Object,
                narrow: {
                    type: Boolean,
                    observer: '_narrowChanged'
                },
                marginLeft: Number,
                family: Number
            },
            behaviors: [Polymer.IronResizableBehavior],
            listeners: {
                'iron-resize': '_onResize'
            },
            ready() {
                this.graphic = this.$.mainCanvas.getContext('2d');
                this.graphic.globalAlpha = 0.5;
                this.graphic.globalCompositeOperation = "lighter";
            },
            _onResize() {
                this.$.mainCanvas.width = this.offsetWidth;
                this.$.mainCanvas.height = this.offsetHeight;
            },
            _narrowChanged(narrow) {
                this.marginLeft = narrow ? 0 : 256;
            },
            paint(event) {
                var x = (event.detail.x - this.marginLeft) * this.$.mainCanvas.width / this.offsetWidth;
                var y = (event.detail.y - this.offsetTop) * this.$.mainCanvas.height / this.offsetHeight;
                this.$.shape.paint(this.graphic, x, y)
            }
        });
    </script>
</dom-module>