<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="div-main-canvas.html">
<link rel="import" href="css/canvas-view.html">
<link rel="import" href="shapes-list.html">
<link rel="import" href="canvas-button.html">

<dom-module id="ag-tablette-app">
  <template>
    <style include="canvas-view">
        .action-button {
            display: block;
            box-sizing: border-box;
            width: 100%;
            height: 30px;
            margin: 8px 0;
        }

        .action-button:hover,
        .action-button:focus {
            font-weight: bold;
        }

        canvas-button {
            display: inline-block;
            width: 50px;
            height: 50px;
            margin: 4px;
        }
    </style>

    <div id="app-canvas-view">

      <div id="app-canvas-view-toolbar" class="toolbar" style="display:table; table-layout:fixed; height:100%; max-height:100%;">
        <div id="app-canvas-view-toolbar-p1" style="padding-bottom: 15px;display:table-row;height:1%;">
            <div  style="display:table-cell;">
                <div id="app-canvas-mode-text"><span style="color: gray;">Mode:</span> {{currentMode}}</div>
                <div>
                    <button class="action-button" name="annuler" on-click='_actionHandle'>Annuler</button>
                </div>

                <div>
                    <button class="action-button" name="settings" on-click='_actionHandle'>Paramètres</button>
                </div>

                <div>
                    <strong>Formes standard</strong>
                </div>
                <template is="dom-repeat" items="[[_getFamilies()]]">
                    <canvas-button family="[[item]]" active="{{currentFamily}}"></canvas-button>
                </template>
                <shapes-list style="position:absolute;z-index:100000" family="[[currentFamily]]" name="choose_shape_in_list" on-selected-shape='_actionHandle'></shapes-list>

                <hr>
            </div>
        </div>

        <div id="app-canvas-view-toolbar-p2" style="display:table-row;">
        <div style="display:table-cell;">
        <div style="height:100%;overflow-y:auto;">

            <div >
                <strong>Mouvements</strong>
            </div>
            <button class="action-button" name="move_shape" on-click='_actionHandle'>Glisser</button>
            <button class="action-button" name="rotate_shape" on-click='_actionHandle'>Tourner</button>
            <button class="action-button" name="reverse_shape" on-click='_actionHandle'>Retouner</button>
            <button class="action-button" name="global_zoom" on-click='_actionHandle'>Zoomer</button>

            <div style="margin-top: 25px">
                <strong>Outils</strong>
            </div>
            <button class="action-button" name="link_shapes" on-click='_actionHandle'>Lier des formes</button>
            <button class="action-button" name="unlink_shapes" on-click='_actionHandle'>Délier</button>
            <button class="action-button" name="name_shape" on-click='_actionHandle'>Nommer TODO</button>
            <button class="action-button" name="delete_shape" on-click='_actionHandle'>Supprimer</button>
            <button class="action-button" name="background_color" on-click='_actionHandle'>Couleur de fond</button>
            <button class="action-button" name="border_color" on-click='_actionHandle'>Couleur des bords</button>

            <div style="margin-top: 25px">
                <strong>Opérations</strong>
            </div>
            <button class="action-button" name="merge_shapes" on-click='_actionHandle'>Fusionner</button>
            <button class="action-button" name="divide_segment" on-click='_actionHandle'>Diviser</button>
            <button class="action-button" name="cut_shape" on-click='_actionHandle'>Découper</button>
            <button class="action-button" name="duplicate_shape" on-click='_actionHandle'>Dupliquer</button>
            <button class="action-button" name="build_shape_center" on-click='_actionHandle'>Construire le centre</button>
        </div>
        </div>
        </div>
      </div>

      <div-main-canvas style="position:absolute;top:0px;background-color: rgba(0,0,0,0);" id="div-main-canvas"></div-main-canvas>
    </div>

  </template>

  <script>
    /**
     * Menu event handlers
     */
    class AGTabletteApp extends Polymer.Element {
        static get is() { return 'ag-tablette-app'; }

        static get properties() {
            return {
                currentFamily: String,
                currentMode: String
            }
        }

        /**
         * Main event handler
         */
        _actionHandle(event) {
            this.currentFamily = ''

            var states = {
                'move_shape': 'Glisser',
                'rotate_shape': 'Tourner',
                'global_zoom': 'Zoom',
                'delete_shape': 'Supprimer',
                'background_color': 'Couleur de fond',
                'border_color': 'Couleur des bords',
                'link_shapes': 'Lier des formes',
                'unlink_shapes': 'Délier des formes',
                'reverse_shape': 'Retourner',
                'build_shape_center': 'Construire le centre',
                'duplicate_shape': 'Dupliquer',
                'divide_segment': 'Diviser',
                'merge_shapes': 'Fusionner',
                'cut_shape': 'Découper'
            };

            if(states.hasOwnProperty(event.target.name)) {
                window.app.colorpicker.cancel();
                if(window.app.workspace.history.isRunning) {
                    console.log("history is running, skipping action");
                    return;
                }
                window.app.setState(event.target.name);
                this.currentMode = states[event.target.name];
            } else if(event.target.name=="settings") {
                window.app.colorpicker.cancel();
                document.getElementById('settings-popup-gray').style.display='block';
            } else if(event.target.name=="annuler") {
                window.app.colorpicker.cancel();
                window.app.workspace.history.cancelLastStep();
            } else if(event.type=="selected-shape") {
                window.app.colorpicker.cancel();
                this.currentMode = 'Ajouter forme';
            } else {
                console.log("AGTabletteApp._actionHandle: received unknown event:");
                console.log(event);
            }
        }

        /**
         * Récupérer la liste des familles
         * @return liste des noms des familles ([String])
         */
        _getFamilies() {
            return Workspace.getMenuAFamiliesNames();
        }
    }

    window.customElements.define(AGTabletteApp.is, AGTabletteApp);
  </script>
</dom-module>
