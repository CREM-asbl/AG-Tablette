<script>
    class Glisser {

        constructor() {
            this.name = 'glisser'
            this.shape = null
        }

        click(event) {
            //selectShape
            if (!this.shape) {
                if (event.target.id === "svg") { return }
                this.shape = event.target
                this.start = { x: event.x, y: event.y }
                this.translate = { x: 0, y: 0 }
            }
            else {
                this.glisser(event.x, event.y)
                this.shape.translate = this.translate
                this.shape = null
            }
        }

        mouseMove(event) {
            if (!this.shape) { return }
            this.glisser(event.x, event.y)
        }

        glisser(x, y) {
            console.log('***Glisser***')
            this.translate = { x: x - this.start.x, y: y - this.start.y }
            if (this.shape.translate) {
                this.translate.x += this.shape.translate.x
                this.translate.y += this.shape.translate.y
            }
            console.log(this.translate)
            console.log(this.shape.getScreenCTM())
            let transform = `translate(${this.translate.x},${this.translate.y})`
            if (this.shape.angle) {
                // on modifie l'élément rotation car CG a été déplacé
                // essayer de trouver une méthode plus propre
                let center = this.shape.getCG()
                transform += ` rotate(${this.shape.angle}, ${center.x}, ${center.y})`
            }
            this.shape.setAttribute('transform', transform)
            console.log(this.shape)
            console.log('*******')
        }
    }
</script>