[{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\.eslintrc.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\astro.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\docs\\development\\debug-silhouette.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\docs\\development\\test-silhouette-script.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'testBackObjects' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":7,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":22,"suggestions":[{"messageId":"removeVar","data":{"varName":"testBackObjects"},"fix":{"range":[259,715],"text":""},"desc":"Remove unused variable 'testBackObjects'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Test script pour v├®rifier que les silhouettes se chargent correctement\r\n// Ce script peut ├¬tre ex├®cut├® dans la console du navigateur\r\n\r\nconsole.log('­ƒº¬ Test de chargement des silhouettes Tangram');\r\n\r\n// Simuler les donn├®es de test du fichier .ags fourni\r\nconst testBackObjects = {\r\n  shapesData: [\r\n    {\r\n      id: \"df2b4edd20\",\r\n      position: \"tangram\",\r\n      type: \"RegularShape\",\r\n      path: \"M 736.992680838248 620.4692623622534 L 910.5487513032267 446.91319189727193\\nL 563.4366103732684 446.913191897276\\nL 736.992680838248 620.4692623622534\",\r\n      name: \"silhouette\",\r\n      fillColor: \"#000\",\r\n      fillOpacity: 1\r\n    }\r\n    // ... autres shapes\r\n  ],\r\n  segmentsData: [],\r\n  pointsData: []\r\n};\r\n\r\n// Fonction de test\r\nfunction testSilhouetteLoading() {\r\n  console.log('­ƒôï V├®rification de l\\'├®tat initial:');\r\n  console.log('  - app.environment.name:', app?.environment?.name);\r\n  console.log('  - app.tangramCanvasLayer existe:', !!app?.tangramCanvasLayer);\r\n\r\n  if (app?.tangramCanvasLayer) {\r\n    console.log('  - Nombre de shapes dans tangramCanvasLayer:', app.tangramCanvasLayer.shapes?.length || 0);\r\n  }\r\n\r\n  console.log('\\n­ƒöº Modifications apport├®es:');\r\n  console.log('  Ô£à Ajout du chargement des backObjects dans Workspace.initFromObject()');\r\n  console.log('  Ô£à Ajout de l\\'├®v├®nement tangram-canvas-ready');\r\n  console.log('  Ô£à Gestion asynchrone du chargement');\r\n\r\n  console.log('\\n­ƒôØ Pour tester manuellement:');\r\n  console.log('  1. Charger un fichier .ags avec des backObjects');\r\n  console.log('  2. V├®rifier que les silhouettes apparaissent imm├®diatement');\r\n  console.log('  3. V├®rifier dans la console qu\\'il n\\'y a pas d\\'erreurs');\r\n\r\n  return 'Test initialis├® - pr├¬t pour les tests manuels';\r\n}\r\n\r\n// Ex├®cuter le test\r\ntestSilhouetteLoading();","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\docs\\sync-optimization-examples.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'setupStateWatcher' is defined but never used. Allowed unused vars must match /^_/u.","line":112,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":112,"endColumn":27,"suggestions":[{"messageId":"removeVar","data":{"varName":"setupStateWatcher"},"fix":{"range":[3525,3672],"text":""},"desc":"Remove unused variable 'setupStateWatcher'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'syncResult' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":223,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":223,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"syncResult"},"fix":{"range":[6793,6842],"text":""},"desc":"Remove unused variable 'syncResult'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Exemples d'utilisation des optimisations de synchronisation\r\n * AG-Tablette - Optimisations de Performance\r\n */\r\n\r\n// ========================================\r\n// 1. UTILISATION DE LA SYNCHRONISATION INTELLIGENTE\r\n// ========================================\r\n\r\nimport { getLastSyncInfo, smartSync } from '../src/services/activity-sync.js';\r\n\r\n// Synchronisation automatique (respecte le cache de 24h)\r\nasync function autoSync() {\r\n  const result = await smartSync();\r\n\r\n  switch (result) {\r\n    case 'recent':\r\n      console.log('Ô£à Synchronisation r├®cente, pas de mise ├á jour n├®cessaire');\r\n      break;\r\n    case 'completed':\r\n      console.log('­ƒöä Synchronisation termin├®e avec succ├¿s');\r\n      break;\r\n    case 'offline':\r\n      console.log('­ƒôÂ Hors ligne, synchronisation report├®e');\r\n      break;\r\n    case 'in_progress':\r\n      console.log('ÔÅ│ Synchronisation d├®j├á en cours');\r\n      break;\r\n    case 'error':\r\n      console.log('ÔØî Erreur lors de la synchronisation');\r\n      break;\r\n  }\r\n}\r\n\r\n// Synchronisation forc├®e (ignore le cache)\r\nasync function forceSync() {\r\n  const result = await smartSync({ force: true });\r\n  console.log('Synchronisation forc├®e:', result);\r\n}\r\n\r\n// V├®rifier les informations de la derni├¿re synchronisation\r\nasync function checkSyncStatus() {\r\n  const info = await getLastSyncInfo();\r\n\r\n  if (info) {\r\n    console.log('Derni├¿re synchronisation:', info.lastSyncDate);\r\n    console.log('Activit├®s synchronis├®es:', `${info.syncedFilesCount}/${info.totalFilesCount}`);\r\n    console.log('Synchronisation requise:', info.nextSyncDue ? 'Oui' : 'Non');\r\n  } else {\r\n    console.log('Aucune synchronisation pr├®c├®dente d├®tect├®e');\r\n  }\r\n}\r\n\r\n// ========================================\r\n// 2. GESTION DU CACHE DE M├ëTADONN├ëES\r\n// ========================================\r\n\r\nimport {\r\n  clearExpiredSyncMetadata,\r\n  getSyncMetadata,\r\n  isRecentSyncAvailable\r\n} from '../src/utils/indexeddb-activities.js';\r\n\r\n// V├®rifier si une synchronisation r├®cente est disponible\r\nasync function checkRecentSync() {\r\n  const isRecent = await isRecentSyncAvailable(24); // 24 heures\r\n\r\n  if (isRecent) {\r\n    console.log('Ô£à Synchronisation r├®cente disponible, pas besoin de resync');\r\n    return false; // Pas besoin de synchroniser\r\n  } else {\r\n    console.log('ÔÜá´©Å Synchronisation p├®rim├®e, mise ├á jour recommand├®e');\r\n    return true; // Synchronisation recommand├®e\r\n  }\r\n}\r\n\r\n// Obtenir les m├®tadonn├®es d├®taill├®es du cache\r\nasync function getCacheDetails() {\r\n  const metadata = await getSyncMetadata();\r\n\r\n  if (metadata) {\r\n    console.log('Cache valide:', {\r\n      lastSync: new Date(metadata.lastSyncDate).toLocaleString(),\r\n      expiry: new Date(metadata.expiryDate).toLocaleString(),\r\n      files: metadata.serverFiles?.length || 0,\r\n      themes: metadata.serverThemes?.length || 0\r\n    });\r\n  } else {\r\n    console.log('Aucun cache valide trouv├®');\r\n  }\r\n}\r\n\r\n// Nettoyer le cache expir├®\r\nasync function cleanExpiredCache() {\r\n  const wasExpired = await clearExpiredSyncMetadata();\r\n  console.log('Cache expir├® nettoy├®:', wasExpired ? 'Oui' : 'Non');\r\n}\r\n\r\n// ========================================\r\n// 3. NAVIGATION OPTIMIS├ëE\r\n// ========================================\r\n\r\nimport { goToHomePage } from '../src/controllers/Core/Tools/general.js';\r\n\r\n// Navigation optimis├®e vers la page d'accueil\r\nfunction navigateToHome() {\r\n  console.log('­ƒÅá Navigation vers la page d\\'accueil (optimis├®e)');\r\n  goToHomePage(); // Plus de rechargement complet !\r\n}\r\n\r\n// Surveillance des changements d'├®tat\r\nfunction setupStateWatcher() {\r\n  window.addEventListener('state-changed', () => {\r\n    console.log('├ëtat de l\\'application mis ├á jour');\r\n  });\r\n}\r\n\r\n// ========================================\r\n// 4. WORKFLOW COMPLET OPTIMIS├ë\r\n// ========================================\r\n\r\n/**\r\n * Workflow optimis├® de synchronisation\r\n * Cette fonction impl├®mente la logique compl├¿te d'optimisation\r\n */\r\nasync function optimizedSyncWorkflow() {\r\n  console.log('­ƒÜÇ D├®marrage du workflow de synchronisation optimis├®');\r\n\r\n  try {\r\n    // 1. V├®rifier d'abord le cache local\r\n    const needsSync = await checkRecentSync();\r\n\r\n    if (!needsSync) {\r\n      console.log('Ô£à Cache valide, pas de synchronisation n├®cessaire');\r\n      return 'cache_hit';\r\n    }\r\n\r\n    // 2. V├®rifier la connectivit├®\r\n    if (!navigator.onLine) {\r\n      console.log('­ƒôÂ Hors ligne, utilisation du cache existant');\r\n      return 'offline';\r\n    }\r\n\r\n    // 3. Lancer la synchronisation intelligente\r\n    console.log('­ƒöä Lancement de la synchronisation...');\r\n    const syncResult = await smartSync();\r\n\r\n    // 4. Traiter le r├®sultat\r\n    switch (syncResult) {\r\n      case 'completed':\r\n        console.log('Ô£à Synchronisation termin├®e avec succ├¿s');\r\n        break;\r\n      case 'recent':\r\n        console.log('Ôä╣´©Å Synchronisation d├®j├á r├®cente');\r\n        break;\r\n      default:\r\n        console.log('ÔÜá´©Å R├®sultat de synchronisation:', syncResult);\r\n    }\r\n\r\n    return syncResult;\r\n\r\n  } catch (error) {\r\n    console.error('ÔØî Erreur dans le workflow de synchronisation:', error);\r\n    return 'error';\r\n  }\r\n}\r\n\r\n// ========================================\r\n// 5. CONFIGURATION ET MONITORING\r\n// ========================================\r\n\r\n/**\r\n * Configuration de debug pour les optimisations\r\n */\r\nfunction enableSyncDebug() {\r\n  // Activer les logs d├®taill├®s\r\n  localStorage.setItem('debug', 'true');\r\n  console.log('­ƒöì Mode debug activ├® pour la synchronisation');\r\n}\r\n\r\n/**\r\n * Statistiques de performance de la synchronisation\r\n */\r\nasync function getSyncPerformanceStats() {\r\n  const metadata = await getSyncMetadata();\r\n\r\n  if (!metadata) {\r\n    return null;\r\n  }\r\n\r\n  const timeSinceLastSync = Date.now() - metadata.lastSyncDate;\r\n  const timeUntilExpiry = metadata.expiryDate - Date.now();\r\n\r\n  return {\r\n    lastSync: {\r\n      timestamp: metadata.lastSyncDate,\r\n      timeAgo: Math.floor(timeSinceLastSync / (1000 * 60 * 60)) + ' heures',\r\n      filesCount: metadata.syncedFilesCount || 0,\r\n      themesCount: metadata.totalThemesCount || 0\r\n    },\r\n    cache: {\r\n      isValid: timeUntilExpiry > 0,\r\n      expiresIn: Math.floor(timeUntilExpiry / (1000 * 60 * 60)) + ' heures',\r\n      sizeEstimate: (metadata.serverFiles?.length || 0) + (metadata.serverThemes?.length || 0)\r\n    },\r\n    recommendations: {\r\n      shouldSync: timeUntilExpiry <= 0,\r\n      shouldCleanCache: timeSinceLastSync > 7 * 24 * 60 * 60 * 1000, // 7 jours\r\n      cacheHealth: timeUntilExpiry > 0 ? 'good' : 'expired'\r\n    }\r\n  };\r\n}\r\n\r\n// ========================================\r\n// 6. EXEMPLES D'UTILISATION PRATIQUE\r\n// ========================================\r\n\r\n// Au d├®marrage de l'application\r\nasync function onAppStart() {\r\n  console.log('­ƒô▒ D├®marrage de l\\'application');\r\n\r\n  // Workflow de synchronisation optimis├®\r\n  const syncResult = await optimizedSyncWorkflow();\r\n\r\n  // Afficher les statistiques\r\n  const stats = await getSyncPerformanceStats();\r\n  if (stats) {\r\n    console.log('­ƒôè Statistiques de synchronisation:', stats);\r\n  }\r\n}\r\n\r\n// Lors du retour ├á la page d'accueil\r\nfunction onHomePageNavigation() {\r\n  console.log('­ƒÅá Navigation vers la page d\\'accueil');\r\n\r\n  // Navigation optimis├®e (pas de rechargement)\r\n  navigateToHome();\r\n\r\n  // Pas de synchronisation automatique car g├®r├®e intelligemment\r\n  console.log('Ô£à Navigation termin├®e sans rechargement');\r\n}\r\n\r\n// Synchronisation manuelle (bouton utilisateur)\r\nasync function onManualSync() {\r\n  console.log('­ƒæñ Synchronisation manuelle demand├®e');\r\n\r\n  const result = await smartSync({ force: true });\r\n\r\n  if (result === 'completed') {\r\n    // Afficher notification de succ├¿s\r\n    window.dispatchEvent(new CustomEvent('show-notif', {\r\n      detail: {\r\n        message: 'Synchronisation termin├®e avec succ├¿s',\r\n        type: 'success'\r\n      }\r\n    }));\r\n  }\r\n}\r\n\r\n// ========================================\r\n// 7. EXPORT DES FONCTIONS D'EXEMPLE\r\n// ========================================\r\n\r\nexport {\r\n  autoSync, checkRecentSync, checkSyncStatus, cleanExpiredCache, enableSyncDebug, forceSync, getCacheDetails, getSyncPerformanceStats, navigateToHome, onAppStart,\r\n  onHomePageNavigation,\r\n  onManualSync, optimizedSyncWorkflow\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\playwright.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\public\\service-worker.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\components\\ag-app.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\components\\ag-environnements.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\components\\canvas-container.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\components\\canvas-layer.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":268,"column":42,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":268,"endColumn":44,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7461,7463],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"prefer-const","severity":1,"message":"'pathScaleMethod' is never reassigned. Use 'const' instead.","line":1137,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":1137,"endColumn":24}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { LitElement, css, html } from 'lit';\r\nimport { app } from '../controllers/Core/App';\r\nimport { SelectManager } from '../controllers/Core/Managers/SelectManager';\r\nimport { Coordinates } from '../controllers/Core/Objects/Coordinates';\r\nimport { Point } from '../controllers/Core/Objects/Point';\r\nimport { Segment } from '../controllers/Core/Objects/Segment';\r\n// Shapes imported lazily in loadFromData\r\nimport {\r\n  capitalizeFirstLetter,\r\n  createElem,\r\n  findObjectById,\r\n} from '../controllers/Core/Tools/general';\r\nimport { gridStore } from '../store/gridStore.js';\r\n\r\n// Constantes pour le rendu de la grille\r\nconst GRID_CONSTANTS = {\r\n  PIXELS_PER_CM: 37.8,\r\n  LONG_PRESS_DELAY: 1000,\r\n  DOUBLE_CLICK_THRESHOLD: 100,\r\n  MOVEMENT_THRESHOLD_MOUSE: 5,\r\n  MOVEMENT_THRESHOLD_TOUCH: 20,\r\n};\r\n\r\nclass CanvasLayer extends LitElement {\r\n  constructor() {\r\n    super();\r\n    this.shapes = [];\r\n    this.segments = [];\r\n    this.points = [];\r\n    this.texts = [];\r\n    this.editingShapeIds = [];\r\n    this.mustDrawShapes = true;\r\n    this.mustDrawSegments = true;\r\n    this.mustDrawPoints = true;\r\n    this.mustScaleShapes = true;\r\n    this.unsubscribeGridStore = null;\r\n\r\n    // Optimisation des performances\r\n    this._lastRedrawTime = 0;\r\n    this._redrawThrottle = 16; // ~60fps\r\n    this._pendingRedraw = false;\r\n    this._redrawRequestId = null;\r\n  }\r\n\r\n  static styles = css`\r\n    :host {\r\n      position: absolute;\r\n      bottom: 0;\r\n      left: 0;\r\n      right: 0;\r\n      top: 0;\r\n      background-color: rgba(0, 0, 0, 0);\r\n      box-sizing: border-box;\r\n    }\r\n\r\n    canvas {\r\n      box-sizing: border-box;\r\n      background-color: rgba(0, 0, 0, 0);\r\n      width: 100%;\r\n      height: 100%;\r\n      object-fit: contain;\r\n    }\r\n  `;\r\n\r\n  render() {\r\n    return html`<canvas\r\n      width=\"${this.clientWidth}\"\r\n      height=\"${this.clientHeight}\"\r\n    ></canvas>`;\r\n  }\r\n\r\n  updated() {\r\n    this.throttledRedraw();\r\n  }\r\n\r\n  /**\r\n   * Redraw avec throttling pour am├®liorer les performances\r\n   */\r\n  throttledRedraw() {\r\n    const now = performance.now();\r\n\r\n    // Si un redraw est d├®j├á en attente, l'annuler\r\n    if (this._redrawRequestId) {\r\n      cancelAnimationFrame(this._redrawRequestId);\r\n    }\r\n\r\n    // Si assez de temps s'est ├®coul├® depuis le dernier redraw\r\n    if (now - this._lastRedrawTime >= this._redrawThrottle) {\r\n      this.redraw();\r\n      this._lastRedrawTime = now;\r\n    } else {\r\n      // Programmer le redraw pour plus tard\r\n      this._redrawRequestId = requestAnimationFrame(() => {\r\n        this.redraw();\r\n        this._lastRedrawTime = performance.now();\r\n        this._redrawRequestId = null;\r\n      });\r\n    }\r\n  }\r\n\r\n  removeAllObjects() {\r\n    this.shapes = [];\r\n    this.segments = [];\r\n    this.points = [];\r\n    this.texts = [];\r\n    this.clear();\r\n  }\r\n\r\n  clear() {\r\n    if (this.ctx) {\r\n      // Optimisation: utiliser la largeur r├®elle du canvas\r\n      this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    }\r\n  }\r\n\r\n  redraw() {\r\n    // ├ëviter les redraws inutiles\r\n    if (this._pendingRedraw) return;\r\n    this._pendingRedraw = true;\r\n\r\n    try {\r\n      this.clear();\r\n      this.texts.forEach((text) => text.updateMessage());\r\n\r\n      if (this.canvasName === 'upper') {\r\n        window.dispatchEvent(new CustomEvent('refreshStateUpper'));\r\n      } else if (this.canvasName === 'grid') {\r\n        this.removeAllObjects();\r\n        const gridState = gridStore.getState();\r\n        if (gridState.isVisible) {\r\n          this.drawGridPoints();\r\n        }\r\n      }\r\n\r\n      this.draw();\r\n    } finally {\r\n      this._pendingRedraw = false;\r\n    }\r\n  }\r\n\r\n  draw(scaling = 'scale') {\r\n    if (this.mustDrawShapes) {\r\n      this.shapes.forEach((s) => {\r\n        if (this.editingShapeIds.findIndex((id) => s.id === id) === -1) {\r\n          if (\r\n            s.geometryObject &&\r\n            (s.geometryObject.geometryIsVisible === false ||\r\n              s.geometryObject.geometryIsHidden === true ||\r\n              s.geometryObject.geometryIsConstaintDraw === true)\r\n          )\r\n            return;\r\n          this.drawShape(s, scaling);\r\n          if (this.mustDrawPoints) {\r\n            if (app.environment.name === 'Geometrie') {\r\n              this.drawGeometryShapePoint(s);\r\n            } else {\r\n              this.drawShapePoint(s);\r\n            }\r\n          }\r\n        }\r\n      });\r\n    }\r\n    if (this.mustDrawPoints) {\r\n      this.points.forEach((pt) => {\r\n        if (pt.visible && pt.shapeId === undefined) {\r\n          this.drawPoint(pt);\r\n        }\r\n      });\r\n    }\r\n    this.texts.forEach((text) => {\r\n      this.drawText(text);\r\n    });\r\n  }\r\n\r\n  drawGeometryShapePoint(shape) {\r\n    if (app.settings.areShapesPointed) {\r\n      shape.points.forEach((pt) => {\r\n        if (pt.visible) {\r\n          this.drawPoint(pt);\r\n        }\r\n      });\r\n    } else if (shape instanceof SinglePointShape) {\r\n      if (!shape.geometryObject.geometryPointOnTheFlyChildId) {\r\n        this.drawPoint(shape.points[0]);\r\n      }\r\n    } else {\r\n      shape.points.forEach((pt) => {\r\n        if (\r\n          pt.visible &&\r\n          (pt.type === 'shapeCenter' || pt.type === 'divisionPoint')\r\n        )\r\n          this.drawPoint(pt);\r\n      });\r\n    }\r\n  }\r\n\r\n  drawShapePoint(shape) {\r\n    if (app.settings.areShapesPointed) {\r\n      shape.points.forEach((pt) => {\r\n        if (pt.visible) {\r\n          this.drawPoint(pt);\r\n        }\r\n      });\r\n    } else {\r\n      shape.points.forEach((pt) => {\r\n        if (\r\n          pt.visible &&\r\n          (pt.type === 'shapeCenter' ||\r\n            pt.type === 'divisionPoint' ||\r\n            pt.shape.isCircle())\r\n        ) {\r\n          this.drawPoint(pt);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  toSVG() {\r\n    let svg_data = '';\r\n    if (this.mustDrawShapes) {\r\n      this.shapes.forEach((s) => {\r\n        if (this.editingShapeIds.findIndex((id) => s.id === id) === -1) {\r\n          if (\r\n            s.geometryObject &&\r\n            (s.geometryObject.geometryIsVisible === false ||\r\n              s.geometryObject.geometryIsHidden === true ||\r\n              s.geometryObject.geometryIsConstaintDraw === true)\r\n          ) {\r\n            return;\r\n          }\r\n          svg_data += s.toSVG();\r\n          if (this.mustDrawPoints && app.settings.areShapesPointed) {\r\n            this.points.forEach((pt) => {\r\n              if (pt.visible && pt.shapeId === s.id) {\r\n                svg_data += pt.toSVG();\r\n              }\r\n            });\r\n          }\r\n        }\r\n      });\r\n    }\r\n    if (this.mustDrawPoints) {\r\n      this.points.forEach((pt) => {\r\n        if (pt.visible && pt.shapeId === undefined) {\r\n          svg_data += pt.toSVG();\r\n        }\r\n      });\r\n    }\r\n    return svg_data;\r\n  }\r\n\r\n  getCommonSegmentOfTwoPoints(pt1Id, pt2Id) {\r\n    const pt1 = findObjectById(pt1Id);\r\n    const pt2 = findObjectById(pt2Id);\r\n    if (pt1.shape.name === 'PointOnLine' || pt2.shape.name === 'PointOnLine') {\r\n      let segId;\r\n      if (pt1.shape.name === 'PointOnLine')\r\n        segId = pt1.shape.geometryObject.geometryParentObjectId1;\r\n      else segId = pt2.shape.geometryObject.geometryParentObjectId1;\r\n      return findObjectById(segId);\r\n    }\r\n    const segmentIds1 = pt1.segmentIds;\r\n    const segmentIds2 = pt2.segmentIds;\r\n    const commonSegmentIds = segmentIds1.filter(\r\n      (id1) => segmentIds2.findIndex((id2) => id2 === id1) !== -1,\r\n    );\r\n    const commonSegments = commonSegmentIds.map((id) =>\r\n      this.segments.find((seg) => seg.id == id),\r\n    );\r\n    commonSegments.sort((seg1, seg2) => seg2.idx - seg1.idx);\r\n    return commonSegments[0];\r\n  }\r\n\r\n  saveData() {\r\n    const data = {\r\n      shapesData: this.shapes.map((shape) => shape.saveData()),\r\n      segmentsData: this.segments.map((segment) => segment.saveData()),\r\n      pointsData: this.points.map((point) => point.saveData()),\r\n    };\r\n    return data;\r\n  }\r\n\r\n  async loadFromData(data) {\r\n    this.removeAllObjects();\r\n    // Tol├®rer null/undefined et donn├®es partielles sans lever d'erreur\r\n    if (!data) {\r\n      // Rien ├á charger, simplement rafra├«chir pour effacer le canvas\r\n      this.redraw();\r\n      return;\r\n    }\r\n\r\n    const shapesData = Array.isArray(data.shapesData) ? data.shapesData : [];\r\n    const segmentsData = Array.isArray(data.segmentsData)\r\n      ? data.segmentsData\r\n      : [];\r\n    const pointsData = Array.isArray(data.pointsData) ? data.pointsData : [];\r\n\r\n    if (shapesData.length || segmentsData.length || pointsData.length) {\r\n      for (const shapeData of shapesData) {\r\n        let currentShapeData = shapeData;\r\n        if (isFinite(shapeData.indexOfReference)) {\r\n          currentShapeData = app.history.steps[\r\n            shapeData.indexOfReference\r\n          ].objects.shapesData.find((s) => s.id === shapeData.id);\r\n        }\r\n        if (currentShapeData.type === 'Shape') {\r\n          const { Shape } = await import(\r\n            '../controllers/Core/Objects/Shapes/Shape'\r\n          );\r\n          Shape.loadFromData(currentShapeData);\r\n        } else if (currentShapeData.type === 'RegularShape') {\r\n          const { RegularShape } = await import(\r\n            '../controllers/Core/Objects/Shapes/RegularShape'\r\n          );\r\n          RegularShape.loadFromData(currentShapeData);\r\n        } else if (currentShapeData.type === 'CubeShape') {\r\n          const { CubeShape } = await import(\r\n            '../controllers/Core/Objects/Shapes/CubeShape'\r\n          );\r\n          CubeShape.loadFromData(currentShapeData);\r\n        } else if (currentShapeData.type === 'LineShape') {\r\n          const { LineShape } = await import(\r\n            '../controllers/Core/Objects/Shapes/LineShape'\r\n          );\r\n          LineShape.loadFromData(currentShapeData);\r\n        } else if (currentShapeData.type === 'SinglePointShape') {\r\n          const { SinglePointShape } = await import(\r\n            '../controllers/Core/Objects/Shapes/SinglePointShape'\r\n          );\r\n          SinglePointShape.loadFromData(currentShapeData);\r\n        } else if (currentShapeData.type === 'ArrowLineShape') {\r\n          const { ArrowLineShape } = await import(\r\n            '../controllers/Core/Objects/Shapes/ArrowLineShape'\r\n          );\r\n          ArrowLineShape.loadFromData(currentShapeData);\r\n        } else if (currentShapeData.type === 'StripLineShape') {\r\n          const { StripLineShape } = await import(\r\n            '../controllers/Core/Objects/Shapes/StripLineShape'\r\n          );\r\n          StripLineShape.loadFromData(currentShapeData);\r\n        } else {\r\n          currentShapeData.fillColor = currentShapeData.color;\r\n          currentShapeData.fillOpacity = parseFloat(currentShapeData.opacity);\r\n          currentShapeData.strokeColor = currentShapeData.borderColor;\r\n          currentShapeData.strokeWidth = currentShapeData.borderSize;\r\n          if (\r\n            currentShapeData.segmentIds.length === 1 &&\r\n            !currentShapeData.name.startsWith('Disque')\r\n          ) {\r\n            const { LineShape } = await import(\r\n              '../controllers/Core/Objects/Shapes/LineShape'\r\n            );\r\n            LineShape.loadFromData(currentShapeData);\r\n          } else {\r\n            const { RegularShape } = await import(\r\n              '../controllers/Core/Objects/Shapes/RegularShape'\r\n            );\r\n            RegularShape.loadFromData(currentShapeData);\r\n          }\r\n        }\r\n      }\r\n      segmentsData.forEach((segmentData) => {\r\n        if (isFinite(segmentData.indexOfReference)) {\r\n          segmentData = app.history.steps[\r\n            segmentData.indexOfReference\r\n          ].objects.segmentsData.find((seg) => seg.id === segmentData.id);\r\n        }\r\n        Segment.loadFromData(segmentData);\r\n      });\r\n      pointsData.forEach((pointData) => {\r\n        if (isFinite(pointData.indexOfReference)) {\r\n          pointData = app.history.steps[\r\n            pointData.indexOfReference\r\n          ].objects.pointsData.find((pt) => pt.id === pointData.id);\r\n        }\r\n        Point.loadFromData(pointData);\r\n      });\r\n      this.redraw();\r\n    } else {\r\n      // Donn├®es pr├®sentes mais vides/partielles\r\n      this.redraw();\r\n    }\r\n  }\r\n\r\n  firstUpdated() {\r\n    this.canvas = this.shadowRoot.querySelector('canvas');\r\n    this.canvasName = this.id.substring(0, this.id.lastIndexOf('C'));\r\n    this.ctx = this.canvas.getContext('2d');\r\n    app[this.canvasName + 'CanvasLayer'] = this;\r\n\r\n    // ├ëmettre un ├®v├®nement quand le tangramCanvasLayer est pr├¬t\r\n    if (this.canvasName === 'tangram') {\r\n      window.dispatchEvent(new CustomEvent('tangram-canvas-ready'));\r\n    }\r\n\r\n    window.addEventListener(\r\n      'refresh' + capitalizeFirstLetter(this.canvasName),\r\n      () => {\r\n        this.redraw();\r\n      },\r\n    );\r\n\r\n    if (this.canvasName === 'upper') {\r\n      this.createListeners();\r\n      window.addEventListener('tool-updated', () => this.redraw());\r\n    } else if (this.canvasName === 'main') {\r\n      window.addEventListener('refresh', () => this.redraw());\r\n      window.addEventListener('tool-updated', () => this.redraw());\r\n    } else if (this.canvasName === 'grid') {\r\n      // window.addEventListener('settings-changed', () => this.redraw()); // Replaced by gridStore subscription\r\n      this.unsubscribeGridStore = gridStore.subscribe(() => this.redraw());\r\n\r\n      window.addEventListener('tool-changed', () => {\r\n        if (app.tool?.name === 'grid') {\r\n          if (app.environment.name === 'Cubes') {\r\n            const currentGridState = gridStore.getState();\r\n            if (\r\n              currentGridState.isVisible &&\r\n              currentGridState.gridType === 'vertical-triangle'\r\n            ) {\r\n              // Toggle off if it's the specific cube grid\r\n              gridStore.setGridType('none'); // This will also set isVisible to false\r\n              // gridStore.setGridSize(2); // Keep previous size or reset? Original code set to 2.\r\n            } else {\r\n              // Toggle on to vertical-triangle or switch to it\r\n              gridStore.setGridType('vertical-triangle'); // This will also set isVisible to true\r\n              gridStore.setGridSize(2); // Original code set size to 2 for cubes\r\n            }\r\n            // The old setState call that modified app.settings for grid is removed.\r\n            // History event dispatching:\r\n            if (!app.fullHistory.isRunning) {\r\n              window.dispatchEvent(\r\n                new CustomEvent('actions-executed', {\r\n                  detail: { name: 'Grille' }, // Or a more specific name if needed\r\n                }),\r\n              );\r\n            }\r\n          } else {\r\n            import('@components/popups/grid-popup');\r\n            createElem('grid-popup');\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    super.disconnectedCallback();\r\n\r\n    // Nettoyage des ressources et listeners\r\n    this.cleanupResources();\r\n\r\n    if (this.unsubscribeGridStore) {\r\n      this.unsubscribeGridStore();\r\n      this.unsubscribeGridStore = null;\r\n    }\r\n    // Consider removing other window event listeners if they were added uniquely for this instance\r\n    // and are not cleaned up automatically. For example, if 'refresh' + capitalizeFirstLetter(this.canvasName)\r\n    // was added with a bound function. For now, standard window listeners are usually fine.\r\n  }\r\n\r\n  /**\r\n   * Nettoyage complet des ressources pour ├®viter les fuites m├®moire\r\n   */\r\n  cleanupResources() {\r\n    // Annuler les requ├¬tes d'animation en attente\r\n    if (this._redrawRequestId) {\r\n      cancelAnimationFrame(this._redrawRequestId);\r\n      this._redrawRequestId = null;\r\n    }\r\n\r\n    // Nettoyer les tableaux d'objets\r\n    this.shapes = [];\r\n    this.segments = [];\r\n    this.points = [];\r\n    this.texts = [];\r\n    this.editingShapeIds = [];\r\n\r\n    // Nettoyer le contexte canvas si n├®cessaire\r\n    if (this.ctx) {\r\n      this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    }\r\n\r\n    // R├®initialiser les flags de performance\r\n    this._lastRedrawTime = 0;\r\n    this._pendingRedraw = false;\r\n  }\r\n\r\n  createListeners() {\r\n    this.canvas.addEventListener('click', (event) => {\r\n      if (app.fullHistory.isRunning) return;\r\n      const mousePos = this.getMousePos(event);\r\n      window.dispatchEvent(\r\n        new CustomEvent('mouse-coordinates-changed', {\r\n          detail: { mousePos: mousePos },\r\n        }),\r\n      );\r\n      if (\r\n        app.listenerCounter.objectSelected &&\r\n        'click' === app.workspace.selectionConstraints.eventType\r\n      )\r\n        SelectManager.selectObject(mousePos);\r\n      window.dispatchEvent(new CustomEvent('canvasClick'));\r\n    });\r\n\r\n    this.canvas.addEventListener('mousedown', (event) => {\r\n      if (app.fullHistory.isRunning) return;\r\n      const mousePos = this.getMousePos(event);\r\n\r\n      let mustExitFunction = false;\r\n\r\n      if (\r\n        app.workspace.lastKnownMouseClickTime &&\r\n        app.workspace.lastKnownMouseClickTime >\r\n          event.timeStamp - GRID_CONSTANTS.DOUBLE_CLICK_THRESHOLD &&\r\n        app.workspace.lastKnownMouseClickCoordinates.dist(mousePos) <\r\n          GRID_CONSTANTS.MOVEMENT_THRESHOLD_MOUSE\r\n      ) {\r\n        window.dispatchEvent(\r\n          new CustomEvent('show-notif', {\r\n            detail: {\r\n              message:\r\n                \"Double clic d├®tect├®, le deuxi├¿me clic n'a pas ├®t├® pris en compte.\",\r\n            },\r\n          }),\r\n        );\r\n        mustExitFunction = true;\r\n      }\r\n\r\n      window.dispatchEvent(\r\n        new CustomEvent('mouse-coordinates-changed', {\r\n          detail: { mousePos: mousePos },\r\n        }),\r\n      );\r\n      window.dispatchEvent(\r\n        new CustomEvent('mouse-click-changed', {\r\n          detail: { mousePos: mousePos },\r\n        }),\r\n      );\r\n\r\n      if (mustExitFunction) return;\r\n\r\n      if (\r\n        app.listenerCounter.objectSelected &&\r\n        'mousedown' === app.workspace.selectionConstraints.eventType\r\n      )\r\n        SelectManager.selectObject(mousePos);\r\n      this.pressPositionForLongPress = mousePos;\r\n      this.pressTimeoutId = window.setTimeout(\r\n        () => window.dispatchEvent(new CustomEvent('canvasLongPress')),\r\n        GRID_CONSTANTS.LONG_PRESS_DELAY,\r\n      );\r\n      window.dispatchEvent(new CustomEvent('canvasMouseDown'));\r\n    });\r\n\r\n    this.canvas.addEventListener('mouseup', (event) => {\r\n      if (app.fullHistory.isRunning) return;\r\n      const mousePos = this.getMousePos(event);\r\n      window.dispatchEvent(\r\n        new CustomEvent('mouse-coordinates-changed', {\r\n          detail: { mousePos: mousePos },\r\n        }),\r\n      );\r\n      window.clearTimeout(this.pressTimeoutId);\r\n      window.dispatchEvent(new CustomEvent('canvasMouseUp'));\r\n    });\r\n\r\n    this.canvas.addEventListener('mousemove', (event) => {\r\n      if (app.fullHistory.isRunning) return;\r\n      const mousePos = this.getMousePos(event);\r\n      window.dispatchEvent(\r\n        new CustomEvent('mouse-coordinates-changed', {\r\n          detail: { mousePos: mousePos },\r\n        }),\r\n      );\r\n      if (\r\n        this.pressPositionForLongPress?.dist(mousePos) >\r\n        GRID_CONSTANTS.MOVEMENT_THRESHOLD_MOUSE\r\n      )\r\n        window.clearTimeout(this.pressTimeoutId);\r\n      window.dispatchEvent(new CustomEvent('canvasMouseMove'));\r\n    });\r\n\r\n    this.canvas.addEventListener('mouseout', (event) => {\r\n      event.preventDefault();\r\n      if (app.fullHistory.isRunning) return;\r\n      const mousePos = this.getMousePos(event);\r\n      window.dispatchEvent(\r\n        new CustomEvent('mouse-coordinates-changed', {\r\n          detail: { mousePos: mousePos },\r\n        }),\r\n      );\r\n      window.dispatchEvent(new CustomEvent('canvasMouseUp'));\r\n    });\r\n\r\n    const handleWheel = (event) => {\r\n      event.preventDefault();\r\n      if (app.fullHistory.isRunning) return;\r\n      const mousePos = new Coordinates({\r\n        x: event.clientX - app.settings.mainMenuWidth,\r\n        y: event.clientY,\r\n      });\r\n      window.dispatchEvent(\r\n        new CustomEvent('mouse-coordinates-changed', {\r\n          detail: { mousePos: mousePos },\r\n        }),\r\n      );\r\n      let correctedDeltaY = event.deltaY;\r\n      if (event.deltaY > 0) {\r\n        correctedDeltaY = event.deltaY / 10 + 1;\r\n      } else if (event.deltaY < 0) {\r\n        correctedDeltaY = event.deltaY / 10 - 1;\r\n      }\r\n      const detail = {\r\n        deltaY: correctedDeltaY,\r\n      };\r\n      window.dispatchEvent(\r\n        new CustomEvent('canvasMouseWheel', { detail: detail }),\r\n      );\r\n    };\r\n\r\n    this.canvas.addEventListener('wheel', handleWheel);\r\n    this.canvas.addEventListener('touchstart', (event) => {\r\n      event.preventDefault();\r\n      if (app.fullHistory.isRunning) return;\r\n      const mousePos = this.getMousePos(event);\r\n      if (event.touches.length === 1)\r\n        window.dispatchEvent(\r\n          new CustomEvent('mouse-coordinates-changed', {\r\n            detail: { mousePos: mousePos },\r\n          }),\r\n        );\r\n      if (\r\n        app.listenerCounter.objectSelected &&\r\n        'mousedown' === app.workspace.selectionConstraints.eventType\r\n      )\r\n        SelectManager.selectObject(mousePos);\r\n      const detail = { touches: [] };\r\n      for (const touch of event.touches) {\r\n        detail.touches.push(\r\n          new Coordinates({\r\n            x: touch.clientX - app.settings.mainMenuWidth,\r\n            y: touch.clientY,\r\n          }),\r\n        );\r\n      }\r\n      this.pressPositionForLongPress = mousePos;\r\n      this.pressTimeoutId = window.setTimeout(\r\n        () => window.dispatchEvent(new CustomEvent('canvasLongPress')),\r\n        GRID_CONSTANTS.LONG_PRESS_DELAY,\r\n      );\r\n      window.dispatchEvent(new CustomEvent('canvasMouseDown'));\r\n      window.dispatchEvent(\r\n        new CustomEvent('canvasTouchStart', { detail: detail }),\r\n      );\r\n    });\r\n\r\n    this.canvas.addEventListener(\r\n      'touchmove',\r\n      (event) => {\r\n        event.preventDefault();\r\n        if (app.fullHistory.isRunning) return;\r\n        const mousePos = this.getMousePos(event);\r\n        if (event.touches.length === 1)\r\n          window.dispatchEvent(\r\n            new CustomEvent('mouse-coordinates-changed', {\r\n              detail: { mousePos: mousePos },\r\n            }),\r\n          );\r\n        const detail = { touches: [] };\r\n        for (const touch of event.touches) {\r\n          detail.touches.push(\r\n            new Coordinates({\r\n              x: touch.clientX - app.settings.mainMenuWidth,\r\n              y: touch.clientY,\r\n            }),\r\n          );\r\n        }\r\n        if (this.isOutsideOfCanvas(mousePos)) {\r\n          event.stopPropagation();\r\n          window.clearTimeout(this.pressTimeoutId);\r\n          window.dispatchEvent(new CustomEvent('canvasMouseUp'));\r\n          window.dispatchEvent(\r\n            new CustomEvent('canvasTouchEnd', { detail: detail }),\r\n          );\r\n          return;\r\n        }\r\n        if (\r\n          this.pressPositionForLongPress?.dist(mousePos) >\r\n          GRID_CONSTANTS.MOVEMENT_THRESHOLD_TOUCH\r\n        )\r\n          window.clearTimeout(this.pressTimeoutId);\r\n        window.dispatchEvent(new CustomEvent('canvasMouseMove'));\r\n        window.dispatchEvent(\r\n          new CustomEvent('canvasTouchMove', { detail: detail }),\r\n        );\r\n      },\r\n      false,\r\n    );\r\n\r\n    this.canvas.addEventListener('touchend', (event) => {\r\n      event.preventDefault();\r\n      if (app.fullHistory.isRunning) return;\r\n      const mousePos = this.getMousePos(event);\r\n      if (event.touches.length === 1)\r\n        window.dispatchEvent(\r\n          new CustomEvent('mouse-coordinates-changed', {\r\n            detail: { mousePos: mousePos },\r\n          }),\r\n        );\r\n      if (\r\n        app.listenerCounter.objectSelected &&\r\n        'click' === app.workspace.selectionConstraints.eventType\r\n      )\r\n        SelectManager.selectObject(mousePos);\r\n      const detail = { touches: [] };\r\n      for (const touch of event.changedTouches) {\r\n        detail.touches.push(\r\n          new Coordinates({\r\n            x: touch.clientX - app.settings.mainMenuWidth,\r\n            y: touch.clientY,\r\n          }),\r\n        );\r\n      }\r\n      window.clearTimeout(this.pressTimeoutId);\r\n      window.dispatchEvent(new CustomEvent('canvasMouseUp'));\r\n      window.dispatchEvent(new CustomEvent('canvasClick'));\r\n      window.dispatchEvent(\r\n        new CustomEvent('canvasTouchEnd', { detail: detail }),\r\n      );\r\n    });\r\n\r\n    this.canvas.addEventListener('touchcancel', (event) => {\r\n      event.preventDefault();\r\n      if (app.fullHistory.isRunning) return;\r\n      const mousePos = this.getMousePos(event);\r\n      window.dispatchEvent(\r\n        new CustomEvent('mouse-coordinates-changed', {\r\n          detail: { mousePos: mousePos },\r\n        }),\r\n      );\r\n      if (\r\n        app.listenerCounter.objectSelected &&\r\n        'click' === app.workspace.selectionConstraints.eventType\r\n      )\r\n        SelectManager.selectObject(mousePos);\r\n\r\n      const detail = { touches: [] };\r\n      for (const touch of event.changedTouches) {\r\n        detail.touches.push(\r\n          new Coordinates({\r\n            x: touch.clientX - app.settings.mainMenuWidth,\r\n            y: touch.clientY,\r\n          }),\r\n        );\r\n      }\r\n      window.clearTimeout(this.pressTimeoutId);\r\n      window.dispatchEvent(new CustomEvent('canvasMouseUp'));\r\n      window.dispatchEvent(new CustomEvent('canvasClick'));\r\n      window.dispatchEvent(\r\n        new CustomEvent('canvastouchcancel', { detail: detail }),\r\n      );\r\n    });\r\n  }\r\n\r\n  getMousePos(event) {\r\n    let response = Coordinates.nullCoordinates;\r\n\r\n    if (\r\n      event.changedTouches &&\r\n      event.changedTouches[0] &&\r\n      event.changedTouches[0].clientX !== undefined\r\n    ) {\r\n      response.x = event.changedTouches[0].clientX - app.settings.mainMenuWidth;\r\n      response.y = event.changedTouches[0].clientY;\r\n    } else if (event.offsetX !== undefined) {\r\n      response.x = event.offsetX;\r\n      response.y = event.offsetY;\r\n    } else if (event.layerX !== undefined) {\r\n      response.x = event.layerX;\r\n      response.y = event.layerY;\r\n    } else if (event.clientX !== undefined) {\r\n      response.x = event.clientX;\r\n      response.y = event.clientY;\r\n    } else if (event.pageX !== undefined) {\r\n      response.x = event.pageX;\r\n      response.y = event.pageY;\r\n    } else if (event.x !== undefined) {\r\n      response.x = event.x;\r\n      response.y = event.y;\r\n    } else {\r\n      console.error('Navigator not compatible - unable to get mouse position');\r\n      let str = event.type;\r\n      for (const property1 in event) {\r\n        str += ' | ' + property1 + ' : ' + event[property1];\r\n      }\r\n      console.error('Event details:', str);\r\n\r\n      if (event.touches) {\r\n        str = 'touches: ' + event.touches.length + '';\r\n        for (const property1 in event['touches'][0]) {\r\n          str += ' | ' + property1 + ' : ' + ['touches'][0][property1];\r\n        }\r\n        console.error('Touch details:', str);\r\n      }\r\n      return null;\r\n    }\r\n\r\n    response = response.fromCanvasCoordinates();\r\n    return response;\r\n  }\r\n\r\n  isOutsideOfCanvas(mousePos) {\r\n    mousePos = mousePos.toCanvasCoordinates();\r\n    if (mousePos.x < 0 || mousePos.y < 0) return true;\r\n    if (mousePos.x > app.canvasWidth || mousePos.y > app.canvasHeight)\r\n      return true;\r\n    if (app.workspace.limited && mousePos.x > app.canvasWidth / 2 - 16)\r\n      return true;\r\n    return false;\r\n  }\r\n\r\n  drawGridPoints() {\r\n    const ctx = this.canvas.getContext('2d');\r\n    if (!ctx) {\r\n      // console.warn(\"drawGridPoints: context is not available\");\r\n      return;\r\n    }\r\n\r\n    const gridState = gridStore.getState();\r\n    const canvasWidth = app.canvasWidth;\r\n    const canvasHeight = app.canvasHeight;\r\n\r\n    ctx.clearRect(0, 0, canvasWidth, canvasHeight);\r\n\r\n    if (!gridState.isVisible || gridState.gridType === 'none') {\r\n      return;\r\n    }\r\n\r\n    let zoomLevel = app.workspace.zoomLevel;\r\n    if (\r\n      typeof zoomLevel !== 'number' ||\r\n      !isFinite(zoomLevel) ||\r\n      zoomLevel <= 0\r\n    ) {\r\n      zoomLevel = 1.0;\r\n    }\r\n\r\n    const gridSize = gridState.gridSize; // in cm\r\n    const baseGridStep = gridSize * GRID_CONSTANTS.PIXELS_PER_CM; // Pas de grille en espace monde\r\n\r\n    // Utiliser la m├¬me transformation que toCanvasCoordinates pour la coh├®rence\r\n    const translateOffset =\r\n      app.workspace.translateOffset || new Coordinates({ x: 0, y: 0 });\r\n    const offsetX =\r\n      translateOffset && typeof translateOffset.x === 'number'\r\n        ? translateOffset.x\r\n        : 0;\r\n    const offsetY =\r\n      translateOffset && typeof translateOffset.y === 'number'\r\n        ? translateOffset.y\r\n        : 0;\r\n\r\n    const pointRadius = 2 * zoomLevel;\r\n\r\n    ctx.fillStyle = gridState.gridColor || '#888888';\r\n\r\n    const drawPointAt = (worldX, worldY) => {\r\n      // Appliquer la m├¬me transformation que toCanvasCoordinates()\r\n      const canvasX = worldX * zoomLevel + offsetX;\r\n      const canvasY = worldY * zoomLevel + offsetY;\r\n\r\n      // V├®rifier que le point est visible sur le canvas\r\n      if (\r\n        canvasX >= -pointRadius &&\r\n        canvasX <= canvasWidth + pointRadius &&\r\n        canvasY >= -pointRadius &&\r\n        canvasY <= canvasHeight + pointRadius\r\n      ) {\r\n        ctx.beginPath();\r\n        ctx.arc(canvasX, canvasY, pointRadius, 0, 2 * Math.PI);\r\n        ctx.fill();\r\n      }\r\n    };\r\n\r\n    // Calculer la zone visible en espace monde pour optimiser le rendu\r\n    const worldVisibleLeft = -offsetX / zoomLevel;\r\n    const worldVisibleTop = -offsetY / zoomLevel;\r\n    const worldVisibleRight = (canvasWidth - offsetX) / zoomLevel;\r\n    const worldVisibleBottom = (canvasHeight - offsetY) / zoomLevel;\r\n\r\n    if (gridState.gridType === 'square') {\r\n      const startX = Math.floor(worldVisibleLeft / baseGridStep) * baseGridStep;\r\n      const startY = Math.floor(worldVisibleTop / baseGridStep) * baseGridStep;\r\n\r\n      for (\r\n        let x = startX;\r\n        x <= worldVisibleRight + baseGridStep;\r\n        x += baseGridStep\r\n      ) {\r\n        for (\r\n          let y = startY;\r\n          y <= worldVisibleBottom + baseGridStep;\r\n          y += baseGridStep\r\n        ) {\r\n          drawPointAt(x, y);\r\n        }\r\n      }\r\n    } else if (gridState.gridType === 'vertical-lines') {\r\n      const startX = Math.floor(worldVisibleLeft / baseGridStep) * baseGridStep;\r\n      const startY = Math.floor(worldVisibleTop / baseGridStep) * baseGridStep;\r\n\r\n      for (\r\n        let y = startY;\r\n        y <= worldVisibleBottom + baseGridStep;\r\n        y += baseGridStep\r\n      ) {\r\n        drawPointAt(startX, y);\r\n      }\r\n    } else if (gridState.gridType === 'horizontal-lines') {\r\n      const startX = Math.floor(worldVisibleLeft / baseGridStep) * baseGridStep;\r\n      const startY = Math.floor(worldVisibleTop / baseGridStep) * baseGridStep;\r\n\r\n      for (\r\n        let x = startX;\r\n        x <= worldVisibleRight + baseGridStep;\r\n        x += baseGridStep\r\n      ) {\r\n        drawPointAt(x, startY);\r\n      }\r\n    } else if (gridState.gridType === 'horizontal-triangle') {\r\n      const triangleHeight = baseGridStep * (Math.sqrt(3) / 2);\r\n      const startY =\r\n        Math.floor(worldVisibleTop / triangleHeight) * triangleHeight;\r\n\r\n      for (\r\n        let y = startY, row = Math.floor(startY / triangleHeight);\r\n        y <= worldVisibleBottom + triangleHeight;\r\n        y += triangleHeight, row++\r\n      ) {\r\n        const offsetX = row % 2 === 0 ? 0 : baseGridStep / 2;\r\n        const startX =\r\n          Math.floor((worldVisibleLeft - offsetX) / baseGridStep) *\r\n            baseGridStep +\r\n          offsetX;\r\n\r\n        for (\r\n          let x = startX;\r\n          x <= worldVisibleRight + baseGridStep;\r\n          x += baseGridStep\r\n        ) {\r\n          drawPointAt(x, y);\r\n        }\r\n      }\r\n    } else if (gridState.gridType === 'vertical-triangle') {\r\n      const horizontalStep = baseGridStep * (Math.sqrt(3) / 2);\r\n      const startX =\r\n        Math.floor(worldVisibleLeft / horizontalStep) * horizontalStep;\r\n\r\n      for (\r\n        let x = startX, col = Math.floor(startX / horizontalStep);\r\n        x <= worldVisibleRight + horizontalStep;\r\n        x += horizontalStep, col++\r\n      ) {\r\n        const offsetY = col % 2 === 0 ? 0 : baseGridStep / 2;\r\n        const startY =\r\n          Math.floor((worldVisibleTop - offsetY) / baseGridStep) *\r\n            baseGridStep +\r\n          offsetY;\r\n\r\n        for (\r\n          let y = startY;\r\n          y <= worldVisibleBottom + baseGridStep;\r\n          y += baseGridStep\r\n        ) {\r\n          drawPointAt(x, y);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * R├®cup├¿re le point de la grille le plus proche d'une coordonn├®e donn├®e\r\n   * @param { Coordinates } checkingCoordinates Les coordonn├®es en espace canvas\r\n   * @return { Coordinates | undefined } Les coordonn├®es du point de la grille le plus proche en espace canvas ou undefined\r\n   * @example\r\n   * const closestPoint = canvas.getClosestGridPoint(new Coordinates({ x: 100, y: 200 }));\r\n   * if (closestPoint) {\r\n   *   // Utiliser le point pour snapper\r\n   * }\r\n   */\r\n  getClosestGridPoint(checkingCoordinates) {\r\n    if (\r\n      !checkingCoordinates ||\r\n      typeof checkingCoordinates.x !== 'number' ||\r\n      typeof checkingCoordinates.y !== 'number' ||\r\n      !isFinite(checkingCoordinates.x) ||\r\n      !isFinite(checkingCoordinates.y)\r\n    ) {\r\n      // console.warn(\"getClosestGridPoint: checkingCoordinates are invalid\", checkingCoordinates);\r\n      return undefined;\r\n    }\r\n\r\n    const gridState = gridStore.getState();\r\n    if (!gridState.isVisible || gridState.gridType === 'none') {\r\n      return undefined;\r\n    }\r\n\r\n    let zoomLevel = app.workspace.zoomLevel;\r\n    if (\r\n      typeof zoomLevel !== 'number' ||\r\n      !isFinite(zoomLevel) ||\r\n      zoomLevel <= 0\r\n    ) {\r\n      // console.warn(\"getClosestGridPoint: Invalid app.workspace.zoomLevel, defaulting to 1.0. Value:\", zoomLevel);\r\n      zoomLevel = 1.0;\r\n    }\r\n\r\n    const gridSize = gridState.gridSize; // en cm\r\n    const baseGridStep = gridSize * GRID_CONSTANTS.PIXELS_PER_CM; // Pas de grille en espace monde\r\n\r\n    // Convertir les coordonn├®es canvas en coordonn├®es monde (inverse de toCanvasCoordinates)\r\n    const translateOffset =\r\n      app.workspace.translateOffset || new Coordinates({ x: 0, y: 0 });\r\n    const offsetX =\r\n      translateOffset && typeof translateOffset.x === 'number'\r\n        ? translateOffset.x\r\n        : 0;\r\n    const offsetY =\r\n      translateOffset && typeof translateOffset.y === 'number'\r\n        ? translateOffset.y\r\n        : 0;\r\n\r\n    const worldX = (checkingCoordinates.x - offsetX) / zoomLevel;\r\n    const worldY = (checkingCoordinates.y - offsetY) / zoomLevel;\r\n\r\n    // Calcul direct du point de grille le plus proche en espace monde\r\n    let gridWorldX, gridWorldY;\r\n\r\n    if (gridState.gridType === 'square') {\r\n      gridWorldX = Math.round(worldX / baseGridStep) * baseGridStep;\r\n      gridWorldY = Math.round(worldY / baseGridStep) * baseGridStep;\r\n    } else if (gridState.gridType === 'vertical-lines') {\r\n      gridWorldX = Math.round(worldX / baseGridStep) * baseGridStep;\r\n      gridWorldY = worldY; // Pas de contrainte sur Y\r\n    } else if (gridState.gridType === 'horizontal-lines') {\r\n      gridWorldX = worldX; // Pas de contrainte sur X\r\n      gridWorldY = Math.round(worldY / baseGridStep) * baseGridStep;\r\n    } else if (gridState.gridType === 'horizontal-triangle') {\r\n      // Grille triangulaire verticale\r\n      const triangleHeight = baseGridStep * (Math.sqrt(3) / 2);\r\n\r\n      // Trouver la rang├®e la plus proche\r\n      const row = Math.round(worldY / triangleHeight);\r\n      gridWorldY = row * triangleHeight;\r\n\r\n      // Calculer le d├®calage X pour cette rang├®e\r\n      const offsetX = row % 2 === 0 ? 0 : baseGridStep / 2;\r\n\r\n      // Trouver la colonne la plus proche en tenant compte du d├®calage\r\n      const adjustedX = worldX - offsetX;\r\n      const col = Math.round(adjustedX / baseGridStep);\r\n      gridWorldX = col * baseGridStep + offsetX;\r\n    } else if (gridState.gridType === 'vertical-triangle') {\r\n      // Grille triangulaire horizontale\r\n      const horizontalStep = baseGridStep * (Math.sqrt(3) / 2);\r\n\r\n      // Trouver la colonne la plus proche\r\n      const col = Math.round(worldX / horizontalStep);\r\n      gridWorldX = col * horizontalStep;\r\n\r\n      // Calculer le d├®calage Y pour cette colonne\r\n      const offsetY = col % 2 === 0 ? 0 : baseGridStep / 2;\r\n\r\n      // Trouver la rang├®e la plus proche en tenant compte du d├®calage\r\n      const adjustedY = worldY - offsetY;\r\n      const row = Math.round(adjustedY / baseGridStep);\r\n      gridWorldY = row * baseGridStep + offsetY;\r\n    } else {\r\n      return undefined; // Type de grille non support├®\r\n    }\r\n\r\n    // Convertir le r├®sultat de l'espace monde vers l'espace canvas (comme toCanvasCoordinates)\r\n    const canvasX = gridWorldX * zoomLevel + offsetX;\r\n    const canvasY = gridWorldY * zoomLevel + offsetY;\r\n\r\n    return new Coordinates({ x: canvasX, y: canvasY });\r\n  }\r\n\r\n  updateVisiblePart(forced = false) {\r\n    if (!this.canvas) return;\r\n\r\n    // Validate scale\r\n    if (\r\n      typeof this.scale !== 'number' ||\r\n      !isFinite(this.scale) ||\r\n      this.scale <= 0.00001\r\n    ) {\r\n      this.scale = 1.0;\r\n    }\r\n\r\n    // Validate canvas dimensions\r\n    const canvasWidth =\r\n      typeof this.canvas.width === 'number' && isFinite(this.canvas.width)\r\n        ? this.canvas.width\r\n        : 0;\r\n    const canvasHeight =\r\n      typeof this.canvas.height === 'number' && isFinite(this.canvas.height)\r\n        ? this.canvas.height\r\n        : 0;\r\n\r\n    const newX = Math.floor(this.xOffset / this.scale);\r\n    const newY = Math.floor(this.yOffset / this.scale);\r\n    const newWidth = Math.ceil(canvasWidth / this.scale);\r\n    const newHeight = Math.ceil(canvasHeight / this.scale);\r\n\r\n    // Only update if there is a change or if forced\r\n    if (\r\n      forced ||\r\n      this.canvasVisibleLeft !== newX ||\r\n      this.canvasVisibleTop !== newY ||\r\n      this.canvasVisibleWidth !== newWidth ||\r\n      this.canvasVisibleHeight !== newHeight\r\n    ) {\r\n      this.canvasVisibleLeft = newX;\r\n      this.canvasVisibleTop = newY;\r\n      this.canvasVisibleWidth = newWidth;\r\n      this.canvasVisibleHeight = newHeight;\r\n      // console.log('Visible part updated:', this.canvasVisibleLeft, this.canvasVisibleTop, this.canvasVisibleWidth, this.canvasVisibleHeight);\r\n    }\r\n  }\r\n\r\n  drawShape(shape, scaling) {\r\n    shape.setCtxForDrawing(this.ctx, scaling);\r\n    this.ctx.miterLimit = 1;\r\n\r\n    let pathScaleMethod = this.mustScaleShapes ? 'scale' : 'no scale',\r\n      path = new Path2D(shape.getSVGPath(pathScaleMethod, true, false, true));\r\n    if (shape.drawHidden) {\r\n      const canvasPattern = document.createElement('canvas');\r\n      canvasPattern.width = 10;\r\n      canvasPattern.height = 10;\r\n      const contextPattern = canvasPattern.getContext('2d');\r\n      const path = new Path2D(\r\n        `M 5 0 L 10 5 L 10 10 L 0 0 L 5 0 M 0 5 L 5 10 L 0 10 L 0 5`,\r\n      );\r\n      contextPattern.fillStyle = this.ctx.fillStyle;\r\n      contextPattern.fill(path);\r\n\r\n      const pattern = this.ctx.createPattern(canvasPattern, 'repeat');\r\n      canvasPattern.remove();\r\n\r\n      this.ctx.fillStyle = pattern;\r\n    }\r\n    this.ctx.fill(path, 'nonzero');\r\n\r\n    path = new Path2D(shape.getSVGPath(pathScaleMethod, true, true));\r\n    this.ctx.globalAlpha = 1;\r\n\r\n    if (shape.drawHidden) {\r\n      this.ctx.setLineDash([5, 15]);\r\n    }\r\n    if (shape.segments.some((seg) => seg.color !== undefined)) {\r\n      shape.segments.forEach((seg) => {\r\n        const path = new Path2D(seg.getSVGPath(pathScaleMethod, true));\r\n        this.ctx.strokeStyle = seg.color ? seg.color : shape.strokeColor;\r\n        if (seg.width !== 1) this.ctx.lineWidth = seg.width;\r\n        this.ctx.stroke(path);\r\n        this.ctx.lineWidth = shape.strokeWidth;\r\n      });\r\n    } else this.ctx.stroke(path);\r\n    this.ctx.setLineDash([]);\r\n  }\r\n\r\n  drawPoint(point, justForAgrumentCount, doSave = true) {\r\n    if (point.geometryIsVisible === false || point.geometryIsHidden === true)\r\n      return;\r\n    if (doSave) this.ctx.save();\r\n\r\n    this.ctx.fillStyle = point.color;\r\n    this.ctx.globalAlpha = 1;\r\n\r\n    const canvasCoordinates = point.coordinates.toCanvasCoordinates();\r\n    this.ctx.beginPath();\r\n    this.ctx.arc(\r\n      canvasCoordinates.x,\r\n      canvasCoordinates.y,\r\n      point.size * 2, // Coordonn├®es d├®j├á converties par toCanvasCoordinates()\r\n      0,\r\n      2 * Math.PI,\r\n      0,\r\n    );\r\n    this.ctx.closePath();\r\n    this.ctx.fill();\r\n\r\n    if (doSave) this.ctx.restore();\r\n  }\r\n\r\n  drawText(text, doSave = true) {\r\n    if (doSave) this.ctx.save();\r\n\r\n    const fontSize = 20;\r\n    let position = text.coordinates.add({\r\n      x:\r\n        (((-3 * fontSize) / 13) * text.message.length) /\r\n        app.workspace.zoomLevel,\r\n      y: fontSize / 2 / app.workspace.zoomLevel,\r\n    });\r\n    position = position.toCanvasCoordinates();\r\n\r\n    this.ctx.fillStyle = text.color;\r\n    this.ctx.font = fontSize + 'px Arial';\r\n    this.ctx.fillText(text.message, position.x, position.y);\r\n\r\n    if (doSave) this.ctx.restore();\r\n  }\r\n}\r\ncustomElements.define('canvas-layer', CanvasLayer);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\components\\color-button.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\components\\flex-grid.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\components\\icon-button.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\components\\loading-elem.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\components\\popups\\file-elem.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\components\\popups\\grid-popup.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":106,"column":44,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":106,"endColumn":46,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3481,3483],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":110,"column":62,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":110,"endColumn":64,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3629,3631],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":113,"column":60,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":113,"endColumn":62,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3745,3747],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":114,"column":60,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":114,"endColumn":62,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3823,3825],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":115,"column":60,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":115,"endColumn":62,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3901,3903],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import '@components/color-button';\r\nimport { app } from '@controllers/Core/App.js';\r\nimport { gridStore } from '@store/gridStore';\r\nimport { LitElement, css, html } from 'lit';\r\nimport { TemplatePopup } from './template-popup';\r\n\r\nclass GridPopup extends LitElement {\r\n  static properties = {\r\n    gridShown: Boolean,\r\n    gridType: String,\r\n    gridSize: Number,\r\n  };\r\n\r\n  static styles = [\r\n    TemplatePopup.template_popup_styles(),\r\n    css`\r\n      .field {\r\n        display: grid;\r\n        grid-template-columns: 1fr 1fr;\r\n        text-align: left;\r\n      }\r\n      label {\r\n        margin: 0;\r\n      }\r\n    `,\r\n  ];\r\n\r\n  constructor() {\r\n    super();\r\n    // Initialiser les propri├®t├®s ├á partir du store\r\n    const storeState = gridStore.getState();\r\n    this.gridType = storeState.gridType;\r\n    this.gridSize = storeState.gridSize;\r\n    // gridShown n'est plus une propri├®t├® directe du store, mais d├®riv├®e de isVisible et gridType\r\n    this.gridShown = storeState.isVisible && storeState.gridType !== 'none';\r\n    this._unsubscribe = null;\r\n  }\r\n\r\n  connectedCallback() {\r\n    super.connectedCallback();\r\n    this._unsubscribe = gridStore.subscribe((state) => {\r\n      this.gridType = state.gridType;\r\n      this.gridSize = state.gridSize;\r\n      this.gridShown = state.isVisible && state.gridType !== 'none';\r\n      // requestUpdate est implicitement appel├® par LitElement lors de la modification des propri├®t├®s d├®clar├®es\r\n    });\r\n    // Initialiser l'├®tat une fois connect├®, au cas o├╣ il aurait chang├® entre le constructeur et la connexion\r\n    const currentState = gridStore.getState();\r\n    this.gridType = currentState.gridType;\r\n    this.gridSize = currentState.gridSize;\r\n    this.gridShown = currentState.isVisible && currentState.gridType !== 'none';\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    if (this._unsubscribe) {\r\n      this._unsubscribe();\r\n    }\r\n    super.disconnectedCallback();\r\n  }\r\n\r\n  render() {\r\n    return html`\r\n      <template-popup>\r\n        <h2 slot=\"title\">Grille</h2>\r\n        <div slot=\"body\" id=\"body\">\r\n          <div class=\"field\">\r\n            <label for=\"grid_popup_grid_type\">Type de grille </label>\r\n            <select\r\n              name=\"grid_popup_grid_type\"\r\n              id=\"grid_popup_grid_type\"\r\n              @change=\"${this._actionHandle}\"\r\n            >\r\n              <option value=\"none\" ?selected=\"${this.gridType === 'none'}\">\r\n                Aucune\r\n              </option>\r\n              <option value=\"square\" ?selected=${this.gridType === 'square'}>\r\n                Carr├®s\r\n              </option>\r\n              <option\r\n                value=\"horizontal-triangle\"\r\n                ?selected=${this.gridType === 'horizontal-triangle'}\r\n              >\r\n                Triangles 1\r\n              </option>\r\n              <option\r\n                value=\"vertical-triangle\"\r\n                ?selected=${this.gridType === 'vertical-triangle'}\r\n              >\r\n                Triangles 2\r\n              </option>\r\n            </select>\r\n          </div>\r\n\r\n          <br />\r\n\r\n          <div class=\"field\">\r\n            <label for=\"grid_popup_grid_size\">Taille de la grille </label>\r\n            <select\r\n              name=\"grid_popup_grid_size\"\r\n              id=\"grid_popup_grid_size\"\r\n              @change=\"${this._actionHandle}\"\r\n              ?disabled=\"${this.gridType === 'none'}\"\r\n            >\r\n              <option\r\n                value=\"0.333333333333333\"\r\n                ?selected=\"${this.gridSize == 0.333333333333333}\"\r\n              >\r\n                1/3\r\n              </option>\r\n              <option value=\"0.5\" ?selected=\"${this.gridSize == 0.5}\">\r\n                1/2\r\n              </option>\r\n              <option value=\"1\" ?selected=\"${this.gridSize == 1}\">1</option>\r\n              <option value=\"2\" ?selected=\"${this.gridSize == 2}\">2</option>\r\n              <option value=\"3\" ?selected=\"${this.gridSize == 3}\">3</option>\r\n            </select>\r\n          </div>\r\n        </div>\r\n\r\n        <div slot=\"footer\">\r\n          <color-button\r\n            @click=\"${() =>\r\n              window.dispatchEvent(new CustomEvent('close-popup'))}\"\r\n            innerText=\"Ok\"\r\n          ></color-button>\r\n        </div>\r\n      </template-popup>\r\n    `;\r\n  }\r\n\r\n  firstUpdated() {\r\n    window.addEventListener(\r\n      'close-popup',\r\n      () => {\r\n        this.submitAndClose();\r\n      },\r\n      { once: true },\r\n    );\r\n    // window.addEventListener('settings-changed', this.updateProperties.bind(this)); // Supprim├®\r\n  }\r\n\r\n  submit() {\r\n    // setState({ tool: null }); // Sera g├®r├® diff├®remment ou supprim├® si plus pertinent\r\n  }\r\n\r\n  close() {\r\n    this.remove();\r\n    // window.removeEventListener('settings-changed', this.eventHandler); // Supprim├® (eventHandler n'existe pas, probablement une typo pour updateProperties)\r\n  }\r\n\r\n  submitAndClose() {\r\n    this.submit();\r\n    this.close();\r\n    if (!app.fullHistory.isRunning) {\r\n      window.dispatchEvent(\r\n        new CustomEvent('actions-executed', { detail: { name: 'Grille' } }),\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * event handler principal\r\n   */\r\n  _actionHandle(event) {\r\n    switch (event.target.name) {\r\n      case 'grid_popup_grid_type':\r\n        // setState remplac├® par l'action du store\r\n        gridStore.setGridType(event.target.value);\r\n        // La logique de gridShown est maintenant g├®r├®e par le store via setGridType\r\n        // setState({\r\n        //   settings: {\r\n        //     ...app.settings,\r\n        //     gridType: event.target.value,\r\n        //     gridShown: event.target.value !== 'none',\r\n        //   },\r\n        // });\r\n        break;\r\n\r\n      case 'grid_popup_grid_size':\r\n        // setState remplac├® par l'action du store\r\n        gridStore.setGridSize(parseFloat(event.target.value));\r\n        // setState({\r\n        //   settings: {\r\n        //     ...app.settings,\r\n        //     gridSize: event.target.value,\r\n        //   },\r\n        // });\r\n        break;\r\n\r\n      default:\r\n        console.error(\r\n          'Grid popup: param├¿tre inconnu: ' +\r\n            event.target.name +\r\n            ' ' +\r\n            event.target.value +\r\n            ' ' +\r\n            event.target.checked,\r\n        );\r\n    }\r\n  }\r\n}\r\ncustomElements.define('grid-popup', GridPopup);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\components\\popups\\help-popup.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":42,"column":39,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":42,"endColumn":41,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1140,1142],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":53,"column":21,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":53,"endColumn":23,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1481,1483],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":53,"column":47,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":53,"endColumn":49,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[1507,1509],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":55,"column":39,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":55,"endColumn":41,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[1624,1626],"text":"!=="},"desc":"Use '!==' instead of '!='."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import '@components/color-button';\r\nimport { app } from '@controllers/Core/App';\r\nimport { css, html, LitElement } from 'lit';\r\nimport { tools } from '../../store/tools';\r\nimport { TemplatePopup } from './template-popup';\r\n\r\nclass HelpPopup extends LitElement {\r\n  static properties = {\r\n    content: String,\r\n    toolname: String,\r\n  };\r\n\r\n  static styles = [\r\n    TemplatePopup.template_popup_styles(),\r\n    css`\r\n      :host {\r\n        -webkit-touch-callout: text; /* iOS Safari */\r\n        -webkit-user-select: text; /* Safari */\r\n        -khtml-user-select: text; /* Konqueror HTML */\r\n        -moz-user-select: text; /* Old versions of Firefox */\r\n        -ms-user-select: text; /* Internet Explorer/Edge */\r\n        user-select: text;\r\n      }\r\n      div#helpPopupBody {\r\n        max-width: 70dvw;\r\n        max-height: 70dvh;\r\n      }\r\n\r\n      img {\r\n        width: 100%;\r\n        background-color: rgba(255, 255, 255, 0.5);\r\n      }\r\n    `,\r\n  ];\r\n\r\n  async firstUpdated() {\r\n    window.addEventListener('close-popup', () => this.close());\r\n  }\r\n\r\n  render() {\r\n    const tool = this.toolname\r\n      ? this.tools.find((t) => t.name == this.toolname)\r\n      : undefined;\r\n    let url = '';\r\n    let titleSuffix = '';\r\n    let altText = 'Aide'; // Valeur par d├®faut\r\n\r\n    if (tool) {\r\n      titleSuffix = ' - ' + tool.title;\r\n      altText = `Aide de ${tool.title}`; // altText sp├®cifique si tool est trouv├®\r\n\r\n      // Logique de construction de l'URL\r\n      if (tool.type == undefined && tool.name != 'create') {\r\n        url = `images/help/OutilsGeneraux/${tool.name}.webp`;\r\n      } else if (app.environment.name != 'Geometrie') {\r\n        // Utiliser tool.name ici car this.toolname pourrait ├¬tre juste le nom,\r\n        // et on a d├®j├á confirm├® que 'tool' existe.\r\n        url = `images/help/${app.environment.name}/${tool.name}.webp`;\r\n      }\r\n      // Si aucune des conditions ci-dessus n'est remplie (par exemple, tool.type est d├®fini ET app.environment.name EST \"Geometrie\"),\r\n      // alors l'URL restera vide, ce qui est le comportement souhait├® pour afficher le message de fallback.\r\n    } else if (this.toolname) {\r\n      // Cas o├╣ toolname est fourni mais l'outil n'est pas trouv├® dans this.tools\r\n      // titleSuffix reste '', url reste ''\r\n      altText = `Aide pour ${this.toolname}`; // altText g├®n├®rique si toolname est fourni mais tool non trouv├®\r\n    }\r\n    // Si this.toolname n'est pas fourni du tout, tool est undefined.\r\n    // titleSuffix reste '', url reste '', altText reste 'Aide' (valeur par d├®faut initiale).\r\n\r\n    return html`\r\n      <template-popup>\r\n        <h2 slot=\"title\">Aide${titleSuffix}</h2>\r\n        <div id=\"helpPopupBody\" slot=\"body\">\r\n          ${url\r\n            ? html`<img src=\"${url}\" alt=\"${altText}\" />` // Utiliser la variable altText mise ├á jour\r\n            : html`<div>\r\n                L'aide n'est pas encore disponible pour cette fonction.\r\n              </div>`}\r\n        </div>\r\n        <div slot=\"footer\">\r\n          <color-button @click=\"${() => this.close()}\">Ok</color-button>\r\n        </div>\r\n      </template-popup>\r\n    `;\r\n  }\r\n\r\n  get tools() {\r\n    return [\r\n      ...tools.get(),\r\n      { name: 'home', title: 'Accueil' },\r\n      { name: 'save', title: 'Enregistrer' },\r\n      { name: 'open', title: 'Ouvrir' },\r\n      { name: 'settings', title: 'Param├¿tres' },\r\n      { name: 'undo', title: 'Annuler-refaire' },\r\n      { name: 'redo', title: 'Annuler-refaire' },\r\n      { name: 'replay', title: 'Rejouer' },\r\n    ];\r\n  }\r\n\r\n  close() {\r\n    this.remove();\r\n  }\r\n}\r\ncustomElements.define('help-popup', HelpPopup);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\components\\popups\\home-popup.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\components\\popups\\module-elem.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\components\\popups\\notification.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\components\\popups\\open-popup.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\components\\popups\\open-server-popup.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'OpenServerPopup' is defined but never used. Allowed unused vars must match /^_/u.","line":29,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":29,"endColumn":22,"suggestions":[{"messageId":"removeVar","data":{"varName":"OpenServerPopup"},"fix":{"range":[743,13074],"text":""},"desc":"Remove unused variable 'OpenServerPopup'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'OpenServerPopup' is defined but never used. Allowed unused vars must match /^_/u.","line":29,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import '@components/color-button';\nimport '@components/popups/template-popup';\nimport { LitElement, css, html } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport {\n  downloadFileZip,\n  findAllFiles,\n  findAllThemes,\n} from '../../firebase/firebase-init';\nimport { getLastSyncInfo } from '../../services/activity-sync.js';\nimport { cachedThemes, selectedSequence } from '../../store/notions';\nimport { syncInProgress } from '../../store/syncState.js';\nimport {\n  OptimizedSignalController,\n  debounce,\n  throttle,\n} from '../../utils/signal-observer.js';\nimport './sync-settings-popup';\nimport './theme-elem';\n\n// D├®claration pour le mode debug\ndeclare global {\n  interface Window {\n    dev_mode?: boolean;\n  }\n}\n\n@customElement('open-server-popup')\nclass OpenServerPopup extends LitElement {\n  private signalController = new OptimizedSignalController(this);\n\n  @property({ type: Array }) allThemes = [];\n  @property({ type: Boolean }) isDownloading = false;\n  @property({ type: String }) errorMessage = '';\n  @property({ type: String }) successMessage = '';\n  @property({ type: Object }) lastSyncInfo = null;\n  @property({ type: Boolean }) isLoadingThemes = false;\n  @property({ type: Boolean }) showSyncSettings = false;\n\n  private debouncedDownload = debounce(this.downloadAllFiles.bind(this), 500);\n  private throttledLoadThemes = throttle(this.loadThemes.bind(this), 1000);\n\n  constructor() {\n    super();\n    window.addEventListener('close-popup', () => this.close());\n    this.loadSyncInfo();\n  }\n\n  async loadSyncInfo() {\n    try {\n      this.lastSyncInfo = await getLastSyncInfo();\n    } catch (error) {\n      console.warn(\n        'Erreur lors du chargement des informations de sync:',\n        error,\n      );\n    }\n  }\n\n  close() {\n    this.dispatchEvent(\n      new CustomEvent('closed', {\n        bubbles: true,\n        composed: true,\n      }),\n    );\n    if (this.parentNode) {\n      this.parentNode.removeChild(this);\n    }\n  }\n\n  openSyncSettings() {\n    this.showSyncSettings = true;\n  }\n\n  closeSyncSettings() {\n    this.showSyncSettings = false;\n  }\n\n  static styles = css`\n    .popup-content {\n      display: flex;\n      flex-direction: column;\n      gap: 12px;\n      width: 100%;\n      padding: 8px;\n      max-height: 70vh;\n      overflow: hidden;\n    }\n\n    .theme-list {\n      flex: 1;\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n      max-height: 50vh;\n      overflow-y: auto;\n      padding: 4px;\n    }\n\n    .loading-skeleton {\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n      padding: 16px;\n    }\n\n    .skeleton-line {\n      height: 20px;\n      background: linear-gradient(\n        90deg,\n        rgba(255, 255, 255, 0.1) 0%,\n        rgba(255, 255, 255, 0.2) 50%,\n        rgba(255, 255, 255, 0.1) 100%\n      );\n      border-radius: 4px;\n      animation: shimmer 1.5s infinite;\n    }\n\n    @keyframes shimmer {\n      0% {\n        background-position: -200px 0;\n      }\n      100% {\n        background-position: 200px 0;\n      }\n    }\n\n    .main-action color-button {\n      width: 100%;\n      min-height: 48px;\n      font-weight: 500;\n    }\n\n    .sync-status {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      gap: 8px;\n      font-size: 0.85em;\n      color: var(--theme-text-color, #222);\n      padding: 8px 12px;\n      background: var(--theme-color-soft, rgba(255, 255, 255, 0.05));\n      border-radius: 6px;\n    }\n\n    .sync-info {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    }\n\n    .settings-button {\n      background: var(--theme-color-soft, rgba(255, 255, 255, 0.1));\n      border: 1px solid var(--theme-color, rgba(255, 255, 255, 0.2));\n      color: var(--theme-text-color, #222);\n      border-radius: 4px;\n      width: 28px;\n      height: 28px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      cursor: pointer;\n      transition: all 0.2s ease;\n      font-size: 1em;\n      flex-shrink: 0;\n    }\n\n    .settings-button:hover {\n      background: rgba(255, 255, 255, 0.2);\n      color: white;\n      transform: scale(1.05);\n    }\n\n    .status-dot {\n      width: 8px;\n      height: 8px;\n      border-radius: 50%;\n    }\n\n    .status-dot.success {\n      background: #4caf50;\n    }\n    .status-dot.warning {\n      background: #ff9800;\n      animation: pulse 2s infinite;\n    }\n\n    @keyframes pulse {\n      0%,\n      100% {\n        opacity: 1;\n      }\n      50% {\n        opacity: 0.5;\n      }\n    }\n\n    .loading-indicator {\n      height: 4px;\n      background: linear-gradient(\n        90deg,\n        var(--theme-color, #4caf50) 0%,\n        rgba(76, 175, 80, 0.3) 50%,\n        var(--theme-color, #4caf50) 100%\n      );\n      border-radius: 2px;\n      animation: progress 2s infinite;\n    }\n\n    @keyframes progress {\n      0% {\n        opacity: 0.6;\n      }\n      50% {\n        opacity: 1;\n      }\n      100% {\n        opacity: 0.6;\n      }\n    }\n\n    .message {\n      padding: 8px 12px;\n      border-radius: 6px;\n      font-size: 0.9em;\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    }\n\n    .error-message {\n      color: #e74c3c;\n      background: rgba(231, 76, 60, 0.1);\n      border: 1px solid rgba(231, 76, 60, 0.2);\n    }\n\n    .success-message {\n      color: #2ecc71;\n      background: rgba(46, 204, 113, 0.1);\n      border: 1px solid rgba(46, 204, 113, 0.2);\n    }\n  `;\n\n  async loadThemes() {\n    try {\n      this.isLoadingThemes = true;\n      this.errorMessage = '';\n      this.successMessage = '';\n\n      if (cachedThemes.get() && cachedThemes.get().length > 0) {\n        this.allThemes = cachedThemes.get();\n        this.scrollToOpenModule();\n        return;\n      }\n\n      const themes = await findAllThemes();\n\n      this.allThemes = themes;\n\n      if (themes && themes.length > 0) {\n        cachedThemes.set(themes);\n        this.successMessage = `${themes.length} th├¿mes charg├®s`;\n      } else if (!navigator.onLine) {\n        this.errorMessage =\n          'Mode hors ligne - aucun th├¿me disponible dans le cache local';\n      } else {\n        this.errorMessage = 'Aucun th├¿me disponible';\n      }\n\n      this.scrollToOpenModule();\n    } catch (error) {\n      console.error('Erreur lors du chargement des th├¿mes:', error);\n      if (!navigator.onLine) {\n        this.errorMessage =\n          'Mode hors ligne - impossible de charger les th├¿mes.';\n      } else {\n        this.errorMessage = `Erreur lors du chargement des th├¿mes: ${error.message}`;\n      }\n    } finally {\n      this.isLoadingThemes = false;\n    }\n  }\n\n  scrollToOpenModule() {\n    setTimeout(() => {\n      const currentSequence = selectedSequence.get();\n      if (currentSequence) {\n        const moduleElement = this.shadowRoot?.querySelector(\n          `module-elem[title=\"${currentSequence}\"]`,\n        );\n        if (moduleElement) {\n          moduleElement.scrollIntoView({ behavior: 'smooth', block: 'center' });\n        }\n      }\n    }, 100);\n  }\n\n  setButtonState(selector: string, loading: boolean, disabled: boolean) {\n    const button = this.shadowRoot?.querySelector(selector) as any;\n    if (button) {\n      if (loading) {\n        button.setAttribute('loading', 'true');\n      } else {\n        button.removeAttribute('loading');\n      }\n      button.disabled = disabled;\n    }\n  }\n\n  async downloadAllFiles() {\n    if (this.isDownloading) {\n      console.warn('[DOWNLOAD] T├®l├®chargement d├®j├á en cours');\n      return;\n    }\n\n    try {\n      this.isDownloading = true;\n      this.errorMessage = '';\n      this.successMessage = '';\n\n      const { setSyncProgress, setSyncCompleted } = await import(\n        '../../store/syncState.js'\n      );\n      setSyncProgress(0);\n\n      const files = await findAllFiles();\n      if (files && files.length > 0) {\n        await downloadFileZip(\n          'tous_les_fichiers.zip',\n          files.map((file) => file.id),\n        );\n        this.successMessage = 'Ô£à T├®l├®chargement termin├®';\n        setSyncCompleted();\n      } else {\n        this.errorMessage = 'Aucun fichier disponible pour le t├®l├®chargement';\n        setSyncCompleted();\n      }\n    } catch (error) {\n      console.error('Erreur lors du t├®l├®chargement des fichiers:', error);\n      this.errorMessage = `Erreur lors du t├®l├®chargement: ${error.message}`;\n    } finally {\n      this.isDownloading = false;\n    }\n  }\n\n  async connectedCallback() {\n    super.connectedCallback();\n    await this.throttledLoadThemes();\n    this.addEventListener('state-changed', this.scrollToOpenModule);\n    // Focus automatique sur le bouton principal\n    setTimeout(() => {\n      const mainButton = this.shadowRoot?.querySelector('color-button');\n      if (mainButton && 'focus' in mainButton)\n        (mainButton as HTMLElement).focus();\n    }, 100);\n    // Listener Escape\n    window.addEventListener('keydown', this.handleEscape);\n    // Focus trap\n    this.shadowRoot?.addEventListener('keydown', this.handleFocusTrap);\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    this.removeEventListener('state-changed', this.scrollToOpenModule);\n    window.removeEventListener('keydown', this.handleEscape);\n    this.shadowRoot?.removeEventListener('keydown', this.handleFocusTrap);\n  }\n  // Fermeture via Escape\n  handleEscape = (e: KeyboardEvent) => {\n    if (e.key === 'Escape') this.close();\n  };\n\n  // Focus trap : emp├¬che le focus de sortir du popup\n  handleFocusTrap = (e: KeyboardEvent) => {\n    if (e.key !== 'Tab') return;\n    const focusable = this.getFocusableElements();\n    if (focusable.length === 0) return;\n    const first = focusable[0];\n    const last = focusable[focusable.length - 1];\n    const active = this.shadowRoot?.activeElement;\n    if (!active) return;\n    if (!e.shiftKey && active === last) {\n      e.preventDefault();\n      (first as HTMLElement).focus();\n    } else if (e.shiftKey && active === first) {\n      e.preventDefault();\n      (last as HTMLElement).focus();\n    }\n  };\n\n  getFocusableElements() {\n    const root = this.shadowRoot;\n    if (!root) return [];\n    return Array.from(\n      root.querySelectorAll(\n        'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])',\n      ),\n    ).filter((el: any) => !el.disabled && el.offsetParent !== null);\n  }\n\n  render() {\n    return html`\n      <template-popup>\n        <h2 slot=\"title\">­ƒôü Ouvrir un fichier</h2>\n\n        <div slot=\"body\" class=\"popup-content\" tabindex=\"-1\">\n          ${this.isLoadingThemes ||\n          (this.allThemes.length === 0 && !this.errorMessage)\n            ? html`\n                <div class=\"loading-skeleton\" role=\"status\" aria-live=\"polite\">\n                  <div class=\"skeleton-line\"></div>\n                  <div class=\"skeleton-line\"></div>\n                  <div class=\"skeleton-line\"></div>\n                </div>\n              `\n            : html`\n                <div\n                  class=\"theme-list\"\n                  role=\"list\"\n                  aria-label=\"Th├¿mes disponibles\"\n                >\n                  ${this.allThemes.map(\n                    (theme) =>\n                      html`<theme-elem\n                        role=\"listitem\"\n                        .theme=${theme}\n                      ></theme-elem>`,\n                  )}\n                </div>\n              `}\n\n          <div class=\"main-action\">\n            <color-button\n              @click=\"${this.debouncedDownload}\"\n              ?disabled=\"${this.isDownloading}\"\n              aria-label=\"T├®l├®charger tous les fichiers\"\n            >\n              ${this.isDownloading\n                ? 'Ô¼ç´©Å T├®l├®chargement...'\n                : '­ƒÆ¥ T├®l├®charger tous les fichiers'}\n            </color-button>\n          </div>\n\n          ${this.isDownloading\n            ? html`<div class=\"loading-indicator\"></div>`\n            : ''}\n          ${this.errorMessage\n            ? html`\n                <div class=\"message error-message\">\n                  <span>ÔÜá´©Å</span>\n                  <span>${this.errorMessage}</span>\n                </div>\n              `\n            : ''}\n          ${this.successMessage\n            ? html`\n                <div class=\"message success-message\">\n                  <span>${this.successMessage}</span>\n                </div>\n              `\n            : ''}\n\n          <div class=\"sync-status\">\n            <div class=\"sync-info\">\n              <div\n                class=\"status-dot ${syncInProgress.value\n                  ? 'warning'\n                  : 'success'}\"\n              ></div>\n              <span>Sync: ${syncInProgress.value ? 'En cours' : 'OK'}</span>\n            </div>\n            <button\n              class=\"settings-button\"\n              @click=\"${this.openSyncSettings}\"\n              title=\"Param├¿tres de synchronisation\"\n              aria-label=\"Ouvrir les param├¿tres de synchronisation\"\n            >\n              ÔÜÖ´©Å\n            </button>\n          </div>\n        </div>\n      </template-popup>\n\n      ${this.showSyncSettings\n        ? html`<sync-settings-popup\n            @closed=\"${this.closeSyncSettings}\"\n          ></sync-settings-popup>`\n        : ''}\n    `;\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\components\\popups\\save-popup.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":96,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":96,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[2669,2671],"text":"!=="},"desc":"Use '!==' instead of '!='."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import '@components/color-button';\r\nimport { app } from '@controllers/Core/App';\r\nimport { css, html, LitElement } from 'lit';\r\nimport { TemplatePopup } from './template-popup';\r\n\r\nclass SavePopup extends LitElement {\r\n  static properties = {\r\n    opts: { type: Object },\r\n    filename: { type: String },\r\n    saveSettings: { type: Boolean },\r\n    saveHistory: { type: Boolean },\r\n  };\r\n\r\n  constructor() {\r\n    super();\r\n    this.filename = 'sans titre';\r\n    this.saveSettings = true;\r\n    this.saveHistory = true;\r\n    this.permanentHide = false;\r\n    window.addEventListener('close-popup', () => this.close());\r\n  }\r\n\r\n  static styles = [\r\n    TemplatePopup.template_popup_styles(),\r\n    css`\r\n      #body {\r\n        display: grid;\r\n        grid-template-columns: auto 1fr;\r\n        gap: 16px;\r\n        justify-content: center;\r\n      }\r\n\r\n      label {\r\n        text-align: right;\r\n      }\r\n\r\n      fieldset {\r\n        grid-column: 1 / 3;\r\n      }\r\n    `,\r\n  ];\r\n\r\n  render() {\r\n    return html`\r\n      <template-popup>\r\n        <h2 slot=\"title\">Enregistrer</h2>\r\n        <form slot=\"body\" id=\"body\" @submit=\"${this._actionHandle}\">\r\n          <label for=\"save_popup_filename\">Nom du fichier</label>\r\n          <input\r\n            type=\"text\"\r\n            name=\"save_popup_filename\"\r\n            id=\"save_popup_filename\"\r\n            value=\"${this.opts.suggestedName || this.filename}\"\r\n            @change=\"${this._actionHandle}\"\r\n            onfocus=\"this.select()\"\r\n          />\r\n\r\n          <label for=\"save_popup_format\">Format</label>\r\n          <select name=\"save_popup_format\" id=\"save_popup_format\">\r\n            ${this.opts.types.map(\r\n              (type) =>\r\n                html`<option value=\"${type.description}\">\r\n                  ${type.description}\r\n                </option>`,\r\n            )}\r\n          </select>\r\n\r\n          <fieldset>\r\n            <legend>Options</legend>\r\n\r\n            <div class=\"field\">\r\n              <input\r\n                type=\"checkbox\"\r\n                name=\"save_popup_settings\"\r\n                id=\"save_popup_settings\"\r\n                ?checked=\"${this.saveSettings}\"\r\n                @change=\"${this._actionHandle}\"\r\n              />\r\n              <label for=\"save_popup_settings\"\r\n                >Enregistrer les param├¿tres</label\r\n              >\r\n            </div>\r\n\r\n            ${this.renderHistoryField()} ${this.renderGeometryField()}\r\n          </fieldset>\r\n        </form>\r\n\r\n        <footer slot=\"footer\">\r\n          <color-button @click=\"${this._actionHandle}\"> OK </color-button>\r\n        </footer>\r\n      </template-popup>\r\n    `;\r\n  }\r\n\r\n  renderHistoryField() {\r\n    if (app.environment.name != 'Tangram' || app.tangram.isSilhouetteShown)\r\n      return html`\r\n        <div class=\"field\">\r\n          <input\r\n            type=\"checkbox\"\r\n            name=\"save_popup_history\"\r\n            id=\"save_popup_history\"\r\n            ?checked=\"${this.saveHistory}\"\r\n            @change=\"${this._actionHandle}\"\r\n          />\r\n          <label for=\"save_popup_history\">Enregistrer l'historique</label>\r\n        </div>\r\n      `;\r\n    else this.saveHistory = false;\r\n  }\r\n\r\n  renderGeometryField() {\r\n    if (app.environment.name === 'Geometrie')\r\n      return html`\r\n        <div class=\"field\">\r\n          <input\r\n            type=\"checkbox\"\r\n            name=\"save_popup_permanent_hide\"\r\n            id=\"save_popup_permanent_hide\"\r\n            ?checked=\"${this.permanentHide}\"\r\n            @change=\"${this._actionHandle}\"\r\n          />\r\n          <label for=\"save_popup_permanent_hide\"\r\n            >Cacher de fa├ºon permanente</label\r\n          >\r\n        </div>\r\n      `;\r\n  }\r\n\r\n  close() {\r\n    this.remove();\r\n  }\r\n\r\n  _actionHandle(event) {\r\n    event.preventDefault();\r\n    switch (event.target.name) {\r\n      case 'save_popup_settings':\r\n        this.saveSettings = !this.saveSettings;\r\n        break;\r\n\r\n      case 'save_popup_history':\r\n        this.saveHistory = !this.saveHistory;\r\n        break;\r\n\r\n      case 'save_popup_permanent_hide':\r\n        this.permanentHide = !this.permanentHide;\r\n        break;\r\n\r\n      case 'save_popup_filename':\r\n        this.filename = event.target.value;\r\n        if (!this.filename) this.filename = 'sans titre';\r\n        break;\r\n\r\n      default:\r\n        const ele = this.shadowRoot?.querySelector('#save_popup_format').value;\r\n        const extension = ele.slice(ele.indexOf('.'), -1);\r\n        const name = this.filename + extension,\r\n          saveSettings = this.saveSettings,\r\n          saveHistory = this.saveHistory,\r\n          permanentHide = this.permanentHide;\r\n        this.dispatchEvent(\r\n          new CustomEvent('selected', {\r\n            detail: {\r\n              name,\r\n              types: this.opts.types.filter((type) => type.description === ele),\r\n              saveSettings,\r\n              saveHistory,\r\n              permanentHide,\r\n            },\r\n          }),\r\n        );\r\n        this.remove();\r\n        break;\r\n    }\r\n  }\r\n}\r\ncustomElements.define('save-popup', SavePopup);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\components\\popups\\save-warning.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\components\\popups\\settings-popup.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":86,"column":34,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":86,"endColumn":36,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[2630,2632],"text":"!=="},"desc":"Use '!==' instead of '!='."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import '@components/color-button';\r\nimport { app, setState } from '@controllers/Core/App';\r\nimport { createElem } from '@controllers/Core/Tools/general';\r\nimport '@controllers/version-item';\r\nimport { LitElement, css, html } from 'lit';\r\nimport { TemplatePopup } from './template-popup';\r\n\r\nclass SettingsPopup extends LitElement {\r\n  static properties = {\r\n    settings: { type: Array },\r\n  };\r\n\r\n  constructor() {\r\n    super();\r\n    this.settings = { ...app.settings };\r\n    window.addEventListener(\r\n      'settings-changed',\r\n      () => (this.settings = { ...app.settings }),\r\n    );\r\n    window.addEventListener('close-popup', () => this.close());\r\n  }\r\n\r\n  static styles = [\r\n    TemplatePopup.template_popup_styles(),\r\n    css`\r\n      version-item {\r\n        margin-right: 8px;\r\n      }\r\n\r\n      fieldset {\r\n        width: 100%;\r\n        box-sizing: border-box;\r\n        border-radius: 4px;\r\n      }\r\n\r\n      [slot='body'] {\r\n        gap: 8px;\r\n      }\r\n    `,\r\n  ];\r\n\r\n  render() {\r\n    return html`\r\n      <template-popup>\r\n        <h2 slot=\"title\">Param├¿tres</h2>\r\n        <div slot=\"body\">\r\n          <fieldset>\r\n            <legend>Environnement g├®n├®ral</legend>\r\n            <div class=\"field\">\r\n              <input\r\n                type=\"checkbox\"\r\n                name=\"settings_automatic_adjustment\"\r\n                id=\"settings_automatic_adjustment\"\r\n                .checked=\"${this.settings.automaticAdjustment}\"\r\n                @change=\"${this._actionHandle}\"\r\n              />\r\n              <label for=\"settings_automatic_adjustment\">Ajustement automatique</label>\r\n            </div>\r\n\r\n            ${\r\n              app.environment.name === 'Geometrie'\r\n                ? html` <div class=\"field\">\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      name=\"settings_animation_in_geometry_tranformations\"\r\n                      id=\"settings_animation_in_geometry_tranformations\"\r\n                      .checked=\"${this.settings\r\n                        .geometryTransformationAnimation}\"\r\n                      @change=\"${this._actionHandle}\"\r\n                    />\r\n                    <label for=\"settings_animation_in_geometry_tranformations\"\r\n                      >Animation des tranformations</label\r\n                    >\r\n                  </div>`\r\n                : ''\r\n            }\r\n\r\n            <div class=\"field\">\r\n              <color-button @click=\"${this.openToolChoicePopup}\">\r\n                Choix des outils disponibles\r\n              </color-button>\r\n            </div>\r\n          </fieldset>\r\n\r\n          ${\r\n            app.environment.name != 'Tangram'\r\n              ? html` <fieldset>\r\n                  <legend>Figures</legend>\r\n                  ${app.environment.name === 'Grandeurs'\r\n                    ? html` <div class=\"field\">\r\n                        <label for=\"settings_shapes_size\"\r\n                          >Taille des figures</label\r\n                        >\r\n                        <select\r\n                          name=\"settings_shapes_size\"\r\n                          id=\"settings_shapes_size\"\r\n                          @change=\"${this._actionHandle}\"\r\n                        >\r\n                          <option\r\n                            value=\"1\"\r\n                            ?selected=\"${this.settings.shapesSize === 1}\"\r\n                          >\r\n                            1\r\n                          </option>\r\n                          <option\r\n                            value=\"2\"\r\n                            ?selected=\"${this.settings.shapesSize === 2}\"\r\n                          >\r\n                            2\r\n                          </option>\r\n                          <option\r\n                            value=\"3\"\r\n                            ?selected=\"${this.settings.shapesSize === 3}\"\r\n                          >\r\n                            3\r\n                          </option>\r\n                        </select>\r\n                      </div>`\r\n                    : ''}\r\n\r\n                  <div class=\"field\">\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      name=\"settings_shapes_pointed\"\r\n                      id=\"settings_shapes_pointed\"\r\n                      .checked=\"${this.settings.areShapesPointed}\"\r\n                      @change=\"${this._actionHandle}\"\r\n                    />\r\n                    <label for=\"settings_shapes_pointed\"\r\n                      >Figures point├®es</label\r\n                    >\r\n                  </div>\r\n                </fieldset>`\r\n              : ''\r\n          }\r\n          </div>\r\n\r\n          <footer slot=\"footer\">\r\n            <version-item></version-item>\r\n            <color-button @click=\"${() => app.resetSettings()}\">Param├¿tres par d├®faut</color-button>\r\n            <color-button @click=\"${this.close}\">OK</color-button>\r\n          </footer>\r\n        </div>\r\n      </template-popup>\r\n    `;\r\n  }\r\n\r\n  close() {\r\n    this.remove();\r\n  }\r\n\r\n  /**\r\n   * event handler principal\r\n   */\r\n  _actionHandle(event) {\r\n    switch (event.target.name) {\r\n      case 'settings_automatic_adjustment':\r\n        setState({\r\n          settings: {\r\n            ...app.settings,\r\n            automaticAdjustment: event.target.checked,\r\n          },\r\n        });\r\n        break;\r\n\r\n      case 'settings_animation_in_geometry_tranformations':\r\n        setState({\r\n          settings: {\r\n            ...app.settings,\r\n            geometryTransformationAnimation: event.target.checked,\r\n          },\r\n        });\r\n        break;\r\n\r\n      case 'settings_shapes_size':\r\n        setState({\r\n          settings: {\r\n            ...app.settings,\r\n            shapesSize: parseInt(event.target.value),\r\n          },\r\n        });\r\n        break;\r\n\r\n      case 'settings_shapes_pointed':\r\n        setState({\r\n          settings: {\r\n            ...app.settings,\r\n            areShapesPointed: event.target.checked,\r\n          },\r\n        });\r\n        window.dispatchEvent(new CustomEvent('refresh'));\r\n        break;\r\n\r\n      default:\r\n        console.error(\r\n          'Settings: param├¿tre inconnu: ' +\r\n            event.target.name +\r\n            ' ' +\r\n            event.target.value +\r\n            ' ' +\r\n            event.target.checked,\r\n        );\r\n    }\r\n    this.settings = { ...this.settings };\r\n  }\r\n\r\n  openToolChoicePopup() {\r\n    import('./tool-choice-popup');\r\n    createElem('tool-choice-popup');\r\n    this.close();\r\n  }\r\n}\r\ncustomElements.define('settings-popup', SettingsPopup);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\components\\popups\\sync-settings-popup.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'type' is assigned a value but never used. Allowed unused args must match /^_/u.","line":23,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":24,"suggestions":[{"messageId":"removeVar","data":{"varName":"type"},"fix":{"range":[772,784],"text":""},"desc":"Remove unused variable 'type'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'NetworkError' is defined but never used. Allowed unused vars must match /^_/u.","line":30,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":30,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"NetworkError"},"fix":{"range":[863,1010],"text":""},"desc":"Remove unused variable 'NetworkError'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'NetworkError' is defined but never used. Allowed unused vars must match /^_/u.","line":30,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'AuthError' is defined but never used. Allowed unused vars must match /^_/u.","line":36,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":36,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"AuthError"},"fix":{"range":[1012,1150],"text":""},"desc":"Remove unused variable 'AuthError'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AuthError' is defined but never used. Allowed unused vars must match /^_/u.","line":36,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":16},{"ruleId":"no-unused-vars","severity":1,"message":"'SyncSettingsPopup' is defined but never used. Allowed unused vars must match /^_/u.","line":43,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":43,"endColumn":24,"suggestions":[{"messageId":"removeVar","data":{"varName":"SyncSettingsPopup"},"fix":{"range":[1152,18801],"text":""},"desc":"Remove unused variable 'SyncSettingsPopup'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SyncSettingsPopup' is defined but never used. Allowed unused vars must match /^_/u.","line":43,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":43,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import '@components/color-button';\nimport '@components/popups/template-popup';\nimport { LitElement, css, html } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { getLastSyncInfo, smartSync } from '../../services/activity-sync.js';\nimport {\n  CacheClearError,\n  CacheError,\n  CacheService,\n  CacheUnavailableError,\n} from '../../services/cache.service';\nimport { cachedThemes } from '../../store/notions';\nimport { syncInProgress, syncProgress } from '../../store/syncState.js';\nimport { getAllActivities } from '../../utils/indexeddb-activities.js';\nimport { debounce } from '../../utils/signal-observer.js';\n\n/**\n * Types d'erreurs pour la synchronisation\n */\nclass SyncError extends Error {\n  constructor(\n    message: string,\n    public type: string = 'SYNC_ERROR',\n  ) {\n    super(message);\n    this.name = 'SyncError';\n  }\n}\n\nclass NetworkError extends SyncError {\n  constructor(message: string = 'Probl├¿me de connexion r├®seau') {\n    super(message, 'NETWORK_ERROR');\n  }\n}\n\nclass AuthError extends SyncError {\n  constructor(message: string = \"Erreur d'authentification\") {\n    super(message, 'AUTH_ERROR');\n  }\n}\n\n@customElement('sync-settings-popup')\nclass SyncSettingsPopup extends LitElement {\n  @property({ type: String }) errorMessage = '';\n  @property({ type: String }) successMessage = '';\n  @property({ type: Object }) lastSyncInfo = null;\n  @property({ type: Boolean }) showClearCacheConfirmation = false;\n  @property({ type: Boolean }) isSyncing = false;\n  @property({ type: Number }) localActivitiesCount = 0;\n\n  private debouncedForceSync = debounce(this.forceSync.bind(this), 1000);\n  private debouncedClearCache = debounce(this.clearCache.bind(this), 300);\n\n  async connectedCallback() {\n    super.connectedCallback();\n    await this.loadSyncInfo();\n  }\n\n  async loadSyncInfo() {\n    try {\n      const [syncInfo, localActivities] = await Promise.all([\n        getLastSyncInfo(),\n        getAllActivities(),\n      ]);\n\n      this.lastSyncInfo = syncInfo;\n      this.localActivitiesCount = localActivities.length;\n\n      if ((window as any).dev_mode) {\n      }\n    } catch (error) {\n      console.warn(\n        'Erreur lors du chargement des informations de sync:',\n        error,\n      );\n    }\n  }\n\n  close() {\n    this.dispatchEvent(\n      new CustomEvent('closed', {\n        bubbles: true,\n        composed: true,\n      }),\n    );\n  }\n\n  static styles = css`\n    .popup-content {\n      display: flex;\n      flex-direction: column;\n      gap: 20px;\n      width: 100%;\n      max-width: 500px;\n      padding: 16px;\n      color: var(--theme-text-color, #222);\n    }\n\n    .section {\n      background: var(--theme-color-soft, #e6f9e6);\n      border-radius: 14px;\n      padding: 22px 20px 18px 20px;\n      border: 1.5px solid var(--theme-color, #b2e6b2);\n      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);\n      margin-bottom: 18px;\n    }\n\n    .section-title {\n      font-size: 1.1em;\n      font-weight: 600;\n      margin: 0 0 16px 0;\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      color: var(--theme-text-color, #222);\n      background: none;\n    }\n\n    .sync-details {\n      color: var(--theme-text-color, #222);\n      display: grid;\n      grid-template-columns: 1fr 1fr;\n      gap: 12px;\n      margin-bottom: 16px;\n      font-size: 0.9em;\n    }\n\n    .detail-item {\n      padding: 8px 12px;\n      background: var(--theme-color-soft, rgba(255, 255, 255, 0.05));\n      border-radius: 6px;\n      border: 1px solid rgba(255, 255, 255, 0.1);\n    }\n    .detail-label {\n      font-weight: 600;\n      color: var(--theme-label-color, #2e6c2e);\n      font-size: 0.92em;\n      margin-bottom: 2px;\n    }\n\n    .detail-value {\n      color: var(--theme-value-color, #1a3a1a);\n      font-weight: 500;\n      font-size: 1.05em;\n    }\n\n    .status-indicator {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      padding: 12px;\n      background: var(--theme-color-soft, rgba(255, 255, 255, 0.05));\n      border-radius: 8px;\n      margin-bottom: 16px;\n      color: var(--theme-text-color, #222);\n      font-weight: 500;\n    }\n\n    .status-indicator.warning {\n      background: rgba(255, 152, 0, 0.1);\n      border: 1px solid rgba(255, 152, 0, 0.3);\n      color: #f57c00;\n    }\n\n    .status-indicator.success {\n      background: rgba(76, 175, 80, 0.1);\n      border: 1px solid rgba(76, 175, 80, 0.3);\n      color: #388e3c;\n    }\n\n    .status-indicator.progress {\n      background: rgba(33, 150, 243, 0.1);\n      border: 1px solid rgba(33, 150, 243, 0.3);\n      color: #1976d2;\n    }\n    .status-dot {\n      width: 12px;\n      height: 12px;\n      border-radius: 50%;\n    }\n\n    .status-dot.success {\n      background: #4caf50;\n      box-shadow: 0 0 8px rgba(76, 175, 80, 0.4);\n    }\n\n    .status-dot.warning {\n      background: #ff9800;\n      box-shadow: 0 0 8px rgba(255, 152, 0, 0.4);\n      animation: pulse 2s infinite;\n    }\n\n    .status-dot.error {\n      background: #f44336;\n      box-shadow: 0 0 8px rgba(244, 67, 54, 0.4);\n    }\n\n    @keyframes pulse {\n      0%,\n      100% {\n        opacity: 1;\n      }\n      50% {\n        opacity: 0.6;\n      }\n    }\n\n    .actions-grid {\n      display: grid;\n      grid-template-columns: 1fr 1fr;\n      gap: 12px;\n      background: none;\n      box-shadow: none;\n    }\n\n    .primary-action {\n      grid-column: 1 / -1;\n    }\n\n    .primary-action color-button {\n      width: 100%;\n      min-height: 48px;\n      font-weight: 600;\n      border-radius: 8px;\n      background: var(--theme-color, #4caf50);\n      color: #fff;\n      border: none;\n      box-shadow: 0 2px 8px rgba(44, 62, 80, 0.1);\n      transition:\n        box-shadow 0.2s,\n        background 0.2s;\n    }\n    .primary-action color-button:hover {\n      background: var(--theme-color-dark, #388e3c);\n      box-shadow: 0 4px 16px rgba(44, 62, 80, 0.16);\n    }\n\n    /* Am├®lioration de l'accessibilit├® - Focus visible */\n    color-button:focus {\n      outline: 2px solid var(--theme-color, #4caf50);\n      outline-offset: 2px;\n    }\n\n    .confirmation-dialog {\n      /* Am├®lioration pour la navigation clavier */\n      isolation: isolate;\n    }\n\n    /* Am├®lioration du contraste pour les messages */\n    .section-title {\n      /* Assurer un contraste suffisant */\n      font-weight: 600;\n    }\n    .cache-explanation {\n      color: var(--theme-text-color, #222);\n      margin-bottom: 16px;\n      font-size: 0.92em;\n      font-weight: 500;\n    }\n\n    .message {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      padding: 12px 16px;\n      border-radius: 8px;\n      font-size: 0.9em;\n      margin: 8px 0;\n    }\n\n    .error-message {\n      color: #e74c3c;\n      background: rgba(231, 76, 60, 0.1);\n      border: 1px solid rgba(231, 76, 60, 0.2);\n    }\n\n    .success-message {\n      color: #2ecc71;\n      background: rgba(46, 204, 113, 0.1);\n      border: 1px solid rgba(46, 204, 113, 0.2);\n    }\n\n    .warning-message {\n      color: #f39c12;\n      background: rgba(243, 156, 18, 0.1);\n      border: 1px solid rgba(243, 156, 18, 0.2);\n    }\n\n    .confirmation-overlay {\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(0, 0, 0, 0.6);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      z-index: 2000;\n    }\n\n    .confirmation-dialog {\n      background: var(--bg-color, rgba(44, 62, 80, 0.95));\n      color: rgba(255, 255, 255, 0.9);\n      padding: 24px;\n      border-radius: 12px;\n      max-width: 400px;\n      text-align: center;\n      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);\n      border: 1px solid rgba(255, 255, 255, 0.1);\n      backdrop-filter: blur(10px);\n    }\n\n    .confirmation-actions {\n      display: flex;\n      gap: 12px;\n      margin-top: 20px;\n      justify-content: center;\n    }\n\n    .loading-indicator {\n      height: 4px;\n      background: linear-gradient(\n        90deg,\n        var(--theme-color, #4caf50) 0%,\n        rgba(76, 175, 80, 0.3) 50%,\n        var(--theme-color, #4caf50) 100%\n      );\n      border-radius: 2px;\n      animation: progress 2s infinite;\n      margin: 8px 0;\n    }\n\n    @keyframes progress {\n      0% {\n        opacity: 0.6;\n        transform: scaleX(0.8);\n      }\n      50% {\n        opacity: 1;\n        transform: scaleX(1);\n      }\n      100% {\n        opacity: 0.6;\n        transform: scaleX(0.8);\n      }\n    }\n  `;\n\n  async forceSync() {\n    try {\n      this.isSyncing = true;\n      this.errorMessage = '';\n      this.successMessage = '';\n\n      const result = await smartSync({ force: true });\n\n      if (result === 'completed') {\n        this.successMessage = '­ƒöä Synchronisation forc├®e termin├®e avec succ├¿s';\n        await this.loadSyncInfo();\n      } else if (result === 'recent') {\n        this.successMessage =\n          'Ô£à Synchronisation d├®j├á r├®cente, aucune action n├®cessaire';\n      } else {\n        this.errorMessage = 'Erreur lors de la synchronisation forc├®e';\n      }\n    } catch (error) {\n      console.error('[SYNC] Erreur synchronisation:', error);\n\n      if (\n        error.message?.includes('network') ||\n        error.message?.includes('fetch')\n      ) {\n        this.errorMessage =\n          '­ƒîÉ Probl├¿me de connexion r├®seau. V├®rifiez votre connexion internet.';\n      } else if (\n        error.message?.includes('auth') ||\n        error.message?.includes('401')\n      ) {\n        this.errorMessage = \"­ƒöÆ Erreur d'authentification. Reconnectez-vous.\";\n      } else if (error.message?.includes('timeout')) {\n        this.errorMessage =\n          \"ÔÅ▒´©Å D├®lai d'attente d├®pass├®. R├®essayez dans quelques instants.\";\n      } else {\n        this.errorMessage = `ÔÜá´©Å Erreur technique: ${error.message}`;\n      }\n    } finally {\n      this.isSyncing = false;\n    }\n  }\n\n  showClearCacheDialog() {\n    this.showClearCacheConfirmation = true;\n  }\n\n  cancelClearCache() {\n    this.showClearCacheConfirmation = false;\n  }\n\n  async confirmClearCache() {\n    this.showClearCacheConfirmation = false;\n    await this.clearCache();\n  }\n\n  async clearCache() {\n    try {\n      this.errorMessage = '';\n      this.successMessage = '';\n\n      const statistiques = await CacheService.obtenirStatistiques();\n      if (!statistiques.disponible) {\n        this.errorMessage = `­ƒÆ¥ Cache non disponible: ${statistiques.raison}`;\n        return;\n      }\n\n      if (statistiques.nombreElements === 0) {\n        this.successMessage = 'Ô£¿ Le cache est d├®j├á vide';\n        return;\n      }\n\n      await CacheService.viderCache();\n      cachedThemes.set([]);\n\n      this.successMessage = `­ƒùæ´©Å Cache vid├® avec succ├¿s (${statistiques.nombreElements} ├®l├®ments supprim├®s)`;\n    } catch (error) {\n      console.error('Erreur lors du vidage du cache:', error);\n\n      if (error instanceof CacheUnavailableError) {\n        this.errorMessage =\n          '­ƒÆ¥ Cache non accessible. V├®rifiez le support IndexedDB de votre navigateur.';\n      } else if (error instanceof CacheClearError) {\n        this.errorMessage =\n          \"­ƒÜ½ Impossible de vider le cache. R├®essayez ou red├®marrez l'application.\";\n      } else if (error instanceof CacheError) {\n        this.errorMessage = `­ƒÆ¥ Erreur cache: ${error.message}`;\n      } else {\n        this.errorMessage = `ÔÜá´©Å Erreur technique: ${error.message}`;\n      }\n    }\n  }\n\n  render() {\n    return html`\n      <template-popup>\n        <h2 slot=\"title\">ÔÜÖ´©Å Param├¿tres de synchronisation</h2>\n        <div slot=\"body\" class=\"popup-content\">\n          <!-- Section Statut de synchronisation -->\n          <div class=\"section\">\n            <h3 class=\"section-title\">­ƒôè Statut de synchronisation</h3>\n\n            <div\n              class=\"status-indicator ${syncInProgress.value\n                ? 'progress'\n                : this.lastSyncInfo &&\n                    this.localActivitiesCount <\n                      this.lastSyncInfo.totalFilesCount\n                  ? 'warning'\n                  : 'success'}\"\n            >\n              <span>\n                ${syncInProgress.value\n                  ? `­ƒöä Synchronisation en cours (${Math.min(syncProgress.value ?? 0, 100)}%)`\n                  : this.lastSyncInfo &&\n                      this.localActivitiesCount <\n                        this.lastSyncInfo.totalFilesCount\n                    ? `ÔÜá´©Å Synchronisation partielle (${this.localActivitiesCount}/${this.lastSyncInfo.totalFilesCount})`\n                    : 'Ô£à Synchronisation compl├¿te'}\n              </span>\n            </div>\n\n            ${this.lastSyncInfo\n              ? html`\n                  <div class=\"sync-details\">\n                    <div class=\"detail-item\">\n                      <div class=\"detail-label\">Derni├¿re synchronisation</div>\n                      <div class=\"detail-value\">\n                        ${this.lastSyncInfo.lastSyncDate.toLocaleDateString()} ├á\n                        ${this.lastSyncInfo.lastSyncDate.toLocaleTimeString()}\n                      </div>\n                    </div>\n                    <div class=\"detail-item\">\n                      <div class=\"detail-label\">Statut</div>\n                      <div class=\"detail-value\">\n                        ${this.lastSyncInfo.nextSyncDue\n                          ? 'ÔÜá´©Å Sync recommand├®e'\n                          : 'Ô£à ├Ç jour'}\n                      </div>\n                    </div>\n                    <div class=\"detail-item\">\n                      <div class=\"detail-label\">Activit├®s en local</div>\n                      <div class=\"detail-value\">\n                        ${this.localActivitiesCount} /\n                        ${this.lastSyncInfo.totalFilesCount} disponibles\n                      </div>\n                    </div>\n                    <div class=\"detail-item\">\n                      <div class=\"detail-label\">Derni├¿re session</div>\n                      <div class=\"detail-value\">\n                        ${this.lastSyncInfo.syncedFilesCount}\n                        ${this.lastSyncInfo.syncedFilesCount === 1\n                          ? 'mise ├á jour'\n                          : 'mises ├á jour'}\n                      </div>\n                    </div>\n                    <div class=\"detail-item\">\n                      <div class=\"detail-label\">Th├¿mes disponibles</div>\n                      <div class=\"detail-value\">\n                        ${this.lastSyncInfo.totalThemesCount} th├¿mes\n                      </div>\n                    </div>\n                  </div>\n                `\n              : html`\n                  <div class=\"message warning-message\">\n                    <span>ÔÜá´©Å</span>\n                    <span>Aucune synchronisation d├®tect├®e</span>\n                  </div>\n                `}\n\n            <div class=\"primary-action\">\n              <color-button\n                @click=\"${this.debouncedForceSync}\"\n                ?disabled=\"${this.isSyncing || syncInProgress.value}\"\n                aria-label=\"${this.lastSyncInfo?.nextSyncDue\n                  ? 'Synchroniser les donn├®es maintenant'\n                  : 'Forcer une nouvelle synchronisation'}\"\n                role=\"button\"\n                tabindex=\"0\"\n              >\n                <span aria-hidden=\"true\"\n                  >${this.lastSyncInfo?.nextSyncDue ? '­ƒöä' : '­ƒöº'}</span\n                >\n                ${this.lastSyncInfo?.nextSyncDue\n                  ? 'Synchroniser maintenant'\n                  : 'Forcer la synchronisation'}\n              </color-button>\n            </div>\n\n            ${this.isSyncing ? html`<div class=\"loading-indicator\"></div>` : ''}\n          </div>\n\n          <!-- Section Gestion du cache -->\n          <div class=\"section\">\n            <h3 class=\"section-title\">­ƒÆ¥ Gestion du cache local</h3>\n\n            <p\n              style=\"font-size: 0.9em; color: var(--theme-value-color, #1a3a1a); margin-bottom: 16px;\"\n            >\n              Le cache local am├®liore les performances en stockant les donn├®es.\n              Videz-le si vous rencontrez des probl├¿mes ou pour lib├®rer de\n              l'espace.\n            </p>\n\n            <div class=\"actions-grid\">\n              <color-button\n                @click=\"${this.showClearCacheDialog}\"\n                aria-label=\"Vider le cache local de l'application\"\n                role=\"button\"\n                tabindex=\"0\"\n              >\n                <span aria-hidden=\"true\">­ƒùæ´©Å</span> Vider le cache\n              </color-button>\n              <color-button\n                @click=\"${() => window.location.reload()}\"\n                aria-label=\"Recharger compl├¿tement l'application\"\n                role=\"button\"\n                tabindex=\"0\"\n              >\n                <span aria-hidden=\"true\">­ƒöä</span> Recharger l'app\n              </color-button>\n            </div>\n          </div>\n\n          <!-- Messages d'├®tat -->\n          ${this.errorMessage\n            ? html`\n                <div class=\"message error-message\">\n                  <span>ÔÜá´©Å</span>\n                  <span>${this.errorMessage}</span>\n                </div>\n              `\n            : ''}\n          ${this.successMessage\n            ? html`\n                <div class=\"message success-message\">\n                  <span>${this.successMessage}</span>\n                </div>\n              `\n            : ''}\n        </div>\n      </template-popup>\n\n      <!-- Dialog de confirmation pour vider le cache -->\n      ${this.showClearCacheConfirmation\n        ? html`\n            <div class=\"confirmation-overlay\" @click=\"${this.cancelClearCache}\">\n              <div\n                class=\"confirmation-dialog\"\n                @click=\"${(e: Event) => e.stopPropagation()}\"\n              >\n                <h3>­ƒùæ´©Å Vider le cache local</h3>\n                <p>\n                  Cette action supprimera toutes les donn├®es mises en cache\n                  localement. Vous devrez les ret├®l├®charger lors de votre\n                  prochaine utilisation.\n                </p>\n                <p><strong>├ètes-vous s├╗r de vouloir continuer ?</strong></p>\n                <div class=\"confirmation-actions\">\n                  <color-button\n                    @click=\"${this.cancelClearCache}\"\n                    style=\"background: #6c757d;\"\n                    aria-label=\"Annuler le vidage du cache\"\n                    role=\"button\"\n                    tabindex=\"0\"\n                  >\n                    <span aria-hidden=\"true\">ÔØî</span> Annuler\n                  </color-button>\n                  <color-button\n                    @click=\"${this.confirmClearCache}\"\n                    style=\"background: #dc3545;\"\n                    aria-label=\"Confirmer le vidage du cache local\"\n                    role=\"button\"\n                    tabindex=\"0\"\n                  >\n                    <span aria-hidden=\"true\">­ƒùæ´©Å</span> Vider le cache\n                  </color-button>\n                </div>\n              </div>\n            </div>\n          `\n        : ''}\n    `;\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\components\\popups\\template-popup.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\components\\popups\\theme-elem.ts","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":111,"column":44,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":111,"endColumn":46,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[2933,2935],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'themeDocRef' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":203,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":203,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'themeDocRef' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":203,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":203,"endColumn":24}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { SignalWatcher } from '@lit-labs/signals';\r\nimport { LitElement, css, html } from 'lit';\r\nimport { property, state } from 'lit/decorators.js';\r\nimport {\r\n  getModulesDocFromTheme,\r\n  getThemeDocFromThemeName,\r\n} from '../../firebase/firebase-init';\r\nimport {\r\n  cachedSequences,\r\n  selectedNotion,\r\n  toggleNotion,\r\n} from '../../store/notions';\r\nimport './module-elem';\r\n\r\nclass ThemeElem extends SignalWatcher(LitElement) {\r\n  @property({ type: Object }) theme = {};\r\n  @property({ type: String }) title = '';\r\n  @property({ type: Array }) modules = [];\r\n  @property({ type: String }) moduleNames = '';\r\n  @property({ type: Boolean }) loaded = false;\r\n  @state() private isOpen = false;\r\n  @state() private moduleNamesList: string[] = [];\r\n\r\n  static styles = css`\r\n    :host {\r\n      width: 100%;\r\n      display: block;\r\n    }\r\n\r\n    details {\r\n      border-radius: 8px;\r\n      overflow: hidden;\r\n      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\r\n      transition: all 0.3s ease;\r\n      background-color: rgba(255, 255, 255, 0.1);\r\n    }\r\n\r\n    details[open] {\r\n      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);\r\n      margin-bottom: 8px;\r\n    }\r\n\r\n    summary {\r\n      cursor: pointer;\r\n      font-weight: 500;\r\n      padding: 12px 16px;\r\n      background-color: var(--theme-color);\r\n      color: white;\r\n      border-radius: 6px;\r\n      position: relative;\r\n      display: flex;\r\n      align-items: center;\r\n      outline: none;\r\n      transition: background-color 0.2s ease;\r\n    }\r\n\r\n    summary:hover {\r\n      background-color: var(--theme-color-dark, var(--theme-color));\r\n    }\r\n\r\n    summary::-webkit-details-marker {\r\n      display: none;\r\n    }\r\n\r\n    summary::after {\r\n      content: 'Ôû╝';\r\n      font-size: 0.8em;\r\n      margin-left: auto;\r\n      transition: transform 0.3s ease;\r\n    }\r\n\r\n    details[open] summary::after {\r\n      transform: rotate(180deg);\r\n    }\r\n\r\n    .modules-container {\r\n      padding: 12px;\r\n    }\r\n\r\n    progress {\r\n      width: 100%;\r\n      height: 6px;\r\n      border-radius: 3px;\r\n      margin: 8px 0;\r\n    }\r\n  `;\r\n\r\n  connectedCallback() {\r\n    super.connectedCallback();\r\n    // Si un objet theme est fourni, extraire le titre\r\n    if (this.theme && (this.theme as any).id) {\r\n      this.title = (this.theme as any).id;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const isSelected = selectedNotion.get() === this.title;\r\n    return html`\r\n      <details name=\"summary\" ?open=${isSelected}>\r\n        <summary name=\"summary\" @click=\"${this.summaryClick}\">\r\n          ${this.title}\r\n        </summary>\r\n        <div class=\"modules-container\">\r\n          ${!this.loaded ? html`<progress></progress>` : html``}\r\n          ${this.modules.length === 0 && this.loaded\r\n            ? html`<div style=\"padding:12px;color:#888;font-size:0.95em;\">\r\n                Aucun module disponible\r\n              </div>`\r\n            : html``}\r\n          ${this.modules\r\n            .filter((info) => info?.hidden != true)\r\n            .map(\r\n              (info) =>\r\n                html` <module-elem\r\n                  title=\"${info.id}\"\r\n                  .fileNames=\"${info.files\r\n                    ? info.files.map((file) => file.id)\r\n                    : []}\"\r\n                >\r\n                </module-elem>`,\r\n            )}\r\n        </div>\r\n      </details>\r\n    `;\r\n  }\r\n\r\n  firstUpdated() {\r\n    this.isOpen = selectedNotion.get() === this.title;\r\n    if (this.isOpen) {\r\n      this.loadModules();\r\n    }\r\n    if (typeof this.moduleNames === 'string') {\r\n      this.moduleNamesList = this.moduleNames.split(',');\r\n    }\r\n  }\r\n\r\n  updated() {\r\n    const isSelected = selectedNotion.get() === this.title;\r\n    // Ne mettre ├á jour isOpen que si sa valeur a chang├®\r\n    if (this.isOpen !== isSelected) {\r\n      this.isOpen = isSelected;\r\n    }\r\n\r\n    if (isSelected && !this.loaded) {\r\n      this.loadModules();\r\n    }\r\n  }\r\n\r\n  async summaryClick(e) {\r\n    // Emp├¬cher le comportement par d├®faut pour g├®rer manuellement l'├®tat\r\n    e.preventDefault();\r\n\r\n    this.isOpen = !this.isOpen;\r\n    if (this.isOpen) {\r\n      this.loadModules();\r\n    }\r\n    toggleNotion(this.title);\r\n\r\n    // Mettre ├á jour manuellement l'├®tat ouvert/ferm├® de l'├®l├®ment details\r\n    const details = e.target.closest('details');\r\n    if (details) {\r\n      details.open = this.isOpen;\r\n    }\r\n  }\r\n\r\n  async loadModules() {\r\n    if (this.loaded) return;\r\n\r\n    try {\r\n      // V├®rifier d'abord si des modules pour ce th├¿me sont d├®j├á en cache m├®moire\r\n      let cachedModulesForTheme =\r\n        cachedSequences.get() &&\r\n        cachedSequences.get().find((cache) => cache.theme === this.title);\r\n\r\n      // Fallback : si pas de modules en m├®moire, tenter de r├®cup├®rer depuis IndexedDB\r\n      if (!cachedModulesForTheme) {\r\n        const { getAllModules } = await import(\r\n          '../../utils/indexeddb-activities.js'\r\n        );\r\n        const allModules = await getAllModules();\r\n        const filtered = allModules.filter((m) => m.data.theme === this.title);\r\n        if (filtered.length > 0) {\r\n          cachedModulesForTheme = {\r\n            theme: this.title,\r\n            modules: filtered.map((m) => ({ id: m.id, ...m.data })),\r\n          };\r\n          // Mettre ├á jour le cache m├®moire\r\n          const currentCache = Array.isArray(cachedSequences.get())\r\n            ? [...cachedSequences.get()]\r\n            : [];\r\n          currentCache.push(cachedModulesForTheme);\r\n          cachedSequences.set(currentCache);\r\n        }\r\n      }\r\n\r\n      if (cachedModulesForTheme) {\r\n        this.modules = cachedModulesForTheme.modules;\r\n        this.loaded = true;\r\n        return;\r\n      }\r\n\r\n      // Sinon charger depuis getModulesDocFromTheme (qui g├¿re IndexedDB + serveur)\r\n      const themeDocRef = getThemeDocFromThemeName(this.title);\r\n      const modulesDoc = await getModulesDocFromTheme(this.title); // Passer directement le nom du th├¿me\r\n      this.modules = modulesDoc || [];\r\n\r\n      // Sauvegarder les modules dans IndexedDB si r├®cup├®r├®s du serveur\r\n      if (modulesDoc && modulesDoc.length > 0 && navigator.onLine) {\r\n        const { saveModulesToIndexedDB } = await import('../../store/notions');\r\n        await saveModulesToIndexedDB(modulesDoc, this.title);\r\n      }\r\n\r\n      // Mise ├á jour du cache des s├®quences en m├®moire\r\n      if (modulesDoc && modulesDoc.length > 0) {\r\n        const currentCache = Array.isArray(cachedSequences.get())\r\n          ? [...cachedSequences.get()]\r\n          : [];\r\n        const existingIndex = currentCache.findIndex(\r\n          (cache) => cache.theme === this.title,\r\n        );\r\n        if (existingIndex >= 0) {\r\n          currentCache[existingIndex] = {\r\n            theme: this.title,\r\n            modules: modulesDoc,\r\n          };\r\n        } else {\r\n          currentCache.push({ theme: this.title, modules: modulesDoc });\r\n        }\r\n        cachedSequences.set(currentCache);\r\n      }\r\n\r\n      this.loaded = true;\r\n    } catch (error) {\r\n      console.error(\r\n        'Erreur lors du chargement des modules pour le th├¿me',\r\n        this.title,\r\n        ':',\r\n        error,\r\n      );\r\n      this.modules = [];\r\n      this.loaded = true;\r\n    }\r\n  }\r\n}\r\ncustomElements.define('theme-elem', ThemeElem);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\components\\popups\\tool-choice-popup.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":92,"column":29,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":92,"endColumn":31,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[2497,2499],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":125,"column":29,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":125,"endColumn":31,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[3670,3672],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":153,"column":27,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":153,"endColumn":29,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4507,4509],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":156,"column":34,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":156,"endColumn":36,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4644,4646],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":160,"column":31,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":160,"endColumn":33,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4792,4794],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import '@components/color-button';\r\nimport '@components/icon-button';\r\nimport { app } from '@controllers/Core/App';\r\nimport { SignalWatcher } from '@lit-labs/signals';\r\nimport { kit } from '@store/kit';\r\nimport { tools } from '@store/tools';\r\nimport { LitElement, css, html } from 'lit';\r\nimport {\r\n  toggleAllFamiliesVisibility,\r\n  toggleFamilyVisibility,\r\n} from '../../store/kit';\r\nimport {\r\n  toggleAllToolsVisibility,\r\n  toggleToolVisibility,\r\n} from '../../store/tools';\r\nimport { TemplatePopup } from './template-popup';\r\n\r\nclass ToolChoicePopup extends SignalWatcher(LitElement) {\r\n  static styles = [\r\n    TemplatePopup.template_popup_styles(),\r\n    css`\r\n      #toolChoicePopupBody {\r\n        display: grid;\r\n        grid-template: auto auto 1fr / 1fr 1fr;\r\n        height: 100%;\r\n        grid-auto-flow: column;\r\n        gap: 8px;\r\n      }\r\n\r\n      h3 {\r\n        margin: 0;\r\n        width: 100%;\r\n        text-align: center;\r\n      }\r\n\r\n      .toolContainer {\r\n        display: grid;\r\n        grid-template-columns: repeat(4, 1fr);\r\n        gap: 2px;\r\n        width: 100%;\r\n        height: 100%;\r\n        place-content: baseline;\r\n        background-color: white;\r\n        border-radius: 4px;\r\n        overflow: auto;\r\n        scrollbar-width: thin;\r\n      }\r\n\r\n      button {\r\n        border: inherit;\r\n        background: inherit;\r\n        cursor: pointer;\r\n        font-size: 16px;\r\n      }\r\n\r\n      #allHide {\r\n        justify-self: right;\r\n      }\r\n\r\n      #allShow {\r\n        justify-self: left;\r\n      }\r\n    `,\r\n  ];\r\n\r\n  render() {\r\n    this.tools = tools.get();\r\n    this.families = kit.get()?.families || [];\r\n    return html`\r\n      <template-popup>\r\n        <h2 slot=\"title\">Choix des outils disponibles</h2>\r\n        <div id=\"toolChoicePopupBody\" slot=\"body\">\r\n          <h3>Disponibles</h3>\r\n          <button id=\"allHide\" @click=\"${this._actionHandle}\">\r\n            Tout cacher &#8594;\r\n          </button>\r\n          <div class=\"toolContainer\">\r\n            ${this.families\r\n              .filter((family) => family.isVisible)\r\n              .map(\r\n                (family) =>\r\n                  html` <icon-button\r\n                    name=\"${family.shapeTemplates[0].name}\"\r\n                    type=\"Create\"\r\n                    title=\"${family.name}\"\r\n                    @click=\"${this._actionHandle}\"\r\n                  ></icon-button>`,\r\n              )}\r\n            ${this.tools\r\n              .filter(\r\n                (tool) =>\r\n                  tool.name != 'create' && tool.isVisible && !tool.isDisable,\r\n              )\r\n              .map(\r\n                (tool) => html`\r\n                  <icon-button\r\n                    name=\"${tool.name}\"\r\n                    type=\"State\"\r\n                    title=\"${tool.title}\"\r\n                    cantInteract=\"true\"\r\n                    @click=\"${this._actionHandle}\"\r\n                  ></icon-button>\r\n                `,\r\n              )}\r\n          </div>\r\n          <h3>Non disponibles</h3>\r\n          <button id=\"allShow\" @click=\"${this._actionHandle}\">\r\n            &#8592; Tout montrer\r\n          </button>\r\n          <div class=\"toolContainer\">\r\n            ${this.families\r\n              .filter((family) => !family.isVisible)\r\n              .map(\r\n                (family) =>\r\n                  html` <icon-button\r\n                    name=\"${family.shapeTemplates[0].name}\"\r\n                    type=\"Create\"\r\n                    title=\"${family.name}\"\r\n                    @click=\"${this._actionHandle}\"\r\n                  ></icon-button>`,\r\n              )}\r\n            ${this.tools\r\n              .filter(\r\n                (tool) =>\r\n                  tool.name != 'create' && !tool.isVisible && !tool.isDisable,\r\n              )\r\n              .map(\r\n                (tool) => html`\r\n                  <icon-button\r\n                    name=\"${tool.name}\"\r\n                    type=\"State\"\r\n                    title=\"${tool.title}\"\r\n                    cantInteract=\"true\"\r\n                    ?active=\"${tool.name === app.tool?.name}\"\r\n                    @click=\"${this._actionHandle}\"\r\n                  ></icon-button>\r\n                `,\r\n              )}\r\n          </div>\r\n        </div>\r\n        <div slot=\"footer\">\r\n          <color-button\r\n            @click=\"${() => this.close()}\"\r\n            innerText=\"Ok\"\r\n          ></color-button>\r\n        </div>\r\n      </template-popup>\r\n    `;\r\n  }\r\n\r\n  _actionHandle(event) {\r\n    if (!app.fullHistory.isRunning) {\r\n      if (event.target.id == 'allHide') {\r\n        toggleAllToolsVisibility(false);\r\n        toggleAllFamiliesVisibility(false);\r\n      } else if (event.target.id == 'allShow') {\r\n        toggleAllToolsVisibility(true);\r\n        toggleAllFamiliesVisibility(true);\r\n      } else {\r\n        if (event.target.type == 'Create') {\r\n          toggleFamilyVisibility(event.target.title);\r\n        } else {\r\n          toggleToolVisibility(event.target.name);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  firstUpdated() {\r\n    window.addEventListener('close-popup', () => this.close());\r\n  }\r\n\r\n  close() {\r\n    this.remove();\r\n  }\r\n}\r\ncustomElements.define('tool-choice-popup', ToolChoicePopup);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\components\\shape-selector.ts","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":92,"column":31,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":92,"endColumn":33,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[2467,2469],"text":"!=="},"desc":"Use '!==' instead of '!='."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import '@components/flex-grid';\r\nimport '@components/icon-button';\r\nimport { app, setState } from '@controllers/Core/App';\r\nimport { LitElement, css, html } from 'lit';\r\nimport { customElement } from 'lit/decorators/custom-element.js';\r\nimport { property } from 'lit/decorators/property.js';\r\n\r\n@customElement('shape-selector')\r\nexport class ShapeSelector extends LitElement {\r\n  @property({ type: String }) family;\r\n  @property({ type: String }) type;\r\n  @property({ type: Array }) templatesNames = [];\r\n  @property({ type: Array }) titles = [];\r\n  @property({ type: Object }) selectedTemplate;\r\n  @property({ type: String }) nextStep;\r\n\r\n  static styles = css`\r\n    :host {\r\n      display: grid;\r\n      justify-content: center;\r\n      position: absolute;\r\n      bottom: 0;\r\n      right: 0;\r\n      left: 250px;\r\n      padding: 4px;\r\n    }\r\n\r\n    .container {\r\n      background: var(--theme-color-soft);\r\n      box-shadow: 0 1px 3px gray;\r\n      z-index: 100;\r\n      box-sizing: border-box;\r\n      overflow: auto;\r\n      border-radius: 8px;\r\n    }\r\n\r\n    h2 {\r\n      padding: 4px;\r\n      margin: 0;\r\n      text-align: center;\r\n      font-size: 1.2rem;\r\n    }\r\n  `;\r\n\r\n  render() {\r\n    return html`\r\n      <div class=\"container\">\r\n        <h2>${this.selectedTemplate?.title || this.family}</h2>\r\n        <flex-grid>\r\n          ${this.templatesNames.map(\r\n            (template) =>\r\n              html` <icon-button\r\n                name=\"${template.name}\"\r\n                type=\"${this.type}\"\r\n                title=\"${template.title}\"\r\n                ?active=\"${template.name === this.selectedTemplate?.name}\"\r\n                @click=\"${this._clickHandle}\"\r\n              >\r\n              </icon-button>`,\r\n          )}\r\n        </flex-grid>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  _clickHandle(event) {\r\n    this.selectedTemplate = this.templatesNames.find(\r\n      (template) => template.name === event.target.name,\r\n    );\r\n    setState({\r\n      tool: {\r\n        ...app.tool,\r\n        selectedTemplate: this.selectedTemplate,\r\n        currentStep: this.nextStep,\r\n      },\r\n    });\r\n  }\r\n\r\n  firstUpdated() {\r\n    window.addEventListener('tool-updated', () => {\r\n      const actions = [\r\n        'create',\r\n        'createLine',\r\n        'createPoint',\r\n        'createTriangle',\r\n        'createQuadrilateral',\r\n        'createCircle',\r\n      ];\r\n      if (\r\n        !actions.includes(app.tool?.name) ||\r\n        !this.selectedTemplate ||\r\n        this.selectedTemplate != app.tool.selectedTemplate\r\n      )\r\n        this.remove();\r\n    });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\components\\svg-layer.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\components\\sync-status-indicator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\components\\template-toolbar.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\components\\toolbar-kit.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":58,"column":43,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":58,"endColumn":45,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1715,1717],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import '@components/icon-button';\r\nimport { html, LitElement } from 'lit';\r\nimport { app, setState } from '../controllers/Core/App';\r\nimport './template-toolbar';\r\n\r\nclass ToolbarKit extends LitElement {\r\n  static properties = {\r\n    kit: { type: Object },\r\n    selectedFamily: { type: String },\r\n    helpSelected: { type: Boolean },\r\n  };\r\n\r\n  constructor() {\r\n    super();\r\n    this._filteredFamilies = [];\r\n    this._lastKit = null;\r\n    this._pendingUpdate = false;\r\n  }\r\n\r\n  shouldUpdate(changedProperties) {\r\n    // Optimiser les rendus en ne mettant ├á jour que si les propri├®t├®s pertinentes changent\r\n    if (\r\n      changedProperties.has('kit') ||\r\n      changedProperties.has('selectedFamily') ||\r\n      changedProperties.has('helpSelected')\r\n    ) {\r\n      return true;\r\n    }\r\n    return super.shouldUpdate(changedProperties);\r\n  }\r\n\r\n  // Memoize les familles filtr├®es pour ├®viter les calculs inutiles\r\n  _getFilteredFamilies() {\r\n    if (this._lastKit !== this.kit || !this._filteredFamilies.length) {\r\n      this._filteredFamilies =\r\n        this.kit?.families?.filter((family) => family.isVisible) || [];\r\n      this._lastKit = this.kit;\r\n    }\r\n    return this._filteredFamilies;\r\n  }\r\n\r\n  render() {\r\n    if (!this.kit) return null;\r\n\r\n    const families = this._getFilteredFamilies();\r\n    if (!families.length) return null;\r\n\r\n    const familyNames = families.map((family) => family.name);\r\n\r\n    return html`\r\n      <template-toolbar>\r\n        <h2 slot=\"title\">${this.kit.name}</h2>\r\n        <div slot=\"body\">\r\n          ${familyNames.map(\r\n            (familyName) => html`\r\n              <icon-button\r\n                name=\"${this.kit.families.find(\r\n                  (family) => family.name == familyName,\r\n                ).shapeTemplates[0].name}\"\r\n                type=\"Create\"\r\n                title=\"${familyName}\"\r\n                ?active=\"${familyName === this.selectedFamily}\"\r\n                ?helpanimation=\"${this.helpSelected}\"\r\n                @click=\"${this._actionHandle}\"\r\n              >\r\n              </icon-button>\r\n            `,\r\n          )}\r\n        </div>\r\n      </template-toolbar>\r\n    `;\r\n  }\r\n\r\n  _actionHandle(event) {\r\n    if (this._pendingUpdate) return;\r\n\r\n    // Limiter la fr├®quence des mises ├á jour\r\n    this._pendingUpdate = true;\r\n    requestAnimationFrame(() => {\r\n      this._pendingUpdate = false;\r\n    });\r\n\r\n    if (this.helpSelected) {\r\n      window.dispatchEvent(\r\n        new CustomEvent('helpToolChosen', { detail: { toolname: 'create' } }),\r\n      );\r\n      setState({ helpSelected: false });\r\n    } else if (!app.fullHistory.isRunning) {\r\n      setState({\r\n        tool: {\r\n          name: 'create',\r\n          selectedFamily: event.target.title,\r\n          currentStep: 'start',\r\n        },\r\n      });\r\n    }\r\n  }\r\n}\r\ncustomElements.define('toolbar-kit', ToolbarKit);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\components\\toolbar-section.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Biface\\BifaceTool.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Biface\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Bugs.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'error' is defined but never used. Allowed unused args must match /^_/u.","line":5,"column":50,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":55,"suggestions":[{"messageId":"removeVar","data":{"varName":"error"},"fix":{"range":[174,181],"text":""},"desc":"Remove unused variable 'error'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import '@db/firebase-init';\nimport { doc, getFirestore, setDoc } from 'firebase/firestore';\nimport { app } from './Core/App';\n\nexport const bugSend = (message, src, line, col, error) => {\n  if (location.hostname === 'localhost') return;\n  const ids = src.split('/');\n  const id = ids[ids.length - 1];\n  if (app.bugs?.find(id)) return;\n  const state = JSON.stringify(app);\n  const data = { message, src, line, col, state };\n  setDoc(doc(getFirestore(), 'BUGS', id), data);\n  app.bugs = [...(app.bugs || []), id];\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\BuildCenter\\BuildCenterTool.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\BuildCenter\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\CentralSymetry\\CentralSymetryTool.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":168,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":168,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5029,5031],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":176,"column":27,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":176,"endColumn":29,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5325,5327],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":186,"column":44,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":186,"endColumn":46,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5779,5781],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":200,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":200,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6186,6188],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":209,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":209,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6547,6549],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app, setState } from '../Core/App';\r\nimport { GroupManager } from '../Core/Managers/GroupManager';\r\nimport { SelectManager } from '../Core/Managers/SelectManager';\r\nimport { ShapeManager } from '../Core/Managers/ShapeManager';\r\nimport { CharacteristicElements } from '../Core/Objects/CharacteristicElements';\r\nimport { Coordinates } from '../Core/Objects/Coordinates';\r\nimport { Point } from '../Core/Objects/Point';\r\nimport { ShapeGroup } from '../Core/Objects/ShapeGroup';\r\nimport { GeometryObject } from '../Core/Objects/Shapes/GeometryObject';\r\nimport { SinglePointShape } from '../Core/Objects/Shapes/SinglePointShape';\r\nimport { Tool } from '../Core/States/Tool';\r\nimport { findObjectById, removeObjectById } from '../Core/Tools/general';\r\n\r\n/**\r\n */\r\nexport class CentralSymetryTool extends Tool {\r\n  constructor() {\r\n    super('centralSymetry', 'Sym├®trie centrale', 'transformation');\r\n  }\r\n\r\n  start() {\r\n    this.removeListeners();\r\n    this.duration = app.settings.geometryTransformationAnimation\r\n      ? app.settings.geometryTransformationAnimationDuration\r\n      : 0.001;\r\n\r\n    setTimeout(\r\n      () =>\r\n        setState({\r\n          tool: {\r\n            ...app.tool,\r\n            name: this.name,\r\n            currentStep: 'selectCharacteristicElement',\r\n          },\r\n        }),\r\n      50,\r\n    );\r\n  }\r\n\r\n  selectCharacteristicElement() {\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.stopAnimation();\r\n    this.removeListeners();\r\n\r\n    this.showLastCharacteristicElements();\r\n\r\n    this.pointDrawn = null;\r\n    this.characteristicElements = null;\r\n\r\n    this.mouseDownId = app.addListener('canvasMouseDown', this.handler);\r\n  }\r\n\r\n  animateCharacteristicElement() {\r\n    this.removeListeners();\r\n\r\n    window.dispatchEvent(new CustomEvent('reset-selection-constraints'));\r\n    app.workspace.selectionConstraints.eventType = 'click';\r\n    app.workspace.selectionConstraints.points.canSelect = true;\r\n    this.animate();\r\n    this.mouseUpId = app.addListener('canvasMouseUp', this.handler);\r\n  }\r\n\r\n  selectObject() {\r\n    if (this.drawingShapes)\r\n      this.drawingShapes.forEach((s) => {\r\n        removeObjectById(s.id);\r\n      });\r\n    const shapesToDelete = [];\r\n    app.upperCanvasLayer.shapes.forEach((s) => {\r\n      if (s.geometryObject.geometryIsCharacteristicElements)\r\n        shapesToDelete.push(s);\r\n    });\r\n    shapesToDelete.forEach((s) => removeObjectById(s.id));\r\n    this.removeListeners();\r\n\r\n    this.setSelectionConstraints();\r\n    this.objectSelectedId = app.addListener('objectSelected', this.handler);\r\n  }\r\n\r\n  central() {\r\n    this.removeListeners();\r\n\r\n    this.startTime = Date.now();\r\n    this.animate();\r\n  }\r\n\r\n  end() {\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.stopAnimation();\r\n    this.removeListeners();\r\n  }\r\n\r\n  canvasMouseDown() {\r\n    const coord = app.workspace.lastKnownMouseCoordinates;\r\n    this.pointDrawn = new Point({\r\n      coordinates: coord,\r\n      layer: 'upper',\r\n      color: app.settings.referenceDrawColor,\r\n      size: 2,\r\n    });\r\n    setState({\r\n      tool: {\r\n        ...app.tool,\r\n        name: this.name,\r\n        currentStep: 'animateCharacteristicElement',\r\n      },\r\n    });\r\n  }\r\n\r\n  canvasMouseUp() {\r\n    this.stopAnimation();\r\n\r\n    window.dispatchEvent(new CustomEvent('reset-selection-constraints'));\r\n    app.workspace.selectionConstraints.eventType = 'click';\r\n    app.workspace.selectionConstraints.points.canSelect = true;\r\n    app.workspace.selectionConstraints.points.canSelectFromUpper = true;\r\n\r\n    const coord = app.workspace.lastKnownMouseCoordinates;\r\n    let object = SelectManager.selectObject(coord);\r\n    if (object) {\r\n      if (object.shape.geometryObject.geometryIsCharacteristicElements) {\r\n        this.characteristicElements = new CharacteristicElements(\r\n          object.shape.geometryObject.geometryTransformationCharacteristicElements,\r\n        );\r\n      } else {\r\n        app.workspace.selectionConstraints.points.canSelectFromUpper = false;\r\n        object = SelectManager.selectObject(coord);\r\n\r\n        this.characteristicElements = new CharacteristicElements({\r\n          type: 'symetryCenter',\r\n          elementIds: [object.id],\r\n        });\r\n      }\r\n    }\r\n    setState({\r\n      tool: { ...app.tool, name: this.name, currentStep: 'selectObject' },\r\n    });\r\n  }\r\n\r\n  objectSelected(object) {\r\n    if (!object) return;\r\n\r\n    this.involvedShapes = ShapeManager.getAllBindedShapes(object);\r\n    this.drawingShapes = this.involvedShapes.map(\r\n      (s) =>\r\n        new s.constructor({\r\n          ...s,\r\n          layer: 'upper',\r\n          path: s.getSVGPath('no scale', false),\r\n          id: undefined,\r\n          segmentsColor: s.segments.map((seg) => {\r\n            return seg.color;\r\n          }),\r\n          pointsColor: s.vertexes.map((pt) => {\r\n            return pt.color;\r\n          }),\r\n        }),\r\n    );\r\n    setState({\r\n      tool: {\r\n        ...app.tool,\r\n        currentStep: 'central',\r\n      },\r\n    });\r\n  }\r\n\r\n  animate() {\r\n    if (app.tool.currentStep == 'animateCharacteristicElement') {\r\n      window.dispatchEvent(new CustomEvent('refreshUpper'));\r\n      this.requestAnimFrameId = window.requestAnimationFrame(() =>\r\n        this.animate(),\r\n      );\r\n      return;\r\n    }\r\n    this.lastProgress = this.progress || 0;\r\n    if (this.lastProgress == 0) {\r\n      app.upperCanvasLayer.points.forEach((point) => {\r\n        point.startCoordinates = new Coordinates(point.coordinates);\r\n        point.endCoordinates = new Coordinates({\r\n          x: point.x + 2 * (this.pointDrawn.x - point.x),\r\n          y: point.y + 2 * (this.pointDrawn.y - point.y),\r\n        });\r\n      });\r\n    }\r\n    this.progress = (Date.now() - this.startTime) / (this.duration * 1000);\r\n    if (this.progress > 1 && app.tool.name == 'centralSymetry') {\r\n      this.executeAction();\r\n      setState({\r\n        tool: { ...app.tool, name: this.name, currentStep: 'selectObject' },\r\n      });\r\n    } else {\r\n      window.dispatchEvent(new CustomEvent('refreshUpper'));\r\n      this.requestAnimFrameId = window.requestAnimationFrame(() =>\r\n        this.animate(),\r\n      );\r\n    }\r\n  }\r\n\r\n  refreshStateUpper() {\r\n    if (app.tool.currentStep == 'central') {\r\n      app.upperCanvasLayer.points.forEach((point) => {\r\n        if (point.startCoordinates)\r\n          point.coordinates = point.startCoordinates.substract(\r\n            point.startCoordinates\r\n              .substract(point.endCoordinates)\r\n              .multiply(this.progress),\r\n          );\r\n      });\r\n    } else if (app.tool.currentStep == 'animateCharacteristicElement') {\r\n      const coord = app.workspace.lastKnownMouseCoordinates;\r\n      const object = SelectManager.selectObject(coord);\r\n      if (object) {\r\n        this.pointDrawn.coordinates = object.coordinates;\r\n      } else {\r\n        this.pointDrawn.coordinates = coord;\r\n      }\r\n    }\r\n  }\r\n\r\n  _executeAction() {\r\n    if (!this.characteristicElements) {\r\n      const coord = this.pointDrawn.coordinates;\r\n      const point = new SinglePointShape({\r\n        layer: 'main',\r\n        path: `M ${coord.x} ${coord.y}`,\r\n        name: 'Point',\r\n        familyName: 'Point',\r\n        geometryObject: new GeometryObject({}),\r\n      }).points[0];\r\n      this.characteristicElements = new CharacteristicElements({\r\n        type: 'symetryCenter',\r\n        elementIds: [point.id],\r\n      });\r\n    }\r\n    if (\r\n      !app.workspace.centralSymetryLastCharacteristicElements.find((elements) =>\r\n        this.characteristicElements.equal(elements),\r\n      )\r\n    ) {\r\n      app.workspace.centralSymetryLastCharacteristicElements.push(\r\n        this.characteristicElements,\r\n      );\r\n    }\r\n    const newShapes = this.involvedShapes.map((s) => {\r\n      const newShape = new s.constructor({\r\n        ...s,\r\n        layer: 'main',\r\n        familyName: 'transformation',\r\n        id: undefined,\r\n        path: s.getSVGPath('no scale', false),\r\n        segmentsColor: s.segments.map((seg) => {\r\n          return seg.color;\r\n        }),\r\n        pointsColor: s.vertexes.map((pt) => {\r\n          return pt.color;\r\n        }),\r\n        geometryObject: new GeometryObject({\r\n          geometryTransformationChildShapeIds: [],\r\n          geometryTransformationParentShapeId: s.id,\r\n          geometryTransformationCharacteristicElements:\r\n            this.characteristicElements,\r\n          geometryTransformationName: 'centralSymetry',\r\n          geometryIsVisible: s.geometryObject.geometryIsVisible,\r\n          geometryIsHidden: s.geometryObject.geometryIsHidden,\r\n          geometryIsConstaintDraw: s.geometryObject.geometryIsConstaintDraw,\r\n        }),\r\n      });\r\n      s.geometryObject.geometryTransformationChildShapeIds.push(newShape.id);\r\n      const symetryCenter = this.characteristicElements.firstElement;\r\n      if (\r\n        !symetryCenter.shape.geometryObject.geometryTransformationChildShapeIds.includes(\r\n          newShape.id,\r\n        )\r\n      ) {\r\n        symetryCenter.shape.geometryObject.geometryTransformationChildShapeIds.push(\r\n          newShape.id,\r\n        );\r\n      }\r\n      newShape.rotate(Math.PI, symetryCenter.coordinates);\r\n      newShape.points.forEach((pt, idx) => {\r\n        pt.geometryIsVisible = s.points[idx].geometryIsVisible;\r\n        pt.geometryIsHidden = s.points[idx].geometryIsHidden;\r\n      });\r\n      return newShape;\r\n    });\r\n\r\n    if (newShapes.length > 1) {\r\n      const userGroup = new ShapeGroup(0, 1);\r\n      userGroup.shapesIds = newShapes.map((s) => s.id);\r\n      GroupManager.addGroup(userGroup);\r\n    }\r\n  }\r\n\r\n  setSelectionConstraints() {\r\n    const constraints = app.fastSelectionConstraints.mousedown_all_shape;\r\n    constraints.shapes.blacklist = app.mainCanvasLayer.shapes.filter(\r\n      (s) => s.geometryObject.geometryPointOnTheFlyChildId,\r\n    );\r\n    app.workspace.selectionConstraints = constraints;\r\n  }\r\n\r\n  showLastCharacteristicElements() {\r\n    app.workspace.centralSymetryLastCharacteristicElements.forEach(\r\n      (characteristicElement) => {\r\n        const point = findObjectById(characteristicElement.elementIds[0]);\r\n        const shape = new SinglePointShape({\r\n          layer: 'upper',\r\n          path: `M ${point.coordinates.x} ${point.coordinates.y}`,\r\n          name: 'Point',\r\n          familyName: 'Point',\r\n          geometryObject: new GeometryObject({\r\n            geometryIsCharacteristicElements: true,\r\n            geometryTransformationCharacteristicElements: characteristicElement,\r\n          }),\r\n        });\r\n        shape.points[0].color = app.settings.referenceDrawColor2;\r\n        shape.points[0].size = 2;\r\n      },\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\CentralSymetry\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Color\\ColorTool.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":89,"column":24,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":89,"endColumn":26,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2453,2455],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":112,"column":24,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":112,"endColumn":26,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3164,3166],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":118,"column":34,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":118,"endColumn":36,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[3428,3430],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":138,"column":31,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":138,"endColumn":33,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4109,4111],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { html } from 'lit';\r\nimport { app, setState } from '../Core/App';\r\nimport { SelectManager } from '../Core/Managers/SelectManager';\r\nimport { ShapeManager } from '../Core/Managers/ShapeManager';\r\nimport { Segment } from '../Core/Objects/Segment';\r\nimport { LineShape } from '../Core/Objects/Shapes/LineShape';\r\nimport { Shape } from '../Core/Objects/Shapes/Shape';\r\nimport { Tool } from '../Core/States/Tool';\r\n\r\n/**\r\n * Modifier la couleur\r\n */\r\nexport class ColorTool extends Tool {\r\n  constructor() {\r\n    super('color', 'Colorier', 'tool');\r\n  }\r\n\r\n  /**\r\n   * Renvoie l'aide ├á afficher ├á l'utilisateur\r\n   * @return {String} L'aide, en HTML\r\n   */\r\n  getHelpText() {\r\n    const toolName = this.title;\r\n    return html`\r\n      <h3>${toolName}</h3>\r\n      <p>\r\n        Vous avez s├®lectionn├® l'outil <b>\"${toolName}\"</b>.<br />\r\n        <!-- Apr├¿s avoir choisi une couleur, touchez une figure pour en colorier les\r\n        bords. -->\r\n      </p>\r\n    `;\r\n  }\r\n\r\n  start() {\r\n    setTimeout(\r\n      () =>\r\n        setState({\r\n          tool: { ...app.tool, name: this.name, currentStep: 'listen' },\r\n        }),\r\n      50,\r\n    );\r\n  }\r\n\r\n  listen() {\r\n    this.mustPreventNextClick = false;\r\n    this.removeListeners();\r\n    this.longPressId = app.addListener('canvasLongPress', this.handler);\r\n    this.mouseClickId = app.addListener('canvasClick', this.handler);\r\n  }\r\n\r\n  end() {\r\n    this.removeListeners();\r\n  }\r\n\r\n  canvasLongPress() {\r\n    const mouseCoordinates = app.workspace.lastKnownMouseCoordinates;\r\n    this.clickType = 'long';\r\n    this.getConstraints();\r\n\r\n    const object = SelectManager.selectObject(mouseCoordinates);\r\n    if (object) {\r\n      this.object = object;\r\n      this.executeAction();\r\n    }\r\n    this.mustPreventNextClick = true;\r\n  }\r\n\r\n  canvasClick() {\r\n    if (this.mustPreventNextClick) {\r\n      this.mustPreventNextClick = false;\r\n      return;\r\n    }\r\n    const mouseCoordinates = app.workspace.lastKnownMouseCoordinates;\r\n    this.clickType = 'normal';\r\n    this.getConstraints();\r\n\r\n    let object = SelectManager.selectObject(mouseCoordinates);\r\n    if (object) {\r\n      if (object instanceof Segment && object.shape instanceof LineShape)\r\n        object = object.shape;\r\n      this.object = object;\r\n      this.executeAction();\r\n    }\r\n  }\r\n\r\n  getConstraints() {\r\n    const constraints = SelectManager.getEmptySelectionConstraints();\r\n    constraints.shapes.canSelect = true;\r\n    if (this.clickType == 'normal') {\r\n      constraints.segments.canSelect = true;\r\n      constraints.segments.blockHidden = true; // s├╗r ?\r\n      constraints.points.canSelect = true;\r\n      constraints.points.blockHidden = true; // s├╗r ?\r\n      constraints.points.numberOfObjects = 'allSuperimposed';\r\n      constraints.priority = ['points', 'shapes', 'segments'];\r\n    }\r\n    app.workspace.selectionConstraints = constraints;\r\n  }\r\n\r\n  objectSelected(shape) {\r\n    if (!shape) return;\r\n\r\n    this.involvedShapes = ShapeManager.getAllBindedShapes(shape);\r\n\r\n    this.executeAction();\r\n    setState({\r\n      tool: { ...app.tool, name: this.name, currentStep: 'listen' },\r\n    });\r\n  }\r\n\r\n  _executeAction() {\r\n    if (this.clickType == 'normal') {\r\n      if (this.object instanceof Shape) {\r\n        const involvedShapes = ShapeManager.getAllBindedShapes(this.object);\r\n        let mustChangeOpacity = false;\r\n        if (\r\n          involvedShapes.some((s) => {\r\n            return s.fillOpacity != 1;\r\n          })\r\n        ) {\r\n          mustChangeOpacity = true;\r\n        }\r\n        involvedShapes.forEach((s) => {\r\n          if (s instanceof LineShape && !s.segments[0].isArc()) {\r\n            s.strokeColor = app.settings.shapesDrawColor;\r\n          } else {\r\n            if (mustChangeOpacity) s.fillOpacity = 0.7;\r\n            s.fillColor = app.settings.shapesDrawColor;\r\n          }\r\n        });\r\n      } else if (this.object instanceof Segment) {\r\n        this.object.color = app.settings.shapesDrawColor;\r\n      } else {\r\n        this.object.forEach(\r\n          (obj) => (obj.color = app.settings.shapesDrawColor),\r\n        );\r\n      }\r\n    } else if (this.clickType == 'long') {\r\n      const involvedShapes = ShapeManager.getAllBindedShapes(this.object);\r\n      involvedShapes.forEach((s) => {\r\n        s.strokeColor = app.settings.shapesDrawColor;\r\n      });\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Color\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Copy\\CopyTool.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":110,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":110,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[3800,3802],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":127,"column":35,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":127,"endColumn":37,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[4358,4360],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":144,"column":31,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":144,"endColumn":33,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4982,4984],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":174,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":174,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[5996,5998],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":193,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":193,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[6504,6506],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":204,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":204,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6843,6845],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":257,"column":19,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":257,"endColumn":21,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8543,8545],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":265,"column":35,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":265,"endColumn":37,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[8881,8883],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":289,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":289,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[9740,9742],"text":"!=="},"desc":"Use '!==' instead of '!='."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { html } from 'lit';\r\nimport { app, setState } from '../Core/App';\r\nimport { GroupManager } from '../Core/Managers/GroupManager';\r\nimport { SelectManager } from '../Core/Managers/SelectManager';\r\nimport { ShapeManager } from '../Core/Managers/ShapeManager';\r\nimport { Coordinates } from '../Core/Objects/Coordinates';\r\nimport { Segment } from '../Core/Objects/Segment';\r\nimport { ShapeGroup } from '../Core/Objects/ShapeGroup';\r\nimport { GeometryObject } from '../Core/Objects/Shapes/GeometryObject';\r\nimport { LineShape } from '../Core/Objects/Shapes/LineShape';\r\nimport { SinglePointShape } from '../Core/Objects/Shapes/SinglePointShape';\r\nimport { Tool } from '../Core/States/Tool';\r\nimport { getShapeAdjustment } from '../Core/Tools/automatic_adjustment';\r\nimport { addInfoToId, findObjectById } from '../Core/Tools/general';\r\nimport { computeAllShapeTransform } from '../GeometryTools/recomputeShape';\r\n\r\n/**\r\n * Dupliquer une figure\r\n */\r\nexport class CopyTool extends Tool {\r\n  constructor() {\r\n    super('copy', 'Copier', 'operation');\r\n\r\n    this.currentStep = null; // listen-canvas-click -> moving-shape\r\n\r\n    //coordonn├®es de la souris lorsque la duplication a commenc├®\r\n    this.startClickCoordinates = null;\r\n\r\n    /*\r\n        L'ensemble des figures li├®es ├á la figure s├®lectionn├®e, y compris la figure\r\n        elle-m├¬me\r\n         */\r\n    this.involvedShapes = [];\r\n\r\n    this.translateOffset = new Coordinates({ x: -20, y: -20 });\r\n\r\n    this.shapeMoved = 0;\r\n  }\r\n\r\n  /**\r\n   * Renvoie l'aide ├á afficher ├á l'utilisateur\r\n   * @return {String} L'aide, en HTML\r\n   */\r\n  getHelpText() {\r\n    const toolName = this.title;\r\n    return html`\r\n      <h3>${toolName}</h3>\r\n      <p>\r\n        Vous avez s├®lectionn├® l'outil <b>\"${toolName}\"</b>.<br />\r\n        Pour copier une figure, appuyez sur la figure et faites glissez votre\r\n        doigt dans une direction sans le relacher. Relachez ensuite votre doigt\r\n        une fois que la nouvelle figure est ├á la bonne place.<br /><br />\r\n        <b>Attention:</b> si vous appuyez sur une figure puis relachez\r\n        directement, une copie de la figure aura bien ├®t├® cr├®├®e, mais ├á la m├¬me\r\n        position que la figure d'origine. Il y a donc deux figures l'une sur\r\n        l'autre.<br /><br />\r\n        <b>Note:</b> la nouvelle figure cr├®├®e n'est pas li├®e d'une mani├¿re ou\r\n        d'une autre avec la figure d'origine: il s'agit bien d'une copie\r\n        compl├¿tement ind├®pendante.\r\n      </p>\r\n    `;\r\n  }\r\n\r\n  start() {\r\n    setTimeout(\r\n      () =>\r\n        setState({\r\n          tool: { ...app.tool, name: this.name, currentStep: 'listen' },\r\n        }),\r\n      50,\r\n    );\r\n  }\r\n\r\n  listen() {\r\n    this.shapeMoved = 0;\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.stopAnimation();\r\n    this.removeListeners();\r\n\r\n    const constraints = SelectManager.getEmptySelectionConstraints();\r\n    constraints.eventType = 'mousedown';\r\n    constraints.shapes.canSelect = true;\r\n    constraints.shapes.blacklist = app.mainCanvasLayer.shapes.filter(\r\n      (s) => s instanceof SinglePointShape,\r\n    );\r\n    constraints.segments.canSelect = true;\r\n    constraints.segments.blacklist = app.mainCanvasLayer.shapes\r\n      .filter((s) => s instanceof LineShape)\r\n      .map((s) => {\r\n        return { shapeId: s.id };\r\n      });\r\n    constraints.priority = ['points', 'shapes', 'segments'];\r\n    app.workspace.selectionConstraints = constraints;\r\n    this.objectSelectedId = app.addListener('objectSelected', this.handler);\r\n  }\r\n\r\n  move() {\r\n    this.removeListeners();\r\n\r\n    this.mouseUpId = app.addListener('canvasMouseUp', this.handler);\r\n  }\r\n\r\n  end() {\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.stopAnimation();\r\n    this.removeListeners();\r\n  }\r\n\r\n  objectSelected(object) {\r\n    if (app.tool.currentStep != 'listen') return;\r\n    if (!object) return;\r\n\r\n    if (object instanceof Segment) {\r\n      this.mode = 'segment';\r\n\r\n      this.startClickCoordinates = app.workspace.lastKnownMouseCoordinates;\r\n      this.lastKnownMouseCoordinates = this.startClickCoordinates;\r\n\r\n      this.involvedSegment = object;\r\n\r\n      const newShape = new LineShape({\r\n        layer: 'upper',\r\n        path: object.getSVGPath('no scale', true),\r\n        id: undefined,\r\n        segmentsColor: [object.color],\r\n        pointsColor: object.points\r\n          .filter((pt) => pt.type != 'divisionPoint')\r\n          .map((pt) => {\r\n            return pt.color;\r\n          }),\r\n        geometryObject: new GeometryObject({}),\r\n      });\r\n      this.selectedShape = newShape;\r\n      this.shapesToMove = [this.selectedShape];\r\n      newShape.translate(this.translateOffset);\r\n\r\n      this.drawingShapes = [newShape];\r\n    } else {\r\n      this.mode = 'shape';\r\n      this.selectedShape = object;\r\n      this.involvedShapes = ShapeManager.getAllBindedShapes(object);\r\n      for (let i = 0; i < this.involvedShapes.length; i++) {\r\n        const currentShape = this.involvedShapes[i];\r\n        if (currentShape.name == 'Vector') {\r\n          window.dispatchEvent(\r\n            new CustomEvent('show-notif', {\r\n              detail: {\r\n                message:\r\n                  'Les vecteurs ne peuvent pas ├¬tre copi├®s, mais peuvent ├¬tre multipli├®s.',\r\n              },\r\n            }),\r\n          );\r\n          return;\r\n        }\r\n      }\r\n\r\n      this.startClickCoordinates = app.workspace.lastKnownMouseCoordinates;\r\n      this.lastKnownMouseCoordinates = this.startClickCoordinates;\r\n\r\n      // sort shape by height\r\n      this.involvedShapes.sort(\r\n        (s1, s2) =>\r\n          ShapeManager.getShapeIndex(s1) - ShapeManager.getShapeIndex(s2),\r\n      );\r\n      this.drawingShapes = this.involvedShapes.map((s) => {\r\n        const newShape = new s.constructor({\r\n          ...s,\r\n          layer: 'upper',\r\n          path: s.getSVGPath('no scale', false),\r\n          segmentsColor: s.segments.map((seg) => {\r\n            return seg.color;\r\n          }),\r\n          pointsColor: s.points\r\n            .filter((pt) => pt.type != 'divisionPoint')\r\n            .map((pt) => {\r\n              return pt.color;\r\n            }),\r\n        });\r\n        newShape.vertexes.forEach(\r\n          (vx, idx) => (vx.visible = s.vertexes[idx].visible),\r\n        );\r\n        newShape.translate(this.translateOffset);\r\n        return newShape;\r\n      });\r\n      this.shapesToMove = this.drawingShapes;\r\n    }\r\n\r\n    setState({ tool: { ...app.tool, currentStep: 'move' } });\r\n    this.animate();\r\n  }\r\n\r\n  canvasMouseUp() {\r\n    if (app.tool.currentStep != 'move') return;\r\n\r\n    this.translation = app.workspace.lastKnownMouseCoordinates\r\n      .substract(this.startClickCoordinates)\r\n      .add(this.translateOffset);\r\n\r\n    this.executeAction();\r\n    setState({ tool: { ...app.tool, name: this.name, currentStep: 'listen' } });\r\n  }\r\n\r\n  refreshStateUpper() {\r\n    if (app.tool.currentStep == 'move') {\r\n      this.shapeMoved++;\r\n      if (this.shapeMoved <= 10) return;\r\n      const mainShape = findObjectById(\r\n        addInfoToId(this.selectedShape.id, 'upper'),\r\n      );\r\n      const translation = app.workspace.lastKnownMouseCoordinates.substract(\r\n        this.lastKnownMouseCoordinates,\r\n      );\r\n\r\n      this.shapesToMove.forEach((s) => {\r\n        if (this.lastAdjusment) {\r\n          s.translate(\r\n            Coordinates.nullCoordinates.substract(\r\n              this.lastAdjusment.translation,\r\n            ),\r\n          );\r\n          s.rotate(\r\n            this.lastAdjusment.rotationAngle * -1,\r\n            this.lastAdjusment.centerCoord,\r\n          );\r\n        }\r\n        s.translate(translation);\r\n      });\r\n\r\n      const adjustment = getShapeAdjustment(this.shapesToMove, mainShape);\r\n      this.lastAdjusment = {\r\n        ...adjustment,\r\n        centerCoord: new Coordinates(mainShape.centerCoordinates),\r\n      };\r\n      this.shapesToMove.forEach((s) => {\r\n        s.rotate(adjustment.rotationAngle, this.lastAdjusment.centerCoord);\r\n        s.translate(adjustment.translation);\r\n      });\r\n      this.shapesToMove.forEach((s) => {\r\n        computeAllShapeTransform(s, 'upper', false);\r\n      });\r\n\r\n      this.lastKnownMouseCoordinates = app.workspace.lastKnownMouseCoordinates;\r\n\r\n      // let transformation = app.workspace.lastKnownMouseCoordinates.substract(\r\n      //   this.lastKnownMouseCoordinates,\r\n      // );\r\n\r\n      // this.drawingShapes.forEach((s) => s.translate(transformation));\r\n\r\n      // this.lastKnownMouseCoordinates = app.workspace.lastKnownMouseCoordinates;\r\n    }\r\n  }\r\n\r\n  _executeAction() {\r\n    const shapesList = [];\r\n\r\n    if (this.mode == 'segment') {\r\n      const newShape = new LineShape({\r\n        layer: 'main',\r\n        familyName: 'copy',\r\n        path: this.involvedSegment.getSVGPath('no scale', true),\r\n        id: undefined,\r\n        segmentsColor: [this.involvedSegment.color],\r\n        pointsColor: this.involvedSegment.points\r\n          .filter((pt) => pt.type != 'divisionPoint')\r\n          .map((pt) => {\r\n            return pt.color;\r\n          }),\r\n        geometryObject: new GeometryObject({}),\r\n      });\r\n\r\n      shapesList.push(newShape);\r\n      newShape.translate(this.translation);\r\n    } else {\r\n      this.involvedShapes.forEach((s) => {\r\n        const newShape = new s.constructor({\r\n          ...s,\r\n          layer: 'main',\r\n          familyName: 'copy',\r\n          path: s.getSVGPath('no scale', false),\r\n          id: undefined,\r\n          // divisionPointInfos: s.divisionPoints.map((dp) => {\r\n          //   return { coordinates: dp.coordinates, ratio: dp.ratio, segmentIdx: dp.segments[0].idx, color: dp.color };\r\n          // }),\r\n          segmentsColor: s.segments.map((seg) => {\r\n            return seg.color;\r\n          }),\r\n          pointsColor: s.points\r\n            .filter((pt) => pt.type != 'divisionPoint')\r\n            .map((pt) => {\r\n              return pt.color;\r\n            }),\r\n        });\r\n        newShape.vertexes.forEach(\r\n          (vx, idx) => (vx.visible = s.vertexes[idx].visible),\r\n        );\r\n        if (newShape.name.startsWith('Parallele'))\r\n          newShape.name = newShape.name.slice('Parallele'.length);\r\n        if (newShape.name.startsWith('Perpendicular'))\r\n          newShape.name = newShape.name.slice('Perpendicular'.length);\r\n        if (newShape.geometryObject)\r\n          newShape.geometryObject = new GeometryObject({});\r\n        shapesList.push(newShape);\r\n        newShape.translate(this.translation);\r\n      });\r\n    }\r\n\r\n    if (this.shapeMoved > 10) {\r\n      const transformation = getShapeAdjustment(shapesList, shapesList[0]);\r\n\r\n      shapesList.forEach((newShape) => {\r\n        newShape.rotate(\r\n          transformation.rotationAngle,\r\n          shapesList[0].centerCoordinates,\r\n        );\r\n        newShape.translate(transformation.translation);\r\n      });\r\n    }\r\n\r\n    if (shapesList.length > 1) {\r\n      const userGroup = new ShapeGroup(0, 1);\r\n      userGroup.shapesIds = shapesList.map((s) => s.id);\r\n      GroupManager.addGroup(userGroup);\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Copy\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\App.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":240,"column":59,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":240,"endColumn":61,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[9357,9359],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":245,"column":43,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":245,"endColumn":45,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[9526,9528],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { signal } from '@lit-labs/signals';\r\nimport { resetToolsVisibility, tools } from '@store/tools';\r\nimport { resetKitVisibility } from '../../store/kit';\r\nimport { initSaveFileEventListener } from './Managers/SaveFileManager';\r\nimport { initSelectManager } from './Managers/SelectManager';\r\nimport { uniqId } from './Tools/general';\r\nimport { Workspace } from './Objects/Workspace';\r\n\r\nexport const changes = signal({});\r\n\r\n/**\r\n * @typedef {object} Settings Configuration de l'application\r\n * @property {number} magnetismDistance - Distance de magn├®tisme.\r\n * @property {number} selectionDistance - Distance de s├®lection.\r\n * @property {number} precision - Pr├®cision des calculs.\r\n * @property {number} maxZoomLevel - Niveau de zoom maximal.\r\n * @property {number} minZoomLevel - Niveau de zoom minimal.\r\n * @property {number} mainMenuWidth - Largeur du menu principal.\r\n * @property {string} constraintsDrawColor - Couleur pour dessiner les contraintes.\r\n * @property {string} temporaryDrawColor - Couleur pour les dessins temporaires.\r\n * @property {string} referenceDrawColor - Couleur de r├®f├®rence pour le dessin.\r\n * @property {string} referenceDrawColor2 - Deuxi├¿me couleur de r├®f├®rence pour le dessin.\r\n * @property {number} geometryTransformationAnimationDuration - Dur├®e de l'animation pour la transformation g├®om├®trique.\r\n * @property {boolean} geometryTransformationAnimation - Activer/d├®sactiver l'animation de transformation g├®om├®trique.\r\n * @property {boolean} automaticAdjustment - Ajustement automatique.\r\n * @property {boolean} areShapesPointed - Indique si les formes sont point├®es.\r\n * @property {number} shapesSize - Taille des formes.\r\n * @property {number} numberOfDivisionParts - Nombre de parties pour la division.\r\n * @property {number} numberOfRegularPoints - Nombre de points pour les formes r├®guli├¿res.\r\n * @property {string} shapesDrawColor - Couleur de dessin pour les formes.\r\n * @property {number} shapeOpacity - Opacit├® des formes.\r\n * @property {number} scalarNumerator - Num├®rateur pour la mise ├á l'├®chelle.\r\n * @property {number} scalarDenominator - D├®nominateur pour la mise ├á l'├®chelle.\r\n * @property {boolean} gridShown - Afficher/masquer la grille.\r\n * @property {string} gridType - Type de grille ('none', 'square', 'triangle').\r\n * @property {number} gridSize - Taille de la grille.\r\n */\r\n\r\n/**\r\n * @typedef {object} HistoryState ├ëtat de l'historique\r\n * @property {number} index - Index actuel dans l'historique.\r\n * @property {Array<object>} steps - Les ├®tapes de l'historique.\r\n * @property {object | null} startSituation - Situation de d├®part.\r\n * @property {Settings} startSettings - Param├¿tres de d├®part.\r\n */\r\n\r\n/**\r\n * @typedef {object} FullHistoryState ├ëtat complet de l'historique (pour la relecture)\r\n * @property {number} index - Index actuel.\r\n * @property {number} actionIndex - Index de l'action en cours.\r\n * @property {number} numberOfActions - Nombre total d'actions.\r\n * @property {Array<object>} steps - Les ├®tapes de l'historique complet.\r\n * @property {boolean} isRunning - Indique si la relecture de l'historique complet est en cours.\r\n */\r\n\r\n/**\r\n * @typedef {object} TangramState ├ëtat sp├®cifique au Tangram\r\n * @property {boolean} isSilhouetteShown - Indique si la silhouette du Tangram est affich├®e.\r\n */\r\n\r\n/**\r\n * Classe principale de l'application g├®rant l'├®tat global, les param├¿tres, l'historique et les ├®v├®nements.\r\n * @class App\r\n */\r\nexport class App {\r\n  /**\r\n   * Cr├®e une instance de App.\r\n   * Initialise les dimensions du canvas, l'outil s├®lectionn├®, les param├¿tres par d├®faut,\r\n   * l'historique, l'historique complet, l'├®tat du tangram et d'autres ├®tats internes.\r\n   */\r\n  constructor() {\r\n    /** @type {number | null} Largeur du canvas */\r\n    this.canvasWidth = null;\r\n    /** @type {number | null} Hauteur du canvas */\r\n    this.canvasHeight = null;\r\n\r\n    /** @type {object | null} L'outil actuellement s├®lectionn├® par l'utilisateur */\r\n    this.tool = null;\r\n\r\n    /** @type {Settings} Param├¿tres de l'application */\r\n    this.settings = {\r\n      magnetismDistance: 20,\r\n      selectionDistance: 20,\r\n      precision: 1.5,\r\n      maxZoomLevel: 10,\r\n      minZoomLevel: 0.1,\r\n      mainMenuWidth: 250,\r\n      constraintsDrawColor: '#080',\r\n      temporaryDrawColor: '#E90CC8',\r\n      referenceDrawColor: '#a6dbff',\r\n      referenceDrawColor2: '#4a88b2',\r\n\r\n      geometryTransformationAnimationDuration: 2,\r\n      geometryTransformationAnimation: false,\r\n\r\n      automaticAdjustment: true,\r\n      areShapesPointed: true,\r\n      shapesSize: 2,\r\n      numberOfDivisionParts: 2,\r\n      numberOfRegularPoints: 3,\r\n      shapesDrawColor: '#ff0000',\r\n      shapeOpacity: 0.7,\r\n      scalarNumerator: 1,\r\n      scalarDenominator: 1,\r\n\r\n      // gridShown: false, // Supprim├®\r\n      // gridType: 'none', // Supprim├®\r\n      // gridSize: 1, // Supprim├®\r\n    };\r\n\r\n    /** @type {HistoryState} Historique des actions de l'utilisateur */\r\n    this.history = {\r\n      index: -1,\r\n      steps: [],\r\n      startSituation: null,\r\n      startSettings: { ...this.settings },\r\n    };\r\n\r\n    /** @type {FullHistoryState} Historique complet pour la relecture des actions */\r\n    this.fullHistory = {\r\n      index: 0,\r\n      actionIndex: 0,\r\n      numberOfActions: 0,\r\n      steps: [],\r\n      isRunning: false,\r\n    };\r\n\r\n    /** @type {TangramState} ├ëtat sp├®cifique ├á l'outil Tangram */\r\n    this.tangram = {\r\n      isSilhouetteShown: false,\r\n    };\r\n\r\n    /** @type {boolean} Indique si une action a ├®t├® effectu├®e depuis la derni├¿re sauvegarde */\r\n    this.stepSinceSave = false;\r\n    /** @type {boolean} Indique si l'application a d├®marr├® */\r\n    this.started = false;\r\n    /** @type {boolean} Indique si l'application est en cours de chargement */\r\n    this.appLoading = false;\r\n    /** @type {number} Index pour la prochaine couleur de groupe ├á assigner */\r\n    this.nextGroupColorIdx = 0;\r\n\r\n    this.workspace = new Workspace();\r\n\r\n    /** @type {object} ├ëtat par d├®faut de l'application, utilis├® pour la r├®initialisation */\r\n    this.defaultState = {\r\n      tool: null,\r\n      settings: { ...this.settings },\r\n      history: { ...this.history },\r\n      fullHistory: { ...this.fullHistory },\r\n      tangram: { ...this.tangram },\r\n      stepSinceSave: this.stepSinceSave,\r\n      notionsOpen: { ...this.notionsOpen }, // Assurez-vous que this.notionsOpen est d├®fini ou initialis├®\r\n    };\r\n\r\n    /**\r\n     * @type {Object.<string, Object.<string, Function>>}\r\n     * Compteur et registre des ├®couteurs d'├®v├®nements.\r\n     * La cl├® externe est le nom de l'├®v├®nement, la cl├® interne est un ID unique pour l'├®couteur.\r\n     */\r\n    this.listenerCounter = {};\r\n\r\n    initSaveFileEventListener(this);\r\n    initSelectManager(this);\r\n  }\r\n\r\n  /**\r\n   * Ajoute un ├®couteur d'├®v├®nements ├á la fen├¬tre et le stocke pour pouvoir le supprimer ult├®rieurement.\r\n   * @param {string} listenerName - Le nom de l'├®v├®nement (ex: 'click', 'tool-changed').\r\n   * @param {Function} func - La fonction callback ├á ex├®cuter lorsque l'├®v├®nement est d├®clench├®.\r\n   * @returns {string} Un ID unique pour l'├®couteur d'├®v├®nement ajout├®, utile pour le supprimer.\r\n   */\r\n  addListener(listenerName, func) {\r\n    const id = uniqId();\r\n    if (!this.listenerCounter[listenerName]) {\r\n      this.listenerCounter[listenerName] = {};\r\n    }\r\n    this.listenerCounter[listenerName][id] = func;\r\n    window.addEventListener(listenerName, func);\r\n    return id;\r\n  }\r\n\r\n  /**\r\n   * Supprime un ├®couteur d'├®v├®nements de la fen├¬tre en utilisant son nom et l'ID retourn├® par addListener.\r\n   * @param {string} listenerName - Le nom de l'├®v├®nement.\r\n   * @param {string} id - L'ID unique de l'├®couteur ├á supprimer.\r\n   * @returns {void}\r\n   */\r\n  removeListener(listenerName, id) {\r\n    if (\r\n      !id ||\r\n      !this.listenerCounter[listenerName] ||\r\n      !this.listenerCounter[listenerName][id]\r\n    ) {\r\n      // V├®rification ajout├®e pour la robustesse\r\n      return;\r\n    }\r\n    window.removeEventListener(\r\n      listenerName,\r\n      this.listenerCounter[listenerName][id],\r\n    );\r\n    this.listenerCounter[listenerName][id] = null;\r\n  }\r\n\r\n  /**\r\n   * R├®initialise certains param├¿tres de l'application ├á leurs valeurs par d├®faut.\r\n   * Cela inclut la visibilit├® des outils, la visibilit├® du kit, et certains param├¿tres sp├®cifiques\r\n   * tout en conservant l'├®tat actuel de la grille.\r\n   * @returns {void}\r\n   */\r\n  resetSettings() {\r\n    resetToolsVisibility();\r\n    resetKitVisibility();\r\n    setState({\r\n      settings: {\r\n        ...app.defaultState.settings,\r\n        // Les lignes suivantes sont supprim├®es car l'├®tat de la grille est g├®r├® par gridStore\r\n        // gridShown: app.settings.gridShown,\r\n        // gridType: app.settings.gridType,\r\n        // gridSize: app.settings.gridSize,\r\n      },\r\n    });\r\n  }\r\n}\r\n\r\nexport const app = new App();\r\n\r\n//Pr├®paration ├á un state-changed plus g├®n├®ral\r\n//Ceci permettra aussi de r├®duire le nombre de listener par la suite\r\n/**\r\n * Met ├á jour l'├®tat global de l'application et d├®clenche les ├®v├®nements correspondants.\r\n * @param {Partial<App>} update - Un objet contenant les propri├®t├®s de l'instance `app` ├á mettre ├á jour.\r\n * @returns {void}\r\n */\r\nexport const setState = (update) => {\r\n  for (const [key, value] of Object.entries(update)) {\r\n    app[key] = value;\r\n  }\r\n\r\n  if ('tool' in update) {\r\n    const toolInfo = tools.get().find((tool) => tool.name == app.tool?.name);\r\n    if (toolInfo) {\r\n      app.tool.title = toolInfo.title;\r\n      app.tool.type = toolInfo.type;\r\n    }\r\n    if (!app.tool || app.tool.currentStep == 'start') {\r\n      window.dispatchEvent(new CustomEvent('tool-changed', { detail: app }));\r\n    }\r\n    window.dispatchEvent(new CustomEvent('tool-updated', { detail: app }));\r\n  }\r\n  if ('tangram' in update) {\r\n    window.dispatchEvent(new CustomEvent('tangram-changed', { detail: app }));\r\n  }\r\n  if ('settings' in update) {\r\n    window.dispatchEvent(new CustomEvent('settings-changed', { detail: app }));\r\n  }\r\n  if ('history' in update) {\r\n    window.dispatchEvent(new CustomEvent('history-changed', { detail: app }));\r\n  }\r\n  if ('started' in update) {\r\n    window.dispatchEvent(new CustomEvent('app-started', { detail: app }));\r\n  }\r\n  window.dispatchEvent(new CustomEvent('state-changed', { detail: app }));\r\n  changes.set(update);\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Environment.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Environments\\Cubes.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Environments\\Geometrie.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Environments\\Grandeurs.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Environments\\Tangram.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Managers\\FullHistoryManager.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":12,"column":27,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":12,"endColumn":29,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[414,416],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":14,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":14,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[473,475],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":92,"column":63,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":92,"endColumn":65,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2566,2568],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":158,"column":14,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":158,"endColumn":16,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4568,4570],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":159,"column":23,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":159,"endColumn":25,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4612,4614],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":161,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":161,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4709,4711],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":163,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":163,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4806,4808],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":171,"column":47,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":171,"endColumn":49,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5134,5136],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":177,"column":21,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":177,"endColumn":23,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5332,5334],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":177,"column":47,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":177,"endColumn":49,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5358,5360],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":179,"column":21,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":179,"endColumn":23,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5442,5444],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":182,"column":21,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":182,"endColumn":23,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5581,5583],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":184,"column":21,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":184,"endColumn":23,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5701,5703],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":187,"column":21,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":187,"endColumn":23,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5889,5891],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":190,"column":21,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":190,"endColumn":23,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6068,6070],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":203,"column":16,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":203,"endColumn":18,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6496,6498],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":205,"column":23,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":205,"endColumn":25,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6569,6571],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":210,"column":15,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":210,"endColumn":17,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6658,6660],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":210,"column":54,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":210,"endColumn":56,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6697,6699],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":212,"column":18,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":212,"endColumn":20,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[6763,6765],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":228,"column":14,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":228,"endColumn":16,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7256,7258],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":229,"column":21,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":229,"endColumn":23,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7298,7300],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":230,"column":28,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":230,"endColumn":30,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7340,7342],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":231,"column":18,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":231,"endColumn":20,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7373,7375],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":232,"column":22,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":232,"endColumn":24,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7420,7422],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":233,"column":29,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":233,"endColumn":31,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7470,7472],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":234,"column":36,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":234,"endColumn":38,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7520,7522],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":255,"column":14,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":255,"endColumn":16,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8086,8088],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":256,"column":14,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":256,"endColumn":16,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8148,8150],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":259,"column":28,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":259,"endColumn":30,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8275,8277],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":272,"column":28,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":272,"endColumn":30,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8777,8779],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":276,"column":13,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":276,"endColumn":15,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8850,8852],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":276,"column":39,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":276,"endColumn":41,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8876,8878],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":277,"column":36,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":277,"endColumn":38,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8934,8936],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":34,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app, setState } from '../App';\r\nimport { Coordinates } from '../Objects/Coordinates';\r\nimport { createElem } from '../Tools/general';\r\nimport { SelectManager } from './SelectManager';\r\n\r\n/**\r\n * Repr├®sente l'historique complet d'un espace de travail.\r\n */\r\nexport class FullHistoryManager {\r\n  static startBrowsing() {\r\n    const numberOfActions = app.fullHistory.steps.filter(\r\n      (step) => step.type == 'add-fullstep',\r\n    ).length;\r\n    if (numberOfActions == 0) {\r\n      window.dispatchEvent(\r\n        new CustomEvent('show-notif', {\r\n          detail: { message: \"L'historique est vide.\" },\r\n        }),\r\n      );\r\n      return;\r\n    }\r\n    FullHistoryManager.cleanHisto();\r\n    import('../../fullhistory-tools');\r\n    createElem('fullhistory-tools');\r\n\r\n    // if called when already running\r\n    window.clearTimeout(app.fullHistory.timeoutId);\r\n\r\n    setState({\r\n      tool: null,\r\n      fullHistory: {\r\n        ...app.fullHistory,\r\n        index: 0,\r\n        actionIndex: 0,\r\n        numberOfActions: numberOfActions,\r\n        isRunning: true,\r\n        isPlaying: false,\r\n      },\r\n    });\r\n\r\n    FullHistoryManager.saveHistory = { ...app.history };\r\n    FullHistoryManager.setWorkspaceToStartSituation();\r\n    FullHistoryManager.nextTime = 0;\r\n  }\r\n\r\n  static stopBrowsing() {\r\n    window.clearTimeout(app.fullHistory.timeoutId);\r\n    FullHistoryManager.moveTo(app.fullHistory.numberOfActions);\r\n    setState({\r\n      tool: null,\r\n      fullHistory: {\r\n        ...app.fullHistory,\r\n        isRunning: false,\r\n      },\r\n      history: { ...FullHistoryManager.saveHistory },\r\n    });\r\n  }\r\n\r\n  static pauseBrowsing() {\r\n    setState({\r\n      fullHistory: {\r\n        ...app.fullHistory,\r\n        isPlaying: false,\r\n      },\r\n    });\r\n    window.clearTimeout(app.fullHistory.timeoutId);\r\n  }\r\n\r\n  static playBrowsing(onlySingleAction = false) {\r\n    const timeoutId = setTimeout(\r\n      () => FullHistoryManager.executeAllSteps(onlySingleAction),\r\n      FullHistoryManager.nextTime + 50,\r\n    );\r\n    setState({\r\n      fullHistory: {\r\n        ...app.fullHistory,\r\n        timeoutId,\r\n        isPlaying: true,\r\n      },\r\n    });\r\n  }\r\n\r\n  static setWorkspaceToStartSituation() {\r\n    app.workspace.initFromObject(app.history.startSituation);\r\n    setState({ settings: { ...app.history.startSettings } });\r\n  }\r\n\r\n  static moveTo(actionIndex, isForSingleActionPlaying = false) {\r\n    FullHistoryManager.pauseBrowsing();\r\n    let index = app.fullHistory.steps.findIndex(\r\n      (step) =>\r\n        step.detail?.actionIndex === actionIndex && step.type == 'add-fullstep',\r\n    );\r\n    let data = app.fullHistory.steps[index]?.detail.data;\r\n    if (isForSingleActionPlaying) {\r\n      index = app.fullHistory.steps.findIndex(\r\n        (step) => step.detail?.actionIndex === actionIndex,\r\n      );\r\n      data = app.fullHistory.steps[index - 1]?.detail.data;\r\n    }\r\n    if (data) {\r\n      app.workspace.initFromObject({ ...data });\r\n      const settings = {\r\n        ...app.settings,\r\n        gridShown: data.settings.gridShown,\r\n        gridType: data.settings.gridType,\r\n        gridSize: data.settings.gridSize,\r\n      };\r\n      setState({ settings });\r\n    } else {\r\n      FullHistoryManager.setWorkspaceToStartSituation();\r\n    }\r\n\r\n    // not to re-execute fullStep\r\n    if (!isForSingleActionPlaying) index++;\r\n    setState({\r\n      fullHistory: { ...app.fullHistory, actionIndex: actionIndex, index },\r\n      tool: undefined,\r\n    });\r\n  }\r\n\r\n  static executeAllSteps(onlySingleAction = false) {\r\n    if (app.fullHistory.index >= app.fullHistory.steps.length) {\r\n      FullHistoryManager.stopBrowsing();\r\n      return;\r\n    }\r\n\r\n    if (FullHistoryManager.executeStep() && onlySingleAction) {\r\n      FullHistoryManager.pauseBrowsing();\r\n      return;\r\n    }\r\n    if (!app.fullHistory.isRunning) return;\r\n\r\n    const index = app.fullHistory.index + 1;\r\n    const timeoutId = setTimeout(\r\n      () => FullHistoryManager.executeAllSteps(onlySingleAction),\r\n      FullHistoryManager.nextTime + 50, // nextTime,\r\n    );\r\n    setState({ fullHistory: { ...app.fullHistory, index, timeoutId } });\r\n    FullHistoryManager.nextTime = 0;\r\n  }\r\n\r\n  static executeStep(index = app.fullHistory.index) {\r\n    const { type, detail } = app.fullHistory.steps[index];\r\n    if (detail && detail.mousePos) {\r\n      detail.mousePos = new Coordinates(detail.mousePos);\r\n    }\r\n\r\n    if (detail.actionIndex) {\r\n      setState({\r\n        fullHistory: {\r\n          ...app.fullHistory,\r\n          actionIndex: detail.actionIndex,\r\n        },\r\n      });\r\n    }\r\n\r\n    if (type == 'add-fullstep') {\r\n      if (detail.name == 'Retourner') {\r\n        FullHistoryManager.nextTime = 2 * 1000;\r\n      } else if (detail.name == 'Diviser') {\r\n        FullHistoryManager.nextTime = 0.5 * 1000;\r\n      } else if (detail.name == 'D├®couper') {\r\n        FullHistoryManager.nextTime = 0.5 * 1000;\r\n      }\r\n      setTimeout(() => {\r\n        const data = detail.data;\r\n        app.workspace.initFromObject(data);\r\n        setState({ tangram: { ...data.tangram } });\r\n      }, FullHistoryManager.nextTime + 30);\r\n      if (app.fullHistory.numberOfActions + 1 == app.fullHistory.actionIndex)\r\n        setTimeout(\r\n          () => FullHistoryManager.stopBrowsing(),\r\n          FullHistoryManager.nextTime,\r\n        );\r\n      return true;\r\n    } else if (type == 'tool-changed' || type == 'tool-updated') {\r\n      setState({ tool: { ...detail } });\r\n    } else if (type == 'settings-changed') {\r\n      FullHistoryManager.nextTime = 1 * 1000;\r\n      setState({ settings: { ...detail } });\r\n    } else if (type == 'objectSelected') {\r\n      SelectManager.selectObject(app.workspace.lastKnownMouseCoordinates);\r\n    } else if (type == 'mouse-coordinates-changed') {\r\n      window.dispatchEvent(new CustomEvent(type, { detail: detail }));\r\n      window.dispatchEvent(new CustomEvent('show-cursor'));\r\n    } else if (type == 'setNumberOfParts') {\r\n      window.dispatchEvent(new CustomEvent(type, { detail: detail }));\r\n      window.dispatchEvent(new CustomEvent('close-popup'));\r\n    } else if (type == 'canvasMouseUp') {\r\n      window.dispatchEvent(new CustomEvent(type));\r\n    } else {\r\n      window.dispatchEvent(new CustomEvent(type, { detail: detail }));\r\n    }\r\n  }\r\n\r\n  static cleanMouseSteps() {\r\n    let isClicked = false;\r\n    for (let i = 0; i < app.fullHistory.steps.length - 1; i++) {\r\n      const { type, _ } = app.fullHistory.steps[i];\r\n      const nextType = app.fullHistory.steps[i + 1].type;\r\n\r\n      if (type == 'canvasMouseUp') {\r\n        isClicked = false;\r\n      } else if (type == 'canvasMouseDown') {\r\n        isClicked = true;\r\n      }\r\n\r\n      if (\r\n        (type == 'mouse-coordinates-changed' || type == 'canvasMouseMove') &&\r\n        !isClicked &&\r\n        nextType != 'objectSelected'\r\n      ) {\r\n        app.fullHistory.steps.splice(i, 1);\r\n        i--;\r\n      }\r\n    }\r\n  }\r\n\r\n  static cleanColorMultiplication() {\r\n    for (let i = 0; i < app.fullHistory.steps.length - 2; i++) {\r\n      const { type, detail } = app.fullHistory.steps[i];\r\n      const nextType = app.fullHistory.steps[i + 1].type;\r\n      const nextNextType = app.fullHistory.steps[i + 2].type;\r\n      const nextNextDetail = app.fullHistory.steps[i + 2].detail;\r\n\r\n      if (\r\n        type == 'tool-updated' &&\r\n        detail.name == 'color' &&\r\n        detail.currentStep == 'listen' &&\r\n        nextType == 'settings-changed' &&\r\n        nextNextType == 'tool-updated' &&\r\n        nextNextDetail.name == 'color' &&\r\n        nextNextDetail.currentStep == 'listen'\r\n      ) {\r\n        app.fullHistory.steps.splice(i, 1);\r\n        app.fullHistory.steps.splice(i, 1);\r\n        i--;\r\n      }\r\n    }\r\n  }\r\n\r\n  static cleanHisto() {\r\n    FullHistoryManager.cleanColorMultiplication();\r\n    FullHistoryManager.cleanMouseSteps();\r\n  }\r\n\r\n  /**\r\n   * @param {String} type  Le type d'event (pas d'office ├®gal ├á celui de l'event d├®clencheur)\r\n   * @param {Event}  event L'event d├®clencheur\r\n   */\r\n  static addStep(type, event) {\r\n    if (app.fullHistory.isRunning) return;\r\n    const detail = { ...event.detail };\r\n    if (type == 'objectSelected') detail.object = undefined;\r\n    if (type == 'add-fullstep') {\r\n      detail.actionIndex =\r\n        app.fullHistory.steps.filter((step) => {\r\n          return step.type == 'add-fullstep';\r\n        }).length + 1;\r\n      const data = app.workspace.data;\r\n      data.history = undefined;\r\n      data.settings = { ...app.settings };\r\n      data.tangram = { ...app.tangram };\r\n      detail.data = data;\r\n      setState({ stepSinceSave: true });\r\n    } else if (app.fullHistory.steps.length <= 1) {\r\n      detail.actionIndex = app.fullHistory.steps.length;\r\n    } else {\r\n      detail.actionIndex =\r\n        app.fullHistory.steps.filter((step) => {\r\n          return step.type == 'add-fullstep';\r\n        }).length + 1;\r\n    }\r\n    if (\r\n      (type == 'tool-changed' || type == 'tool-updated') &&\r\n      (!detail.name || detail.name == 'solveChecker')\r\n    ) {\r\n      return;\r\n    }\r\n    const timeStamp = Date.now() - FullHistoryManager.startTimestamp;\r\n    const steps = [...app.fullHistory.steps, { type, detail, timeStamp }];\r\n    setState({ fullHistory: { ...app.fullHistory, steps } });\r\n  }\r\n}\r\n\r\nFullHistoryManager.startTimestamp = Date.now();\r\n\r\n// mouse events\r\nwindow.addEventListener('canvasClick', (event) =>\r\n  FullHistoryManager.addStep('canvasClick', event),\r\n);\r\nwindow.addEventListener('canvasMouseDown', (event) =>\r\n  FullHistoryManager.addStep('canvasMouseDown', event),\r\n);\r\nwindow.addEventListener('canvasMouseUp', (event) =>\r\n  FullHistoryManager.addStep('canvasMouseUp', event),\r\n);\r\nwindow.addEventListener('canvasMouseMove', (event) =>\r\n  FullHistoryManager.addStep('canvasMouseMove', event),\r\n);\r\nwindow.addEventListener('canvasMouseWheel', (event) =>\r\n  FullHistoryManager.addStep('canvasMouseWheel', event),\r\n);\r\nwindow.addEventListener('canvasTouchStart', (event) =>\r\n  FullHistoryManager.addStep('canvasTouchStart', event),\r\n);\r\nwindow.addEventListener('canvasTouchMove', (event) =>\r\n  FullHistoryManager.addStep('canvasTouchMove', event),\r\n);\r\nwindow.addEventListener('canvasTouchEnd', (event) =>\r\n  FullHistoryManager.addStep('canvasTouchEnd', event),\r\n);\r\nwindow.addEventListener('canvastouchcancel', (event) =>\r\n  FullHistoryManager.addStep('canvastouchcancel', event),\r\n);\r\nwindow.addEventListener('objectSelected', (event) =>\r\n  FullHistoryManager.addStep('objectSelected', event),\r\n);\r\n\r\n// use for animation states\r\nwindow.addEventListener('mouse-coordinates-changed', (event) =>\r\n  FullHistoryManager.addStep('mouse-coordinates-changed', event),\r\n);\r\n\r\nwindow.addEventListener('actions-executed', (event) =>\r\n  FullHistoryManager.addStep('add-fullstep', { detail: event.detail }),\r\n);\r\n\r\nwindow.addEventListener('create-silhouette', (event) =>\r\n  FullHistoryManager.addStep('create-silhouette', event),\r\n);\r\n\r\n// undo - redo\r\nwindow.addEventListener('undo', (event) =>\r\n  FullHistoryManager.addStep('undo', event),\r\n);\r\nwindow.addEventListener('redo', (event) =>\r\n  FullHistoryManager.addStep('redo', event),\r\n);\r\n\r\nwindow.addEventListener('close-popup', (event) =>\r\n  FullHistoryManager.addStep('close-popup', event),\r\n);\r\n\r\nwindow.addEventListener('tool-changed', () => {\r\n  FullHistoryManager.addStep('tool-changed', { detail: app.tool });\r\n});\r\nwindow.addEventListener('tool-updated', () => {\r\n  FullHistoryManager.addStep('tool-updated', { detail: app.tool });\r\n});\r\nwindow.addEventListener('settings-changed', () => {\r\n  FullHistoryManager.addStep('settings-changed', { detail: app.settings });\r\n});\r\n\r\nwindow.addEventListener('start-browsing', () => {\r\n  FullHistoryManager.startBrowsing();\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Managers\\GroupManager.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":19,"column":62,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":19,"endColumn":64,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[673,675],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":39,"column":43,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":39,"endColumn":45,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1341,1343],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":51,"column":13,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":51,"endColumn":15,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[1608,1610],"text":"!=="},"desc":"Use '!==' instead of '!='."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app } from '../App';\r\n\r\nexport class GroupManager {\r\n  /**\r\n   * Ajouter un groupe ├á l'espace de travail\r\n   * @param {Group}   group       Le groupe\r\n   * @param {Number}  index       L'index o├╣ placer le groupe. Par d├®faut: ├á la fin\r\n   */\r\n  static addGroup(group, index = app.workspace.shapeGroups.length) {\r\n    app.workspace.shapeGroups.splice(index, 0, group);\r\n  }\r\n\r\n  /**\r\n   * R├®cup├®rer l'index d'un groupe dans le tableau de groupes\r\n   * @param  {Group}  group       Le groupe\r\n   * @return {Number}             L'index (peut varier dans le temps!)\r\n   */\r\n  static getGroupIndex(group) {\r\n    return app.workspace.shapeGroups.findIndex((gr) => gr.id == group.id);\r\n  }\r\n\r\n  /**\r\n   * R├®cup├®rer le groupe d'une figure\r\n   * @param  {Shape} shape         la figure\r\n   * @return {Group}               le groupe, ou null s'il n'y en a pas.\r\n   */\r\n  static getShapeGroup(shape) {\r\n    const group = app.workspace.shapeGroups.find((gr) => gr.contains(shape.id));\r\n    return group ? group : null;\r\n  }\r\n\r\n  /**\r\n   * R├®cup├®rer un groupe ├á partir de son id\r\n   * @param  {String} id            L'id du groupe\r\n   * @return {Group}               Le groupe, ou null s'il n'existe pas\r\n   */\r\n  static getGroup(id) {\r\n    for (let i = 0; i < app.workspace.shapeGroups.length; i++) {\r\n      if (app.workspace.shapeGroups[i].id == id)\r\n        return app.workspace.shapeGroups[i];\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Supprimer un groupe\r\n   * @param  {Group} group         Le groupe\r\n   */\r\n  static deleteGroup(group) {\r\n    const idx = GroupManager.getGroupIndex(group);\r\n    if (idx != -1) app.workspace.shapeGroups.splice(idx, 1);\r\n    else console.error(\"Couldn't delete group: \", group);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Managers\\HistoryManager.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":14,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":14,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[387,389],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":36,"column":15,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":36,"endColumn":17,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[872,874],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":99,"column":32,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":99,"endColumn":34,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3789,3791],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":164,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":164,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6135,6137],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":227,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":227,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8662,8664],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":276,"column":34,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":276,"endColumn":36,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[9998,10000],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":288,"column":38,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":288,"endColumn":40,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[10514,10516],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":304,"column":15,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":304,"endColumn":17,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[10911,10913],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { gridStore } from '../../../store/gridStore';\r\nimport { app, setState } from '../App';\r\nimport { FullHistoryManager } from './FullHistoryManager';\r\n\r\n/**\r\n * Repr├®sente l'historique d'un espace de travail.\r\n */\r\nexport class HistoryManager {\r\n  /**\r\n   * Renvoie true si undo() peut ├¬tre appel├®.\r\n   * @return {Boolean}\r\n   */\r\n  static canUndo() {\r\n    return app.history.index != -1;\r\n  }\r\n\r\n  /**\r\n   * Renvoie true si redo() peut ├¬tre appel├®.\r\n   * @return {Boolean}\r\n   */\r\n  static canRedo() {\r\n    return app.history.index < app.history.steps.length - 1;\r\n  }\r\n\r\n  /**\r\n   * Annuler une ├®tape. Cela fait reculer le curseur de l'historique d'un\r\n   * ├®l├®ment.\r\n   */\r\n  static undo() {\r\n    if (!HistoryManager.canUndo()) {\r\n      console.info('Nothing to undo');\r\n      return;\r\n    }\r\n    const index = app.history.index - 1;\r\n    let data;\r\n    if (index == -1) {\r\n      data = app.history.startSituation;\r\n    } else {\r\n      data = app.history.steps[index];\r\n    }\r\n    data = { ...data }; // Clone data to avoid modifying history steps directly\r\n\r\n    app.workspace.initFromObject(data); // This might use data.settings internally if present\r\n\r\n    let settingsForApp, tangram;\r\n\r\n    if (!data || !data.settings) {\r\n      // This case handles undoing to the initial state or if settings were not saved in this step.\r\n      // Reset grid to its default state.\r\n      gridStore.setGridType('none'); // This also sets isVisible to false by default in gridStore\r\n      gridStore.setGridSize(1); // Default grid size\r\n      // No specific app settings to restore from this history step, app.settings will be used.\r\n      settingsForApp = { ...app.settings }; // Use current app settings\r\n      // Remove any potential lingering grid properties from current app settings\r\n      delete settingsForApp.gridShown;\r\n      delete settingsForApp.gridType;\r\n      delete settingsForApp.gridSize;\r\n      delete settingsForApp.isVisible;\r\n\r\n      tangram = {\r\n        ...app.defaultState.tangram,\r\n      };\r\n    } else {\r\n      // data.settings contains the settings saved at this history point.\r\n      const historicalSettings = { ...data.settings };\r\n\r\n      // Restore grid state from historicalSettings into gridStore\r\n      if (typeof historicalSettings.gridType !== 'undefined') {\r\n        gridStore.setGridType(historicalSettings.gridType);\r\n      } else {\r\n        // If not defined in history (e.g. older save), reset to default\r\n        gridStore.setGridType('none');\r\n      }\r\n      if (typeof historicalSettings.gridSize !== 'undefined') {\r\n        gridStore.setGridSize(historicalSettings.gridSize);\r\n      } else {\r\n        gridStore.setGridSize(1);\r\n      }\r\n      // isVisible should be set after setGridType, as setGridType might change isVisible.\r\n      // The key in historical data might be 'isVisible' (new) or 'gridShown' (old).\r\n      if (typeof historicalSettings.isVisible !== 'undefined') {\r\n        gridStore.setIsVisible(historicalSettings.isVisible);\r\n      } else if (typeof historicalSettings.gridShown !== 'undefined') {\r\n        // Check for old key\r\n        gridStore.setIsVisible(historicalSettings.gridShown);\r\n      }\r\n      // If neither isVisible nor gridShown is present, setGridType would have set a default visibility.\r\n\r\n      // Prepare settings to be applied to app.settings:\r\n      // Start with current app.settings, then overlay historical non-grid settings.\r\n      settingsForApp = { ...app.settings, ...historicalSettings };\r\n\r\n      // Remove all grid-related properties from settingsForApp, as grid is now managed by gridStore.\r\n      delete settingsForApp.gridType;\r\n      delete settingsForApp.gridSize;\r\n      delete settingsForApp.isVisible;\r\n      delete settingsForApp.gridShown; // Old key\r\n\r\n      if (app.environment.name == 'Tangram') {\r\n        if (data.tangram) {\r\n          tangram = {\r\n            ...app.defaultState.tangram,\r\n            isSilhouetteShown: data.tangram.isSilhouetteShown,\r\n          };\r\n        }\r\n      }\r\n    }\r\n\r\n    setState({\r\n      tool: null,\r\n      history: { ...app.history, index },\r\n      settings: settingsForApp,\r\n      tangram,\r\n    });\r\n    FullHistoryManager.addStep('add-fullstep', { detail: { name: 'Annuler' } });\r\n  }\r\n\r\n  /**\r\n   * Refaire l'├®tape qui vient d'├¬tre annul├®e. Cela fait avancer le curseur\r\n   * de l'historique d'un ├®l├®ment.\r\n   */\r\n  static redo() {\r\n    if (!HistoryManager.canRedo()) {\r\n      console.info('Nothing to redo');\r\n      return;\r\n    }\r\n    const index = app.history.index + 1;\r\n    const data = app.history.steps[index];\r\n    app.workspace.initFromObject(data); // This might use data.settings\r\n\r\n    const historicalSettings = { ...data.settings }; // Settings from the history step to redo\r\n    let tangram;\r\n\r\n    // Restore grid state from historicalSettings into gridStore\r\n    if (typeof historicalSettings.gridType !== 'undefined') {\r\n      gridStore.setGridType(historicalSettings.gridType);\r\n    } else {\r\n      gridStore.setGridType('none'); // Default if missing\r\n    }\r\n    if (typeof historicalSettings.gridSize !== 'undefined') {\r\n      gridStore.setGridSize(historicalSettings.gridSize);\r\n    } else {\r\n      gridStore.setGridSize(1); // Default if missing\r\n    }\r\n    // isVisible should be set after setGridType. Check for new and old keys.\r\n    if (typeof historicalSettings.isVisible !== 'undefined') {\r\n      gridStore.setIsVisible(historicalSettings.isVisible);\r\n    } else if (typeof historicalSettings.gridShown !== 'undefined') {\r\n      // Check for old key\r\n      gridStore.setIsVisible(historicalSettings.gridShown);\r\n    }\r\n    // If neither is present, setGridType handles default visibility.\r\n\r\n    // Prepare settings to be applied to app.settings:\r\n    // Start with current app.settings, then overlay historical non-grid settings.\r\n    const settingsForApp = { ...app.settings, ...historicalSettings };\r\n\r\n    // Remove all grid-related properties from settingsForApp\r\n    delete settingsForApp.gridType;\r\n    delete settingsForApp.gridSize;\r\n    delete settingsForApp.isVisible;\r\n    delete settingsForApp.gridShown; // Old key\r\n\r\n    if (app.environment.name == 'Tangram') {\r\n      if (data.tangram) {\r\n        tangram = {\r\n          ...app.defaultState.tangram,\r\n          isSilhouetteShown: data.tangram.isSilhouetteShown,\r\n        };\r\n      }\r\n    }\r\n    setState({\r\n      tool: null,\r\n      history: { ...app.history, index },\r\n      settings: settingsForApp,\r\n      tangram,\r\n    });\r\n    FullHistoryManager.addStep('add-fullstep', { detail: { name: 'Refaire' } });\r\n  }\r\n\r\n  /**\r\n   * Ajouter une ├®tape (ensemble d'action) ├á l'historique (l'├®tape n'est pas\r\n   * ex├®cut├®e, il est suppos├® qu'elle a d├®j├á ├®t├® ex├®cut├®e).\r\n   */\r\n  static addStep() {\r\n    const steps = [...app.history.steps];\r\n    steps.splice(\r\n      app.history.index + 1,\r\n      app.history.steps.length,\r\n      HistoryManager.saveData(),\r\n    );\r\n    const index = steps.length - 1;\r\n\r\n    HistoryManager.reduceSize(steps, index);\r\n    setState({ history: { ...app.history, steps, index } });\r\n  }\r\n\r\n  static saveData() {\r\n    const data = app.workspace.data; // This is the object that will be stored in history.\r\n    // It typically includes shapes, segments, points, etc.\r\n    const gridState = gridStore.getState();\r\n\r\n    // Create a settings object for this history entry.\r\n    // Start with a copy of the current application settings (app.settings).\r\n    // These app.settings should ideally no longer contain any grid-related properties\r\n    // as they have been migrated out of App.js.\r\n    const settingsForHistory = { ...app.settings };\r\n\r\n    // Defensively remove any old grid-related keys that might still linger in the\r\n    // app.settings copy. This ensures they don't conflict with gridStore's state.\r\n    delete settingsForHistory.gridShown; // Old key for visibility\r\n    delete settingsForHistory.gridType; // Old key for grid type\r\n    delete settingsForHistory.gridSize; // Old key for grid size\r\n    delete settingsForHistory.isVisible; // Just in case new key was wrongly in app.settings\r\n\r\n    // Now, add the authoritative grid state from gridStore to settingsForHistory.\r\n    settingsForHistory.gridType = gridState.gridType;\r\n    settingsForHistory.gridSize = gridState.gridSize;\r\n    settingsForHistory.isVisible = gridState.isVisible;\r\n    // Note: gridOpacity is not saved here, consistent with the previous behavior\r\n    // which only saved gridShown, gridType, and gridSize.\r\n\r\n    // Assign the composed settingsForHistory object to data.settings.\r\n    // This is what will be saved in the history step.\r\n    data.settings = settingsForHistory;\r\n\r\n    if (app.environment.name == 'Tangram') {\r\n      data.tangram = {\r\n        isSilhouetteShown: app.tangram?.isSilhouetteShown,\r\n      };\r\n    }\r\n\r\n    return data;\r\n  }\r\n\r\n  static isObjectEqual(object1, object2) {\r\n    const keys1 = Object.keys(object1);\r\n    const keys2 = Object.keys(object2);\r\n\r\n    if (keys1.length !== keys2.length) {\r\n      return false;\r\n    }\r\n    for (const key of keys1) {\r\n      if (object1[key] instanceof Object) {\r\n        if (!HistoryManager.isObjectEqual(object1[key], object2[key])) {\r\n          return false;\r\n        }\r\n      } else if (object1[key] !== object2[key]) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static reduceSizeOfSingleObjectType(objectType, steps, index) {\r\n    if (\r\n      !steps[index] ||\r\n      !steps[index].objects ||\r\n      !steps[index].objects[objectType + 'Data']\r\n    )\r\n      return;\r\n    if (\r\n      !steps[index - 1] ||\r\n      !steps[index - 1].objects ||\r\n      !steps[index - 1].objects[objectType + 'Data']\r\n    )\r\n      return;\r\n\r\n    for (const indexOfObject in steps[index].objects[objectType + 'Data']) {\r\n      const objectData =\r\n        steps[index].objects[objectType + 'Data'][indexOfObject];\r\n      let indexOfReference = index - 1;\r\n      let previousObjectData = steps[index - 1].objects[\r\n        objectType + 'Data'\r\n      ].find((sData) => sData.id == objectData.id);\r\n      if (previousObjectData) {\r\n        if (previousObjectData.indexOfReference) {\r\n          indexOfReference = previousObjectData.indexOfReference;\r\n          if (\r\n            !steps[indexOfReference] ||\r\n            !steps[indexOfReference].objects ||\r\n            !steps[indexOfReference].objects[objectType + 'Data']\r\n          )\r\n            continue;\r\n          previousObjectData = steps[indexOfReference].objects[\r\n            objectType + 'Data'\r\n          ].find((sData) => sData.id == objectData.id);\r\n        }\r\n        if (\r\n          previousObjectData &&\r\n          HistoryManager.isObjectEqual(objectData, previousObjectData)\r\n        ) {\r\n          steps[index].objects[objectType + 'Data'][indexOfObject] = {\r\n            id: objectData.id,\r\n            indexOfReference,\r\n          };\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  static reduceSize(steps, index) {\r\n    if (index == 0) return;\r\n    HistoryManager.reduceSizeOfSingleObjectType('shapes', steps, index);\r\n    HistoryManager.reduceSizeOfSingleObjectType('segments', steps, index);\r\n    HistoryManager.reduceSizeOfSingleObjectType('points', steps, index);\r\n  }\r\n}\r\n\r\nwindow.addEventListener('actions-executed', () => HistoryManager.addStep());\r\nwindow.addEventListener('undo', () => HistoryManager.undo());\r\nwindow.addEventListener('redo', () => HistoryManager.redo());\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Managers\\OpenFileManager.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Managers\\SaveFileManager.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'saveStateToFile' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":281,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":281,"endColumn":22,"suggestions":[{"messageId":"removeVar","data":{"varName":"saveStateToFile"},"fix":{"range":[8694,9199],"text":""},"desc":"Remove unused variable 'saveStateToFile'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'gridCanvasLayer' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":436,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":436,"endColumn":22,"suggestions":[{"messageId":"removeVar","data":{"varName":"gridCanvasLayer"},"fix":{"range":[13969,13993],"text":""},"desc":"Remove unused variable 'gridCanvasLayer'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'tangramCanvasLayer' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":437,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":437,"endColumn":25,"suggestions":[{"messageId":"removeVar","data":{"varName":"tangramCanvasLayer"},"fix":{"range":[13993,14020],"text":""},"desc":"Remove unused variable 'tangramCanvasLayer'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'mainCanvasLayer' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":438,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":438,"endColumn":22,"suggestions":[{"messageId":"removeVar","data":{"varName":"mainCanvasLayer"},"fix":{"range":[14020,14044],"text":""},"desc":"Remove unused variable 'mainCanvasLayer'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { gridStore } from '@store/gridStore';\r\nimport { kit } from '@store/kit';\r\nimport { tools } from '@store/tools';\r\nimport { setState } from '../App';\r\nimport { createElem } from '../Tools/general';\r\nimport { FullHistoryManager } from './FullHistoryManager';\r\n\r\nconst hasNativeFS = 'showSaveFilePicker' in window;\r\n\r\n/**\r\n * Propri├®t├®s temporaires ├á supprimer des settings avant la sauvegarde\r\n */\r\nconst TEMPORARY_SETTINGS_PROPERTIES = [\r\n  'numberOfDivisionParts',\r\n  'numberOfRegularPoints',\r\n  'shapesDrawColor',\r\n  'shapeOpacity',\r\n  'scalarNumerator',\r\n  'scalarDenominator',\r\n];\r\n\r\n/**\r\n * Nettoie les propri├®t├®s temporaires des settings\r\n * @param {object} settings - Les settings ├á nettoyer\r\n * @returns {object} - Les settings nettoy├®s\r\n */\r\nconst cleanTemporarySettings = (settings) => {\r\n  if (!settings) return settings;\r\n\r\n  const cleanedSettings = { ...settings };\r\n  TEMPORARY_SETTINGS_PROPERTIES.forEach((prop) => {\r\n    delete cleanedSettings[prop];\r\n  });\r\n\r\n  return cleanedSettings;\r\n};\r\n\r\n/**\r\n * Configure les options de sauvegarde selon l'environnement\r\n * @param {object} environment - L'environnement actuel\r\n * @param {object} tangram - L'├®tat du jeu Tangram (optionnel)\r\n * @param {string} fileName - Le nom sugg├®r├® du fichier\r\n * @returns {object} - Les options de sauvegarde configur├®es\r\n */\r\nconst configureSaveOptions = (environment, tangram, fileName) => {\r\n  const baseOptions = {\r\n    suggestedName: fileName || 'sans-titre',\r\n    types: [],\r\n  };\r\n\r\n  // Pour Tangram, g├®rer les options sp├®ciales\r\n  if (environment.name === 'Tangram') {\r\n    if (!tangram.isSilhouetteShown) {\r\n      baseOptions.types.push({\r\n        description: `Silhouette (*${environment.extensions[1]})`,\r\n        accept: { 'application/agmobile': [environment.extensions[1]] },\r\n      });\r\n    } else {\r\n      baseOptions.types.push({\r\n        description: `├ëtat (*${environment.extensions[0]})`,\r\n        accept: { 'application/agmobile': [environment.extensions[0]] },\r\n      });\r\n    }\r\n  } else {\r\n    // Pour les autres environnements, utiliser leurs extensions sp├®cifiques\r\n    baseOptions.types.push({\r\n      description: `├ëtat de l'application (*${environment.extensions[0]})`,\r\n      accept: { 'application/agmobile': environment.extensions },\r\n    });\r\n  }\r\n\r\n  // Ajouter toujours les options d'export image\r\n  baseOptions.types.push(\r\n    {\r\n      description: 'Image matricielle (*.png)',\r\n      accept: { 'image/png': ['.png'] },\r\n    },\r\n    {\r\n      description: 'Image vectorielle (*.svg)',\r\n      accept: { 'image/svg+xml': ['.svg'] },\r\n    },\r\n  );\r\n\r\n  return baseOptions;\r\n};\r\n\r\n/**\r\n * Pr├®pare les donn├®es sp├®cifiques ├á Tangram\r\n * @param {object} app - L'instance de l'application\r\n * @param {object} saveData - Les donn├®es de sauvegarde\r\n * @param {Array} toolsVisibility - La visibilit├® des outils\r\n */\r\nconst prepareTangramData = (app, saveData, toolsVisibility) => {\r\n  // D├®sactiver l'outil de translation pour Tangram\r\n  const translateTool = toolsVisibility.find(\r\n    (tool) => tool.name === 'translate',\r\n  );\r\n  if (translateTool) {\r\n    translateTool.isVisible = false;\r\n  }\r\n\r\n  // Ajouter le niveau Tangram si disponible\r\n  if (app.tangram.level) {\r\n    saveData.tangramLevelSelected = app.tangram.level;\r\n  }\r\n};\r\n\r\n/**\r\n * Valide l'├®tat de l'application avant la sauvegarde\r\n * @param {object} app - L'instance de l'application\r\n * @returns {boolean} - True si valide, false sinon\r\n */\r\nconst validateAppState = (app) => {\r\n  if (!app.environment) {\r\n    console.error(\r\n      \"L'environnement n'est pas charg├®, la sauvegarde est annul├®e.\",\r\n    );\r\n    window.dispatchEvent(\r\n      new CustomEvent('show-notif', {\r\n        detail: { message: \"Erreur : L'environnement n'est pas pr├¬t.\" },\r\n      }),\r\n    );\r\n    return false;\r\n  }\r\n\r\n  if (app.environment.kit && !kit.get()) {\r\n    console.error(\r\n      \"Le kit de formes requis n'est pas charg├®, la sauvegarde est annul├®e.\",\r\n    );\r\n    window.dispatchEvent(\r\n      new CustomEvent('show-notif', {\r\n        detail: {\r\n          message: \"Erreur : Le kit de formes requis n'est pas charg├®.\",\r\n        },\r\n      }),\r\n    );\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\n/**\r\n * Pr├®pare la visibilit├® des familles\r\n * @param {object} app - L'instance de l'application\r\n * @returns {Array} - La visibilit├® des familles\r\n */\r\nconst prepareFamiliesVisibility = (app) => {\r\n  if (!app.environment.kit) return [];\r\n\r\n  const currentKit = kit.get();\r\n  return currentKit.families.map((family) => ({\r\n    name: family.name,\r\n    isVisible: family.isVisible,\r\n  }));\r\n};\r\n\r\n/**\r\n * Applique le masquage permanent aux objets g├®om├®triques\r\n * @param {object} workspaceData - Les donn├®es du workspace\r\n * @param {boolean} permanentHide - Si le masquage doit ├¬tre permanent\r\n */\r\nconst applyPermanentHide = (workspaceData, permanentHide) => {\r\n  if (!permanentHide) return;\r\n\r\n  workspaceData.objects.shapesData.forEach((sData) => {\r\n    if (sData.geometryObject?.geometryIsHidden) {\r\n      sData.geometryObject.geometryIsPermanentHidden = true;\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * Pr├®pare les donn├®es de l'application pour la sauvegarde.\r\n * @param {object} app - L'instance principale de l'application.\r\n * @param {object} workspace - L'espace de travail actuel.\r\n * @param {boolean} saveHistory - Indique si l'historique doit ├¬tre inclus.\r\n * @param {boolean} permanentHide - Indique si les objets cach├®s doivent le rester de fa├ºon permanente.\r\n * @returns {object | null} - L'objet contenant les donn├®es de sauvegarde, ou null si des donn├®es essentielles manquent.\r\n */\r\nconst prepareSaveData = (\r\n  app,\r\n  workspace,\r\n  { saveHistory, permanentHide, saveSettings },\r\n) => {\r\n  // Nettoyer l'historique complet\r\n  FullHistoryManager.cleanHisto();\r\n\r\n  // Validation de l'├®tat de l'application\r\n  if (!validateAppState(app)) {\r\n    return null;\r\n  }\r\n\r\n  // Pr├®paration des donn├®es de base\r\n  const workspaceData = { ...workspace.data };\r\n  const settings = saveSettings\r\n    ? cleanTemporarySettings({ ...app.settings })\r\n    : undefined;\r\n\r\n  // Ajout des param├¿tres de grille si disponibles\r\n  if (typeof gridStore !== 'undefined') {\r\n    const gridState = gridStore.getState();\r\n    if (settings) {\r\n      settings.gridType = gridState.gridType;\r\n      settings.gridSize = gridState.gridSize;\r\n      settings.gridOpacity = gridState.gridOpacity;\r\n      settings.gridShown = gridState.isVisible;\r\n    }\r\n  }\r\n\r\n  // Pr├®paration des donn├®es d'historique\r\n  const history = saveHistory ? { ...app.history } : undefined;\r\n  const fullHistory = saveHistory ? { ...app.fullHistory } : undefined;\r\n\r\n  // Pr├®paration de la visibilit├® des outils\r\n  const toolsVisibility = tools.get().map((tool) => ({\r\n    name: tool.name,\r\n    isVisible: tool.isVisible,\r\n  }));\r\n\r\n  // Pr├®paration de la visibilit├® des familles\r\n  const familiesVisibility = prepareFamiliesVisibility(app);\r\n\r\n  // Application du masquage permanent si demand├®\r\n  applyPermanentHide(workspaceData, permanentHide);\r\n\r\n  // Construction de l'objet de sauvegarde\r\n  const saveData = {\r\n    appVersion: app.version,\r\n    timestamp: Date.now(),\r\n    envName: app.environment.name,\r\n    workspaceData,\r\n    settings,\r\n    fullHistory,\r\n    history,\r\n    toolsVisibility,\r\n    familiesVisibility,\r\n  };\r\n\r\n  // Pr├®paration des donn├®es sp├®cifiques ├á Tangram\r\n  if (app.environment.name === 'Tangram') {\r\n    prepareTangramData(app, saveData, toolsVisibility);\r\n  }\r\n\r\n  return saveData;\r\n};\r\n\r\n/**\r\n * ├ëcrit les donn├®es dans un fichier en utilisant l'API File System Access.\r\n * @param {FileSystemFileHandle} fileHandle - Le handle du fichier.\r\n * @param {Blob|string} contents - Le contenu ├á ├®crire.\r\n */\r\nconst writeFileNative = async (fileHandle, contents) => {\r\n  const writer = await fileHandle.createWritable();\r\n  await writer.truncate(0);\r\n  await writer.write(contents);\r\n  await writer.close();\r\n};\r\n\r\n/**\r\n * D├®clenche le t├®l├®chargement d'un fichier pour les navigateurs sans API File System Access.\r\n * @param {string} filename - Le nom du fichier.\r\n * @param {string} dataUrl - L'URL des donn├®es ├á t├®l├®charger.\r\n */\r\nconst downloadFileFallback = (filename, dataUrl) => {\r\n  const downloader = document.createElement('a');\r\n  downloader.href = dataUrl;\r\n  downloader.download = filename;\r\n  downloader.target = '_blank';\r\n  document.body.appendChild(downloader);\r\n  downloader.click();\r\n  document.body.removeChild(downloader);\r\n};\r\n\r\n/**\r\n * Sauvegarde l'├®tat de l'application dans un fichier.\r\n * @param {FileSystemFileHandle | object} handle - Le handle du fichier ou un objet de remplacement.\r\n * @param {object} saveData - Les donn├®es de l'application ├á sauvegarder.\r\n * @param {object} environment - L'environnement actuel.\r\n */\r\nconst saveStateToFile = (handle, saveData, environment) => {\r\n  const jsonData = JSON.stringify(saveData);\r\n  const mimeType =\r\n    environment.name === 'Tangram'\r\n      ? 'application/agmobile'\r\n      : 'application/json';\r\n  const file = new Blob([jsonData], { type: mimeType });\r\n\r\n  if (hasNativeFS) {\r\n    writeFileNative(handle, file);\r\n  } else {\r\n    const dataUrl = window.URL.createObjectURL(file);\r\n    downloadFileFallback(handle.name, dataUrl);\r\n  }\r\n  setState({ stepSinceSave: false });\r\n};\r\n\r\n/**\r\n * Sauvegarde les donn├®es JSON dans un fichier.\r\n * @param {object} saveData - Les donn├®es ├á sauvegarder.\r\n * @param {object} options - Les options de sauvegarde.\r\n * @param {object} environment - L'environnement actuel.\r\n * @param {FileSystemFileHandle} [handle] - Le handle du fichier (optionnel, pour ├®viter le doublon).\r\n * @returns {Promise<boolean>} - True si la sauvegarde a r├®ussi.\r\n */\r\nconst saveToJson = async (saveData, options, environment, handle = null) => {\r\n  try {\r\n    const jsonData = JSON.stringify(saveData, null, 2);\r\n    const mimeType =\r\n      environment.name === 'Tangram'\r\n        ? 'application/agmobile'\r\n        : 'application/json';\r\n    const extension = environment.extensions[0]; // Utiliser la premi├¿re extension de l'environnement\r\n\r\n    // Mettre ├á jour le nom du fichier avec la bonne extension\r\n    const fileName = options.suggestedName.includes('.')\r\n      ? options.suggestedName.replace(/\\.[^/.]+$/, extension)\r\n      : `${options.suggestedName}${extension}`;\r\n\r\n    const file = new Blob([jsonData], { type: mimeType });\r\n\r\n    if (hasNativeFS && !handle) {\r\n      // Si pas de handle fourni, on demande ├á l'utilisateur\r\n      handle = await window.showSaveFilePicker({\r\n        suggestedName: fileName,\r\n        types: [\r\n          {\r\n            description: `├ëtat de l'application (*${extension})`,\r\n            accept: { [mimeType]: [extension] },\r\n          },\r\n        ],\r\n      });\r\n    }\r\n\r\n    if (handle) {\r\n      if (hasNativeFS) {\r\n        await writeFileNative(handle, file);\r\n      } else {\r\n        const dataUrl = window.URL.createObjectURL(file);\r\n        downloadFileFallback(fileName, dataUrl);\r\n      }\r\n    }\r\n\r\n    setState({ stepSinceSave: false });\r\n    return true;\r\n  } catch (error) {\r\n    if (error.name === 'AbortError') {\r\n      console.log(\"Sauvegarde JSON annul├®e par l'utilisateur.\");\r\n      return false;\r\n    }\r\n    console.error('Erreur lors de la sauvegarde JSON:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * Sauvegarde le canvas principal en tant qu'image PNG.\r\n * @param {object} app - L'instance principale de l'application.\r\n * @param {object} saveData - Les donn├®es de sauvegarde (non utilis├®es pour PNG).\r\n * @param {object} options - Les options de sauvegarde.\r\n * @param {FileSystemFileHandle} [handle] - Le handle du fichier (optionnel, pour ├®viter le doublon).\r\n * @returns {Promise<boolean>} - True si la sauvegarde a r├®ussi.\r\n */\r\nconst saveToPng = async (app, saveData, options, handle = null) => {\r\n  try {\r\n    const {\r\n      invisibleCanvasLayer,\r\n      gridCanvasLayer,\r\n      tangramCanvasLayer,\r\n      mainCanvasLayer,\r\n    } = app;\r\n    const ctx = invisibleCanvasLayer.ctx;\r\n    const { canvas } = ctx;\r\n    const { width, height } = canvas;\r\n\r\n    ctx.clearRect(0, 0, width, height);\r\n    ctx.fillStyle = '#fff';\r\n    ctx.fillRect(0, 0, width, height);\r\n\r\n    if (gridCanvasLayer)\r\n      ctx.drawImage(gridCanvasLayer.canvas, 0, 0, width, height);\r\n    if (tangramCanvasLayer) {\r\n      if (app.tangram.level > 2 && app.tangram.level < 5) {\r\n        ctx.fillStyle = '#ff000020';\r\n        ctx.fillRect(width / 2, 0, width, height);\r\n      }\r\n      ctx.drawImage(tangramCanvasLayer.canvas, width / 2, 0, width / 2, height);\r\n    }\r\n    ctx.drawImage(mainCanvasLayer.canvas, 0, 0, width, height);\r\n\r\n    const blob = await new Promise((resolve) =>\r\n      canvas.toBlob(resolve, 'image/png'),\r\n    );\r\n\r\n    if (hasNativeFS && !handle) {\r\n      // Si pas de handle fourni, on demande ├á l'utilisateur\r\n      handle = await window.showSaveFilePicker({\r\n        suggestedName: options.suggestedName,\r\n        types: options.types,\r\n      });\r\n    }\r\n\r\n    if (handle) {\r\n      if (hasNativeFS) {\r\n        await writeFileNative(handle, blob);\r\n      } else {\r\n        const dataUrl = canvas.toDataURL('image/png');\r\n        downloadFileFallback(options.suggestedName, dataUrl);\r\n      }\r\n    }\r\n\r\n    ctx.clearRect(0, 0, width, height);\r\n    return true;\r\n  } catch (error) {\r\n    if (error.name === 'AbortError') {\r\n      console.log(\"Sauvegarde PNG annul├®e par l'utilisateur.\");\r\n      return false;\r\n    }\r\n    console.error('Erreur lors de la sauvegarde PNG:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * Sauvegarde le canvas principal en tant qu'image SVG.\r\n * @param {object} app - L'instance principale de l'application.\r\n * @param {object} saveData - Les donn├®es de sauvegarde (non utilis├®es pour SVG).\r\n * @param {object} options - Les options de sauvegarde.\r\n * @param {FileSystemFileHandle} [handle] - Le handle du fichier (optionnel, pour ├®viter le doublon).\r\n * @returns {Promise<boolean>} - True si la sauvegarde a r├®ussi.\r\n */\r\nconst saveToSvg = async (app, saveData, options, handle = null) => {\r\n  try {\r\n    const {\r\n      invisibleCanvasLayer,\r\n      gridCanvasLayer,\r\n      tangramCanvasLayer,\r\n      mainCanvasLayer,\r\n    } = app;\r\n    const ctx = invisibleCanvasLayer.ctx;\r\n    const { canvas } = ctx;\r\n    const { width, height } = canvas;\r\n\r\n    // Cr├®er un ├®l├®ment SVG\r\n    const svgElement = document.createElementNS(\r\n      'http://www.w3.org/2000/svg',\r\n      'svg',\r\n    );\r\n    svgElement.setAttribute('width', width);\r\n    svgElement.setAttribute('height', height);\r\n    svgElement.setAttribute('viewBox', `0 0 ${width} ${height}`);\r\n\r\n    // Ajouter un fond blanc\r\n    const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\r\n    rect.setAttribute('width', '100%');\r\n    rect.setAttribute('height', '100%');\r\n    rect.setAttribute('fill', 'white');\r\n    svgElement.appendChild(rect);\r\n\r\n    // Convertir le canvas en image SVG (simplifi├®)\r\n    const imageData = canvas.toDataURL('image/png');\r\n    const image = document.createElementNS(\r\n      'http://www.w3.org/2000/svg',\r\n      'image',\r\n    );\r\n    image.setAttribute('x', '0');\r\n    image.setAttribute('y', '0');\r\n    image.setAttribute('width', width);\r\n    image.setAttribute('height', height);\r\n    image.setAttribute('href', imageData);\r\n    svgElement.appendChild(image);\r\n\r\n    const svgData = new XMLSerializer().serializeToString(svgElement);\r\n    const blob = new Blob([svgData], { type: 'image/svg+xml' });\r\n\r\n    if (hasNativeFS && !handle) {\r\n      // Si pas de handle fourni, on demande ├á l'utilisateur\r\n      handle = await window.showSaveFilePicker({\r\n        suggestedName: options.suggestedName,\r\n        types: options.types,\r\n      });\r\n    }\r\n\r\n    if (handle) {\r\n      if (hasNativeFS) {\r\n        await writeFileNative(handle, blob);\r\n      } else {\r\n        const dataUrl = encodeSvgForDataUrl(svgData);\r\n        downloadFileFallback(options.suggestedName, dataUrl);\r\n      }\r\n    }\r\n\r\n    return true;\r\n  } catch (error) {\r\n    if (error.name === 'AbortError') {\r\n      console.log(\"Sauvegarde SVG annul├®e par l'utilisateur.\");\r\n      return false;\r\n    }\r\n    console.error('Erreur lors de la sauvegarde SVG:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * Traite la sauvegarde directement avec les options sp├®cifi├®es (sans popup).\r\n * @param {object} handle - Le handle du fichier.\r\n * @param {object} app - L'instance principale de l'application.\r\n * @param {object} detail - Les d├®tails de l'├®v├®nement de sauvegarde.\r\n * @param {string} fileType - Le type de fichier.\r\n */\r\nconst processSaveDirect = async (handle, app, detail, fileType) => {\r\n  try {\r\n    const options = { suggestedName: handle.name, types: [] };\r\n    let success = false;\r\n\r\n    switch (fileType) {\r\n      case 'png':\r\n        success = await saveToPng(app, null, options, handle);\r\n        break;\r\n      case 'svg':\r\n        success = await saveToSvg(app, null, options, handle);\r\n        break;\r\n      default: {\r\n        const saveData = prepareSaveData(app, app.workspace, detail);\r\n        if (saveData) {\r\n          success = await saveToJson(saveData, options, app.environment);\r\n        } else {\r\n          return;\r\n        }\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (success) {\r\n      window.dispatchEvent(\r\n        new CustomEvent('show-notif', {\r\n          detail: { message: `Sauvegard├® vers ${handle.name}.` },\r\n        }),\r\n      );\r\n    }\r\n  } catch (error) {\r\n    console.error('Erreur lors de la sauvegarde directe:', error);\r\n    window.dispatchEvent(\r\n      new CustomEvent('show-notif', {\r\n        detail: { message: `Erreur lors de la sauvegarde: ${error.message}` },\r\n      }),\r\n    );\r\n  }\r\n};\r\n\r\n/**\r\n * G├¿re la sauvegarde apr├¿s que l'utilisateur a s├®lectionn├® un fichier.\r\n * @param {FileSystemFileHandle | object} handle - Le handle du fichier.\r\n * @param {object} app - L'instance principale de l'application.\r\n * @param {object} detail - Les d├®tails de l'├®v├®nement de sauvegarde.\r\n */\r\nconst processSave = async (handle, app, detail) => {\r\n  try {\r\n    const extension = handle.name.split('.').pop().toLowerCase();\r\n    const options = { suggestedName: handle.name, types: [] };\r\n\r\n    let success = false;\r\n    switch (extension) {\r\n      case 'png':\r\n        success = await saveToPng(app, null, options, handle);\r\n        break;\r\n      case 'svg':\r\n        success = await saveToSvg(app, null, options, handle);\r\n        break;\r\n      default: {\r\n        const saveData = prepareSaveData(app, app.workspace, detail);\r\n        if (saveData) {\r\n          success = await saveToJson(\r\n            saveData,\r\n            options,\r\n            app.environment,\r\n            handle,\r\n          );\r\n        } else {\r\n          return;\r\n        }\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (success) {\r\n      window.dispatchEvent(\r\n        new CustomEvent('show-notif', {\r\n          detail: { message: `Sauvegard├® vers ${handle.name}.` },\r\n        }),\r\n      );\r\n    }\r\n  } catch (error) {\r\n    console.error('Erreur lors du traitement de la sauvegarde:', error);\r\n    window.dispatchEvent(\r\n      new CustomEvent('show-notif', {\r\n        detail: { message: `Erreur lors de la sauvegarde: ${error.message}` },\r\n      }),\r\n    );\r\n  }\r\n};\r\n\r\n/**\r\n * Fonction principale pour initier la sauvegarde d'un fichier.\r\n * @param {object} app - L'instance principale de l'application.\r\n * @param {object} options - Les options de sauvegarde (optionnel).\r\n * @param {string} options.fileName - Le nom du fichier.\r\n * @param {string} options.fileType - Le type de fichier ('json', 'png', 'svg').\r\n * @param {boolean} options.saveHistory - Inclure l'historique.\r\n * @param {boolean} options.permanentHide - Masquer d├®finitivement les objets cach├®s.\r\n * @param {boolean} options.saveSettings - Inclure les param├¿tres.\r\n */\r\nexport const saveFile = async (app, options = {}) => {\r\n  try {\r\n    // Validation sp├®cifique ├á Tangram\r\n    if (\r\n      app.environment.name === 'Tangram' &&\r\n      app.workspace.data.backObjects.shapesData.length === 0\r\n    ) {\r\n      window.dispatchEvent(\r\n        new CustomEvent('show-notif', {\r\n          detail: {\r\n            message: \"Le puzzle est vide, il n'y a rien ├á sauvegarder.\",\r\n          },\r\n        }),\r\n      );\r\n      return;\r\n    }\r\n\r\n    // Configuration des options selon l'environnement\r\n    const saveOptions = configureSaveOptions(\r\n      app.environment,\r\n      app.tangram,\r\n      options.fileName,\r\n    );\r\n\r\n    // Si des options sp├®cifiques sont fournies, on les utilise directement\r\n    if (options.fileType && options.fileName) {\r\n      const handle = { name: options.fileName };\r\n      const detail = {\r\n        saveHistory: options.saveHistory || false,\r\n        permanentHide: options.permanentHide || false,\r\n        saveSettings: options.saveSettings || true,\r\n      };\r\n      await processSaveDirect(handle, app, detail, options.fileType);\r\n      return;\r\n    }\r\n\r\n    // Sinon, on utilise le syst├¿me de popup\r\n    await import('@components/popups/save-popup');\r\n    const popup = createElem('save-popup');\r\n    popup.opts = saveOptions;\r\n\r\n    popup.addEventListener('selected', async (event) => {\r\n      let handle;\r\n      if (hasNativeFS) {\r\n        try {\r\n          const saveOptionsNative = {\r\n            suggestedName: event.detail.name,\r\n            types: event.detail.types,\r\n          };\r\n          handle = await window.showSaveFilePicker(saveOptionsNative);\r\n        } catch (error) {\r\n          if (error.name === 'AbortError') {\r\n            console.log(\"Sauvegarde annul├®e par l'utilisateur.\");\r\n            return;\r\n          }\r\n          console.error('Erreur lors de la sauvegarde du fichier :', error);\r\n          window.dispatchEvent(\r\n            new CustomEvent('show-notif', {\r\n              detail: {\r\n                message: 'Une erreur est survenue lors de la sauvegarde.',\r\n              },\r\n            }),\r\n          );\r\n          return;\r\n        }\r\n      } else {\r\n        handle = { ...event.detail };\r\n      }\r\n\r\n      if (handle) {\r\n        processSave(handle, app, event.detail);\r\n      }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Erreur lors de l'initialisation de la sauvegarde:\", error);\r\n    window.dispatchEvent(\r\n      new CustomEvent('show-notif', {\r\n        detail: { message: `Erreur lors de la sauvegarde: ${error.message}` },\r\n      }),\r\n    );\r\n  }\r\n};\r\n\r\n/**\r\n * Initialise le gestionnaire de sauvegarde en ajoutant un ├®couteur d'├®v├®nements global.\r\n * @param {object} app - L'instance principale de l'application.\r\n */\r\nexport const initSaveFileEventListener = (app) => {\r\n  window.addEventListener('save-file', () => saveFile(app));\r\n};\r\n\r\n// Export des fonctions utilitaires pour les tests\r\nexport { configureSaveOptions, prepareSaveData, validateAppState };\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Managers\\SelectManager.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":142,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":142,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5815,5817],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":147,"column":68,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":147,"endColumn":70,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6104,6106],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":169,"column":32,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":169,"endColumn":34,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[6789,6791],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":170,"column":29,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":170,"endColumn":31,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6859,6861],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":171,"column":42,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":171,"endColumn":44,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6919,6921],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":172,"column":29,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":172,"endColumn":31,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6966,6968],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":174,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":174,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7040,7042],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":175,"column":31,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":175,"endColumn":33,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7086,7088],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":176,"column":32,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":176,"endColumn":34,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7134,7136],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":178,"column":29,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":178,"endColumn":31,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7204,7206],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":180,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":180,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7285,7287],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":181,"column":31,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":181,"endColumn":33,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7338,7340],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":182,"column":32,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":182,"endColumn":34,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7386,7388],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":183,"column":31,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":183,"endColumn":33,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7455,7457],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":194,"column":32,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":194,"endColumn":34,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[7790,7792],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":195,"column":29,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":195,"endColumn":31,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7860,7862],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":196,"column":42,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":196,"endColumn":44,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7920,7922],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":197,"column":29,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":197,"endColumn":31,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7967,7969],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":199,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":199,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8041,8043],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":200,"column":31,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":200,"endColumn":33,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8087,8089],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":201,"column":32,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":201,"endColumn":34,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8135,8137],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":203,"column":29,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":203,"endColumn":31,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8205,8207],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":205,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":205,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8286,8288],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":206,"column":31,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":206,"endColumn":33,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8339,8341],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":207,"column":32,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":207,"endColumn":34,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8387,8389],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":208,"column":31,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":208,"endColumn":33,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8456,8458],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":220,"column":34,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":220,"endColumn":36,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8742,8744],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":228,"column":27,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":228,"endColumn":29,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[9125,9127],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":228,"column":57,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":228,"endColumn":59,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[9155,9157],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":229,"column":27,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":229,"endColumn":29,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[9204,9206],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":229,"column":57,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":229,"endColumn":59,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[9234,9236],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":233,"column":23,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":233,"endColumn":25,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[9412,9414],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":235,"column":20,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":235,"endColumn":22,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[9484,9486],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":235,"column":44,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":235,"endColumn":46,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[9508,9510],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":240,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":240,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[9621,9623],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":267,"column":60,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":267,"endColumn":62,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[10573,10575],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":271,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":271,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[10653,10655],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":272,"column":62,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":272,"endColumn":64,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[10725,10727],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":273,"column":42,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":273,"endColumn":44,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[10800,10802],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":275,"column":34,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":275,"endColumn":36,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[10913,10915],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":295,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":295,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[11591,11593],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":300,"column":70,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":300,"endColumn":72,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[11890,11892],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":332,"column":32,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":332,"endColumn":34,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[12917,12919],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":334,"column":35,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":334,"endColumn":37,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[13040,13042],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":343,"column":32,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":343,"endColumn":34,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[13292,13294],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":345,"column":35,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":345,"endColumn":37,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[13415,13417],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":355,"column":36,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":355,"endColumn":38,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[13620,13622],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":357,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":357,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[13678,13680],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":380,"column":36,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":380,"endColumn":38,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[14438,14440],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":401,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":401,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[15034,15036],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":405,"column":66,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":405,"endColumn":68,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[15281,15283],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":411,"column":27,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":411,"endColumn":29,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[15470,15472],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":419,"column":27,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":419,"endColumn":29,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[15687,15689],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":432,"column":15,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":432,"endColumn":17,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[16067,16069],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":477,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":477,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[17786,17788],"text":"!=="},"desc":"Use '!==' instead of '!='."}]}],"suppressedMessages":[],"errorCount":55,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app } from '../App';\r\nimport { LineShape } from '../Objects/Shapes/LineShape';\r\nimport { RegularShape } from '../Objects/Shapes/RegularShape';\r\nimport { SinglePointShape } from '../Objects/Shapes/SinglePointShape';\r\nimport { StripLineShape } from '../Objects/Shapes/StripLineShape';\r\nimport { ShapeManager } from './ShapeManager';\r\n\r\nexport class SelectManager {\r\n  /**\r\n   * V├®rifier si 2 points sont ├á la distance de s├®lection l'un de l'autre.\r\n   * @param  {Coordinates}  c1\r\n   * @param  {Coordinates}  c2\r\n   */\r\n  static areCoordinatesInSelectionDistance(c1, c2) {\r\n    const areInSelectionDistance = c1.equal(\r\n      c2,\r\n      app.settings.selectionDistance / app.workspace.zoomLevel,\r\n    );\r\n    return areInSelectionDistance;\r\n  }\r\n\r\n  /**\r\n   * V├®rifier si 2 points sont ├á la distance de magn├®tisme l'un de l'autre.\r\n   * @param  {Coordinates}  c1\r\n   * @param  {Coordinates}  c2\r\n   */\r\n  static areCoordinatesInMagnetismDistance(c1, c2) {\r\n    const areInMagnetismDistance = c1.equal(\r\n      c2,\r\n      app.settings.magnetismDistance / app.workspace.zoomLevel,\r\n    );\r\n    return areInMagnetismDistance;\r\n  }\r\n\r\n  /**\r\n   * Renvoie un objet de configuration des contraintes de s├®lection.\r\n   * @return {Object}\r\n   */\r\n  static getEmptySelectionConstraints() {\r\n    return {\r\n      //'click' ou 'mousedown'\r\n      eventType: 'click',\r\n      //du + au - prioritaire. Les 3 valeurs doivent se retrouver dans le tableau.\r\n      priority: ['points', 'segments', 'shapes'],\r\n      blockHidden: false,\r\n      shapes: {\r\n        canSelect: false,\r\n        canSelectFromUpper: false,\r\n        // Liste de Shape. La figure doit ├¬tre dans ce tableau s'il est non null\r\n        whitelist: null,\r\n        // Liste de Shape. La figure ne doit pas ├¬tre dans ce tableau s'il est non null\r\n        blacklist: null,\r\n      },\r\n      segments: {\r\n        canSelect: false,\r\n        canSelectFromUpper: false,\r\n        /*\r\n                Liste pouvant contenir diff├®rents ├®l├®ments:\r\n                    - {'shapeId': shapeId}\r\n                      Le segment doit faire partie de cette figure.\r\n                    - {'shapeId': shapeId, 'index': int}\r\n                      Le segment doit ├¬tre le segment n┬░ index de la figure\r\n                Si tableau non null, le segment doit satisfaire au moins un des\r\n                ├®lements de cette liste.\r\n                 */\r\n        whitelist: null,\r\n        /*\r\n                Liste pouvant contenir les m├¬mes ├®l├®ments que whitelist.\r\n                Si tableau non null, le segment ne doit satisfaire aucun des\r\n                ├®l├®ments de cette liste.\r\n                 */\r\n        blacklist: null,\r\n        // one, allInDistance\r\n        numberOfObjects: 'one',\r\n      },\r\n      points: {\r\n        canSelect: false,\r\n        canSelectFromUpper: false,\r\n        //Ind├®pendamment de whitelist et blacklist, le point doit ├¬tre\r\n        //d'un des types renseign├®s dans ce tableau.\r\n        types: [\r\n          'shapeCenter',\r\n          'vertex',\r\n          'divisionPoint',\r\n          'modifiablePoint',\r\n          'arcCenter',\r\n        ],\r\n        /*\r\n                Liste pouvant contenir diff├®rents ├®l├®ments sous la figure:\r\n                    - {'shapeId': shapeId}\r\n                      Le point doit faire partie de cette figure.\r\n                    - {'shapeId': shapeId, 'type': 'shapeCenter'}\r\n                      Le point doit ├¬tre le centre de la figure donn├®e.\r\n                    - {'shapeId': shapeId, 'type': 'vertex'}\r\n                      Le point doit ├¬tre un sommet de la figure donn├®e.\r\n                    - {'shapeId': shapeId, 'type': 'vertex', index: int}\r\n                      Le point doit ├¬tre le sommet d'index index de la figure donn├®e\r\n                    - {'shapeId': shapeId, 'type': 'divisionPoint'}\r\n                      Le point doit ├¬tre un point de segment de la figure donn├®e.\r\n                    - {'shapeId': shapeId, 'type': 'divisionPoint', index: int}\r\n                      Le point doit ├¬tre un point de segment de la figure donn├®e,\r\n                      et l'index du segment doit ├¬tre index.\r\n                    - {'shapeId': shapeId, 'type': 'divisionPoint', index: int, ratio: ratio}\r\n                      Le point doit ├¬tre un point de segment de la figure donn├®e,\r\n                      dont le segment est d'index index et dont le ratio vaut ratio.\r\n                Si tableau non null, le segment doit satisfaire au moins un des\r\n                ├®lements de cette liste.\r\n                 */\r\n        whitelist: null,\r\n        /*\r\n                Liste pouvant contenir les m├¬mes ├®l├®ments que whitelist.\r\n                Si tableau non null, le segment ne doit satisfaire aucun des\r\n                ├®l├®ments de cette liste.\r\n                 */\r\n        blacklist: null,\r\n        // one, allInDistance, allSuperimposed\r\n        numberOfObjects: 'one',\r\n      },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Essaie de s├®lectionner un point, en fonction des contraintes donn├®es.\r\n   * Renvoie null si pas de point.\r\n   * @param  {Point} mouseCoordinates\r\n   * @param  {Object} constraints      Contraintes. Voir selectionConstraints.points.\r\n   * @param  {Boolean} easySelection   true si selectionDistance, false si magnetismDistance\r\n   * @param  {Boolean} all si retourne tous les points et pas seulement le plus haut / proche\r\n   * @return {Point}\r\n   */\r\n  static selectPoint(mouseCoordinates, constraints, easySelection = true) {\r\n    if (!constraints.canSelect) return null;\r\n\r\n    const distCheckFunction = easySelection\r\n      ? SelectManager.areCoordinatesInSelectionDistance\r\n      : SelectManager.areCoordinatesInMagnetismDistance;\r\n\r\n    // all points at the correct distance\r\n    const potentialPoints = [];\r\n    let allPoints = [...app.mainCanvasLayer.points];\r\n\r\n    if (app.environment.name == 'Geometrie') {\r\n      allPoints = allPoints\r\n        .filter((pt) => pt.shape.geometryObject?.geometryIsVisible !== false)\r\n        .filter((pt) => pt.shape.geometryObject?.geometryIsHidden !== true)\r\n        .filter(\r\n          (pt) => pt.shape.geometryObject?.geometryIsConstaintDraw == false,\r\n        );\r\n    }\r\n\r\n    if (constraints.canSelectFromUpper)\r\n      allPoints.push(...app.upperCanvasLayer.points);\r\n    allPoints.forEach((pt) => {\r\n      if (pt.visible && pt.geometryIsVisible && !pt.geometryIsHidden) {\r\n        if (\r\n          constraints.types.includes(pt.type) &&\r\n          distCheckFunction(pt.coordinates, mouseCoordinates)\r\n        ) {\r\n          potentialPoints.push(pt);\r\n        }\r\n      }\r\n    });\r\n\r\n    // apply constrains\r\n    const constrainedPoints = potentialPoints.filter((potentialPoint) => {\r\n      if (constraints.whitelist != null) {\r\n        if (\r\n          !constraints.whitelist.some((constr) => {\r\n            if (constr.shapeId != potentialPoint.shapeId) return false;\r\n            if (constr.type == 'shapeCenter')\r\n              return potentialPoint.type == 'shapeCenter';\r\n            if (constr.type == 'vertex')\r\n              return (\r\n                potentialPoint.type == 'vertex' &&\r\n                (constr.index == undefined ||\r\n                  constr.index == potentialPoint.idx)\r\n              );\r\n            if (constr.type == 'divisionPoint')\r\n              return (\r\n                potentialPoint.type == 'divisionPoint' &&\r\n                (constr.index == undefined ||\r\n                  constr.index == potentialPoint.segments[0].idx) &&\r\n                (constr.ratio == undefined ||\r\n                  Math.abs(constr.ratio - potentialPoint.ratio) < 0.001)\r\n              );\r\n            return true;\r\n          })\r\n        )\r\n          return false;\r\n      }\r\n      if (constraints.blacklist != null) {\r\n        if (\r\n          constraints.blacklist.some((constr) => {\r\n            if (constr.shapeId != potentialPoint.shapeId) return false;\r\n            if (constr.type == 'shapeCenter')\r\n              return potentialPoint.type == 'shapeCenter';\r\n            if (constr.type == 'vertex')\r\n              return (\r\n                potentialPoint.type == 'vertex' &&\r\n                (constr.index == undefined ||\r\n                  constr.index == potentialPoint.idx)\r\n              );\r\n            if (constr.type == 'divisionPoint')\r\n              return (\r\n                potentialPoint.type == 'divisionPoint' &&\r\n                (constr.index == undefined ||\r\n                  constr.index == potentialPoint.segments[0].idx) &&\r\n                (constr.ratio == undefined ||\r\n                  Math.abs(constr.ratio - potentialPoint.ratio) < 0.001)\r\n              );\r\n            return true;\r\n          })\r\n        )\r\n          return false;\r\n      }\r\n      return true;\r\n    });\r\n\r\n    // if no possibilities\r\n    if (constrainedPoints.length == 0) return null;\r\n\r\n    // sort by distance, by shape height and by index in the shape, taking next criteria when equal\r\n    constrainedPoints.sort((pt1, pt2) => {\r\n      const dist1 = pt1.coordinates.dist(mouseCoordinates);\r\n      const dist2 = pt2.coordinates.dist(mouseCoordinates);\r\n      if (Math.abs(dist1 - dist2) > 0.001) return dist1 - dist2;\r\n\r\n      if (pt1.shape.layer == 'upper' && pt2.shape.layer == 'main') return -1;\r\n      if (pt2.shape.layer == 'upper' && pt1.shape.layer == 'main') return 1;\r\n\r\n      const shapeIndex1 = ShapeManager.getShapeIndex(pt1.shape);\r\n      const shapeIndex2 = ShapeManager.getShapeIndex(pt2.shape);\r\n      if (shapeIndex1 != shapeIndex2) return shapeIndex2 - shapeIndex1;\r\n\r\n      if (pt1.type == 'vertex' && pt2.type == 'vertex')\r\n        return pt2.idx - pt1.idx;\r\n      return 0;\r\n    });\r\n\r\n    if (constraints.numberOfObjects == 'allInDistance') {\r\n      return constrainedPoints;\r\n    }\r\n\r\n    // let notHiddenPoints = constrainedPoints;\r\n    constrainedPoints.forEach((pt) => (pt.isBehindShape = false));\r\n    if (constraints.blockHidden) {\r\n      // notHiddenPoints = [];\r\n      const shapes =\r\n        ShapeManager.shapesThatContainsCoordinates(mouseCoordinates);\r\n      constrainedPoints.forEach((pt) => {\r\n        const shapeIndex = ShapeManager.getShapeIndex(pt.shape);\r\n        if (\r\n          !shapes.every((s) => {\r\n            const otherShapeIndex = ShapeManager.getShapeIndex(s);\r\n            return otherShapeIndex <= shapeIndex;\r\n          })\r\n        ) {\r\n          // pt.isBehindShape = false;\r\n          // } else {\r\n          pt.isBehindShape = true;\r\n        }\r\n        // notHiddenPoints.push(pt);\r\n      });\r\n\r\n      // if no possibilities\r\n      // if (notHiddenPoints.length == 0) return null;\r\n      if (!constrainedPoints.find((pt) => pt.isBehindShape == false))\r\n        return false;\r\n    }\r\n\r\n    if (constraints.numberOfObjects == 'one')\r\n      return constrainedPoints.find((pt) => pt.isBehindShape == false); //notHiddenPoints[0];\r\n    else if (constraints.numberOfObjects == 'allSuperimposed') {\r\n      const firstPointCoord = constrainedPoints.find(\r\n        (pt) => pt.isBehindShape == false,\r\n      ).coordinates;\r\n      // let coordPt1 = constrainedPoints[firstPointIndex].coordinates//notHiddenPoints[0].coordinates;\r\n      let i = 0; //1;\r\n      for (; i < constrainedPoints.length; i++) {\r\n        if (firstPointCoord.dist(constrainedPoints[i]) > 0.01) {\r\n          return constrainedPoints.slice(0, i);\r\n        }\r\n      }\r\n      return constrainedPoints.slice(0, i);\r\n    }\r\n  }\r\n\r\n  static selectSegment(mouseCoordinates, constraints) {\r\n    if (!constraints.canSelect) return null;\r\n\r\n    // all segments at the correct distance\r\n    let potentialSegments = [];\r\n    let allSegments = [...app.mainCanvasLayer.segments];\r\n\r\n    if (app.environment.name == 'Geometrie') {\r\n      allSegments = allSegments\r\n        .filter((seg) => seg.shape.geometryObject?.geometryIsVisible !== false)\r\n        .filter((seg) => seg.shape.geometryObject?.geometryIsHidden !== true)\r\n        .filter(\r\n          (seg) => seg.shape.geometryObject?.geometryIsConstaintDraw == false,\r\n        );\r\n    }\r\n\r\n    if (constraints.canSelectFromUpper)\r\n      allSegments = [...app.upperCanvasLayer.segments, ...allSegments];\r\n    allSegments.forEach((seg) => {\r\n      const projection = seg.projectionOnSegment(mouseCoordinates);\r\n      if (\r\n        seg.isCoordinatesOnSegment(projection) &&\r\n        SelectManager.areCoordinatesInSelectionDistance(\r\n          projection,\r\n          mouseCoordinates,\r\n        )\r\n      ) {\r\n        potentialSegments.push({\r\n          segment: seg,\r\n          dist: projection.dist(mouseCoordinates),\r\n        });\r\n      }\r\n    });\r\n\r\n    potentialSegments.sort((segInfo1, segInfo2) => {\r\n      return segInfo1.dist - segInfo2.dist;\r\n    });\r\n    potentialSegments = potentialSegments.map((segInfo) => segInfo.segment);\r\n\r\n    // apply constrains\r\n    const constrainedSegments = potentialSegments.filter((potentialSegment) => {\r\n      if (constraints.whitelist != null) {\r\n        if (\r\n          !constraints.whitelist.some((constr) => {\r\n            if (constr.shapeId != potentialSegment.shapeId) return false;\r\n            if (constr.index !== undefined)\r\n              return constr.index == potentialSegment.idx;\r\n            return true;\r\n          })\r\n        )\r\n          return false;\r\n      }\r\n      if (constraints.blacklist != null) {\r\n        if (\r\n          constraints.blacklist.some((constr) => {\r\n            if (constr.shapeId != potentialSegment.shapeId) return false;\r\n            if (constr.index !== undefined)\r\n              return constr.index == potentialSegment.idx;\r\n            return true;\r\n          })\r\n        )\r\n          return false;\r\n      }\r\n      return true;\r\n    });\r\n\r\n    // if no possibilities\r\n    if (constrainedSegments.length == 0) return null;\r\n\r\n    if (constraints.numberOfObjects == 'allInDistance') {\r\n      return constrainedSegments;\r\n    }\r\n\r\n    // no possibilities to choose blockHidden constraints\r\n\r\n    let notHiddenSegments = constrainedSegments;\r\n    if (constraints.blockHidden) {\r\n      notHiddenSegments = [];\r\n      const shapes =\r\n        ShapeManager.shapesThatContainsCoordinates(mouseCoordinates);\r\n      constrainedSegments.forEach((seg) => {\r\n        const shapeIndex = ShapeManager.getShapeIndex(seg.shape);\r\n        if (\r\n          shapes.every((s) => {\r\n            const otherShapeIndex = ShapeManager.getShapeIndex(s);\r\n            return otherShapeIndex <= shapeIndex;\r\n          })\r\n        )\r\n          notHiddenSegments.push(seg);\r\n      });\r\n\r\n      // if no possibilities\r\n      if (notHiddenSegments.length == 0) return null;\r\n    }\r\n\r\n    return notHiddenSegments[0];\r\n  }\r\n\r\n  /**\r\n   * Essaie de s├®lectionner une figure, en fonction des contraintes donn├®es.\r\n   * Renvoie null si pas de figure.\r\n   * @param  {Point} mouseCoordinates\r\n   * @param  {Object} constraints      Contraintes. Voir selectionConstraints.shapes.\r\n   * @return {Shape}\r\n   */\r\n  static selectShape(mouseCoordinates, constraints) {\r\n    if (!constraints.canSelect) return null;\r\n\r\n    let shapes = ShapeManager.shapesThatContainsCoordinates(\r\n      mouseCoordinates,\r\n      constraints,\r\n    );\r\n\r\n    if (app.environment.name == 'Geometrie') {\r\n      shapes = shapes\r\n        .filter((s) => s.geometryObject?.geometryIsVisible !== false)\r\n        .filter((s) => s.geometryObject?.geometryIsHidden !== true)\r\n        .filter((s) => s.geometryObject?.geometryIsConstaintDraw == false);\r\n    }\r\n\r\n    if (constraints.whitelist != null) {\r\n      shapes = shapes.filter((shape) => {\r\n        return constraints.whitelist.some((shape2) => {\r\n          return shape.id == shape2.id;\r\n        });\r\n      });\r\n    }\r\n\r\n    if (constraints.blacklist != null) {\r\n      shapes = shapes.filter((shape) => {\r\n        return constraints.blacklist.every((shape2) => {\r\n          return shape.id != shape2.id;\r\n        });\r\n      });\r\n    }\r\n\r\n    if (shapes.length > 0) {\r\n      if (\r\n        shapes[0] instanceof RegularShape ||\r\n        shapes[0] instanceof StripLineShape ||\r\n        (shapes[0] instanceof LineShape && shapes[0].segments[0].isArc())\r\n      )\r\n        return shapes[0];\r\n      const idx = shapes.findIndex((s) => s instanceof RegularShape);\r\n      if (idx != -1) shapes = shapes.slice(0, idx);\r\n      const dists = shapes.map((s) => {\r\n        if (s instanceof LineShape) {\r\n          const projection =\r\n            s.segments[0].projectionOnSegment(mouseCoordinates);\r\n          return projection.dist(mouseCoordinates);\r\n        } else if (s instanceof SinglePointShape) {\r\n          return s.points[0].coordinates.dist(mouseCoordinates) / 10;\r\n        }\r\n      });\r\n      const minDistance = Math.min(...dists);\r\n      const minDistanceIndex = dists.indexOf(minDistance);\r\n      return shapes[minDistanceIndex];\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Essaie de s├®lectionner un objet (point, segment, figure) en fonction des\r\n   * contraintes d├®finies via setSelectionConstraints. Renvoie null si aucun\r\n   * objet n'a pu ├¬tre s├®lectionn├®.\r\n   * @param  {Point} mouseCoordinates\r\n   * @return {Object} Renvoie soit:\r\n   *          - Pour une figure: un objet de type Shape;\r\n   *          - Pour un segment: un objet de type Segment;\r\n   *          - Pour un point: un objet de type Point;\r\n   */\r\n  static selectObject(mouseCoordinates) {\r\n    const constr = app.workspace.selectionConstraints,\r\n      calls = {\r\n        points: (mCoord, constr) => {\r\n          return SelectManager.selectPoint(mCoord, constr);\r\n        },\r\n        segments: (mCoord, constr) => {\r\n          return SelectManager.selectSegment(mCoord, constr);\r\n        },\r\n        shapes: (mCoord, constr) => {\r\n          return SelectManager.selectShape(mCoord, constr);\r\n        },\r\n      };\r\n    //V├®rification que priority est bien d├®fini\r\n    if (\r\n      !constr.priority.every((p) => {\r\n        return ['points', 'segments', 'shapes'].includes(p);\r\n      }) ||\r\n      constr.priority.length != 3\r\n    ) {\r\n      console.error('Bad constr.priority value!');\r\n      return null;\r\n    }\r\n\r\n    for (let i = 0; i < constr.priority.length; i++) {\r\n      const f = calls[constr.priority[i]],\r\n        obj = f(mouseCoordinates, constr[constr.priority[i]]);\r\n      if (obj) {\r\n        window.dispatchEvent(\r\n          new CustomEvent('objectSelected', {\r\n            detail: { object: obj, mousePos: mouseCoordinates },\r\n          }),\r\n        );\r\n        return obj;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n}\r\n\r\nexport function initSelectManager(app) {\r\n  window.addEventListener('reset-selection-constraints', () => {\r\n    app.workspace.selectionConstraints =\r\n      SelectManager.getEmptySelectionConstraints();\r\n  });\r\n\r\n  const click_all_shape_constr = SelectManager.getEmptySelectionConstraints();\r\n  click_all_shape_constr.eventType = 'click';\r\n  click_all_shape_constr.shapes.canSelect = true;\r\n  const mousedown_all_shape_constr =\r\n    SelectManager.getEmptySelectionConstraints();\r\n  mousedown_all_shape_constr.eventType = 'mousedown';\r\n  mousedown_all_shape_constr.shapes.canSelect = true;\r\n  const click_all_segments_constr =\r\n    SelectManager.getEmptySelectionConstraints();\r\n  click_all_segments_constr.eventType = 'click';\r\n  click_all_segments_constr.segments.canSelect = true;\r\n  app.fastSelectionConstraints = {\r\n    click_all_shape: click_all_shape_constr,\r\n    mousedown_all_shape: mousedown_all_shape_constr,\r\n    click_all_segments: click_all_segments_constr,\r\n  };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Managers\\ShapeManager.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":30,"column":50,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":30,"endColumn":52,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1046,1048],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":31,"column":15,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":31,"endColumn":17,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[1068,1070],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":49,"column":50,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":49,"endColumn":52,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1686,1688],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":50,"column":15,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":50,"endColumn":17,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[1708,1710],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":75,"column":61,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":75,"endColumn":63,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2581,2583],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":84,"column":63,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":84,"endColumn":65,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2873,2875],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"prefer-const","severity":1,"message":"'group' is never reassigned. Use 'const' instead.","line":147,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":147,"endColumn":12},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":153,"column":42,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":153,"endColumn":44,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[5155,5157],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":164,"column":33,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":164,"endColumn":35,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[5420,5422],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":189,"column":39,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":189,"endColumn":41,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[6370,6372],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":198,"column":65,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":198,"endColumn":67,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[6739,6741],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":199,"column":67,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":199,"endColumn":69,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[6818,6820],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":214,"column":57,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":214,"endColumn":59,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[7282,7284],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":215,"column":65,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":215,"endColumn":67,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[7363,7365],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":223,"column":32,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":223,"endColumn":34,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7608,7610],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":230,"column":67,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":230,"endColumn":69,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[7872,7874],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":255,"column":20,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":255,"endColumn":22,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8625,8627],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":16,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app } from '../App';\r\nimport { findObjectById } from '../Tools/general';\r\nimport { GroupManager } from './GroupManager';\r\nimport { SelectManager } from './SelectManager';\r\n\r\nexport class ShapeManager {\r\n  /**\r\n   * Ajoute une figure au workspace\r\n   * @param {Shape} shape   La figure ├á ajouter\r\n   * @param {Numbre} index  L'index qu'elle doit avoir dans le tableau des figures\r\n   */\r\n  static addShape(shape, index = null) {\r\n    if (index !== null) {\r\n      app.workspace.shapes.splice(index, 0, shape);\r\n    } else {\r\n      app.workspace.shapes.push(shape);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * moves the selected shapes above all other, with respect of the order\r\n   * @param {Number[]} indexes this indexes of the shapes to move\r\n   * @return {Number[]} the new indexes of the shapes\r\n   */\r\n  static moveShapesUp(indexes) {\r\n    const max = app.workspace.shapes.length - 1;\r\n    let shapesMoved = 0;\r\n    const newIndexes = new Array(indexes.length);\r\n    for (let i = max; i >= 0; i--) {\r\n      const idx = indexes.findIndex((idx) => idx == i);\r\n      if (idx != -1) {\r\n        const shape = app.workspace.shapes[i];\r\n        app.workspace.shapes.splice(i, 1);\r\n        app.workspace.shapes.splice(max - shapesMoved, 0, shape);\r\n        shapesMoved++;\r\n        newIndexes[max - shapesMoved] = idx;\r\n      }\r\n    }\r\n    return newIndexes;\r\n  }\r\n\r\n  /**\r\n   * move the upper shapes back to their place, accordingly to indexes\r\n   * @param {Number[]} indexes the final place of the shapes\r\n   */\r\n  static moveShapesBackToTheirPlace(indexes) {\r\n    const max = app.workspace.shapes.length - 1;\r\n    for (let i = 0; i < max; i++) {\r\n      const idx = indexes.findIndex((idx) => idx == i);\r\n      if (idx != -1) {\r\n        const shape = app.workspace.shapes[i];\r\n        app.workspace.shapes.splice(i, 1);\r\n        app.workspace.shapes.splice(indexes[idx], 0, shape);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * reverse the order of the <nbr> upper shapes\r\n   * @param {Number} nbr number of shapes to reverse\r\n   */\r\n  static reverseUpperShapes(nbr) {\r\n    const lower = app.workspace.shapes.slice(0, -nbr),\r\n      upper = app.workspace.shapes.slice(-nbr);\r\n    app.workspace.shapes = [...lower, ...upper.reverse()];\r\n  }\r\n\r\n  /**\r\n   * Renvoie l'index d'une figure (index dans le tableau de figures du\r\n   * Workspace actuel), ou -1 si la figure n'a pas ├®t├® trouv├®e.\r\n   * @param  {Shape} shape la figure\r\n   * @return {int}       l'index de cette figure dans le tableau des figures\r\n   */\r\n  static getShapeIndex(shape) {\r\n    return app.mainCanvasLayer.shapes.findIndex((s) => s.id == shape.id);\r\n  }\r\n\r\n  /**\r\n   * Renvoie la figure ayant un certain id\r\n   * @param  {int} id l'id de la figure\r\n   * @return {Shape}         l'objet figure, ou null si la figure n'existe pas\r\n   */\r\n  static getShapeById(id) {\r\n    const shape = app.mainCanvasLayer.shapes.find((s) => s.id == id);\r\n    return shape ? shape : null;\r\n  }\r\n\r\n  /**\r\n   * Renvoie la liste des figures contenant une certaine coordonn├®e.\r\n   * Le tableau renvoy├® est tri├® de la figure la plus en avant ├á la figure la\r\n   * plus en arri├¿re.\r\n   * @param {Coordinates} coord\r\n   */\r\n  static shapesThatContainsCoordinates(coord, constraints = {}) {\r\n    const allShapes = [...app.mainCanvasLayer.shapes];\r\n    if (constraints.canSelectFromUpper) {\r\n      allShapes.push(...app.upperCanvasLayer.shapes);\r\n    }\r\n    const list = allShapes.filter((shape) => {\r\n      if (shape.isSegment() && !shape.segments[0].isArc()) {\r\n        const seg = shape.segments[0];\r\n        const projection = seg.projectionOnSegment(coord);\r\n        if (\r\n          seg.isCoordinatesOnSegment(projection) &&\r\n          SelectManager.areCoordinatesInSelectionDistance(projection, coord)\r\n        ) {\r\n          return true;\r\n        }\r\n        if (\r\n          SelectManager.areCoordinatesInSelectionDistance(\r\n            seg.vertexes[0].coordinates,\r\n            coord,\r\n          ) ||\r\n          SelectManager.areCoordinatesInSelectionDistance(\r\n            seg.vertexes[1].coordinates,\r\n            coord,\r\n          )\r\n        ) {\r\n          return true;\r\n        }\r\n        return false;\r\n      } else if (shape.isPoint()) {\r\n        return SelectManager.areCoordinatesInSelectionDistance(\r\n          coord,\r\n          shape.points[0].coordinates,\r\n        );\r\n      } else {\r\n        return (\r\n          shape.isCoordinatesInPath(coord) || shape.isCoordinatesOnBorder(coord)\r\n        );\r\n      }\r\n    });\r\n    list.reverse();\r\n    return list;\r\n  }\r\n\r\n  /**\r\n   * Renvoie la liste des figures solidaires ├á la figure donn├®e (c'est-├á-dire\r\n   * faisant partie du m├¬me groupe).\r\n   * @param  {Shape} shape Une figure\r\n   * @param  {Boolean} [includeReceivedShape=false] true: inclus la figure\r\n   * \t\t\t\t\t\t\t\t\t\t\t\t   re├ºue dans les r├®sultats\r\n   * @return {[Shape]}     Les figures li├®es\r\n   */\r\n  static getAllBindedShapes(shape, includeReceivedShape = true) {\r\n    let shapes = [shape],\r\n      group = GroupManager.getShapeGroup(shape);\r\n    if (group) {\r\n      shapes = group.shapesIds.map((id) => ShapeManager.getShapeById(id));\r\n    }\r\n\r\n    if (!includeReceivedShape) {\r\n      shapes = shapes.filter((s) => s.id != shape.id);\r\n    }\r\n    return shapes;\r\n  }\r\n\r\n  static getAllBindedShapesInGeometry(shape) {\r\n    let allLinkedShapes = [shape];\r\n\r\n    const getParents = (currentShape) => {\r\n      const parents = [];\r\n      currentShape.points\r\n        .filter((pt) => pt.type != 'divisionPoint')\r\n        .forEach((vx) => {\r\n          if (vx.reference != null) {\r\n            parents.push(findObjectById(vx.reference).shape);\r\n          }\r\n        });\r\n      if (currentShape.geometryObject.geometryParentObjectId1) {\r\n        const seg = findObjectById(\r\n          currentShape.geometryObject.geometryParentObjectId1,\r\n        );\r\n        const s = seg\r\n          ? seg.shape\r\n          : findObjectById(currentShape.geometryObject.geometryParentObjectId1);\r\n        parents.push(s);\r\n      }\r\n      if (currentShape.geometryObject.geometryParentObjectId2)\r\n        parents.push(\r\n          findObjectById(currentShape.geometryObject.geometryParentObjectId2)\r\n            .shape,\r\n        );\r\n      return parents;\r\n    };\r\n    const getChildren = (currentShape) => {\r\n      const children = currentShape.geometryObject.geometryChildShapeIds\r\n        .map((sId) => findObjectById(sId))\r\n        .filter((child) => child.name != 'PointOnIntersection'); //&& child.name != 'cut');\r\n      return children;\r\n    };\r\n\r\n    const getParentAndChildren = (shape, currentShapeArray) => {\r\n      const parents = getParents(shape);\r\n      const children = getChildren(shape);\r\n      [...parents, ...children].forEach((s) => {\r\n        if (\r\n          allLinkedShapes.every((linkedShape) => linkedShape.id != s.id) &&\r\n          currentShapeArray.every((linkedShape) => linkedShape.id != s.id)\r\n        ) {\r\n          currentShapeArray.push(s);\r\n          getParentAndChildren(s, currentShapeArray);\r\n        }\r\n      });\r\n    };\r\n    getParentAndChildren(shape, allLinkedShapes);\r\n\r\n    let allGroups = [];\r\n    const getGroups = (shapes, currentGroupArray) => {\r\n      shapes.forEach((s) => {\r\n        const group = GroupManager.getShapeGroup(s);\r\n        if (!group) return;\r\n        if (\r\n          allGroups.every((groupFound) => groupFound.id != group.id) &&\r\n          currentGroupArray.every((groupFound) => groupFound.id != group.id)\r\n        ) {\r\n          currentGroupArray.push(group);\r\n        }\r\n      });\r\n    };\r\n    const iterateWithGroups = (workingShapes, workingGroups) => {\r\n      getGroups(workingShapes, workingGroups);\r\n      if (workingGroups.length == 0) return;\r\n\r\n      const newLinkedShapes = [];\r\n      workingGroups.forEach((group) => {\r\n        group.shapesIds.forEach((id) => {\r\n          const shape = findObjectById(id);\r\n          if (\r\n            allLinkedShapes.every((linkedShape) => linkedShape.id != shape.id)\r\n          ) {\r\n            newLinkedShapes.push(shape);\r\n          }\r\n        });\r\n      });\r\n      newLinkedShapes.forEach((currentShape) => {\r\n        getParentAndChildren(currentShape, newLinkedShapes);\r\n      });\r\n\r\n      allLinkedShapes = [...allLinkedShapes, ...newLinkedShapes];\r\n      allGroups = [...allGroups, ...workingGroups];\r\n      iterateWithGroups(newLinkedShapes, []);\r\n    };\r\n    iterateWithGroups(allLinkedShapes, allGroups);\r\n\r\n    return allLinkedShapes;\r\n  }\r\n\r\n  /**\r\n   * Supprime une figure. Ne la supprime pas des groupes (├á faire manuellement)\r\n   * @param  {Shape} shape La figure ├á supprimer\r\n   */\r\n  static deleteShape(shape) {\r\n    const shapeIndex = ShapeManager.getShapeIndex(shape);\r\n    if (shapeIndex == -1) {\r\n      console.error(\"Workspace.deleteShape: couldn't delete the shape\");\r\n      return;\r\n    }\r\n    //supprime la figure\r\n    app.workspace.shapes.splice(shapeIndex, 1);\r\n  }\r\n\r\n  static updateReferencedShapes(mustDraw = false) {\r\n    app.workspace.shapes.forEach((s) => {\r\n      s.updateReferenced(mustDraw);\r\n    });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Managers\\WorkspaceManager.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Manifest.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Objects\\Bounds.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Objects\\CharacteristicElements.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":15,"column":17,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":15,"endColumn":19,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[406,408],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":16,"column":22,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":16,"endColumn":24,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[462,464],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":19,"column":32,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":19,"endColumn":34,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[551,553],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { findObjectById } from '../Tools/general';\r\n\r\n/**\r\n * Repr├®sente le ou les ├®l├®ments caract├®ristiques d'un transformation\r\n */\r\nexport class CharacteristicElements {\r\n  constructor({ type = '', elementIds = [], clockwise = false }) {\r\n    this.type = type;\r\n    this.elementIds = [...elementIds];\r\n    this.clockwise = clockwise;\r\n  }\r\n\r\n  equal(characteristicElements) {\r\n    if (\r\n      this.type == characteristicElements.type &&\r\n      this.clockwise == characteristicElements.clockwise\r\n    ) {\r\n      if (\r\n        this.elementIds.length == characteristicElements.elementIds.length &&\r\n        this.elementIds.every(\r\n          (elem, index) => elem === characteristicElements.elementIds[index],\r\n        )\r\n      ) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  get elements() {\r\n    return this.elementIds.map((elId) => findObjectById(elId));\r\n  }\r\n\r\n  get firstElement() {\r\n    return findObjectById(this.elementIds[0]);\r\n  }\r\n\r\n  get secondElement() {\r\n    return findObjectById(this.elementIds[1]);\r\n  }\r\n\r\n  get thirdElement() {\r\n    return findObjectById(this.elementIds[2]);\r\n  }\r\n\r\n  get fourthElement() {\r\n    return findObjectById(this.elementIds[3]);\r\n  }\r\n\r\n  saveData() {\r\n    const data = {\r\n      type: this.type,\r\n      elementIds: [...this.elementIds],\r\n      clockwise: this.clockwise,\r\n    };\r\n    return data;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Objects\\Coordinates.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Objects\\Family.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Objects\\GeometryConstraint.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Coordinates' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":21,"suggestions":[{"messageId":"removeVar","data":{"varName":"Coordinates"},"fix":{"range":[164,208],"text":""},"desc":"Remove unused variable 'Coordinates'."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":23,"column":21,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":23,"endColumn":23,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[939,941],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":35,"column":28,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":35,"endColumn":30,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1372,1374],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":76,"column":22,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":76,"endColumn":24,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2444,2446],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":80,"column":22,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":80,"endColumn":24,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2511,2513],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":84,"column":22,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":84,"endColumn":24,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2581,2583],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":88,"column":22,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":88,"endColumn":24,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2651,2653],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app } from '../App';\r\nimport { SelectManager } from '../Managers/SelectManager';\r\nimport { findObjectsByName, removeObjectById } from '../Tools/general';\r\nimport { Coordinates } from './Coordinates';\r\nimport { Point } from './Point';\r\nimport { GeometryObject } from './Shapes/GeometryObject';\r\nimport { LineShape } from './Shapes/LineShape';\r\n\r\nexport class GeometryConstraint {\r\n  /**\r\n   *\r\n   * @param {String} type         isFree (libre), isConstrained (sur des segments ou des points pr├®cis), isBlocked (bloqu├® par une contruction), isContructed (dessin├®)\r\n   * @param {[Coordinates]} lines pout isContructed\r\n   * @param {[Point]} points      pout isContructed\r\n   */\r\n  constructor(type, lines = [], points = []) {\r\n    findObjectsByName('constraints', 'upper').forEach((s) =>\r\n      removeObjectById(s.id),\r\n    );\r\n    this.type = type;\r\n    this.segments = lines.map((ln) => {\r\n      let path = '';\r\n      if (ln.length == 2) {\r\n        // segment de droite\r\n        const angle = ln[0].angleWith(ln[1]);\r\n        ln[0] = ln[0].substract({\r\n          x: 10000 * Math.cos(angle),\r\n          y: 10000 * Math.sin(angle),\r\n        });\r\n        ln[1] = ln[1].add({\r\n          x: 10000 * Math.cos(angle),\r\n          y: 10000 * Math.sin(angle),\r\n        });\r\n        path = ['M', ln[0].x, ln[0].y, 'L', ln[1].x, ln[1].y].join(' ');\r\n      } else if (ln.length == 3) {\r\n        // cercle\r\n        const oppositeCoordinates = ln[2].multiply(2).substract(ln[0]),\r\n          radius = ln[0].dist(ln[2]);\r\n        path = ['M', ln[0].x, ln[0].y]\r\n          .concat([\r\n            'A',\r\n            radius,\r\n            radius,\r\n            0,\r\n            1,\r\n            0,\r\n            oppositeCoordinates.x,\r\n            oppositeCoordinates.y,\r\n          ])\r\n          .concat(['A', radius, radius, 0, 1, 0, ln[1].x, ln[1].y])\r\n          .join(' ');\r\n      }\r\n      const s = new LineShape({\r\n        layer: 'upper',\r\n        path: path,\r\n        name: 'constraints',\r\n        strokeColor: app.settings.constraintsDrawColor,\r\n        fillOpacity: 0,\r\n        strokeWidth: 2,\r\n        geometryObject: new GeometryObject({}),\r\n      });\r\n      return s.segments[0];\r\n    });\r\n    this.points = points.map(\r\n      (pt) =>\r\n        new Point({\r\n          layer: 'upper',\r\n          coordinates: pt,\r\n          color: app.settings.constraintsDrawColor,\r\n          size: 2,\r\n        }),\r\n    );\r\n  }\r\n\r\n  get isFree() {\r\n    return this.type == 'isFree';\r\n  }\r\n\r\n  get isConstrained() {\r\n    return this.type == 'isConstrained';\r\n  }\r\n\r\n  get isBlocked() {\r\n    return this.type == 'isBlocked';\r\n  }\r\n\r\n  get isConstructed() {\r\n    return this.type == 'isConstructed';\r\n  }\r\n\r\n  projectionOnConstraints(coordinates, errorWhenTooFar = false) {\r\n    const projectionsOnContraints = this.segments\r\n      .map((segment) => {\r\n        const projection = segment.projectionOnSegment(coordinates);\r\n        const dist = projection.dist(coordinates);\r\n        return { projection: projection, dist: dist };\r\n      })\r\n      .concat(\r\n        this.points.map((pt) => {\r\n          const dist = pt.coordinates.dist(coordinates);\r\n          return { projection: pt.coordinates, dist: dist };\r\n        }),\r\n      );\r\n    projectionsOnContraints.sort((p1, p2) => (p1.dist > p2.dist ? 1 : -1));\r\n    if (\r\n      errorWhenTooFar &&\r\n      !SelectManager.areCoordinatesInSelectionDistance(\r\n        projectionsOnContraints[0].projection,\r\n        coordinates,\r\n      )\r\n    ) {\r\n      return null;\r\n    }\r\n    return projectionsOnContraints[0].projection;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Objects\\Point.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":41,"column":12,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":41,"endColumn":14,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1316,1318],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":150,"column":26,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":150,"endColumn":28,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4447,4449],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":150,"column":58,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":150,"endColumn":60,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4479,4481],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":158,"column":38,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":158,"endColumn":40,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4838,4840],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":161,"column":33,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":161,"endColumn":35,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4939,4941],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":167,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":167,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5136,5138],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":168,"column":52,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":168,"endColumn":54,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5206,5208],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":173,"column":34,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":173,"endColumn":36,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5367,5369],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":185,"column":34,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":185,"endColumn":36,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5728,5730],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":204,"column":34,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":204,"endColumn":36,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6355,6357],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":232,"column":34,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":232,"endColumn":36,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7479,7481],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":235,"column":29,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":235,"endColumn":31,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7593,7595],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":247,"column":34,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":247,"endColumn":36,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7915,7917],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":250,"column":29,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":250,"endColumn":31,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8027,8029],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":266,"column":34,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":266,"endColumn":36,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8659,8661],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":272,"column":34,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":272,"endColumn":36,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8856,8858],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":285,"column":34,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":285,"endColumn":36,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[9229,9231],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":291,"column":34,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":291,"endColumn":36,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[9429,9431],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":310,"column":34,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":310,"endColumn":36,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[10035,10037],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":312,"column":34,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":312,"endColumn":36,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[10120,10122],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":313,"column":23,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":313,"endColumn":25,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[10162,10164],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":330,"column":34,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":330,"endColumn":36,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[10768,10770],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":331,"column":23,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":331,"endColumn":25,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[10809,10811],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":333,"column":29,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":333,"endColumn":31,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[10894,10896],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":349,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":349,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[11425,11427],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":350,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":350,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[11471,11473],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":352,"column":23,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":352,"endColumn":25,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[11523,11525],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":354,"column":29,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":354,"endColumn":31,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[11608,11610],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":359,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":359,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[11764,11766],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":361,"column":28,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":361,"endColumn":30,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[11819,11821],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":362,"column":29,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":362,"endColumn":31,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[11873,11875],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":363,"column":20,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":363,"endColumn":22,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[11928,11930],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":388,"column":28,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":388,"endColumn":30,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[12835,12837],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":389,"column":29,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":389,"endColumn":31,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[12893,12895],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":390,"column":20,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":390,"endColumn":22,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[12952,12954],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":415,"column":29,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":415,"endColumn":31,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[13866,13868],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":418,"column":28,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":418,"endColumn":30,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[13961,13963],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":419,"column":29,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":419,"endColumn":31,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[14006,14008],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":420,"column":29,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":420,"endColumn":31,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[14060,14062],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":421,"column":29,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":421,"endColumn":31,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[14110,14112],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":422,"column":20,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":422,"endColumn":22,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[14146,14148],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":425,"column":29,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":425,"endColumn":31,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[14231,14233],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":428,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":428,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[14335,14337],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":429,"column":29,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":429,"endColumn":31,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[14378,14380],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":432,"column":27,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":432,"endColumn":29,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[14478,14480],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":433,"column":27,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":433,"endColumn":29,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[14525,14527],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'shape' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":484,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":484,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"shape"},"fix":{"range":[15864,15883],"text":""},"desc":"Remove unused variable 'shape'."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":512,"column":19,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":512,"endColumn":21,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[16558,16560],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":513,"column":19,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":513,"endColumn":21,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[16614,16616],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":514,"column":20,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":514,"endColumn":22,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[16671,16673],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":534,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":534,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[17621,17623],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":50,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app } from '../App';\r\nimport { addInfoToId, findObjectById, mod, uniqId } from '../Tools/general';\r\nimport { Coordinates } from './Coordinates';\r\nimport { Segment } from './Segment';\r\n\r\n/**\r\n * Repr├®sente un point du plan\r\n */\r\nexport class Point {\r\n  /**\r\n   * @param {String}                      id\r\n   * @param {Coordinates}                 coordinates\r\n   * @param {Number}                      x\r\n   * @param {Number}                      y\r\n   * @param {[String]}                    segmentIds\r\n   * @param {String}                      shapeId\r\n   * @param {String}                      type  -> 'vertex', 'divisionPoint', 'arcCenter' or 'shapeCenter'\r\n   * @param {String}                      name  -> 'firstPoint', 'secondPoint', 'thirdPoint', 'fourthPoint'\r\n   * @param {Number}                      ratio -> the ratio of this between the 2 vertexes of the segment\r\n   */\r\n  constructor({\r\n    id,\r\n    layer,\r\n    coordinates = undefined,\r\n    // x = 0,\r\n    // y = 0,\r\n    shapeId = undefined,\r\n    idx = undefined,\r\n    segmentIds = [],\r\n    type = undefined,\r\n    name = undefined,\r\n    ratio = undefined,\r\n    visible = true,\r\n    color = '#000',\r\n    size = 1,\r\n    reference = null,\r\n    endpointIds = [],\r\n    geometryIsVisible = true,\r\n    geometryIsHidden = false,\r\n  }) {\r\n    if (id == undefined) id = uniqId(layer, 'point');\r\n    else id = addInfoToId(id, layer, 'point');\r\n    this.id = id;\r\n    this.layer = layer;\r\n    this.canvasLayer.points.push(this);\r\n\r\n    if (coordinates !== undefined)\r\n      this.coordinates = new Coordinates(coordinates);\r\n    else\r\n      this.coordinates = new Coordinates({\r\n        x: 0, //parseFloat(x),\r\n        y: 0, //parseFloat(y),\r\n      });\r\n\r\n    this.shapeId = shapeId;\r\n    if (this.shapeId !== undefined)\r\n      this.canvasLayer.shapes\r\n        .find((s) => s.id === this.shapeId)\r\n        .pointIds.push(this.id);\r\n    this.idx = idx;\r\n    this.segmentIds = [...segmentIds];\r\n    this.type = type;\r\n    this.name = name;\r\n    if (ratio !== undefined) this.ratio = parseFloat(ratio);\r\n    this.visible = visible;\r\n    this.color = color;\r\n    this.size = size;\r\n    this.reference = reference;\r\n    this.endpointIds = [...endpointIds];\r\n    this.geometryIsVisible = geometryIsVisible;\r\n    this.geometryIsHidden = geometryIsHidden;\r\n  }\r\n\r\n  get canvasLayer() {\r\n    return app[this.layer + 'CanvasLayer'];\r\n  }\r\n\r\n  get shape() {\r\n    const shape = this.canvasLayer.shapes.find((s) => s.id === this.shapeId);\r\n    return shape;\r\n  }\r\n\r\n  get segments() {\r\n    const segments = this.segmentIds.map((segId) =>\r\n      this.canvasLayer.segments.find((seg) => seg.id === segId),\r\n    );\r\n    return segments;\r\n  }\r\n\r\n  get x() {\r\n    return this.coordinates.x;\r\n  }\r\n\r\n  get y() {\r\n    return this.coordinates.y;\r\n  }\r\n\r\n  /**\r\n   * move this with coordinates\r\n   * @param {Coordinates} coordinates\r\n   * @param {Boolean} negativeTranslation true if the coordinates must be reversed\r\n   */\r\n  translate(coordinates, negativeTranslation = false) {\r\n    this.coordinates = negativeTranslation\r\n      ? this.coordinates.substract(coordinates)\r\n      : this.coordinates.add(coordinates);\r\n  }\r\n\r\n  /**\r\n   * multiplies this with scalar(s)\r\n   * @param {Number} multiplierX\r\n   * @param {Number} multiplierY\r\n   */\r\n  multiply(multiplierX, multiplierY = multiplierX) {\r\n    this.coordinates = this.coordinates.multiply(multiplierX, multiplierY);\r\n  }\r\n\r\n  /**\r\n   * rotate a point clockwise\r\n   * @param {number} angle - rotation angle\r\n   * @param {{x: number, y: number}} [center] - rotation center\r\n   * @return {{x: number, y: number}} new coordinates\r\n   */\r\n  rotate(angle, center = { x: 0, y: 0 }) {\r\n    const s = Math.sin(angle),\r\n      c = Math.cos(angle),\r\n      x = this.x - center.x,\r\n      y = this.y - center.y,\r\n      newX = x * c - y * s + center.x,\r\n      newY = x * s + y * c + center.y;\r\n    this.x = newX;\r\n    this.y = newY;\r\n    return this.copy();\r\n  }\r\n\r\n  computeTransformConstraint() {\r\n    let constraints = {\r\n      isFree: false,\r\n      isConstrained: false,\r\n      isBlocked: false,\r\n      isConstructed: false,\r\n      lines: [],\r\n      points: [],\r\n    };\r\n    const reference = findObjectById(this.reference);\r\n    if (reference && reference instanceof Point) {\r\n      const reference = findObjectById(this.reference);\r\n      reference.computeTransformConstraint();\r\n      constraints = reference.transformConstraints;\r\n    } else if (this.type == 'divisionPoint' || this.type == 'shapeCenter') {\r\n      constraints.isConstructed = true;\r\n    } else if (this.shape.geometryObject.geometryTransformationName != null) {\r\n      constraints.isConstructed = true;\r\n    } else if (\r\n      this.shape.geometryObject.geometryDuplicateParentShapeId != null\r\n    ) {\r\n      constraints.isConstructed = true;\r\n    } else if (this.shape.familyName == 'copy') {\r\n      constraints.isConstructed = true;\r\n    } else {\r\n      if (this.shape.familyName == 'Regular') {\r\n        if (this.idx < 2) {\r\n          constraints.isFree = true;\r\n        } else {\r\n          constraints.isConstructed = true;\r\n        }\r\n      } else if (this.shape.familyName == 'Irregular') {\r\n        if (this.shape.points.some((pt) => pt.type == 'arcCenter')) {\r\n          constraints.isBlocked = true;\r\n        } else {\r\n          constraints.isFree = true;\r\n        }\r\n      } else if (this.shape.name == 'RightAngleTriangle') {\r\n        if (this.idx < 2) {\r\n          constraints.isFree = true;\r\n        } else {\r\n          constraints.isConstrained = true;\r\n          constraints.lines = [\r\n            {\r\n              segment: this.shape.segments[1],\r\n              isInfinite: true,\r\n            },\r\n          ];\r\n        }\r\n      } else if (this.shape.name == 'IsoscelesTriangle') {\r\n        if (this.idx < 2) {\r\n          constraints.isFree = true;\r\n        } else {\r\n          constraints.isConstrained = true;\r\n\r\n          const firstSeg = this.shape.segments[0];\r\n          const middleOfSegment = firstSeg.middle;\r\n          constraints.lines = [\r\n            {\r\n              segment: new Segment({\r\n                layer: 'invisible',\r\n                createFromNothing: true,\r\n                vertexCoordinates: [this.coordinates, middleOfSegment],\r\n              }),\r\n              isInfinite: true,\r\n            },\r\n          ];\r\n        }\r\n      } else if (this.shape.name == 'RightAngleIsoscelesTriangle') {\r\n        if (this.idx < 2) {\r\n          constraints.isFree = true;\r\n        } else {\r\n          constraints.isConstrained = true;\r\n          const firstSeg = this.shape.segments[0];\r\n          const segmentLength = firstSeg.length;\r\n          const angle = firstSeg.getAngleWithHorizontal();\r\n          const perpendicularAngle = angle + Math.PI / 2;\r\n          const firstPoint = new Coordinates({\r\n            x:\r\n              firstSeg.vertexes[1].x +\r\n              Math.cos(perpendicularAngle) * segmentLength,\r\n            y:\r\n              firstSeg.vertexes[1].y +\r\n              Math.sin(perpendicularAngle) * segmentLength,\r\n          });\r\n          const secondPoint = new Coordinates({\r\n            x:\r\n              firstSeg.vertexes[1].x -\r\n              Math.cos(perpendicularAngle) * segmentLength,\r\n            y:\r\n              firstSeg.vertexes[1].y -\r\n              Math.sin(perpendicularAngle) * segmentLength,\r\n          });\r\n          constraints.points.push(firstPoint);\r\n          constraints.points.push(secondPoint);\r\n        }\r\n      } else if (this.shape.name == 'Rectangle') {\r\n        if (this.idx < 2) {\r\n          constraints.isFree = true;\r\n        } else if (this.idx == 2) {\r\n          constraints.isConstrained = true;\r\n\r\n          constraints.lines = [\r\n            {\r\n              segment: this.shape.segments[1],\r\n              isInfinite: true,\r\n            },\r\n          ];\r\n        } else {\r\n          constraints.isConstructed = true;\r\n        }\r\n      } else if (this.shape.name == 'Losange') {\r\n        if (this.idx < 2) {\r\n          constraints.isFree = true;\r\n        } else if (this.idx == 2) {\r\n          constraints.isConstrained = true;\r\n          const constraintLine = {\r\n            segment: new Segment({\r\n              layer: 'invisible',\r\n              createFromNothing: true,\r\n              vertexCoordinates: [this.shape.vertexes[0].coordinates],\r\n              arcCenterCoordinates: this.shape.vertexes[1].coordinates,\r\n            }),\r\n          };\r\n          constraintLine.segment.vertexIds[1] =\r\n            constraintLine.segment.vertexIds[0];\r\n          constraints.lines = [constraintLine];\r\n        } else {\r\n          constraints.isConstructed = true;\r\n        }\r\n      } else if (this.shape.name == 'Parallelogram') {\r\n        if (this.idx < 3) {\r\n          constraints.isFree = true;\r\n        } else {\r\n          constraints.isConstructed = true;\r\n        }\r\n      } else if (this.shape.name == 'RightAngleTrapeze') {\r\n        if (this.idx < 2) {\r\n          constraints.isFree = true;\r\n        } else {\r\n          constraints.isConstrained = true;\r\n\r\n          constraints.lines = [\r\n            {\r\n              segment: this.shape.segments[this.idx - 1],\r\n              isInfinite: true,\r\n            },\r\n          ];\r\n        }\r\n      } else if (this.shape.name == 'IsoscelesTrapeze') {\r\n        if (this.idx < 3) {\r\n          constraints.isFree = true;\r\n        } else {\r\n          constraints.isConstructed = true;\r\n        }\r\n      } else if (this.shape.name == 'Trapeze') {\r\n        if (this.idx < 3) {\r\n          constraints.isFree = true;\r\n        } else {\r\n          constraints.isConstrained = true;\r\n          constraints.lines = [\r\n            {\r\n              segment: new Segment({\r\n                layer: 'invisible',\r\n                createFromNothing: true,\r\n                vertexCoordinates: [\r\n                  this.shape.vertexes[2].coordinates,\r\n                  this.shape.vertexes[3].coordinates,\r\n                ],\r\n              }),\r\n              isInfinite: true,\r\n            },\r\n          ];\r\n        }\r\n      } else if (this.shape.name == 'Circle') {\r\n        constraints.isFree = true;\r\n      } else if (this.shape.name == 'CirclePart') {\r\n        if (this.type == 'arcCenter') {\r\n          constraints.isFree = true;\r\n        } else if (this.idx <= 1) {\r\n          constraints.isFree = true;\r\n        } else {\r\n          constraints.isConstrained = true;\r\n          constraints.lines = [\r\n            {\r\n              segment: new Segment({\r\n                layer: 'invisible',\r\n                createFromNothing: true,\r\n                vertexCoordinates: [this.coordinates, this.coordinates],\r\n                arcCenterCoordinates: this.segments[0].arcCenter.coordinates,\r\n              }),\r\n            },\r\n          ];\r\n        }\r\n      } else if (this.shape.name == 'CircleArc') {\r\n        if (this.type == 'arcCenter') {\r\n          constraints.isFree = true;\r\n        } else if (this.idx == 0) {\r\n          constraints.isFree = true;\r\n        } else {\r\n          constraints.isConstrained = true;\r\n          constraints.lines = [\r\n            {\r\n              segment: new Segment({\r\n                layer: 'invisible',\r\n                createFromNothing: true,\r\n                vertexCoordinates: [this.coordinates, this.coordinates],\r\n                arcCenterCoordinates: this.segments[0].arcCenter.coordinates,\r\n              }),\r\n            },\r\n          ];\r\n        }\r\n      } else if (\r\n        this.shape.name == '30degreesArc' ||\r\n        this.shape.name == '45degreesArc'\r\n      ) {\r\n        if (this.type == 'arcCenter') {\r\n          constraints.isFree = true;\r\n        } else if (this.idx == 0) {\r\n          constraints.isFree = true;\r\n        } else {\r\n          constraints.isBlocked = true;\r\n        }\r\n      } else if (this.shape.familyName == 'Line') {\r\n        if (\r\n          (this.shape.name == 'ParalleleSegment' ||\r\n            this.shape.name == 'ParalleleSemiStraightLine') &&\r\n          this.idx == 1\r\n        ) {\r\n          constraints.isConstrained = true;\r\n          const reference = findObjectById(\r\n            this.shape.geometryObject.geometryParentObjectId1,\r\n          );\r\n          const referenceAngle = reference.getAngleWithHorizontal();\r\n          const constraintLine = {\r\n            segment: new Segment({\r\n              layer: 'invisible',\r\n              createFromNothing: true,\r\n              vertexCoordinates: [\r\n                this.shape.vertexes[0],\r\n                this.shape.vertexes[0].coordinates.add(\r\n                  new Coordinates({\r\n                    x: 100 * Math.cos(referenceAngle),\r\n                    y: 100 * Math.sin(referenceAngle),\r\n                  }),\r\n                ),\r\n              ],\r\n            }),\r\n            isInfinite: true,\r\n          };\r\n          constraints.lines = [constraintLine];\r\n        } else if (\r\n          (this.shape.name == 'PerpendicularSegment' ||\r\n            this.shape.name == 'PerpendicularSemiStraightLine') &&\r\n          this.idx == 1\r\n        ) {\r\n          constraints.isConstrained = true;\r\n          const reference = findObjectById(\r\n            this.shape.geometryObject.geometryParentObjectId1,\r\n          );\r\n          const referenceAngle =\r\n            reference.getAngleWithHorizontal() + Math.PI / 2;\r\n          const constraintLine = {\r\n            segment: new Segment({\r\n              layer: 'invisible',\r\n              createFromNothing: true,\r\n              vertexCoordinates: [\r\n                this.shape.vertexes[0],\r\n                this.shape.vertexes[0].coordinates.add(\r\n                  new Coordinates({\r\n                    x: 100 * Math.cos(referenceAngle),\r\n                    y: 100 * Math.sin(referenceAngle),\r\n                  }),\r\n                ),\r\n              ],\r\n            }),\r\n            isInfinite: true,\r\n          };\r\n          constraints.lines = [constraintLine];\r\n        } else if (this.idx == 0) {\r\n          constraints.isFree = true;\r\n        } else if (\r\n          (this.shape.name == 'Segment' ||\r\n            this.shape.name == 'SemiStraightLine' ||\r\n            this.shape.name == 'StraightLine' ||\r\n            this.shape.name == 'Vector') &&\r\n          this.idx == 1\r\n        ) {\r\n          constraints.isFree = true;\r\n        } else if (this.idx == 1) {\r\n          constraints.isConstructed = true;\r\n        }\r\n      } else if (this.shape.familyName == 'Point') {\r\n        if (this.shape.name == 'Point') {\r\n          constraints.isFree = true;\r\n        } else if (\r\n          this.shape.name == 'PointOnLine' ||\r\n          this.shape.name == 'PointOnShape'\r\n        ) {\r\n          constraints.isConstrained = true;\r\n        } else {\r\n          constraints.isConstructed = true;\r\n        }\r\n      }\r\n    }\r\n    if (reference && reference instanceof Segment) {\r\n      if (constraints.isFree) {\r\n        constraints.isFree = false;\r\n        constraints.isConstrained = true;\r\n        constraints.lines = [\r\n          {\r\n            segment: reference,\r\n          },\r\n        ];\r\n      } else if (constraints.isConstrained) {\r\n        constraints.isConstrained = false;\r\n        constraints.isBlocked = true;\r\n        constraints.lines.push({\r\n          segment: reference,\r\n        });\r\n      }\r\n    }\r\n    this.transformConstraints = constraints;\r\n  }\r\n\r\n  /**\r\n   * convertit en balise circle de svg\r\n   */\r\n  toSVG() {\r\n    const canvasCoordinates = this.coordinates.toCanvasCoordinates();\r\n    return (\r\n      '<circle cx=\"' +\r\n      canvasCoordinates.x +\r\n      '\" cy=\"' +\r\n      canvasCoordinates.y +\r\n      '\" r=\"' +\r\n      this.size * 2 * app.workspace.zoomLevel +\r\n      '\" fill=\"' +\r\n      this.color +\r\n      '\" />\\n'\r\n    );\r\n  }\r\n\r\n  /**\r\n   * get the positive angle figured by the 2 segments of the vertex in 0 =< value < 2 * Math.PI\r\n   * @param {Boolean} reduced   return value reduced to 0 =< value < Math.PI\r\n   */\r\n  getVertexAngle(reduced = false) {\r\n    const shape = this.shape,\r\n      segment = this.segments[0],\r\n      nextSegment = this.segments[1];\r\n\r\n    const angle1 = segment.getAngleWithHorizontal();\r\n    const angle2 = nextSegment.getAngleWithHorizontal();\r\n\r\n    let resultAngle = mod(angle1 - angle2, 2 * Math.PI);\r\n    if (reduced && resultAngle > Math.PI)\r\n      resultAngle = 2 * Math.PI - resultAngle;\r\n\r\n    return resultAngle;\r\n  }\r\n\r\n  saveToObject() {\r\n    return this.saveData();\r\n  }\r\n\r\n  saveData() {\r\n    const data = {\r\n      id: this.id,\r\n      coordinates: this.coordinates,\r\n      shapeId: this.shapeId,\r\n      position: this.layer,\r\n      idx: this.idx,\r\n      segmentIds: [...this.segmentIds],\r\n    };\r\n\r\n    if (this.type != undefined) data.type = this.type;\r\n    if (this.name != undefined) data.name = this.name;\r\n    if (this.ratio != undefined) data.ratio = this.ratio;\r\n    if (this.visible !== true) data.visible = this.visible;\r\n    if (this.color !== '#000') data.color = this.color;\r\n    if (this.size !== 1) data.size = this.size;\r\n    if (this.reference !== null) data.reference = this.reference;\r\n    if (this.endpointIds.length !== 0) data.endpointIds = [...this.endpointIds];\r\n    if (this.geometryIsVisible !== true)\r\n      data.geometryIsVisible = this.geometryIsVisible;\r\n    if (this.geometryIsHidden !== false)\r\n      data.geometryIsHidden = this.geometryIsHidden;\r\n    return data;\r\n  }\r\n\r\n  static loadFromData(data) {\r\n    if (!data.position) data.position = 'main';\r\n    const point = new Point({ layer: data.position });\r\n    Object.assign(point, data);\r\n    point.coordinates = new Coordinates(point.coordinates);\r\n    point.segmentIds = [...data.segmentIds];\r\n    if (data.endpointIds) point.endpointIds = [...data.endpointIds];\r\n    if (app.environment.name == 'Tangram') {\r\n      point.startTangramCoordinates = new Coordinates(point.coordinates);\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Objects\\Segment.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":44,"column":12,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":44,"endColumn":14,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1239,1241],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":76,"column":32,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":76,"endColumn":34,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[2264,2266],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"prefer-const","severity":1,"message":"'centerCoordinates' is never reassigned. Use 'const' instead.","line":192,"column":11,"nodeType":"Identifier","messageId":"useConst","endLine":192,"endColumn":28},{"ruleId":"prefer-const","severity":1,"message":"'firstAngle' is never reassigned. Use 'const' instead.","line":193,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":193,"endColumn":19},{"ruleId":"prefer-const","severity":1,"message":"'secondAngle' is never reassigned. Use 'const' instead.","line":194,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":194,"endColumn":20},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":261,"column":17,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":261,"endColumn":19,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8300,8302],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":271,"column":16,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":271,"endColumn":18,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8542,8544],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":284,"column":19,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":284,"endColumn":21,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8998,9000],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"prefer-const","severity":1,"message":"'radius' is never reassigned. Use 'const' instead.","line":287,"column":11,"nodeType":"Identifier","messageId":"useConst","endLine":287,"endColumn":17},{"ruleId":"prefer-const","severity":1,"message":"'firstAngle' is never reassigned. Use 'const' instead.","line":288,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":288,"endColumn":19},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":343,"column":19,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":343,"endColumn":21,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[10755,10757],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'radius' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":346,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":346,"endColumn":17,"suggestions":[{"messageId":"removeVar","data":{"varName":"radius"},"fix":{"range":[10850,10901],"text":""},"desc":"Remove unused variable 'radius'."}]},{"ruleId":"prefer-const","severity":1,"message":"'radius' is never reassigned. Use 'const' instead.","line":346,"column":11,"nodeType":"Identifier","messageId":"useConst","endLine":346,"endColumn":17},{"ruleId":"prefer-const","severity":1,"message":"'firstAngle' is never reassigned. Use 'const' instead.","line":347,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":347,"endColumn":19},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":363,"column":19,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":363,"endColumn":21,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[11844,11846],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":426,"column":26,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":426,"endColumn":28,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[13504,13506],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":440,"column":26,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":440,"endColumn":28,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[13988,13990],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"prefer-const","severity":1,"message":"'vertex' is never reassigned. Use 'const' instead.","line":449,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":449,"endColumn":15},{"ruleId":"prefer-const","severity":1,"message":"'center' is never reassigned. Use 'const' instead.","line":450,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":450,"endColumn":13},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":468,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":468,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[15035,15037],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":470,"column":42,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":470,"endColumn":44,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[15158,15160],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":495,"column":70,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":495,"endColumn":72,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[16023,16025],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":526,"column":22,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":526,"endColumn":24,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[16872,16874],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":528,"column":11,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":528,"endColumn":13,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[16912,16914],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":534,"column":22,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":534,"endColumn":24,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[17130,17132],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":536,"column":11,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":536,"endColumn":13,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[17167,17169],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":588,"column":13,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":588,"endColumn":15,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[19136,19138],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"prefer-const","severity":1,"message":"'p1x' is never reassigned. Use 'const' instead.","line":613,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":613,"endColumn":12},{"ruleId":"prefer-const","severity":1,"message":"'p1y' is never reassigned. Use 'const' instead.","line":614,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":614,"endColumn":12},{"ruleId":"prefer-const","severity":1,"message":"'p2x' is never reassigned. Use 'const' instead.","line":615,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":615,"endColumn":12},{"ruleId":"prefer-const","severity":1,"message":"'p2y' is never reassigned. Use 'const' instead.","line":616,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":616,"endColumn":12},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":715,"column":19,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":715,"endColumn":21,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[23257,23259],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":841,"column":21,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":841,"endColumn":23,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[27915,27917],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":907,"column":23,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":907,"endColumn":25,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[30603,30605],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":931,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":931,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[31366,31368],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":950,"column":15,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":950,"endColumn":17,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[31920,31922],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":983,"column":34,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":983,"endColumn":36,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[33170,33172],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":1013,"column":19,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":1013,"endColumn":21,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[34178,34180],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":1014,"column":22,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":1014,"endColumn":24,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[34208,34210],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":1050,"column":26,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":1050,"endColumn":28,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[35250,35252],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":1056,"column":20,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":1056,"endColumn":22,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[35578,35580],"text":"!=="},"desc":"Use '!==' instead of '!='."}]}],"suppressedMessages":[],"errorCount":27,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app } from '../App';\r\nimport {\r\n  addInfoToId,\r\n  findObjectById,\r\n  isAlmostInfinite,\r\n  mod,\r\n  removeObjectById,\r\n  uniqId,\r\n} from '../Tools/general';\r\nimport { Bounds } from './Bounds';\r\nimport { Coordinates } from './Coordinates';\r\nimport { Point } from './Point';\r\n\r\nexport class Segment {\r\n  /**\r\n   * @param {String}                      id\r\n   * @param {String}                      shapeId\r\n   * @param {Number}                      idx\r\n   * @param {[String]}                    vertexIds\r\n   * @param {[String]}                    divisionPointIds\r\n   * @param {String}                      arcCenterId\r\n   * @param {Boolean}                     counterclockwise\r\n   * @param {Boolean}                     isInfinite\r\n   * @param {Boolean}                     isSemiInfinite\r\n   */\r\n  constructor({\r\n    id,\r\n    layer,\r\n    shapeId = undefined,\r\n    idx = undefined,\r\n    createFromNothing = false,\r\n    vertexCoordinates = [],\r\n    divisionPointInfos = [],\r\n    arcCenterCoordinates = null,\r\n    vertexIds = [],\r\n    divisionPointIds = [],\r\n    arcCenterId = undefined,\r\n    counterclockwise = false,\r\n    isInfinite = false,\r\n    isSemiInfinite = false,\r\n    color = undefined,\r\n    width = 1,\r\n  }) {\r\n    if (id == undefined) id = uniqId(layer, 'segment');\r\n    else id = addInfoToId(id, layer, 'segment');\r\n    this.id = id;\r\n    this.layer = layer;\r\n    this.canvasLayer.segments.push(this);\r\n\r\n    this.shapeId = shapeId;\r\n    this.idx = idx;\r\n    if (createFromNothing) {\r\n      this.vertexIds = vertexCoordinates.map((vCoord, idx) => {\r\n        const newPoint = new Point({\r\n          layer: this.layer,\r\n          segmentIds: [this.id],\r\n          shapeId: this.shapeId,\r\n          idx: idx,\r\n          type: 'vertex',\r\n          coordinates: vCoord,\r\n        });\r\n        return newPoint.id;\r\n      });\r\n      this.divisionPointIds = divisionPointInfos.map((dInfo) => {\r\n        const newPoint = new Point({\r\n          layer: this.layer,\r\n          segmentIds: [this.id],\r\n          shapeId: this.shapeId,\r\n          type: 'divisionPoint',\r\n          coordinates: dInfo.coordinates,\r\n          ratio: dInfo.ratio,\r\n          color: dInfo.color,\r\n        });\r\n        return newPoint.id;\r\n      });\r\n      if (arcCenterCoordinates != undefined) {\r\n        const arcCenter = new Point({\r\n          layer: this.layer,\r\n          segmentIds: [this.id],\r\n          shapeId: this.shapeId,\r\n          type: 'arcCenter',\r\n          coordinates: arcCenterCoordinates,\r\n          visible: false,\r\n        });\r\n        this.arcCenterId = arcCenter.id;\r\n      }\r\n    } else {\r\n      this.vertexIds = [...vertexIds];\r\n      this.vertexIds.forEach((vxId) =>\r\n        findObjectById(vxId).segmentIds.push(this.id),\r\n      );\r\n      this.divisionPointIds = [...divisionPointIds];\r\n      this.divisionPointIds.forEach((dptId) =>\r\n        findObjectById(dptId).segmentIds.push(this.id),\r\n      );\r\n      this.shapeId = shapeId;\r\n      if (this.shapeId !== undefined) {\r\n        findObjectById(this.shapeId).segmentIds.push(this.id);\r\n      }\r\n      this.arcCenterId = arcCenterId;\r\n    }\r\n    this.counterclockwise = counterclockwise;\r\n    this.isInfinite = isInfinite;\r\n    this.isSemiInfinite = isSemiInfinite;\r\n    this.color = color;\r\n    this.width = width;\r\n  }\r\n\r\n  /* #################################################################### */\r\n  /* ############################## GET/SET ############################# */\r\n  /* #################################################################### */\r\n\r\n  get canvasLayer() {\r\n    return app[this.layer + 'CanvasLayer'];\r\n  }\r\n\r\n  get shape() {\r\n    const shape = findObjectById(this.shapeId);\r\n    return shape;\r\n  }\r\n\r\n  get points() {\r\n    const points = [...this.divisionPoints, ...this.vertexes];\r\n    return points;\r\n  }\r\n\r\n  get vertexes() {\r\n    const vertexes = this.vertexIds.map((ptId) => findObjectById(ptId));\r\n    return vertexes;\r\n  }\r\n\r\n  get divisionPoints() {\r\n    const divisionPoints = this.divisionPointIds.map((ptId) =>\r\n      findObjectById(ptId),\r\n    );\r\n    return divisionPoints;\r\n  }\r\n\r\n  get arcCenter() {\r\n    const arcCenter = findObjectById(this.arcCenterId);\r\n    return arcCenter;\r\n  }\r\n\r\n  get bounds() {\r\n    const firstCoordinates = this.vertexes[0].coordinates,\r\n      secondCoordinates = this.vertexes[1].coordinates;\r\n    const bounds = new Bounds(\r\n      Math.min(firstCoordinates.x, secondCoordinates.x),\r\n      Math.min(firstCoordinates.y, secondCoordinates.y),\r\n      Math.max(firstCoordinates.x, secondCoordinates.x),\r\n      Math.max(firstCoordinates.y, secondCoordinates.y),\r\n    );\r\n    if (this.isArc()) {\r\n      let proj = this.centerProjectionOnSegment(Math.PI);\r\n      if (this.isCoordinatesOnSegment(proj))\r\n        bounds.minX = Math.min(bounds.minX, proj.x);\r\n      proj = this.centerProjectionOnSegment(1.5 * Math.PI);\r\n      if (this.isCoordinatesOnSegment(proj))\r\n        bounds.minY = Math.min(bounds.minY, proj.y);\r\n      proj = this.centerProjectionOnSegment(0);\r\n      if (this.isCoordinatesOnSegment(proj))\r\n        bounds.maxX = Math.max(bounds.maxX, proj.x);\r\n      proj = this.centerProjectionOnSegment(0.5 * Math.PI);\r\n      if (this.isCoordinatesOnSegment(proj))\r\n        bounds.maxY = Math.max(bounds.maxY, proj.y);\r\n    }\r\n    return bounds;\r\n  }\r\n\r\n  get radius() {\r\n    if (!this.arcCenter) {\r\n      console.error('cannot take radius of straight segment ', this);\r\n      return 0;\r\n    }\r\n    return this.arcCenter.coordinates.dist(this.vertexes[1].coordinates);\r\n  }\r\n\r\n  get length() {\r\n    return this.vertexes[0].coordinates.dist(this.vertexes[1].coordinates);\r\n  }\r\n\r\n  get direction() {\r\n    const originVector = this.vertexes[1].coordinates.substract(\r\n      this.vertexes[0].coordinates,\r\n    );\r\n    const normalOriginVector = originVector.multiply(1 / this.length);\r\n    return normalOriginVector;\r\n  }\r\n\r\n  get middle() {\r\n    if (this.isArc()) {\r\n      let centerCoordinates = this.arcCenter.coordinates,\r\n        firstAngle = centerCoordinates.angleWith(this.vertexes[0].coordinates),\r\n        secondAngle = centerCoordinates.angleWith(this.vertexes[1].coordinates),\r\n        middleAngle = (firstAngle + secondAngle) / 2;\r\n\r\n      if (this.counterclockwise ^ (firstAngle > secondAngle))\r\n        middleAngle += Math.PI;\r\n      const middle = new Coordinates({\r\n        x: this.radius * Math.cos(middleAngle) + centerCoordinates.x,\r\n        y: this.radius * Math.sin(middleAngle) + centerCoordinates.y,\r\n      });\r\n      return middle;\r\n    } else {\r\n      return this.vertexes[0].coordinates.middleWith(\r\n        this.vertexes[1].coordinates,\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * return the non common point of this if this is joined to segment (1 common point)\r\n   * @param {Segment}  segment\r\n   */\r\n  getNonCommonPointIfJoined(segment) {\r\n    const jointure = this.vertexes.filter((v1) =>\r\n      segment.vertexes.some((v2) => v1.equal(v2)),\r\n    );\r\n    if (jointure) return jointure[0];\r\n    else return undefined;\r\n  }\r\n\r\n  /**\r\n   * return the middle of this if this is joined to segment (1 common point)\r\n   * @param {Segment} segment\r\n   */\r\n  getMiddleIfJoined(segment) {\r\n    if (this.vertexes.some((v1) => segment.vertexes.some((v2) => v1.equal(v2))))\r\n      return this.middle;\r\n    else return undefined;\r\n  }\r\n\r\n  getAngleWithHorizontal() {\r\n    return this.vertexes[0].coordinates.angleWith(this.vertexes[1].coordinates);\r\n  }\r\n\r\n  /**\r\n   * convertit le segment en commande de path svg\r\n   */\r\n  getSVGPath(scaling = 'scale', includeMoveTo = false, infiniteCheck = true) {\r\n    let firstCoordinates = this.vertexes[0].coordinates,\r\n      secondCoordinates = this.vertexes[1].coordinates;\r\n    if (infiniteCheck && this.isInfinite) {\r\n      const angle = this.getAngleWithHorizontal();\r\n      firstCoordinates = firstCoordinates.substract({\r\n        x: 10000 * Math.cos(angle),\r\n        y: 10000 * Math.sin(angle),\r\n      });\r\n      secondCoordinates = secondCoordinates.add({\r\n        x: 10000 * Math.cos(angle),\r\n        y: 10000 * Math.sin(angle),\r\n      });\r\n    } else if (infiniteCheck && this.isSemiInfinite) {\r\n      const angle = this.getAngleWithHorizontal();\r\n      secondCoordinates = secondCoordinates.add({\r\n        x: 10000 * Math.cos(angle),\r\n        y: 10000 * Math.sin(angle),\r\n      });\r\n    }\r\n\r\n    if (scaling == 'scale') {\r\n      firstCoordinates = firstCoordinates.toCanvasCoordinates();\r\n      secondCoordinates = secondCoordinates.toCanvasCoordinates();\r\n    }\r\n\r\n    let path,\r\n      moveTo = '';\r\n\r\n    if (\r\n      !this.shape ||\r\n      this.idx == 0 ||\r\n      this.vertexIds[0] !== this.previousSegment.vertexIds[1] ||\r\n      includeMoveTo\r\n    ) {\r\n      moveTo = ['M', firstCoordinates.x, firstCoordinates.y, ''].join(' ');\r\n    }\r\n\r\n    if (!this.arcCenter) {\r\n      // line\r\n      path = ['L', secondCoordinates.x, secondCoordinates.y].join(' ');\r\n    } else if (this.axisAngle === undefined) {\r\n      // circle or arc\r\n      let centerCoordinates = this.arcCenter.coordinates;\r\n      if (scaling == 'scale')\r\n        centerCoordinates = centerCoordinates.toCanvasCoordinates();\r\n\r\n      let radius = centerCoordinates.dist(secondCoordinates),\r\n        firstAngle = centerCoordinates.angleWith(firstCoordinates),\r\n        secondAngle = centerCoordinates.angleWith(secondCoordinates);\r\n\r\n      if (firstCoordinates.equal(secondCoordinates)) {\r\n        // circle\r\n        const oppositeAngle = firstAngle + Math.PI,\r\n          oppositeCoordinates = new Coordinates({\r\n            x: centerCoordinates.x + Math.cos(oppositeAngle) * radius,\r\n            y: centerCoordinates.y + Math.sin(oppositeAngle) * radius,\r\n          });\r\n        path = [\r\n          'A',\r\n          radius,\r\n          radius,\r\n          0,\r\n          1,\r\n          0,\r\n          oppositeCoordinates.x,\r\n          oppositeCoordinates.y,\r\n        ]\r\n          .concat([\r\n            'A',\r\n            radius,\r\n            radius,\r\n            0,\r\n            1,\r\n            0,\r\n            secondCoordinates.x,\r\n            secondCoordinates.y,\r\n          ])\r\n          .join(' ');\r\n      } else {\r\n        // arc\r\n        if (secondAngle < firstAngle) secondAngle += 2 * Math.PI;\r\n        let largeArcFlag = secondAngle - firstAngle > Math.PI ? 1 : 0,\r\n          sweepFlag = 1;\r\n        if (this.counterclockwise) {\r\n          sweepFlag = Math.abs(sweepFlag - 1);\r\n          largeArcFlag = Math.abs(largeArcFlag - 1);\r\n        }\r\n        path = [\r\n          'A',\r\n          radius,\r\n          radius,\r\n          0,\r\n          largeArcFlag,\r\n          sweepFlag,\r\n          secondCoordinates.x,\r\n          secondCoordinates.y,\r\n        ].join(' ');\r\n      }\r\n    } else {\r\n      // ellipse or ellipse arc\r\n\r\n      let centerCoordinates = this.arcCenter.coordinates;\r\n      if (scaling == 'scale')\r\n        centerCoordinates = centerCoordinates.toCanvasCoordinates();\r\n\r\n      let radius = centerCoordinates.dist(secondCoordinates),\r\n        firstAngle = centerCoordinates.angleWith(firstCoordinates),\r\n        secondAngle = centerCoordinates.angleWith(secondCoordinates);\r\n\r\n      if (secondAngle < firstAngle) secondAngle += 2 * Math.PI;\r\n      let largeArcFlag = secondAngle - firstAngle > Math.PI ? 1 : 0,\r\n        sweepFlag = 1;\r\n      if (this.counterclockwise) {\r\n        sweepFlag = Math.abs(sweepFlag - 1);\r\n        largeArcFlag = Math.abs(largeArcFlag - 1);\r\n      }\r\n\r\n      // Ensure tangent points are in the same coordinate system as centerCoordinates\r\n      // When scaling == 'scale', firstCoordinates/secondCoordinates/centerCoordinates are converted to canvas coordinates.\r\n      // seg.tangentPoint1/2 are Points (logical coordinates). Convert them to canvas to avoid mixing units under zoom.\r\n      let tp1 = this.tangentPoint1?.coordinates || this.tangentPoint1;\r\n      let tp2 = this.tangentPoint2?.coordinates || this.tangentPoint2;\r\n      if (scaling == 'scale') {\r\n        tp1 = tp1?.toCanvasCoordinates ? tp1.toCanvasCoordinates() : tp1;\r\n        tp2 = tp2?.toCanvasCoordinates ? tp2.toCanvasCoordinates() : tp2;\r\n      }\r\n      const rx = centerCoordinates.dist(tp1),\r\n        ry = centerCoordinates.dist(tp2),\r\n        degreeAxisAngle = (this.axisAngle * 180) / Math.PI;\r\n      // canvas path2D => radian\r\n      // svg path => degree\r\n\r\n      if (firstCoordinates.equal(secondCoordinates)) {\r\n        // ellipse\r\n        const oppositeCoordinates = centerCoordinates\r\n          .multiply(2)\r\n          .substract(firstCoordinates);\r\n\r\n        path = [\r\n          'A',\r\n          rx,\r\n          ry,\r\n          degreeAxisAngle,\r\n          largeArcFlag,\r\n          sweepFlag,\r\n          oppositeCoordinates.x,\r\n          oppositeCoordinates.y,\r\n        ]\r\n          .concat([\r\n            'A',\r\n            rx,\r\n            ry,\r\n            degreeAxisAngle,\r\n            largeArcFlag,\r\n            sweepFlag,\r\n            secondCoordinates.x,\r\n            secondCoordinates.y,\r\n          ])\r\n          .join(' ');\r\n      } else {\r\n        // arc ellipse\r\n        path = [\r\n          'A',\r\n          rx,\r\n          ry,\r\n          degreeAxisAngle,\r\n          largeArcFlag,\r\n          sweepFlag,\r\n          secondCoordinates.x,\r\n          secondCoordinates.y,\r\n        ].join(' ');\r\n      }\r\n    }\r\n\r\n    const resultingPath = moveTo + path;\r\n\r\n    return resultingPath;\r\n  }\r\n\r\n  get previousSegment() {\r\n    if (!this.shapeId) {\r\n      console.error('Cannot take previous Segment when no shape.');\r\n      return null;\r\n    }\r\n    const numberOfSegments = this.shape.segmentIds.length;\r\n    if (numberOfSegments == 1) {\r\n      console.info('Previous Segment of Shape with one Segment returns this.');\r\n    }\r\n    const previousIdx = mod(this.idx - 1, numberOfSegments);\r\n    const previousSegment = this.shape.segments[previousIdx];\r\n    return previousSegment;\r\n  }\r\n\r\n  get nextSegment() {\r\n    if (!this.shapeId) {\r\n      console.error('Cannot take next Segment when no shape.');\r\n      return null;\r\n    }\r\n    const numberOfSegments = this.shape.segmentIds.length;\r\n    if (numberOfSegments == 1) {\r\n      console.info('Next Segment of Shape with one Segment returns this.');\r\n    }\r\n    const nextIdx = mod(this.idx + 1, numberOfSegments);\r\n    const nextSegment = this.shape.segments[nextIdx];\r\n    return nextSegment;\r\n  }\r\n\r\n  getArcTangent(vertexNb) {\r\n    let vertex = this.vertexes[vertexNb],\r\n      center = this.arcCenter,\r\n      originVector = vertex.coordinates.substract(center.coordinates),\r\n      perpendicularOriginVector;\r\n    originVector = originVector.multiply(1 / this.radius);\r\n    if (Math.abs(originVector.y) < 0.001) originVector.y = 0;\r\n    if (Math.abs(originVector.x) < 0.001) originVector.x = 0;\r\n    let xCoordinate = 1;\r\n    if (originVector.y > 0) xCoordinate *= -1;\r\n    let yCoordinate = originVector.x / originVector.y;\r\n    if (originVector.y < 0) yCoordinate *= -1;\r\n    if (this.counterclockwise) {\r\n      xCoordinate *= -1;\r\n      yCoordinate *= -1;\r\n    }\r\n    perpendicularOriginVector = new Coordinates({\r\n      x: xCoordinate,\r\n      y: yCoordinate,\r\n    });\r\n    if (perpendicularOriginVector.y == Infinity)\r\n      perpendicularOriginVector = new Coordinates({ x: 0, y: 1 });\r\n    else if (perpendicularOriginVector.y == -Infinity)\r\n      perpendicularOriginVector = new Coordinates({ x: 0, y: -1 });\r\n    else\r\n      perpendicularOriginVector = perpendicularOriginVector.multiply(\r\n        1 / Coordinates.nullCoordinates.dist(perpendicularOriginVector),\r\n      );\r\n    return perpendicularOriginVector;\r\n  }\r\n\r\n  /* #################################################################### */\r\n  /* ########################## SEGMENT POINTS ########################## */\r\n  /* #################################################################### */\r\n\r\n  addPoint(\r\n    coordinates,\r\n    ratio,\r\n    firstPointId,\r\n    secondPointId,\r\n    verifyIfPointExists = true,\r\n  ) {\r\n    // if doesnt already exist\r\n    if (\r\n      !verifyIfPointExists ||\r\n      this.divisionPoints\r\n        .filter((divPt) => divPt.visible)\r\n        .findIndex((pt) => pt.coordinates.dist(coordinates) < 0.001) == -1\r\n    ) {\r\n      const newPoint = new Point({\r\n        coordinates: coordinates,\r\n        type: 'divisionPoint',\r\n        ratio: ratio,\r\n        layer: this.layer,\r\n        shapeId: this.shapeId,\r\n        segmentIds: [this.id],\r\n        endpointIds: [firstPointId, secondPointId],\r\n      });\r\n      this.divisionPointIds.push(newPoint.id);\r\n      return newPoint;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * sort segment points from vertexes[start]\r\n   * @param {*} start\r\n   */\r\n  sortDivisionPoints(start = 0) {\r\n    this.divisionPointIds.sort((id1, id2) => {\r\n      const pt1 = findObjectById(id1);\r\n      const pt2 = findObjectById(id2);\r\n      return (pt1.ratio - pt2.ratio) * (-start * 2 + 1);\r\n    });\r\n  }\r\n\r\n  deletePoint(point) {\r\n    const pointId = point.id;\r\n    let i = this.divisionPointIds.findIndex((divisionPointId) => {\r\n      return pointId == divisionPointId;\r\n    });\r\n    if (i == -1) {\r\n      console.error(\"couldn't delete point from segment\");\r\n      return null;\r\n    }\r\n    this.divisionPointIds.splice(i, 1);\r\n    i = this.shape.pointIds.findIndex((shapePointId) => {\r\n      return pointId == shapePointId;\r\n    });\r\n    if (i == -1) {\r\n      console.error(\"couldn't delete point from shape\");\r\n      return null;\r\n    }\r\n    this.shape.pointIds.splice(i, 1);\r\n    removeObjectById(pointId);\r\n  }\r\n\r\n  /* #################################################################### */\r\n  /* ############################ TRANSFORM ############################# */\r\n  /* #################################################################### */\r\n\r\n  scale(scaling) {\r\n    this.vertexes.forEach((vertex) => vertex.multiplyWithScalar(scaling, true));\r\n    if (this.points)\r\n      this.points.forEach((pt) => pt.multiplyWithScalar(scaling, true));\r\n    if (this.arcCenter) this.arcCenter.multiplyWithScalar(scaling, true);\r\n  }\r\n\r\n  translate(coordinates) {\r\n    if (this.vertexes)\r\n      this.vertexes.forEach((vertex) => vertex.translate(coordinates));\r\n    if (this.points)\r\n      this.points.forEach((point) => point.translate(coordinates));\r\n    if (this.arcCenter) this.arcCenter.translate(coordinates);\r\n  }\r\n\r\n  reverse(changeClockwise = false) {\r\n    this.vertexIds.reverse();\r\n    this.vertexes.forEach((vx, idx) => (vx.idx = idx));\r\n    this.divisionPoints.forEach((pt) => (pt.ratio = 1 - pt.ratio));\r\n    if (this.arcCenter && changeClockwise)\r\n      this.counterclockwise = !this.counterclockwise;\r\n  }\r\n\r\n  /* #################################################################### */\r\n  /* ############################## OTHER ############################### */\r\n  /* #################################################################### */\r\n\r\n  /**\r\n   * divide a segment with points and return the subsegments\r\n   * @param {Point[]} points the points for the divide\r\n   */\r\n  divideWith(points) {\r\n    points.sort((pt1, pt2) =>\r\n      pt1.coordinates.dist(this.vertexes[0].coordinates) >\r\n      pt2.coordinates.dist(this.vertexes[0].coordinates)\r\n        ? 1\r\n        : -1,\r\n    );\r\n    const newSegments = [this.vertexes[0], ...points, this.vertexes[1]]\r\n      .map((pt, idx, pts) =>\r\n        idx == 0\r\n          ? undefined\r\n          : new Segment({\r\n              layer: this.layer,\r\n              createFromNothing: true,\r\n              vertexCoordinates: [pts[idx - 1].coordinates, pt.coordinates],\r\n            }),\r\n      )\r\n      .slice(1);\r\n    return newSegments;\r\n  }\r\n\r\n  /**\r\n   * Find the point's projection on this.\r\n   *\r\n   * For circle : https://math.stackexchange.com/questions/1744354/project-a-point-within-a-circle-onto-its-edge\r\n   * @param {Coordinates} coordinates\r\n   */\r\n  projectionOnSegment(coordinates) {\r\n    if (this.arcCenter) {\r\n      const angle = this.arcCenter.coordinates.angleWith(coordinates);\r\n      const projection = this.centerProjectionOnSegment(angle);\r\n      return projection;\r\n    } else {\r\n      let proj = null,\r\n        p1x = this.vertexes[0].x,\r\n        p1y = this.vertexes[0].y,\r\n        p2x = this.vertexes[1].x,\r\n        p2y = this.vertexes[1].y;\r\n\r\n      // Calculer la projection du point sur l'axe.\r\n      if (Math.abs(p2x - p1x) < 0.001) {\r\n        //segment vertical\r\n        proj = new Coordinates({ x: p1x, y: coordinates.y });\r\n      } else if (Math.abs(p2y - p1y) < 0.001) {\r\n        //segment horizontal\r\n        proj = new Coordinates({ x: coordinates.x, y: p1y });\r\n      } else {\r\n        // axe.type=='NW' || axe.type=='SW'\r\n        const f_a = (p1y - p2y) / (p1x - p2x),\r\n          f_b = p2y - f_a * p2x,\r\n          x2 =\r\n            (coordinates.x + coordinates.y * f_a - f_a * f_b) / (f_a * f_a + 1),\r\n          y2 = f_a * x2 + f_b;\r\n        proj = new Coordinates({\r\n          x: x2,\r\n          y: y2,\r\n        });\r\n      }\r\n      return proj;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * say if it is a subsegment (segment inside but no match with segmentPoints)\r\n   * @param {Segment} subseg subsegment\r\n   */\r\n  isSubsegment(subseg) {\r\n    return (\r\n      this.isPointOnSegment(subseg.vertexes[0]) &&\r\n      this.isPointOnSegment(subseg.vertexes[1])\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Find the angle's projection on this arc.\r\n   *\r\n   * For circle : https://math.stackexchange.com/questions/1744354/project-a-point-within-a-circle-onto-its-edge\r\n   * @param {*} angle\r\n   */\r\n  centerProjectionOnSegment(angle) {\r\n    if (this.arcCenter) {\r\n      const projection = this.arcCenter.coordinates.add({\r\n        x: this.radius * Math.cos(angle),\r\n        y: this.radius * Math.sin(angle),\r\n      });\r\n      return projection;\r\n    } else {\r\n      console.trace('no arc passed here');\r\n    }\r\n  }\r\n\r\n  isCoordinatesOnSegment(coord, precision = 0.001) {\r\n    if (this.isArc()) {\r\n      if (\r\n        Math.abs(this.arcCenter.coordinates.dist(coord) - this.radius) >\r\n        precision\r\n      )\r\n        return false;\r\n      let angle = this.arcCenter.coordinates.angleWith(coord),\r\n        bound1 = this.arcCenter.coordinates.angleWith(\r\n          this.vertexes[0].coordinates,\r\n        ),\r\n        bound2 = this.arcCenter.coordinates.angleWith(\r\n          this.vertexes[1].coordinates,\r\n        );\r\n      if (Math.abs(bound1 - bound2) < 0.001) return true;\r\n      if (this.counterclockwise) [bound1, bound2] = [bound2, bound1];\r\n      if (angle < bound1) angle += Math.PI * 2;\r\n      if (bound2 < bound1) bound2 += Math.PI * 2;\r\n      if (angle <= bound2) return true;\r\n      return false;\r\n    } else {\r\n      const projection = this.projectionOnSegment(coord);\r\n      if (this.isInfinite) {\r\n        return projection.dist(coord) < precision;\r\n      } else if (this.isSemiInfinite) {\r\n        return (\r\n          projection.dist(coord) < precision &&\r\n          Math.abs(\r\n            this.vertexes[0].coordinates.angleWith(\r\n              this.vertexes[1].coordinates,\r\n            ) - this.vertexes[0].coordinates.angleWith(projection),\r\n          ) < 0.001\r\n        );\r\n      } else {\r\n        const segmentLength = this.length,\r\n          dist1 = this.vertexes[0].coordinates.dist(coord),\r\n          dist2 = this.vertexes[1].coordinates.dist(coord);\r\n        return dist1 + dist2 - segmentLength < precision;\r\n      }\r\n    }\r\n  }\r\n\r\n  arcParelleleWith(segment) {\r\n    if (\r\n      this.arcCenter.coordinates.equal(segment.arcCenter.coordinates) &&\r\n      this.radius == segment.radius\r\n    ) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  isParalleleWith(segment) {\r\n    if (this.isArc() && segment.isArc()) {\r\n      return this.arcParelleleWith(segment);\r\n    } else if (this.isArc() || segment.isArc()) {\r\n      return false;\r\n    }\r\n    const thisv0x = this.vertexes[0].x,\r\n      thisv0y = this.vertexes[0].y,\r\n      thisv1x = this.vertexes[1].x,\r\n      thisv1y = this.vertexes[1].y,\r\n      segmentv0x = segment.vertexes[0].x,\r\n      segmentv0y = segment.vertexes[0].y,\r\n      segmentv1x = segment.vertexes[1].x,\r\n      segmentv1y = segment.vertexes[1].y,\r\n      thisSlope = (thisv0y - thisv1y) / (thisv0x - thisv1x),\r\n      segmentSlope = (segmentv0y - segmentv1y) / (segmentv0x - segmentv1x);\r\n    if (Math.abs(thisSlope - segmentSlope) < 0.001) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * point d'intersection de 2 segments (ou prolongation)\r\n   * @param {object} segment\r\n   * @return le point ou null si segments parall├¿les\r\n   */\r\n  intersectionWith(segment, precision = 1, coordinatesIfParalleleSegments) {\r\n    if (this.isArc() || segment.isArc()) {\r\n      return this.arcIntersectionWith(segment, precision);\r\n    }\r\n    const result = Coordinates.nullCoordinates,\r\n      thisv0x = this.vertexes[0].x,\r\n      thisv0y = this.vertexes[0].y,\r\n      thisv1x = this.vertexes[1].x,\r\n      thisv1y = this.vertexes[1].y,\r\n      segmentv0x = segment.vertexes[0].x,\r\n      segmentv0y = segment.vertexes[0].y,\r\n      segmentv1x = segment.vertexes[1].x,\r\n      segmentv1y = segment.vertexes[1].y,\r\n      thisSlope = (thisv0y - thisv1y) / (thisv0x - thisv1x),\r\n      segmentSlope = (segmentv0y - segmentv1y) / (segmentv0x - segmentv1x);\r\n\r\n    // 2 segments parall├¿les\r\n    if (Math.abs(thisSlope - segmentSlope) < 0.001) {\r\n      if (coordinatesIfParalleleSegments) {\r\n        if (\r\n          this.isCoordinatesOnSegment(coordinatesIfParalleleSegments) &&\r\n          segment.isCoordinatesOnSegment(coordinatesIfParalleleSegments)\r\n        ) {\r\n          return [coordinatesIfParalleleSegments];\r\n        } else {\r\n          return null;\r\n        }\r\n      }\r\n      return null;\r\n    }\r\n\r\n    // 2 segments verticaux\r\n    if (isAlmostInfinite(thisSlope) && isAlmostInfinite(segmentSlope))\r\n      return null;\r\n    // this vertical\r\n    else if (isAlmostInfinite(thisSlope)) {\r\n      const pb = segmentv0y - segmentSlope * segmentv0x;\r\n      result.y = segmentSlope * thisv0x + pb;\r\n      result.x = thisv0x;\r\n      // segment vertical\r\n    } else if (isAlmostInfinite(segmentSlope)) {\r\n      const pa = thisv0y - thisSlope * thisv0x;\r\n      result.y = thisSlope * segmentv0x + pa;\r\n      result.x = segmentv0x;\r\n      // 2 segments 'normaux'\r\n    } else {\r\n      const pb = segmentv0y - segmentSlope * segment.vertexes[0].x;\r\n      const pa = thisv0y - thisSlope * this.vertexes[0].x;\r\n      result.x = (pb - pa) / (thisSlope - segmentSlope);\r\n      result.y = thisSlope * result.x + pa;\r\n    }\r\n    if (\r\n      !this.isCoordinatesOnSegment(result) ||\r\n      !segment.isCoordinatesOnSegment(result)\r\n    ) {\r\n      return null;\r\n    }\r\n    return [result];\r\n  }\r\n\r\n  arcIntersectionWith(segment, precision = 1) {\r\n    let result = [];\r\n    if (this.isArc() && segment.isArc()) {\r\n      // two circles\r\n      // formules tir├®es de http://math.15873.pagesperso-orange.fr/IntCercles.html\r\n      const R0 = this.radius,\r\n        R1 = segment.radius;\r\n      const x0 = this.arcCenter.coordinates.x,\r\n        y0 = this.arcCenter.coordinates.y;\r\n      const x1 = segment.arcCenter.coordinates.x,\r\n        y1 = segment.arcCenter.coordinates.y;\r\n      const dist2Centers = Math.sqrt((x1 - x0) ** 2 + (y1 - y0) ** 2);\r\n      if (dist2Centers < 1 && Math.abs(R0 - R1) < 1) return null;\r\n      else if (dist2Centers > R0 + R1) return null;\r\n      else if (dist2Centers < Math.abs(R1 - R0)) return null;\r\n      else if (Math.abs(dist2Centers - R0 - R1) < 1) {\r\n        const angleBetweenCenter = this.arcCenter.coordinates.angleWith(\r\n          segment.arcCenter.coordinates,\r\n        );\r\n        return [this.centerProjectionOnSegment(angleBetweenCenter)];\r\n      } else if (dist2Centers - Math.abs(R0 - R1) < 1) {\r\n        if (R0 > R1) {\r\n          const angleBetweenCenter = this.arcCenter.coordinates.angleWith(\r\n            segment.arcCenter.coordinates,\r\n          );\r\n          return [this.centerProjectionOnSegment(angleBetweenCenter)];\r\n        } else {\r\n          const angleBetweenCenter = segment.arcCenter.coordinates.angleWith(\r\n            this.arcCenter.coordinates,\r\n          );\r\n          return [segment.centerProjectionOnSegment(angleBetweenCenter)];\r\n        }\r\n      } else if (y0 == y1) {\r\n        const x = (R1 ** 2 - R0 ** 2 - x1 ** 2 + x0 ** 2) / (2 * (x0 - x1));\r\n        const A = 1,\r\n          B = -2 * y1,\r\n          C = x1 ** 2 + x ** 2 - 2 * x1 * x + y1 ** 2 - R1 ** 2;\r\n        const delta = Math.sqrt(B ** 2 - 4 * A * C);\r\n        const resulty0 = (-B + delta) / (2 * A),\r\n          resulty1 = (-B - delta) / (2 * A);\r\n        result = [\r\n          new Coordinates({ x, y: resulty0 }),\r\n          new Coordinates({ x, y: resulty1 }),\r\n        ];\r\n      } else {\r\n        const N =\r\n          (R1 ** 2 - R0 ** 2 - x1 ** 2 + x0 ** 2 - y1 ** 2 + y0 ** 2) /\r\n          (2 * (y0 - y1));\r\n        const quotien = (x0 - x1) / (y0 - y1);\r\n        const A = quotien ** 2 + 1,\r\n          B = 2 * y0 * quotien - 2 * N * quotien - 2 * x0,\r\n          C = x0 ** 2 + y0 ** 2 + N ** 2 - R0 ** 2 - 2 * y0 * N;\r\n        const delta = Math.sqrt(B ** 2 - 4 * A * C);\r\n        const resultx0 = (-B + delta) / (2 * A),\r\n          resultx1 = (-B - delta) / (2 * A);\r\n        const resulty0 = N - resultx0 * quotien,\r\n          resulty1 = N - resultx1 * quotien;\r\n        result = [\r\n          new Coordinates({ x: resultx0, y: resulty0 }),\r\n          new Coordinates({ x: resultx1, y: resulty1 }),\r\n        ];\r\n      }\r\n    } else if (this.isArc() && !segment.isArc()) {\r\n      // a circle and a right line\r\n      const projection = segment.projectionOnSegment(\r\n        this.arcCenter.coordinates,\r\n      );\r\n      const dist1 = projection.dist(this.arcCenter.coordinates);\r\n      const hypothenusLength = this.radius;\r\n      if (dist1 > hypothenusLength) return null;\r\n      else if (Math.abs(dist1 - hypothenusLength) < precision) {\r\n        return [projection];\r\n      } else {\r\n        const dist2 = Math.sqrt(\r\n          Math.pow(hypothenusLength, 2) - Math.pow(dist1, 2),\r\n        );\r\n        const segmentAngle = segment.getAngleWithHorizontal();\r\n        const firstCoord = new Coordinates({\r\n          x: projection.x + Math.cos(segmentAngle) * dist2,\r\n          y: projection.y + Math.sin(segmentAngle) * dist2,\r\n        });\r\n        const secondCoord = new Coordinates({\r\n          x: projection.x + Math.cos(segmentAngle) * -dist2,\r\n          y: projection.y + Math.sin(segmentAngle) * -dist2,\r\n        });\r\n        result = [firstCoord, secondCoord];\r\n      }\r\n    } else if (!this.isArc() && segment.isArc()) {\r\n      return segment.arcIntersectionWith(this, precision);\r\n    }\r\n    result = result.filter(\r\n      (res) =>\r\n        this.isCoordinatesOnSegment(res) && segment.isCoordinatesOnSegment(res),\r\n    );\r\n    result.sort((r1, r2) => {\r\n      if (Math.abs(r1.y - r2.y) < 0.001) return r1.x - r2.x;\r\n      return r1.y - r2.y;\r\n    });\r\n    if (result.length == 0) return null;\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * check si deux segments s'intersectent\r\n   * @param {*} segment\r\n   * @param {Boolean} falseIfEdgePoint si le point d'intersection est la terminaison d'un segment, return false\r\n   */\r\n  doesIntersect(segment, falseIfEdgePoint = false) {\r\n    const intersections = this.intersectionWith(segment);\r\n    if (intersections == null) return false;\r\n    if (falseIfEdgePoint) {\r\n      for (let i = 0; i < intersections.length; i++) {\r\n        if (\r\n          [...this.vertexes, ...segment.vertexes].some((vertex) =>\r\n            vertex.coordinates.equal(intersections[i]),\r\n          )\r\n        ) {\r\n          intersections.splice(i, 1);\r\n          i--;\r\n        }\r\n      }\r\n    }\r\n    if (intersections.length == 0) return false;\r\n    if (\r\n      intersections.some(\r\n        (intersection) =>\r\n          this.isCoordinatesOnSegment(intersection) &&\r\n          segment.isCoordinatesOnSegment(intersection),\r\n      )\r\n    )\r\n      return true;\r\n    return false;\r\n  }\r\n\r\n  contains(object, matchSegmentPoints = true) {\r\n    if (object instanceof Segment) {\r\n      if (matchSegmentPoints) {\r\n        return object.vertexes.every(\r\n          (vx) =>\r\n            this.points.findIndex((point) =>\r\n              point.coordinates.equal(vx.coordinates),\r\n            ) != -1,\r\n        );\r\n      } else {\r\n        console.info('not implemented yet');\r\n      }\r\n    } else if (object instanceof Point)\r\n      return (\r\n        this.vertexes.some((vertex) => vertex.equal(object)) ||\r\n        (matchSegmentPoints && this.points.some((point) => point.equal(object)))\r\n      );\r\n    else if (object instanceof Coordinates) {\r\n      return (\r\n        this.vertexes.some((vertex) => vertex.coordinates.equal(object)) ||\r\n        (matchSegmentPoints &&\r\n          this.points.some((point) => point.coordinates.equal(object)))\r\n      );\r\n    } else console.info('unsupported object :', object);\r\n  }\r\n\r\n  equal(segment) {\r\n    if (this.isArc() ^ segment.isArc()) {\r\n      return false;\r\n    }\r\n    // one is arc and the other not\r\n    else if (\r\n      (this.vertexes[0].coordinates.equal(segment.vertexes[1].coordinates) &&\r\n        this.vertexes[1].coordinates.equal(segment.vertexes[0].coordinates)) ||\r\n      (this.vertexes[0].coordinates.equal(segment.vertexes[0].coordinates) &&\r\n        this.vertexes[1].coordinates.equal(segment.vertexes[1].coordinates))\r\n    ) {\r\n      if (this.isArc()) {\r\n        return (\r\n          this.arcCenter.coordinates.equal(segment.arcCenter.coordinates) &&\r\n          (this.counterclockwise != segment.counterclockwise) ^\r\n            this.vertexes[1].coordinates.equal(segment.vertexes[1].coordinates)\r\n        );\r\n      } else return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * If 2 segments have the same direction\r\n   * @param {*} segment\r\n   * @param {*} vertexNb1 - if arc, tangent to wich vertex of this\r\n   * @param {*} vertexNb2 - if arc, tangent to wich vertex of segment\r\n   * @param {*} matchArcAndOther - allow to compare arc with normal segment\r\n   */\r\n  hasSameDirection(segment, vertexNb1, vertexNb2, matchArcAndOther = true) {\r\n    let dir1, dir2;\r\n    if (!matchArcAndOther && this.isArc() ^ segment.isArc()) return false;\r\n    if (\r\n      this.isArc() &&\r\n      segment.isArc() &&\r\n      !this.arcCenter.coordinates.equal(segment.arcCenter.coordinates, 0.001)\r\n    ) {\r\n      return false;\r\n    }\r\n    if (\r\n      this.isArc() &&\r\n      segment.isArc() &&\r\n      this.arcCenter.coordinates.equal(segment.arcCenter.coordinates, 0.001) &&\r\n      this.radius == 0 &&\r\n      segment.radius == 0\r\n    ) {\r\n      return true;\r\n    }\r\n    if (this.isArc()) dir1 = this.getArcTangent(vertexNb1);\r\n    else dir1 = this.direction;\r\n    if (segment.isArc()) dir2 = segment.getArcTangent(vertexNb2);\r\n    else dir2 = segment.direction;\r\n    return (\r\n      Math.abs(dir1.x - dir2.x) < 0.001 && Math.abs(dir1.y - dir2.y) < 0.001\r\n    );\r\n  }\r\n\r\n  isArc() {\r\n    const isArc = this.arcCenter ? true : false;\r\n    return isArc;\r\n  }\r\n\r\n  saveData() {\r\n    const data = {\r\n      id: this.id,\r\n      shapeId: this.shapeId,\r\n      position: this.layer,\r\n      idx: this.idx,\r\n      vertexIds: [...this.vertexIds],\r\n      // divisionPointIds: [...this.divisionPointIds],\r\n      // arcCenterId: this.arcCenterId,\r\n      // counterclockwise: this.counterclockwise,\r\n      // isInfinite: this.isInfinite,\r\n      // isSemiInfinite: this.isSemiInfinite,\r\n      // color: this.color,\r\n      // width: this.width,\r\n    };\r\n\r\n    if (this.divisionPointIds.length !== 0)\r\n      data.divisionPointIds = [...this.divisionPointIds];\r\n    if (this.arcCenterId != undefined) data.arcCenterId = this.arcCenterId;\r\n    if (this.counterclockwise !== false)\r\n      data.counterclockwise = this.counterclockwise;\r\n    if (this.isInfinite !== false) data.isInfinite = this.isInfinite;\r\n    if (this.isSemiInfinite !== false)\r\n      data.isSemiInfinite = this.isSemiInfinite;\r\n    if (this.color != undefined) data.color = this.color;\r\n    if (this.width !== 1) data.width = this.width;\r\n    return data;\r\n  }\r\n\r\n  static loadFromData(data) {\r\n    if (!data.position) data.position = 'main';\r\n    const segment = new Segment({ layer: data.position });\r\n    Object.assign(segment, data);\r\n    segment.vertexIds = [...data.vertexIds];\r\n    if (data.divisionPointIds)\r\n      segment.divisionPointIds = [...data.divisionPointIds];\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Objects\\ShapeGroup.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":82,"column":60,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":82,"endColumn":62,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[2161,2163],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":83,"column":16,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":83,"endColumn":18,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2185,2187],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app, setState } from '../App';\r\nimport { uniqId } from '../Tools/general';\r\n\r\n/**\r\n * Groupe de figures li├®es. Un tel groupe est cr├®├® par l'utilisateur ├á l'aide de\r\n * l'outil de cr├®ation de groupes (Grouper/D├®grouper).\r\n */\r\nexport class ShapeGroup {\r\n  /**\r\n   * Constructeur\r\n   * @param {Shape} shapeId1   La premi├¿re figure du groupe\r\n   * @param {Shape} shapeId2   La seconde figure du groupe\r\n   */\r\n  constructor(shapeId1, shapeId2) {\r\n    if (shapeId1 === shapeId2) {\r\n      throw new Error(\r\n        'Une m├¬me figure ne peut pas ├¬tre ajout├®e 2 fois ├á un groupe',\r\n      );\r\n    }\r\n    //La liste des figures contenues dans le groupe\r\n    this.shapesIds = [shapeId1, shapeId2];\r\n\r\n    //Identifiant unique du groupe\r\n    this.id = uniqId();\r\n\r\n    this.color = [\r\n      '#77b5fe',\r\n      '#096a09',\r\n      '#f00020',\r\n      '#03224c',\r\n      '#34c924',\r\n      '#d473d4',\r\n      '#fd3f92',\r\n      '#ff8400',\r\n    ][app.nextGroupColorIdx];\r\n    setState({ nextGroupColorIdx: (app.nextGroupColorIdx + 1) % 8 });\r\n  }\r\n\r\n  saveToObject() {\r\n    const save = {\r\n      id: this.id,\r\n      shapesIds: [...this.shapesIds],\r\n    };\r\n    return save;\r\n  }\r\n\r\n  initFromObject(save) {\r\n    this.id = save.id;\r\n    this.shapesIds = [...save.shapesIds];\r\n  }\r\n\r\n  /**\r\n   * copy a shapeGroup\r\n   * @param {Boolean} full si copie id aussi\r\n   */\r\n  copy(full = false) {\r\n    const copy = new ShapeGroup(0, 1);\r\n    copy.shapesIds = [...this.shapesIds];\r\n    if (full) copy.id = this.id;\r\n    return copy;\r\n  }\r\n\r\n  /**\r\n   * Ajouter une figure au groupe\r\n   * @param {number} shapeId    La figure que l'on ajoute\r\n   */\r\n  addShape(shapeId) {\r\n    if (this.contains(shapeId)) {\r\n      console.error('This shape is already part of this user group.');\r\n      return;\r\n    }\r\n    this.shapesIds.push(shapeId);\r\n  }\r\n\r\n  /**\r\n   * Retirer une figure du groupe. Ne supprime pas le groupe s'il ne reste\r\n   * qu'une ou z├®ro figures (cela doit ├¬tre fait manuellement).\r\n   * @param {number} shapeId    La figure que l'on retire\r\n   */\r\n  deleteShape(shapeId) {\r\n    const length = this.shapesIds.length;\r\n    this.shapesIds = this.shapesIds.filter((id) => shapeId != id);\r\n    if (length == this.shapesIds.length)\r\n      console.error(\"Couldn't delete shape from user group.\");\r\n  }\r\n\r\n  /**\r\n   * V├®rifier si une figure fait partie du groupe\r\n   * @param  {number} shapeId la figure\r\n   * @return {Boolean}       true si elle fait partie du groupe, false sinon\r\n   */\r\n  contains(shapeId) {\r\n    return this.shapesIds.includes(shapeId);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Objects\\Shapes\\ArrowLineShape.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used. Allowed unused args must match /^_/u.","line":12,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":7,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[400,403],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'layer' is defined but never used. Allowed unused args must match /^_/u.","line":13,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":10,"suggestions":[{"messageId":"removeVar","data":{"varName":"layer"},"fix":{"range":[402,414],"text":""},"desc":"Remove unused variable 'layer'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'path' is assigned a value but never used. Allowed unused args must match /^_/u.","line":15,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":9,"suggestions":[{"messageId":"removeVar","data":{"varName":"path"},"fix":{"range":[414,439],"text":""},"desc":"Remove unused variable 'path'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'segmentIds' is assigned a value but never used. Allowed unused args must match /^_/u.","line":16,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"segmentIds"},"fix":{"range":[439,461],"text":""},"desc":"Remove unused variable 'segmentIds'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'pointIds' is assigned a value but never used. Allowed unused args must match /^_/u.","line":17,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"pointIds"},"fix":{"range":[461,481],"text":""},"desc":"Remove unused variable 'pointIds'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'divisionPointInfos' is assigned a value but never used. Allowed unused args must match /^_/u.","line":18,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":23,"suggestions":[{"messageId":"removeVar","data":{"varName":"divisionPointInfos"},"fix":{"range":[481,511],"text":""},"desc":"Remove unused variable 'divisionPointInfos'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'name' is assigned a value but never used. Allowed unused args must match /^_/u.","line":20,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":9,"suggestions":[{"messageId":"removeVar","data":{"varName":"name"},"fix":{"range":[511,535],"text":""},"desc":"Remove unused variable 'name'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'familyName' is assigned a value but never used. Allowed unused args must match /^_/u.","line":21,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"familyName"},"fix":{"range":[535,563],"text":""},"desc":"Remove unused variable 'familyName'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'strokeColor' is assigned a value but never used. Allowed unused args must match /^_/u.","line":23,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"strokeColor"},"fix":{"range":[563,592],"text":""},"desc":"Remove unused variable 'strokeColor'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'strokeWidth' is assigned a value but never used. Allowed unused args must match /^_/u.","line":24,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"strokeWidth"},"fix":{"range":[592,614],"text":""},"desc":"Remove unused variable 'strokeWidth'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'fillColor' is assigned a value but never used. Allowed unused args must match /^_/u.","line":25,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":14,"suggestions":[{"messageId":"removeVar","data":{"varName":"fillColor"},"fix":{"range":[614,639],"text":""},"desc":"Remove unused variable 'fillColor'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'fillOpacity' is assigned a value but never used. Allowed unused args must match /^_/u.","line":26,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"fillOpacity"},"fix":{"range":[639,661],"text":""},"desc":"Remove unused variable 'fillOpacity'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'isPointed' is assigned a value but never used. Allowed unused args must match /^_/u.","line":28,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":28,"endColumn":14,"suggestions":[{"messageId":"removeVar","data":{"varName":"isPointed"},"fix":{"range":[661,686],"text":""},"desc":"Remove unused variable 'isPointed'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'size' is assigned a value but never used. Allowed unused args must match /^_/u.","line":29,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":29,"endColumn":9,"suggestions":[{"messageId":"removeVar","data":{"varName":"size"},"fix":{"range":[686,701],"text":""},"desc":"Remove unused variable 'size'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'isReversed' is assigned a value but never used. Allowed unused args must match /^_/u.","line":31,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":31,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"isReversed"},"fix":{"range":[734,759],"text":""},"desc":"Remove unused variable 'isReversed'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'isBiface' is assigned a value but never used. Allowed unused args must match /^_/u.","line":32,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"isBiface"},"fix":{"range":[759,782],"text":""},"desc":"Remove unused variable 'isBiface'."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":42,"column":17,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":42,"endColumn":19,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1062,1064],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":67,"column":21,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":67,"endColumn":23,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1992,1994],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":108,"column":19,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":108,"endColumn":21,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3372,3374],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":149,"column":52,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":149,"endColumn":54,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[4717,4719],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":179,"column":19,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":179,"endColumn":21,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5667,5669],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":184,"column":62,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":184,"endColumn":64,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5907,5909],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":189,"column":22,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":189,"endColumn":24,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6179,6181],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":195,"column":24,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":195,"endColumn":26,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6479,6481],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":16,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app } from '../../App';\r\nimport { mod, removeObjectById } from '../../Tools/general';\r\nimport { Coordinates } from '../Coordinates';\r\nimport { GeometryObject } from './GeometryObject';\r\nimport { LineShape } from './LineShape';\r\n\r\n/**\r\n * Repr├®sente une figure lin├®aire (segment, demi-droite, droite, arc de cercle)\r\n */\r\nexport class ArrowLineShape extends LineShape {\r\n  constructor({\r\n    id,\r\n    layer,\r\n\r\n    path = undefined,\r\n    segmentIds = [],\r\n    pointIds = [],\r\n    divisionPointInfos = [],\r\n\r\n    name = 'Custom',\r\n    familyName = 'Custom',\r\n\r\n    strokeColor = '#000',\r\n    strokeWidth = 1,\r\n    fillColor = '#aaa',\r\n    fillOpacity = 0,\r\n\r\n    isPointed = true,\r\n    size = 2,\r\n    _isCenterShown = undefined,\r\n    isReversed = false,\r\n    isBiface = false,\r\n  }) {\r\n    super(arguments[0]);\r\n  }\r\n\r\n  setCtxForDrawing(ctx, scaling) {\r\n    ctx.strokeStyle = this.strokeColor;\r\n    ctx.fillStyle = this.fillColor;\r\n    ctx.globalAlpha = this.fillOpacity;\r\n    ctx.lineWidth = this.strokeWidth * app.workspace.zoomLevel;\r\n    if (scaling == 'no scale') ctx.lineWidth = this.strokeWidth;\r\n  }\r\n\r\n  /* #################################################################### */\r\n  /* ############################## OTHER ############################### */\r\n  /* #################################################################### */\r\n\r\n  /**\r\n   * convertit la shape en commande de path svg\r\n   */\r\n  getSVGPath(\r\n    scaling = 'scale',\r\n    infiniteCheck = true,\r\n    forDrawing = false,\r\n    forDrawingButInvisible = false,\r\n  ) {\r\n    let path = '';\r\n    path = this.segments\r\n      .map((seg) => seg.getSVGPath(scaling, false, infiniteCheck))\r\n      .join('\\n');\r\n    if (forDrawingButInvisible) {\r\n      if (this.vertexes[1] && this.segments[0].isArc()) {\r\n        let arcCenterCoordinates = this.segments[0].arcCenter.coordinates;\r\n        let firstVertex = this.vertexes[0].coordinates;\r\n        let secondVertex = this.vertexes[1].coordinates;\r\n        if (scaling == 'scale') {\r\n          arcCenterCoordinates = arcCenterCoordinates.toCanvasCoordinates();\r\n          firstVertex = firstVertex.toCanvasCoordinates();\r\n          secondVertex = secondVertex.toCanvasCoordinates();\r\n        }\r\n        path += [\r\n          'M',\r\n          arcCenterCoordinates.x,\r\n          arcCenterCoordinates.y,\r\n          'L',\r\n          firstVertex.x,\r\n          firstVertex.y,\r\n          'L',\r\n          secondVertex.x,\r\n          secondVertex.y,\r\n          'L',\r\n          arcCenterCoordinates.x,\r\n          arcCenterCoordinates.y,\r\n        ].join(' ');\r\n      }\r\n    }\r\n    if (forDrawing) {\r\n      const seg = this.segments[0];\r\n      let arrowEndCoordinates = seg.vertexes[1].coordinates;\r\n      let arrowAngle = seg.getAngleWithHorizontal() + Math.PI;\r\n      if (seg.isArc()) {\r\n        const originVector = this.segments[0].getArcTangent(1);\r\n        arrowAngle = Math.atan2(originVector.y, originVector.x) + Math.PI;\r\n      }\r\n      let firstTriangleCoord = arrowEndCoordinates.add(\r\n        new Coordinates({\r\n          x: 20 * Math.cos(arrowAngle + 0.35),\r\n          y: 20 * Math.sin(arrowAngle + 0.35),\r\n        }),\r\n      );\r\n      let secondTriangleCoord = arrowEndCoordinates.add(\r\n        new Coordinates({\r\n          x: 20 * Math.cos(arrowAngle - 0.35),\r\n          y: 20 * Math.sin(arrowAngle - 0.35),\r\n        }),\r\n      );\r\n      if (scaling == 'scale') {\r\n        arrowEndCoordinates = arrowEndCoordinates.toCanvasCoordinates();\r\n        firstTriangleCoord = firstTriangleCoord.toCanvasCoordinates();\r\n        secondTriangleCoord = secondTriangleCoord.toCanvasCoordinates();\r\n      }\r\n      path += ` M ${arrowEndCoordinates.x} ${arrowEndCoordinates.y} L ${firstTriangleCoord.x} ${firstTriangleCoord.y} M ${arrowEndCoordinates.x} ${arrowEndCoordinates.y} L ${secondTriangleCoord.x} ${secondTriangleCoord.y}`;\r\n    }\r\n    return path;\r\n  }\r\n\r\n  /**\r\n   * convertit la shape en balise path de svg\r\n   */\r\n  toSVG() {\r\n    if (\r\n      this.geometryObject &&\r\n      (this.geometryObject.geometryIsVisible === false ||\r\n        this.geometryObject.geometryIsHidden === true ||\r\n        this.geometryObject.geometryIsConstaintDraw === true)\r\n    ) {\r\n      return '';\r\n    }\r\n\r\n    const path = this.getSVGPath();\r\n\r\n    const attributes = {\r\n      d: path,\r\n      stroke: this.strokeColor,\r\n      fill: '#000',\r\n      'fill-opacity': 0,\r\n      'stroke-width': this.strokeWidth,\r\n      'stroke-opacity': 1, // toujours ├á 1 ?\r\n    };\r\n\r\n    let path_tag = '<path';\r\n    for (const [key, value] of Object.entries(attributes)) {\r\n      path_tag += ' ' + key + '=\"' + value + '\"';\r\n    }\r\n    path_tag += '/>\\n';\r\n\r\n    const pointToDraw = [];\r\n    if (app.settings.areShapesPointed && this.name != 'silhouette') {\r\n      if (this.isSegment()) pointToDraw.push(this.segments[0].vertexes[0]);\r\n      if (!this.isCircle())\r\n        this.segments.forEach((seg) => pointToDraw.push(seg.vertexes[1]));\r\n    }\r\n\r\n    this.segments.forEach((seg) => {\r\n      //Points sur les segments\r\n      seg.divisionPoints.forEach((pt) => {\r\n        pointToDraw.push(pt);\r\n      });\r\n    });\r\n    if (this.isCenterShown) pointToDraw.push(this.center);\r\n\r\n    const point_tags = pointToDraw\r\n      .filter((pt) => {\r\n        pt.visible && pt.geometryIsVisible && !pt.geometryIsHidden;\r\n      })\r\n      .map((pt) => pt.svg)\r\n      .join('\\n');\r\n\r\n    const comment =\r\n      '<!-- ' + this.name.replace('├®', 'e').replace('├¿', 'e') + ' -->\\n';\r\n\r\n    return comment + path_tag + point_tags + '\\n';\r\n  }\r\n\r\n  cleanSameDirectionSegment() {\r\n    for (let i = 0; i < this.segments.length; i++) {\r\n      const nextIdx = mod(i + 1, this.segmentIds.length);\r\n      if (nextIdx == i) break;\r\n      if (\r\n        this.segments[i].hasSameDirection(this.segments[nextIdx], 1, 0, false)\r\n      ) {\r\n        const middlePointId = this.segments[i].vertexIds[1];\r\n        const ptIdx = this.pointIds.findIndex((ptId) => ptId == middlePointId);\r\n        this.pointIds.splice(ptIdx, 1);\r\n        removeObjectById(middlePointId);\r\n        this.segments[i].vertexIds[1] = this.segments[nextIdx].vertexIds[1];\r\n        let idx = this.segments[i].vertexes[1].segmentIds.findIndex(\r\n          (id) => id == this.segmentIds[nextIdx],\r\n        );\r\n        this.segments[i].vertexes[1].segmentIds[idx] = this.segments[i].id;\r\n        if (this.segments[nextIdx].arcCenterId) {\r\n          removeObjectById(this.segments[nextIdx].arcCenterId);\r\n          idx = this.pointIds.findIndex(\r\n            (id) => id == this.segments[nextIdx].arcCenterId,\r\n          );\r\n          this.pointIds.splice(idx, 1);\r\n        }\r\n        removeObjectById(this.segmentIds[nextIdx]);\r\n        this.segmentIds.splice(nextIdx, 1);\r\n        i--; // try to merge this new segment again!\r\n      }\r\n    }\r\n    this.segments.forEach((seg, idx) => (seg.idx = idx));\r\n    this.vertexes.forEach((vx, idx) => (vx.idx = idx));\r\n  }\r\n\r\n  saveData() {\r\n    const data = super.saveData();\r\n    data.type = 'ArrowLineShape';\r\n    return data;\r\n  }\r\n\r\n  static loadFromData(data) {\r\n    if (!data.position) {\r\n      data.position = 'main';\r\n    }\r\n    const shape = new ArrowLineShape({\r\n      layer: data.position,\r\n    });\r\n    Object.assign(shape, data);\r\n    shape.segmentIds = [...data.segmentIds];\r\n    shape.pointIds = [...data.pointIds];\r\n    if (data.geometryObject)\r\n      shape.geometryObject = GeometryObject.loadFromData(data.geometryObject);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Objects\\Shapes\\CubeShape.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used. Allowed unused args must match /^_/u.","line":14,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":7,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[415,418],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'layer' is defined but never used. Allowed unused args must match /^_/u.","line":15,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":10,"suggestions":[{"messageId":"removeVar","data":{"varName":"layer"},"fix":{"range":[417,429],"text":""},"desc":"Remove unused variable 'layer'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'path' is assigned a value but never used. Allowed unused args must match /^_/u.","line":17,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":9,"suggestions":[{"messageId":"removeVar","data":{"varName":"path"},"fix":{"range":[429,454],"text":""},"desc":"Remove unused variable 'path'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'segmentIds' is assigned a value but never used. Allowed unused args must match /^_/u.","line":18,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"segmentIds"},"fix":{"range":[454,476],"text":""},"desc":"Remove unused variable 'segmentIds'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'pointIds' is assigned a value but never used. Allowed unused args must match /^_/u.","line":19,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"pointIds"},"fix":{"range":[476,496],"text":""},"desc":"Remove unused variable 'pointIds'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'divisionPointInfos' is assigned a value but never used. Allowed unused args must match /^_/u.","line":20,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":23,"suggestions":[{"messageId":"removeVar","data":{"varName":"divisionPointInfos"},"fix":{"range":[496,526],"text":""},"desc":"Remove unused variable 'divisionPointInfos'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'name' is assigned a value but never used. Allowed unused args must match /^_/u.","line":22,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":9,"suggestions":[{"messageId":"removeVar","data":{"varName":"name"},"fix":{"range":[526,550],"text":""},"desc":"Remove unused variable 'name'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'familyName' is assigned a value but never used. Allowed unused args must match /^_/u.","line":23,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"familyName"},"fix":{"range":[550,578],"text":""},"desc":"Remove unused variable 'familyName'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'strokeColor' is assigned a value but never used. Allowed unused args must match /^_/u.","line":25,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"strokeColor"},"fix":{"range":[578,607],"text":""},"desc":"Remove unused variable 'strokeColor'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'strokeWidth' is assigned a value but never used. Allowed unused args must match /^_/u.","line":26,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"strokeWidth"},"fix":{"range":[607,629],"text":""},"desc":"Remove unused variable 'strokeWidth'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'fillColor' is assigned a value but never used. Allowed unused args must match /^_/u.","line":27,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":14,"suggestions":[{"messageId":"removeVar","data":{"varName":"fillColor"},"fix":{"range":[629,657],"text":""},"desc":"Remove unused variable 'fillColor'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'fillOpacity' is assigned a value but never used. Allowed unused args must match /^_/u.","line":28,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":28,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"fillOpacity"},"fix":{"range":[657,679],"text":""},"desc":"Remove unused variable 'fillOpacity'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'isPointed' is assigned a value but never used. Allowed unused args must match /^_/u.","line":30,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":30,"endColumn":14,"suggestions":[{"messageId":"removeVar","data":{"varName":"isPointed"},"fix":{"range":[679,704],"text":""},"desc":"Remove unused variable 'isPointed'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'size' is assigned a value but never used. Allowed unused args must match /^_/u.","line":31,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":31,"endColumn":9,"suggestions":[{"messageId":"removeVar","data":{"varName":"size"},"fix":{"range":[704,719],"text":""},"desc":"Remove unused variable 'size'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'isReversed' is assigned a value but never used. Allowed unused args must match /^_/u.","line":33,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":33,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"isReversed"},"fix":{"range":[752,777],"text":""},"desc":"Remove unused variable 'isReversed'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'isBiface' is assigned a value but never used. Allowed unused args must match /^_/u.","line":34,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"isBiface"},"fix":{"range":[777,800],"text":""},"desc":"Remove unused variable 'isBiface'."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":62,"column":20,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":62,"endColumn":22,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1554,1556],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":63,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":63,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[1595,1597],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":65,"column":31,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":65,"endColumn":33,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1700,1702],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":84,"column":28,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":84,"endColumn":30,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[2174,2176],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'ry' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":137,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":137,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"ry"},"fix":{"range":[3684,3727],"text":""},"desc":"Remove unused variable 'ry'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'xAxisRotation' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":138,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":138,"endColumn":26,"suggestions":[{"messageId":"removeVar","data":{"varName":"xAxisRotation"},"fix":{"range":[3727,3781],"text":""},"desc":"Remove unused variable 'xAxisRotation'."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":150,"column":26,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":150,"endColumn":28,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4222,4224],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":150,"column":58,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":150,"endColumn":60,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[4254,4256],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":175,"column":41,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":175,"endColumn":43,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5025,5027],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":194,"column":28,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":194,"endColumn":30,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5399,5401],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":196,"column":42,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":196,"endColumn":44,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[5486,5488],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":196,"column":65,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":196,"endColumn":67,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[5509,5511],"text":"!=="},"desc":"Use '!==' instead of '!='."}]}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":18,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app } from '../../App';\r\nimport { removeObjectById } from '../../Tools/general';\r\nimport { Coordinates } from '../Coordinates';\r\nimport { Point } from '../Point';\r\nimport { Segment } from '../Segment';\r\nimport { GeometryObject } from './GeometryObject';\r\nimport { RegularShape } from './RegularShape';\r\n\r\n/**\r\n * Repr├®sente un cube\r\n */\r\nexport class CubeShape extends RegularShape {\r\n  constructor({\r\n    id,\r\n    layer,\r\n\r\n    path = undefined,\r\n    segmentIds = [],\r\n    pointIds = [],\r\n    divisionPointInfos = [],\r\n\r\n    name = 'Custom',\r\n    familyName = 'Custom',\r\n\r\n    strokeColor = '#000',\r\n    strokeWidth = 1,\r\n    fillColor = '#f46c2e',\r\n    fillOpacity = 1,\r\n\r\n    isPointed = true,\r\n    size = 2,\r\n    _isCenterShown = undefined,\r\n    isReversed = false,\r\n    isBiface = false,\r\n  }) {\r\n    super(arguments[0]);\r\n\r\n    // this.fillColor = fillColor;\r\n    // this.fillOpacity = fillOpacity;\r\n  }\r\n\r\n  setSegmentsFromPath(path) {\r\n    const allPathElements = path\r\n      .split(/[ \\n]/)\r\n      .filter((element) => element !== '');\r\n    let firstVertex, lastVertex, startVertex;\r\n\r\n    let segmentIdx = 0;\r\n    let vertexIdx = 0;\r\n\r\n    this.pointIds = [];\r\n    this.segmentIds = [];\r\n\r\n    let nextVertexCoordinates = null;\r\n\r\n    const createLineTo = (x, y) => {\r\n      const coordinates = new Coordinates({ x, y });\r\n      firstVertex = lastVertex;\r\n      lastVertex = this.points.find((pt) => pt.coordinates.equal(coordinates));\r\n      const lastPointDrawn = this.points[this.points.length - 1];\r\n      if (\r\n        lastVertex == undefined ||\r\n        lastVertex.type != 'vertex' ||\r\n        (lastPointDrawn.coordinates.equal(coordinates) &&\r\n          lastPointDrawn.type == 'vertex')\r\n      ) {\r\n        lastVertex = new Point({\r\n          coordinates: coordinates,\r\n          shapeId: this.id,\r\n          layer: this.layer,\r\n          type: 'vertex',\r\n          idx: vertexIdx++,\r\n          visible: this.isPointed,\r\n        });\r\n      }\r\n      new Segment({\r\n        shapeId: this.id,\r\n        layer: this.layer,\r\n        idx: segmentIdx++,\r\n        vertexIds: [firstVertex.id, lastVertex.id],\r\n      });\r\n    };\r\n\r\n    if (allPathElements[0] != 'M')\r\n      startVertex = lastVertex = new Point({\r\n        shapeId: this.id,\r\n        layer: this.layer,\r\n        type: 'vertex',\r\n        idx: vertexIdx++,\r\n        visible: this.isPointed,\r\n      });\r\n\r\n    while (allPathElements.length) {\r\n      const element = allPathElements.shift();\r\n\r\n      switch (element) {\r\n        case 'M':\r\n        case 'm':\r\n          nextVertexCoordinates = new Coordinates({\r\n            x: allPathElements.shift(),\r\n            y: allPathElements.shift(),\r\n          });\r\n          if (this.contains(nextVertexCoordinates)) {\r\n            startVertex = lastVertex = this.points.find((pt) =>\r\n              pt.coordinates.equal(nextVertexCoordinates),\r\n            );\r\n          } else {\r\n            startVertex = lastVertex = new Point({\r\n              coordinates: nextVertexCoordinates,\r\n              shapeId: this.id,\r\n              layer: this.layer,\r\n              type: 'vertex',\r\n              idx: vertexIdx++,\r\n              visible: this.isPointed,\r\n            });\r\n          }\r\n          break;\r\n\r\n        case 'L':\r\n        case 'l':\r\n          createLineTo(allPathElements.shift(), allPathElements.shift());\r\n          break;\r\n\r\n        case 'H':\r\n        case 'h':\r\n          createLineTo(allPathElements.shift(), lastVertex.y);\r\n          break;\r\n\r\n        case 'V':\r\n        case 'v':\r\n          createLineTo(lastVertex.x, allPathElements.shift());\r\n          break;\r\n\r\n        case 'A':\r\n        case 'a':\r\n          const rx = allPathElements.shift(),\r\n            ry = allPathElements.shift(),\r\n            xAxisRotation = allPathElements.shift(),\r\n            largeArcFlag = allPathElements.shift(),\r\n            sweepFlag = allPathElements.shift();\r\n\r\n          firstVertex = lastVertex;\r\n          nextVertexCoordinates = new Coordinates({\r\n            x: allPathElements.shift(),\r\n            y: allPathElements.shift(),\r\n          });\r\n          lastVertex = this.points.find((pt) =>\r\n            pt.coordinates.equal(nextVertexCoordinates),\r\n          );\r\n          if (lastVertex == undefined || lastVertex.type != 'vertex') {\r\n            lastVertex = new Point({\r\n              coordinates: nextVertexCoordinates,\r\n              shapeId: this.id,\r\n              layer: this.layer,\r\n              type: 'vertex',\r\n              idx: vertexIdx++,\r\n              visible: this.isPointed,\r\n            });\r\n          }\r\n\r\n          const arcCenter = this.getArcCenterFromSVG(\r\n            firstVertex,\r\n            lastVertex,\r\n            rx,\r\n            largeArcFlag,\r\n            sweepFlag,\r\n          );\r\n\r\n          const segment = new Segment({\r\n            shapeId: this.id,\r\n            layer: this.layer,\r\n            idx: segmentIdx++,\r\n            vertexIds: [firstVertex.id, lastVertex.id],\r\n            arcCenterId: arcCenter.id,\r\n            counterclockwise: sweepFlag == 0,\r\n          });\r\n          arcCenter.segmentIds.push(segment.id);\r\n\r\n          this.cleanSameDirectionSegment();\r\n\r\n          break;\r\n\r\n        case 'Z':\r\n        case 'z':\r\n          createLineTo(startVertex.x, startVertex.y);\r\n          break;\r\n\r\n        default:\r\n          break;\r\n      }\r\n    }\r\n    // if segment length == 0\r\n    if (\r\n      app.environment.name == 'Geometrie' &&\r\n      !this.isCircle() &&\r\n      this.points.filter((pt) => pt.type != 'arcCenter').length !=\r\n        this.segmentIds.length\r\n    ) {\r\n      const coord = this.points[0].coordinates;\r\n      const numberOfSegment = this.segmentIds.length;\r\n      this.pointIds.forEach((ptId) => removeObjectById(ptId));\r\n      this.segmentIds.forEach((segId) => removeObjectById(segId));\r\n      this.pointIds = [];\r\n      this.segmentIds = [];\r\n      for (let idx = 0; idx < numberOfSegment; idx++) {\r\n        new Point({\r\n          coordinates: coord,\r\n          shapeId: this.id,\r\n          layer: this.layer,\r\n          type: 'vertex',\r\n          idx,\r\n          visible: this.isPointed,\r\n        });\r\n      }\r\n      for (let idx = 0; idx < numberOfSegment; idx++) {\r\n        new Segment({\r\n          shapeId: this.id,\r\n          layer: this.layer,\r\n          idx,\r\n          vertexIds: [\r\n            this.pointIds[idx],\r\n            this.pointIds[(idx + 1) % numberOfSegment],\r\n          ],\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  saveData() {\r\n    const data = super.saveData();\r\n    data.type = 'CubeShape';\r\n    // data.fillColor = this.fillColor;\r\n    // data.fillOpacity = this.fillOpacity;\r\n    if (this.fillColor !== '#f46c2e') data.fillColor = this.fillColor;\r\n    if (this.fillOpacity !== 1) data.fillOpacity = this.fillOpacity;\r\n    return data;\r\n  }\r\n\r\n  static loadFromData(data) {\r\n    if (!data.position) {\r\n      data.position = 'main';\r\n    }\r\n    const shape = new CubeShape({\r\n      layer: data.position,\r\n    });\r\n    Object.assign(shape, data);\r\n    shape.segmentIds = [...data.segmentIds];\r\n    shape.pointIds = [...data.pointIds];\r\n    if (data.geometryObject)\r\n      shape.geometryObject = GeometryObject.loadFromData(data.geometryObject);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Objects\\Shapes\\GeometryObject.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Objects\\Shapes\\LineShape.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used. Allowed unused args must match /^_/u.","line":15,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":7,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[494,497],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'layer' is defined but never used. Allowed unused args must match /^_/u.","line":16,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":10,"suggestions":[{"messageId":"removeVar","data":{"varName":"layer"},"fix":{"range":[496,508],"text":""},"desc":"Remove unused variable 'layer'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'path' is assigned a value but never used. Allowed unused args must match /^_/u.","line":18,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":9,"suggestions":[{"messageId":"removeVar","data":{"varName":"path"},"fix":{"range":[508,533],"text":""},"desc":"Remove unused variable 'path'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'segmentIds' is assigned a value but never used. Allowed unused args must match /^_/u.","line":19,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"segmentIds"},"fix":{"range":[533,555],"text":""},"desc":"Remove unused variable 'segmentIds'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'pointIds' is assigned a value but never used. Allowed unused args must match /^_/u.","line":20,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"pointIds"},"fix":{"range":[555,575],"text":""},"desc":"Remove unused variable 'pointIds'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'divisionPointInfos' is assigned a value but never used. Allowed unused args must match /^_/u.","line":21,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":23,"suggestions":[{"messageId":"removeVar","data":{"varName":"divisionPointInfos"},"fix":{"range":[575,605],"text":""},"desc":"Remove unused variable 'divisionPointInfos'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'name' is assigned a value but never used. Allowed unused args must match /^_/u.","line":23,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":9,"suggestions":[{"messageId":"removeVar","data":{"varName":"name"},"fix":{"range":[605,629],"text":""},"desc":"Remove unused variable 'name'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'familyName' is assigned a value but never used. Allowed unused args must match /^_/u.","line":24,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"familyName"},"fix":{"range":[629,657],"text":""},"desc":"Remove unused variable 'familyName'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'strokeColor' is assigned a value but never used. Allowed unused args must match /^_/u.","line":26,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"strokeColor"},"fix":{"range":[657,686],"text":""},"desc":"Remove unused variable 'strokeColor'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'strokeWidth' is assigned a value but never used. Allowed unused args must match /^_/u.","line":27,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"strokeWidth"},"fix":{"range":[686,708],"text":""},"desc":"Remove unused variable 'strokeWidth'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'isPointed' is assigned a value but never used. Allowed unused args must match /^_/u.","line":31,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":31,"endColumn":14,"suggestions":[{"messageId":"removeVar","data":{"varName":"isPointed"},"fix":{"range":[755,780],"text":""},"desc":"Remove unused variable 'isPointed'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'size' is assigned a value but never used. Allowed unused args must match /^_/u.","line":32,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":9,"suggestions":[{"messageId":"removeVar","data":{"varName":"size"},"fix":{"range":[780,795],"text":""},"desc":"Remove unused variable 'size'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'isReversed' is assigned a value but never used. Allowed unused args must match /^_/u.","line":34,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"isReversed"},"fix":{"range":[828,853],"text":""},"desc":"Remove unused variable 'isReversed'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'isBiface' is assigned a value but never used. Allowed unused args must match /^_/u.","line":35,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":35,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"isBiface"},"fix":{"range":[853,876],"text":""},"desc":"Remove unused variable 'isBiface'."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":43,"column":38,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":43,"endColumn":40,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[1063,1065],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":129,"column":54,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":129,"endColumn":56,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3702,3704],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":130,"column":32,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":130,"endColumn":34,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3753,3755],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":130,"column":62,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":130,"endColumn":64,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3783,3785],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":134,"column":55,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":134,"endColumn":57,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3999,4001],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":139,"column":36,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":139,"endColumn":38,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4155,4157],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":145,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":145,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[4418,4420],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":161,"column":59,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":161,"endColumn":61,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4969,4971],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":186,"column":20,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":186,"endColumn":22,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5635,5637],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":187,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":187,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[5676,5678],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":207,"column":28,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":207,"endColumn":30,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[6228,6230],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'ry' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":261,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":261,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"ry"},"fix":{"range":[7789,7832],"text":""},"desc":"Remove unused variable 'ry'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'xAxisRotation' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":262,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":262,"endColumn":26,"suggestions":[{"messageId":"removeVar","data":{"varName":"xAxisRotation"},"fix":{"range":[7832,7886],"text":""},"desc":"Remove unused variable 'xAxisRotation'."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":274,"column":26,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":274,"endColumn":28,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8327,8329],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":274,"column":58,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":274,"endColumn":60,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[8359,8361],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":299,"column":41,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":299,"endColumn":43,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[9114,9116],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"prefer-const","severity":1,"message":"'middle' is never reassigned. Use 'const' instead.","line":368,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":368,"endColumn":15},{"ruleId":"prefer-const","severity":1,"message":"'isHorizontal' is never reassigned. Use 'const' instead.","line":371,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":371,"endColumn":19},{"ruleId":"prefer-const","severity":1,"message":"'isVertical' is never reassigned. Use 'const' instead.","line":372,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":372,"endColumn":17},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":414,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":414,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[12286,12288],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":424,"column":17,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":424,"endColumn":19,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[12597,12599],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":436,"column":22,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":436,"endColumn":24,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[12969,12971],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":441,"column":17,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":441,"endColumn":19,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[13039,13041],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'forDrawing' is assigned a value but never used. Allowed unused args must match /^_/u.","line":640,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":640,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"forDrawing"},"fix":{"range":[19308,19333],"text":""},"desc":"Remove unused variable 'forDrawing'."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":652,"column":21,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":652,"endColumn":23,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[19819,19821],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":707,"column":52,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":707,"endColumn":54,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[21281,21283],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":737,"column":19,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":737,"endColumn":21,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[22231,22233],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":741,"column":23,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":741,"endColumn":25,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[22370,22372],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":774,"column":28,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":774,"endColumn":30,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[23589,23591],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":781,"column":26,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":781,"endColumn":28,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[23937,23939],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":787,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":787,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[24231,24233],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":796,"column":26,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":796,"endColumn":28,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[24619,24621],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":26,"fatalErrorCount":0,"warningCount":20,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app } from '../../App';\r\nimport { mod, removeObjectById } from '../../Tools/general';\r\nimport { Bounds } from '../Bounds';\r\nimport { Coordinates } from '../Coordinates';\r\nimport { Point } from '../Point';\r\nimport { Segment } from '../Segment';\r\nimport { GeometryObject } from './GeometryObject';\r\nimport { Shape } from './Shape';\r\n\r\n/**\r\n * Repr├®sente une figure lin├®aire (segment, demi-droite, droite, arc de cercle)\r\n */\r\nexport class LineShape extends Shape {\r\n  constructor({\r\n    id,\r\n    layer,\r\n\r\n    path = undefined,\r\n    segmentIds = [],\r\n    pointIds = [],\r\n    divisionPointInfos = [],\r\n\r\n    name = 'Custom',\r\n    familyName = 'Custom',\r\n\r\n    strokeColor = '#000',\r\n    strokeWidth = 1,\r\n    fillColor = '#aaa',\r\n    fillOpacity = 0,\r\n\r\n    isPointed = true,\r\n    size = 2,\r\n    _isCenterShown = undefined,\r\n    isReversed = false,\r\n    isBiface = false,\r\n  }) {\r\n    super(arguments[0]);\r\n\r\n    this.fillColor = fillColor;\r\n    this.fillOpacity = fillOpacity;\r\n\r\n    const centerId = this.center?.id;\r\n    if (centerId && this.pointIds[2] != centerId) {\r\n      this.pointIds = [\r\n        this.pointIds[0],\r\n        this.pointIds[1],\r\n        centerId,\r\n        ...this.pointIds.slice(2, -1),\r\n      ];\r\n    }\r\n\r\n    if (this.name.endsWith('SemiStraightLine')) {\r\n      this.segments[0].isSemiInfinite = true;\r\n    } else if (this.name.endsWith('StraightLine')) {\r\n      this.segments[0].isInfinite = true;\r\n    }\r\n  }\r\n\r\n  /* #################################################################### */\r\n  /* ############################## GET/SET ############################# */\r\n  /* #################################################################### */\r\n\r\n  get segments() {\r\n    const segments = this.segmentIds.map((segId) =>\r\n      this.canvasLayer.segments.find((seg) => seg.id === segId),\r\n    );\r\n    return segments;\r\n  }\r\n\r\n  get points() {\r\n    // if (this.isCircle() && app.environment.name !== 'Geometrie') => doit-on inclure le point du cercle dans Grandeurs et Cubes ?\r\n    const points = this.pointIds.map((ptId) =>\r\n      this.canvasLayer.points.find((pt) => pt.id === ptId),\r\n    );\r\n    return points;\r\n  }\r\n\r\n  get vertexes() {\r\n    const vertexes = this.points.filter((pt) => pt.type === 'vertex');\r\n    return vertexes;\r\n  }\r\n\r\n  get divisionPoints() {\r\n    const divisionPoints = this.points.filter(\r\n      (pt) => pt.type === 'divisionPoint',\r\n    );\r\n    return divisionPoints;\r\n  }\r\n\r\n  get center() {\r\n    const center = this.points.filter((pt) => pt.type === 'shapeCenter')[0];\r\n    return center;\r\n  }\r\n\r\n  get centerCoordinates() {\r\n    if (this.segments[0].isArc()) {\r\n      const center = this.segments[0].arcCenter;\r\n      return new Coordinates(center.coordinates);\r\n    } else if (this.name.endsWith('StraightLine')) {\r\n      return this.vertexes[0].coordinates;\r\n    } else {\r\n      let totalCoordinates = Coordinates.nullCoordinates;\r\n      this.vertexes.forEach((vertex) => {\r\n        totalCoordinates = totalCoordinates.add(vertex.coordinates);\r\n      });\r\n      const averageCoordinates = totalCoordinates.multiply(\r\n        1 / this.vertexes.length,\r\n      );\r\n      return averageCoordinates;\r\n    }\r\n  }\r\n\r\n  get isCenterShown() {\r\n    const isCenterShown = this._isCenterShown;\r\n    return isCenterShown;\r\n  }\r\n\r\n  set isCenterShown(value) {\r\n    if (value && !this.isCenterShown) {\r\n      const centerCoordinates = this.centerCoordinates;\r\n      new Point({\r\n        coordinates: centerCoordinates,\r\n        shapeId: this.id,\r\n        layer: this.layer,\r\n        type: 'shapeCenter',\r\n        // visible: this.isPointed,\r\n      });\r\n    } else if (!value && this.isCenterShown) {\r\n      const point = this.points.find((pt) => pt.type == 'shapeCenter');\r\n      if (app.environment.name == 'Geometrie' && point.layer == 'main') {\r\n        const shapesToDelete = [];\r\n        this.geometryObject.geometryChildShapeIds.forEach((sId) => {\r\n          const s = findObjectById(sId);\r\n          if (s && s.points.some((pt) => pt.reference == point.id)) {\r\n            shapesToDelete.push(s);\r\n          }\r\n        });\r\n        shapesToDelete.forEach((s) => {\r\n          if (app.environment.name == 'Geometrie') deleteChildren(s);\r\n          removeObjectById(s.id);\r\n        });\r\n        for (let i = 0; i < app.mainCanvasLayer.shapes.length; i++) {\r\n          const s = app.mainCanvasLayer.shapes[i];\r\n          s.points\r\n            .filter((pt) => pt.type != 'divisionPoint')\r\n            .forEach((pt) => {\r\n              if (pt.reference && !findObjectById(pt.reference))\r\n                pt.reference = null;\r\n            });\r\n          if (\r\n            s.geometryObject.geometryPointOnTheFlyChildId &&\r\n            !findObjectById(s.geometryObject.geometryPointOnTheFlyChildId)\r\n          ) {\r\n            deleteChildren(s);\r\n            i--;\r\n          }\r\n        }\r\n      }\r\n      const pointId = point.id;\r\n      removeObjectById(pointId);\r\n      const index = this.pointIds.findIndex((pt) => pt.id == pointId);\r\n      this.pointIds.splice(index, 1);\r\n    }\r\n    this._isCenterShown = value;\r\n  }\r\n\r\n  setSegmentsFromPath(path) {\r\n    const allPathElements = path\r\n      .split(/[ \\n]/)\r\n      .filter((element) => element !== '');\r\n    let firstVertex, lastVertex, startVertex;\r\n\r\n    let segmentIdx = 0;\r\n    let vertexIdx = 0;\r\n\r\n    this.pointIds = [];\r\n    this.segmentIds = [];\r\n\r\n    let nextVertexCoordinates = null;\r\n\r\n    const createLineTo = (x, y) => {\r\n      const coordinates = new Coordinates({ x, y });\r\n      firstVertex = lastVertex;\r\n      lastVertex = this.points.find((pt) => pt.coordinates.equal(coordinates));\r\n      if (\r\n        lastVertex == undefined ||\r\n        lastVertex.type != 'vertex' ||\r\n        this.points[this.points.length - 1].coordinates.equal(coordinates)\r\n      ) {\r\n        lastVertex = new Point({\r\n          coordinates: coordinates,\r\n          shapeId: this.id,\r\n          layer: this.layer,\r\n          type: 'vertex',\r\n          idx: vertexIdx++,\r\n          visible: this.isPointed,\r\n        });\r\n      }\r\n      new Segment({\r\n        shapeId: this.id,\r\n        layer: this.layer,\r\n        idx: segmentIdx++,\r\n        vertexIds: [firstVertex.id, lastVertex.id],\r\n      });\r\n    };\r\n\r\n    if (allPathElements[0] != 'M')\r\n      startVertex = lastVertex = new Point({\r\n        coordinates: Coordinates.nullCoordinates,\r\n        shapeId: this.id,\r\n        layer: this.layer,\r\n        type: 'vertex',\r\n        idx: vertexIdx++,\r\n        visible: this.isPointed,\r\n      });\r\n\r\n    while (allPathElements.length) {\r\n      const element = allPathElements.shift();\r\n\r\n      switch (element) {\r\n        case 'M':\r\n        case 'm':\r\n          nextVertexCoordinates = new Coordinates({\r\n            x: allPathElements.shift(),\r\n            y: allPathElements.shift(),\r\n          });\r\n          if (this.contains(nextVertexCoordinates)) {\r\n            startVertex = lastVertex = this.points.find((pt) =>\r\n              pt.coordinates.equal(nextVertexCoordinates),\r\n            );\r\n          } else {\r\n            startVertex = lastVertex = new Point({\r\n              coordinates: nextVertexCoordinates,\r\n              shapeId: this.id,\r\n              layer: this.layer,\r\n              type: 'vertex',\r\n              idx: vertexIdx++,\r\n              visible: this.isPointed,\r\n            });\r\n          }\r\n          break;\r\n\r\n        case 'L':\r\n        case 'l':\r\n          createLineTo(allPathElements.shift(), allPathElements.shift());\r\n          break;\r\n\r\n        case 'H':\r\n        case 'h':\r\n          createLineTo(allPathElements.shift(), lastVertex.y);\r\n          break;\r\n\r\n        case 'V':\r\n        case 'v':\r\n          createLineTo(lastVertex.x, allPathElements.shift());\r\n          break;\r\n\r\n        case 'A':\r\n        case 'a':\r\n          const rx = allPathElements.shift(),\r\n            ry = allPathElements.shift(),\r\n            xAxisRotation = allPathElements.shift(),\r\n            largeArcFlag = allPathElements.shift(),\r\n            sweepFlag = allPathElements.shift();\r\n\r\n          firstVertex = lastVertex;\r\n          nextVertexCoordinates = new Coordinates({\r\n            x: allPathElements.shift(),\r\n            y: allPathElements.shift(),\r\n          });\r\n          lastVertex = this.points.find((pt) =>\r\n            pt.coordinates.equal(nextVertexCoordinates),\r\n          );\r\n          if (lastVertex == undefined || lastVertex.type != 'vertex') {\r\n            lastVertex = new Point({\r\n              coordinates: nextVertexCoordinates,\r\n              shapeId: this.id,\r\n              layer: this.layer,\r\n              type: 'vertex',\r\n              idx: vertexIdx++,\r\n              visible: this.isPointed,\r\n            });\r\n          }\r\n\r\n          const arcCenter = this.getArcCenterFromSVG(\r\n            firstVertex,\r\n            lastVertex,\r\n            rx,\r\n            largeArcFlag,\r\n            sweepFlag,\r\n          );\r\n\r\n          new Segment({\r\n            shapeId: this.id,\r\n            layer: this.layer,\r\n            idx: segmentIdx++,\r\n            vertexIds: [firstVertex.id, lastVertex.id],\r\n            arcCenterId: arcCenter.id,\r\n            counterclockwise: sweepFlag == 0,\r\n          });\r\n\r\n          this.cleanSameDirectionSegment();\r\n\r\n          break;\r\n\r\n        case 'Z':\r\n        case 'z':\r\n          createLineTo(startVertex.x, startVertex.y);\r\n          break;\r\n\r\n        default:\r\n          break;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * moyenne des vertexes et medianes, pour l'offset de cut\r\n   */\r\n  get fake_center() {\r\n    if (this.isCircle()) {\r\n      const center = this.segments[0].arcCenter;\r\n      return new Coordinates(center);\r\n    } else {\r\n      const total = {\r\n        x: 0,\r\n        y: 0,\r\n        amount: 0,\r\n      };\r\n      this.vertexes.forEach((vertex) => {\r\n        total.x += vertex.x;\r\n        total.y += vertex.y;\r\n        total.amount++;\r\n      });\r\n      this.segments.forEach((seg) => {\r\n        total.x += seg.middle.x;\r\n        total.y += seg.middle.y;\r\n        total.amount++;\r\n      });\r\n\r\n      return new Coordinates(total).multiply(1 / total.amount);\r\n    }\r\n  }\r\n\r\n  get bounds() {\r\n    const segmentBounds = this.segments.map((seg) => seg.bounds);\r\n    return Bounds.getOuterBounds(...segmentBounds);\r\n  }\r\n\r\n  getCommonsCoordinates(shape) {\r\n    const commonsCoordinates = [];\r\n    this.points.forEach((point1) => {\r\n      shape.points.forEach((point2) => {\r\n        if (point1.coordinates.equal(point2.coordinates))\r\n          commonsCoordinates.push(point1.coordinates);\r\n      });\r\n    });\r\n    return commonsCoordinates;\r\n  }\r\n\r\n  getArcCenterFromSVG(\r\n    firstVertex,\r\n    lastVertex,\r\n    radius,\r\n    largeArcFlag,\r\n    sweepFlag,\r\n  ) {\r\n    let middle = firstVertex.coordinates\r\n        .add(lastVertex.coordinates)\r\n        .multiply(1 / 2),\r\n      isHorizontal = Math.abs(firstVertex.y - lastVertex.y) < 0.01,\r\n      isVertical = Math.abs(firstVertex.x - lastVertex.x) < 0.01,\r\n      distanceMiddleArcCenter = Math.sqrt(\r\n        Math.pow(radius, 2) -\r\n          (Math.pow(firstVertex.x - lastVertex.x, 2) +\r\n            Math.pow(firstVertex.y - lastVertex.y, 2)) /\r\n            4,\r\n      );\r\n\r\n    if (isNaN(distanceMiddleArcCenter)) distanceMiddleArcCenter = 0;\r\n\r\n    let theta, arcCenterCoordinates;\r\n    // theta is the angle between the segment firstvertex - lastvertex and the x-axis\r\n\r\n    if (isHorizontal) {\r\n      theta = firstVertex.x < lastVertex.x ? 0 : Math.PI;\r\n    } else if (isVertical) {\r\n      theta = firstVertex.y < lastVertex.y ? Math.PI / 2 : (Math.PI * 3) / 2;\r\n    } else {\r\n      theta = Math.atan2(\r\n        lastVertex.y - firstVertex.y,\r\n        lastVertex.x - firstVertex.x,\r\n      );\r\n    }\r\n\r\n    if (largeArcFlag !== sweepFlag) {\r\n      arcCenterCoordinates = middle.add({\r\n        x: distanceMiddleArcCenter * Math.cos(theta + Math.PI / 2),\r\n        y: distanceMiddleArcCenter * Math.sin(theta + Math.PI / 2),\r\n      });\r\n    } else {\r\n      arcCenterCoordinates = middle.add({\r\n        x: distanceMiddleArcCenter * Math.cos(theta - Math.PI / 2),\r\n        y: distanceMiddleArcCenter * Math.sin(theta - Math.PI / 2),\r\n      });\r\n    }\r\n    const arcCenter = new Point({\r\n      layer: this.layer,\r\n      coordinates: arcCenterCoordinates,\r\n      shapeId: this.id,\r\n      type: 'arcCenter',\r\n      visible: false,\r\n    });\r\n    if (app.environment.name == 'Geometrie') arcCenter.visible = true;\r\n\r\n    return arcCenter;\r\n  }\r\n\r\n  setCtxForDrawing(ctx, scaling) {\r\n    ctx.strokeStyle = this.strokeColor;\r\n    ctx.fillStyle = this.fillColor;\r\n    ctx.globalAlpha = this.fillOpacity;\r\n    ctx.lineWidth = this.strokeWidth * app.workspace.zoomLevel;\r\n    if (scaling == 'no scale') ctx.lineWidth = this.strokeWidth;\r\n  }\r\n\r\n  /* #################################################################### */\r\n  /* ################################ IS ################################ */\r\n  /* #################################################################### */\r\n\r\n  isSegment() {\r\n    return true;\r\n  }\r\n\r\n  isCircle() {\r\n    return this.name == 'Circle';\r\n  }\r\n\r\n  isCircleArc() {\r\n    return (\r\n      this.name == 'CircleArc'\r\n      // this.segments[0].arcCenter &&\r\n    );\r\n  }\r\n\r\n  isStraightLine() {\r\n    return this.segments[0].isInfinite;\r\n  }\r\n\r\n  isSemiStraightLine() {\r\n    return this.segments[0].isSemiInfinite;\r\n  }\r\n\r\n  contains(object) {\r\n    if (object instanceof Point) {\r\n      if (\r\n        this.allOutlinePoints.some((outline_point) =>\r\n          outline_point.equal(object),\r\n        )\r\n      )\r\n        return true;\r\n      if (this.isCenterShown && this.center.equal(object)) return true;\r\n      return false;\r\n    } else if (object instanceof Segment) {\r\n      if (this.segments.some((segment) => segment.equal(object))) return true;\r\n      return false;\r\n    } else if (object instanceof Coordinates) {\r\n      if (this.points.some((pt) => pt.coordinates.equal(object))) return true;\r\n      // if (this.isCenterShown && this.center.equal(object)) return true;\r\n      return false;\r\n    } else {\r\n      console.info('unsupported object');\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * V├®rifie si un point se trouve sur un bord de la figure.\r\n   * @param  {Coordinates}  coordinates\r\n   */\r\n  isCoordinatesOnBorder(coordinates) {\r\n    return this.segments.some((seg) => seg.isCoordinatesOnSegment(coordinates));\r\n  }\r\n\r\n  /**\r\n   * V├®rifie si une coordonn├®e est ├á l'int├®rieur de la figure ou non\r\n   * @param  {Coordinates}  coord  les coordonn├®es\r\n   */\r\n  isCoordinatesInPath(coord) {\r\n    const ctx = app.invisibleCanvasLayer.ctx;\r\n    const canvasCoord = coord.toCanvasCoordinates();\r\n    const path = this.getSVGPath('scale', true, false, true);\r\n    const selected = ctx.isPointInPath(\r\n      new Path2D(path),\r\n      canvasCoord.x,\r\n      canvasCoord.y,\r\n    );\r\n    return selected;\r\n  }\r\n\r\n  isSegmentInside(segment) {\r\n    return (\r\n      this.isCoordinatesInPath(segment.vertexes[0]) &&\r\n      this.isCoordinatesInPath(segment.vertexes[1]) &&\r\n      (!(\r\n        this.isCoordinatesOnBorder(segment.vertexes[0]) &&\r\n        this.isCoordinatesOnBorder(segment.vertexes[1])\r\n      ) ||\r\n        (this.isCoordinatesInPath(segment.middle) &&\r\n          !this.isCoordinatesOnBorder(segment.middle)))\r\n    );\r\n  }\r\n\r\n  /* #################################################################### */\r\n  /* ############################# OVERLAP ############################## */\r\n  /* #################################################################### */\r\n\r\n  /**\r\n   * V├®rifie si cette figure se superpose avec une autre figure.\r\n   * @param  {Shape} shape L'autre figure\r\n   * @return {overlap}     true: si les 2 figures se superposent\r\n   *    consid├®r├® vrai si deux segments sont confondu mais n'ont qu'un point commun ! => peut-etre probleme dans environnement libre\r\n   */\r\n  overlapsWith(shape) {\r\n    const s1 = this,\r\n      s2 = shape,\r\n      s1_segments = s1.segments,\r\n      s2_segments = s2.segments;\r\n\r\n    // s1 in s2 ? if a point of s1 is in s2\r\n    if (this.isThisInsideAnotherShape(shape)) return true;\r\n    // s2 in s1 ? if a point of s2 is in s1\r\n    if (shape.isThisInsideAnotherShape(this)) return true;\r\n\r\n    // check if intersect segments\r\n    if (this.doesThisIntersectAnotherShape(s1_segments, s2_segments))\r\n      return true;\r\n\r\n    return false;\r\n  }\r\n\r\n  isThisInsideAnotherShape(shape) {\r\n    const s1_segments = this.segments,\r\n      s2_segments = shape.segments;\r\n    for (const s1_segment of s1_segments) {\r\n      if (\r\n        s2_segments.some(\r\n          (s2_segment) =>\r\n            s2_segment.contains(s1_segment) || s1_segment.contains(s2_segment),\r\n        )\r\n      )\r\n        continue;\r\n      if (\r\n        shape.isCoordinatesInPath(s1_segment.vertexes[0].coordinates) &&\r\n        shape.isCoordinatesInPath(s1_segment.vertexes[1].coordinates) &&\r\n        shape.isCoordinatesInPath(s1_segment.middle) &&\r\n        !(\r\n          shape.isCoordinatesOnBorder(s1_segment.vertexes[0].coordinates) &&\r\n          shape.isCoordinatesOnBorder(s1_segment.vertexes[1].coordinates) &&\r\n          shape.isCoordinatesOnBorder(s1_segment.middle)\r\n        )\r\n      ) {\r\n        console.info('shape inside another');\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  doesThisIntersectAnotherShape(s1_segments, s2_segments) {\r\n    if (\r\n      s1_segments.some((s1_segment) =>\r\n        s2_segments.some((s2_segment) =>\r\n          s1_segment.doesIntersect(s2_segment, true),\r\n        ),\r\n      )\r\n    ) {\r\n      console.info('shape intersects another');\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /* #################################################################### */\r\n  /* ############################ TRANSFORM ############################# */\r\n  /* #################################################################### */\r\n\r\n  reverse() {\r\n    this.segments.forEach((seg) => {\r\n      if (seg.arcCenter) seg.counterclockwise = !seg.counterclockwise;\r\n    });\r\n    this.isReversed = !this.isReversed;\r\n  }\r\n\r\n  /**\r\n   * move the shape with coordinates\r\n   * @param {Coordinates} coordinates\r\n   * @param {Boolean} negativeTranslation true if the coordinates must be reversed\r\n   */\r\n  translate(coordinates, negativeTranslation = false) {\r\n    this.points.forEach((pt) => pt.translate(coordinates, negativeTranslation));\r\n  }\r\n\r\n  /**\r\n   * scale the shape with scaleRatio\r\n   * @param {Number}    scaleRatio\r\n   */\r\n  scale(scaleRatio) {\r\n    this.points.forEach((pt) => pt.multiply(scaleRatio));\r\n  }\r\n\r\n  /**\r\n   * Applique une homoth├®tie\r\n   * @param {Number} scaling   scale factor\r\n   * @param {Point}  center    center of the transformation\r\n   */\r\n  homothety(scaling, center = Coordinates.nullCoordinates) {\r\n    const saveCenter = new Coordinates(center);\r\n    const newCenter = center.multiply(scaling);\r\n    this.scale(scaling);\r\n    this.translate(saveCenter.substract(newCenter));\r\n  }\r\n\r\n  rotate(angle, center) {\r\n    this.points.forEach(\r\n      (pt) => (pt.coordinates = pt.coordinates.rotate(angle, center)),\r\n    );\r\n  }\r\n\r\n  /* #################################################################### */\r\n  /* ############################## OTHER ############################### */\r\n  /* #################################################################### */\r\n\r\n  /**\r\n   * convertit la shape en commande de path svg\r\n   */\r\n  getSVGPath(\r\n    scaling = 'scale',\r\n    infiniteCheck = true,\r\n    forDrawing = false,\r\n    forDrawingButInvisible = false,\r\n  ) {\r\n    let path = '';\r\n    path = this.segments\r\n      .map((seg) => seg.getSVGPath(scaling, false, infiniteCheck))\r\n      .join('\\n');\r\n    if (forDrawingButInvisible) {\r\n      if (this.vertexes[1] && this.segments[0].isArc()) {\r\n        let arcCenterCoordinates = this.segments[0].arcCenter.coordinates;\r\n        let firstVertex = this.vertexes[0].coordinates;\r\n        let secondVertex = this.vertexes[1].coordinates;\r\n        if (scaling == 'scale') {\r\n          arcCenterCoordinates = arcCenterCoordinates.toCanvasCoordinates();\r\n          firstVertex = firstVertex.toCanvasCoordinates();\r\n          secondVertex = secondVertex.toCanvasCoordinates();\r\n        }\r\n        path += [\r\n          'M',\r\n          arcCenterCoordinates.x,\r\n          arcCenterCoordinates.y,\r\n          'L',\r\n          firstVertex.x,\r\n          firstVertex.y,\r\n          'L',\r\n          secondVertex.x,\r\n          secondVertex.y,\r\n          'L',\r\n          arcCenterCoordinates.x,\r\n          arcCenterCoordinates.y,\r\n        ].join(' ');\r\n      }\r\n    }\r\n    return path;\r\n  }\r\n\r\n  /**\r\n   * convertit la shape en balise path de svg\r\n   */\r\n  toSVG() {\r\n    if (\r\n      this.geometryObject &&\r\n      (this.geometryObject.geometryIsVisible === false ||\r\n        this.geometryObject.geometryIsHidden === true ||\r\n        this.geometryObject.geometryIsConstaintDraw === true)\r\n    ) {\r\n      return '';\r\n    }\r\n\r\n    const path = this.getSVGPath();\r\n\r\n    const attributes = {\r\n      d: path,\r\n      stroke: this.strokeColor,\r\n      fill: '#000',\r\n      'fill-opacity': 0,\r\n      'stroke-width': this.strokeWidth,\r\n      'stroke-opacity': 1, // toujours ├á 1 ?\r\n    };\r\n\r\n    let path_tag = '<path';\r\n    for (const [key, value] of Object.entries(attributes)) {\r\n      path_tag += ' ' + key + '=\"' + value + '\"';\r\n    }\r\n    path_tag += '/>\\n';\r\n\r\n    const pointToDraw = [];\r\n    if (app.settings.areShapesPointed && this.name != 'silhouette') {\r\n      if (this.isSegment()) pointToDraw.push(this.segments[0].vertexes[0]);\r\n      if (!this.isCircle())\r\n        this.segments.forEach((seg) => pointToDraw.push(seg.vertexes[1]));\r\n    }\r\n\r\n    this.segments.forEach((seg) => {\r\n      //Points sur les segments\r\n      seg.divisionPoints.forEach((pt) => {\r\n        pointToDraw.push(pt);\r\n      });\r\n    });\r\n    if (this.isCenterShown) pointToDraw.push(this.center);\r\n\r\n    const point_tags = pointToDraw\r\n      .filter((pt) => {\r\n        pt.visible && pt.geometryIsVisible && !pt.geometryIsHidden;\r\n      })\r\n      .map((pt) => pt.svg)\r\n      .join('\\n');\r\n\r\n    const comment =\r\n      '<!-- ' + this.name.replace('├®', 'e').replace('├¿', 'e') + ' -->\\n';\r\n\r\n    return comment + path_tag + point_tags + '\\n';\r\n  }\r\n\r\n  cleanSameDirectionSegment() {\r\n    for (let i = 0; i < this.segments.length; i++) {\r\n      const nextIdx = mod(i + 1, this.segmentIds.length);\r\n      if (nextIdx == i) break;\r\n      if (\r\n        this.segments[i].hasSameDirection(this.segments[nextIdx], 1, 0, false)\r\n      ) {\r\n        if (this.name == 'Circle' && this.segments[0].radius < 0.001) {\r\n          const coord = this.segments[0].arcCenter.coordinates;\r\n          const counterclockwise = this.segments[0].counterclockwise;\r\n          this.pointIds.forEach((ptId) => removeObjectById(ptId));\r\n          this.segmentIds.forEach((segId) => removeObjectById(segId));\r\n          this.pointIds = [];\r\n          this.segmentIds = [];\r\n          new Point({\r\n            coordinates: coord,\r\n            shapeId: this.id,\r\n            layer: this.layer,\r\n            type: 'vertex',\r\n            idx: 0,\r\n            visible: this.isPointed,\r\n          });\r\n          new Point({\r\n            coordinates: coord,\r\n            shapeId: this.id,\r\n            layer: this.layer,\r\n            type: 'arcCenter',\r\n            visible: this.isPointed,\r\n          });\r\n          new Segment({\r\n            shapeId: this.id,\r\n            layer: this.layer,\r\n            idx: 0,\r\n            vertexIds: [this.pointIds[0]],\r\n            arcCenterId: this.pointIds[1],\r\n            counterclockwise,\r\n          });\r\n        } else {\r\n          const middlePointId = this.segments[i].vertexIds[1];\r\n          const ptIdx = this.pointIds.findIndex(\r\n            (ptId) => ptId == middlePointId,\r\n          );\r\n          this.pointIds.splice(ptIdx, 1);\r\n          removeObjectById(middlePointId);\r\n          this.segments[i].vertexIds[1] = this.segments[nextIdx].vertexIds[1];\r\n          if (this.segments[i].vertexes[1]) {\r\n            const idx = this.segments[i].vertexes[1].segmentIds.findIndex(\r\n              (id) => id == this.segmentIds[nextIdx],\r\n            );\r\n            this.segments[i].vertexes[1].segmentIds[idx] = this.segments[i].id;\r\n          } else {\r\n            const secondPointId = this.segments[i].vertexIds[1];\r\n            const ptIdx = this.pointIds.findIndex(\r\n              (ptId) => ptId == secondPointId,\r\n            );\r\n            this.pointIds.splice(ptIdx, 1);\r\n            removeObjectById(secondPointId);\r\n            // this.segments[i].vertexIds.splice(1);\r\n          }\r\n          if (this.segments[nextIdx].arcCenterId) {\r\n            removeObjectById(this.segments[nextIdx].arcCenterId);\r\n            const idx = this.pointIds.findIndex(\r\n              (id) => id == this.segments[nextIdx].arcCenterId,\r\n            );\r\n            this.pointIds.splice(idx, 1);\r\n          }\r\n          removeObjectById(this.segmentIds[nextIdx]);\r\n          this.segmentIds.splice(nextIdx, 1);\r\n        }\r\n        i--; // try to merge this new segment again!\r\n      }\r\n    }\r\n    this.segments.forEach((seg, idx) => (seg.idx = idx));\r\n    this.vertexes.forEach((vx, idx) => (vx.idx = idx));\r\n  }\r\n\r\n  saveData() {\r\n    const data = super.saveData();\r\n    data.type = 'LineShape';\r\n    return data;\r\n  }\r\n\r\n  static loadFromData(data) {\r\n    if (!data.position) {\r\n      data.position = 'main';\r\n    }\r\n    const shape = new LineShape({\r\n      layer: data.position,\r\n    });\r\n    Object.assign(shape, data);\r\n    shape.segmentIds = [...data.segmentIds];\r\n    shape.pointIds = [...data.pointIds];\r\n    if (data.geometryObject)\r\n      shape.geometryObject = GeometryObject.loadFromData(data.geometryObject);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Objects\\Shapes\\RegularShape.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used. Allowed unused args must match /^_/u.","line":21,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":7,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[600,603],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'layer' is defined but never used. Allowed unused args must match /^_/u.","line":22,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":10,"suggestions":[{"messageId":"removeVar","data":{"varName":"layer"},"fix":{"range":[602,614],"text":""},"desc":"Remove unused variable 'layer'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'path' is assigned a value but never used. Allowed unused args must match /^_/u.","line":24,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":9,"suggestions":[{"messageId":"removeVar","data":{"varName":"path"},"fix":{"range":[614,639],"text":""},"desc":"Remove unused variable 'path'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'segmentIds' is assigned a value but never used. Allowed unused args must match /^_/u.","line":25,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"segmentIds"},"fix":{"range":[639,661],"text":""},"desc":"Remove unused variable 'segmentIds'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'pointIds' is assigned a value but never used. Allowed unused args must match /^_/u.","line":26,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"pointIds"},"fix":{"range":[661,681],"text":""},"desc":"Remove unused variable 'pointIds'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'divisionPointInfos' is assigned a value but never used. Allowed unused args must match /^_/u.","line":27,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":23,"suggestions":[{"messageId":"removeVar","data":{"varName":"divisionPointInfos"},"fix":{"range":[681,711],"text":""},"desc":"Remove unused variable 'divisionPointInfos'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'name' is assigned a value but never used. Allowed unused args must match /^_/u.","line":29,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":29,"endColumn":9,"suggestions":[{"messageId":"removeVar","data":{"varName":"name"},"fix":{"range":[711,735],"text":""},"desc":"Remove unused variable 'name'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'familyName' is assigned a value but never used. Allowed unused args must match /^_/u.","line":30,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":30,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"familyName"},"fix":{"range":[735,763],"text":""},"desc":"Remove unused variable 'familyName'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'strokeColor' is assigned a value but never used. Allowed unused args must match /^_/u.","line":32,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"strokeColor"},"fix":{"range":[763,792],"text":""},"desc":"Remove unused variable 'strokeColor'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'strokeWidth' is assigned a value but never used. Allowed unused args must match /^_/u.","line":33,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":33,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"strokeWidth"},"fix":{"range":[792,814],"text":""},"desc":"Remove unused variable 'strokeWidth'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'isPointed' is assigned a value but never used. Allowed unused args must match /^_/u.","line":37,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":37,"endColumn":14,"suggestions":[{"messageId":"removeVar","data":{"varName":"isPointed"},"fix":{"range":[863,888],"text":""},"desc":"Remove unused variable 'isPointed'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'size' is assigned a value but never used. Allowed unused args must match /^_/u.","line":38,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":38,"endColumn":9,"suggestions":[{"messageId":"removeVar","data":{"varName":"size"},"fix":{"range":[888,903],"text":""},"desc":"Remove unused variable 'size'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'isReversed' is assigned a value but never used. Allowed unused args must match /^_/u.","line":40,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":40,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"isReversed"},"fix":{"range":[936,961],"text":""},"desc":"Remove unused variable 'isReversed'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'isBiface' is assigned a value but never used. Allowed unused args must match /^_/u.","line":41,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":41,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"isBiface"},"fix":{"range":[961,984],"text":""},"desc":"Remove unused variable 'isBiface'."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":117,"column":54,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":117,"endColumn":56,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3322,3324],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":118,"column":32,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":118,"endColumn":34,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3373,3375],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":118,"column":62,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":118,"endColumn":64,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3403,3405],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":122,"column":55,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":122,"endColumn":57,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3619,3621],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":127,"column":36,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":127,"endColumn":38,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3775,3777],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":133,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":133,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[4038,4040],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":149,"column":59,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":149,"endColumn":61,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4589,4591],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":174,"column":20,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":174,"endColumn":22,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5255,5257],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":175,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":175,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[5296,5298],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":176,"column":32,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":176,"endColumn":34,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[5343,5345],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":195,"column":28,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":195,"endColumn":30,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[5809,5811],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'ry' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":248,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":248,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"ry"},"fix":{"range":[7319,7362],"text":""},"desc":"Remove unused variable 'ry'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'xAxisRotation' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":249,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":249,"endColumn":26,"suggestions":[{"messageId":"removeVar","data":{"varName":"xAxisRotation"},"fix":{"range":[7362,7416],"text":""},"desc":"Remove unused variable 'xAxisRotation'."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":261,"column":26,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":261,"endColumn":28,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7857,7859],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":261,"column":58,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":261,"endColumn":60,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[7889,7891],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":286,"column":41,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":286,"endColumn":43,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8660,8662],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":305,"column":28,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":305,"endColumn":30,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[9034,9036],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":307,"column":42,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":307,"endColumn":44,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[9121,9123],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":307,"column":65,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":307,"endColumn":67,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[9144,9146],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"prefer-const","severity":1,"message":"'middle' is never reassigned. Use 'const' instead.","line":391,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":391,"endColumn":15},{"ruleId":"prefer-const","severity":1,"message":"'isHorizontal' is never reassigned. Use 'const' instead.","line":394,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":394,"endColumn":19},{"ruleId":"prefer-const","severity":1,"message":"'isVertical' is never reassigned. Use 'const' instead.","line":395,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":395,"endColumn":17},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":437,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":437,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[12978,12980],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":437,"column":58,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":437,"endColumn":60,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[13006,13008],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":449,"column":17,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":449,"endColumn":19,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[13390,13392],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":458,"column":17,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":458,"endColumn":19,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[13729,13731],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":460,"column":29,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":460,"endColumn":31,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[13814,13816],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":653,"column":21,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":653,"endColumn":23,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[19981,19983],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'strokeWidth' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":654,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":654,"endColumn":23},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":673,"column":52,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":673,"endColumn":54,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[20605,20607],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":703,"column":19,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":703,"endColumn":21,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[21573,21575],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":707,"column":23,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":707,"endColumn":25,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[21712,21714],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":740,"column":28,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":740,"endColumn":30,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[22931,22933],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":746,"column":24,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":746,"endColumn":26,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[23226,23228],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":752,"column":26,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":752,"endColumn":28,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[23538,23540],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":29,"fatalErrorCount":0,"warningCount":20,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { deleteChildren } from '../../../GeometryTools/deleteShape';\r\nimport { app } from '../../App';\r\nimport {\r\n  findObjectById,\r\n  getComplementaryColor,\r\n  mod,\r\n  removeObjectById,\r\n} from '../../Tools/general';\r\nimport { Bounds } from '../Bounds';\r\nimport { Coordinates } from '../Coordinates';\r\nimport { Point } from '../Point';\r\nimport { Segment } from '../Segment';\r\nimport { GeometryObject } from './GeometryObject';\r\nimport { Shape } from './Shape';\r\n\r\n/**\r\n * Repr├®sente une figure classique (rectangle, disque, ...)\r\n */\r\nexport class RegularShape extends Shape {\r\n  constructor({\r\n    id,\r\n    layer,\r\n\r\n    path = undefined,\r\n    segmentIds = [],\r\n    pointIds = [],\r\n    divisionPointInfos = [],\r\n\r\n    name = 'Custom',\r\n    familyName = 'Custom',\r\n\r\n    strokeColor = '#000',\r\n    strokeWidth = 1,\r\n    fillColor = '#aaa',\r\n    fillOpacity = 0.7,\r\n\r\n    isPointed = true,\r\n    size = 2,\r\n    _isCenterShown = undefined,\r\n    isReversed = false,\r\n    isBiface = false,\r\n  }) {\r\n    super(arguments[0]);\r\n\r\n    this.fillColor = fillColor;\r\n    this.fillOpacity = fillOpacity;\r\n  }\r\n\r\n  /* #################################################################### */\r\n  /* ############################## GET/SET ############################# */\r\n  /* #################################################################### */\r\n\r\n  get segments() {\r\n    const segments = this.segmentIds\r\n      .map((segId) => this.canvasLayer.segments.find((seg) => seg.id === segId))\r\n      .filter((seg) => seg !== undefined);\r\n    return segments;\r\n  }\r\n\r\n  get points() {\r\n    // if (this.isCircle() && app.environment.name !== 'Geometrie') => doit-on inclure le point du cercle dans Grandeurs et Cubes ?\r\n    const points = this.pointIds\r\n      .map((ptId) => this.canvasLayer.points.find((pt) => pt.id === ptId))\r\n      .filter((pt) => pt !== undefined);\r\n    return points;\r\n  }\r\n\r\n  get vertexes() {\r\n    const vertexes = this.points.filter((pt) => pt.type === 'vertex');\r\n    return vertexes;\r\n  }\r\n\r\n  get divisionPoints() {\r\n    const divisionPoints = this.points.filter(\r\n      (pt) => pt.type === 'divisionPoint',\r\n    );\r\n    return divisionPoints;\r\n  }\r\n\r\n  get center() {\r\n    const center = this.points.filter((pt) => pt.type === 'shapeCenter')[0];\r\n    return center;\r\n  }\r\n\r\n  get centerCoordinates() {\r\n    if (this.isCircle()) {\r\n      const center = this.segments[0].arcCenter;\r\n      return new Coordinates(center.coordinates);\r\n    } else {\r\n      let totalCoordinates = Coordinates.nullCoordinates;\r\n      this.vertexes.forEach((vertex) => {\r\n        totalCoordinates = totalCoordinates.add(vertex.coordinates);\r\n      });\r\n      const averageCoordinates = totalCoordinates.multiply(\r\n        1 / this.vertexes.length,\r\n      );\r\n      return averageCoordinates;\r\n    }\r\n  }\r\n\r\n  get isCenterShown() {\r\n    const isCenterShown = this._isCenterShown;\r\n    return isCenterShown;\r\n  }\r\n\r\n  set isCenterShown(value) {\r\n    if (value && !this.isCenterShown) {\r\n      const centerCoordinates = this.centerCoordinates;\r\n      new Point({\r\n        coordinates: centerCoordinates,\r\n        shapeId: this.id,\r\n        layer: this.layer,\r\n        type: 'shapeCenter',\r\n        // visible: this.isPointed,\r\n      });\r\n    } else if (!value && this.isCenterShown) {\r\n      const point = this.points.find((pt) => pt.type == 'shapeCenter');\r\n      if (app.environment.name == 'Geometrie' && point.layer == 'main') {\r\n        const shapesToDelete = [];\r\n        this.geometryObject.geometryChildShapeIds.forEach((sId) => {\r\n          const s = findObjectById(sId);\r\n          if (s && s.points.some((pt) => pt.reference == point.id)) {\r\n            shapesToDelete.push(s);\r\n          }\r\n        });\r\n        shapesToDelete.forEach((s) => {\r\n          if (app.environment.name == 'Geometrie') deleteChildren(s);\r\n          removeObjectById(s.id);\r\n        });\r\n        for (let i = 0; i < app.mainCanvasLayer.shapes.length; i++) {\r\n          const s = app.mainCanvasLayer.shapes[i];\r\n          s.points\r\n            .filter((pt) => pt.type != 'divisionPoint')\r\n            .forEach((pt) => {\r\n              if (pt.reference && !findObjectById(pt.reference))\r\n                pt.reference = null;\r\n            });\r\n          if (\r\n            s.geometryObject.geometryPointOnTheFlyChildId &&\r\n            !findObjectById(s.geometryObject.geometryPointOnTheFlyChildId)\r\n          ) {\r\n            deleteChildren(s);\r\n            i--;\r\n          }\r\n        }\r\n      }\r\n      const pointId = point.id;\r\n      removeObjectById(pointId);\r\n      const index = this.pointIds.findIndex((pt) => pt.id == pointId);\r\n      this.pointIds.splice(index, 1);\r\n    }\r\n    this._isCenterShown = value;\r\n  }\r\n\r\n  setSegmentsFromPath(path) {\r\n    const allPathElements = path\r\n      .split(/[ \\n]/)\r\n      .filter((element) => element !== '');\r\n    let firstVertex, lastVertex, startVertex;\r\n\r\n    let segmentIdx = 0;\r\n    let vertexIdx = 0;\r\n\r\n    this.pointIds = [];\r\n    this.segmentIds = [];\r\n\r\n    let nextVertexCoordinates = null;\r\n\r\n    const createLineTo = (x, y) => {\r\n      const coordinates = new Coordinates({ x, y });\r\n      firstVertex = lastVertex;\r\n      lastVertex = this.points.find((pt) => pt.coordinates.equal(coordinates));\r\n      if (\r\n        lastVertex == undefined ||\r\n        lastVertex.type != 'vertex' ||\r\n        allPathElements.length != 0\r\n      ) {\r\n        lastVertex = new Point({\r\n          coordinates: coordinates,\r\n          shapeId: this.id,\r\n          layer: this.layer,\r\n          type: 'vertex',\r\n          idx: vertexIdx++,\r\n          visible: this.isPointed,\r\n        });\r\n      }\r\n      new Segment({\r\n        shapeId: this.id,\r\n        layer: this.layer,\r\n        idx: segmentIdx++,\r\n        vertexIds: [firstVertex.id, lastVertex.id],\r\n      });\r\n    };\r\n\r\n    if (allPathElements[0] != 'M')\r\n      startVertex = lastVertex = new Point({\r\n        shapeId: this.id,\r\n        layer: this.layer,\r\n        type: 'vertex',\r\n        idx: vertexIdx++,\r\n        visible: this.isPointed,\r\n      });\r\n\r\n    while (allPathElements.length) {\r\n      const element = allPathElements.shift();\r\n\r\n      switch (element) {\r\n        case 'M':\r\n        case 'm':\r\n          nextVertexCoordinates = new Coordinates({\r\n            x: allPathElements.shift(),\r\n            y: allPathElements.shift(),\r\n          });\r\n          if (this.contains(nextVertexCoordinates)) {\r\n            startVertex = lastVertex = this.points.find((pt) =>\r\n              pt.coordinates.equal(nextVertexCoordinates),\r\n            );\r\n          } else {\r\n            startVertex = lastVertex = new Point({\r\n              coordinates: nextVertexCoordinates,\r\n              shapeId: this.id,\r\n              layer: this.layer,\r\n              type: 'vertex',\r\n              idx: vertexIdx++,\r\n              visible: this.isPointed,\r\n            });\r\n          }\r\n          break;\r\n\r\n        case 'L':\r\n        case 'l':\r\n          createLineTo(allPathElements.shift(), allPathElements.shift());\r\n          break;\r\n\r\n        case 'H':\r\n        case 'h':\r\n          createLineTo(allPathElements.shift(), lastVertex.y);\r\n          break;\r\n\r\n        case 'V':\r\n        case 'v':\r\n          createLineTo(lastVertex.x, allPathElements.shift());\r\n          break;\r\n\r\n        case 'A':\r\n        case 'a':\r\n          const rx = allPathElements.shift(),\r\n            ry = allPathElements.shift(),\r\n            xAxisRotation = allPathElements.shift(),\r\n            largeArcFlag = allPathElements.shift(),\r\n            sweepFlag = allPathElements.shift();\r\n\r\n          firstVertex = lastVertex;\r\n          nextVertexCoordinates = new Coordinates({\r\n            x: allPathElements.shift(),\r\n            y: allPathElements.shift(),\r\n          });\r\n          lastVertex = this.points.find((pt) =>\r\n            pt.coordinates.equal(nextVertexCoordinates),\r\n          );\r\n          if (lastVertex == undefined || lastVertex.type != 'vertex') {\r\n            lastVertex = new Point({\r\n              coordinates: nextVertexCoordinates,\r\n              shapeId: this.id,\r\n              layer: this.layer,\r\n              type: 'vertex',\r\n              idx: vertexIdx++,\r\n              visible: this.isPointed,\r\n            });\r\n          }\r\n\r\n          const arcCenter = this.getArcCenterFromSVG(\r\n            firstVertex,\r\n            lastVertex,\r\n            rx,\r\n            largeArcFlag,\r\n            sweepFlag,\r\n          );\r\n\r\n          const segment = new Segment({\r\n            shapeId: this.id,\r\n            layer: this.layer,\r\n            idx: segmentIdx++,\r\n            vertexIds: [firstVertex.id, lastVertex.id],\r\n            arcCenterId: arcCenter.id,\r\n            counterclockwise: sweepFlag == 0,\r\n          });\r\n          arcCenter.segmentIds.push(segment.id);\r\n\r\n          this.cleanSameDirectionSegment();\r\n\r\n          break;\r\n\r\n        case 'Z':\r\n        case 'z':\r\n          createLineTo(startVertex.x, startVertex.y);\r\n          break;\r\n\r\n        default:\r\n          break;\r\n      }\r\n    }\r\n    // if segment length == 0\r\n    if (\r\n      app.environment.name == 'Geometrie' &&\r\n      !this.isCircle() &&\r\n      this.points.filter((pt) => pt.type != 'arcCenter').length !=\r\n        this.segmentIds.length\r\n    ) {\r\n      const coord = this.points[0].coordinates;\r\n      const numberOfSegment = this.segmentIds.length;\r\n      this.pointIds.forEach((ptId) => removeObjectById(ptId));\r\n      this.segmentIds.forEach((segId) => removeObjectById(segId));\r\n      this.pointIds = [];\r\n      this.segmentIds = [];\r\n      for (let idx = 0; idx < numberOfSegment; idx++) {\r\n        new Point({\r\n          coordinates: coord,\r\n          shapeId: this.id,\r\n          layer: this.layer,\r\n          type: 'vertex',\r\n          idx,\r\n          visible: this.isPointed,\r\n        });\r\n      }\r\n      for (let idx = 0; idx < numberOfSegment; idx++) {\r\n        new Segment({\r\n          shapeId: this.id,\r\n          layer: this.layer,\r\n          idx,\r\n          vertexIds: [\r\n            this.pointIds[idx],\r\n            this.pointIds[(idx + 1) % numberOfSegment],\r\n          ],\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * moyenne des vertexes et medianes, pour l'offset de cut\r\n   */\r\n  get fake_center() {\r\n    if (this.isCircle()) {\r\n      const center = this.segments[0].arcCenter;\r\n      return new Coordinates(center);\r\n    } else {\r\n      const total = {\r\n        x: 0,\r\n        y: 0,\r\n        amount: 0,\r\n      };\r\n      this.vertexes.forEach((vertex) => {\r\n        total.x += vertex.x;\r\n        total.y += vertex.y;\r\n        total.amount++;\r\n      });\r\n      this.segments.forEach((seg) => {\r\n        total.x += seg.middle.x;\r\n        total.y += seg.middle.y;\r\n        total.amount++;\r\n      });\r\n\r\n      return new Coordinates(total).multiply(1 / total.amount);\r\n    }\r\n  }\r\n\r\n  get bounds() {\r\n    const segmentBounds = this.segments.map((seg) => seg.bounds);\r\n    return Bounds.getOuterBounds(...segmentBounds);\r\n  }\r\n\r\n  getCommonsCoordinates(shape) {\r\n    const commonsCoordinates = [];\r\n    this.points.forEach((point1) => {\r\n      shape.points.forEach((point2) => {\r\n        if (point1.coordinates.equal(point2.coordinates))\r\n          commonsCoordinates.push(point1.coordinates);\r\n      });\r\n    });\r\n    return commonsCoordinates;\r\n  }\r\n\r\n  getArcCenterFromSVG(\r\n    firstVertex,\r\n    lastVertex,\r\n    radius,\r\n    largeArcFlag,\r\n    sweepFlag,\r\n  ) {\r\n    let middle = firstVertex.coordinates\r\n        .add(lastVertex.coordinates)\r\n        .multiply(1 / 2),\r\n      isHorizontal = Math.abs(firstVertex.y - lastVertex.y) < 0.01,\r\n      isVertical = Math.abs(firstVertex.x - lastVertex.x) < 0.01,\r\n      distanceMiddleArcCenter = Math.sqrt(\r\n        Math.pow(radius, 2) -\r\n          (Math.pow(firstVertex.x - lastVertex.x, 2) +\r\n            Math.pow(firstVertex.y - lastVertex.y, 2)) /\r\n            4,\r\n      );\r\n\r\n    if (isNaN(distanceMiddleArcCenter)) distanceMiddleArcCenter = 0;\r\n\r\n    let theta, arcCenterCoordinates;\r\n    // theta is the angle between the segment firstvertex - lastvertex and the x-axis\r\n\r\n    if (isHorizontal) {\r\n      theta = firstVertex.x < lastVertex.x ? 0 : Math.PI;\r\n    } else if (isVertical) {\r\n      theta = firstVertex.y < lastVertex.y ? Math.PI / 2 : (Math.PI * 3) / 2;\r\n    } else {\r\n      theta = Math.atan2(\r\n        lastVertex.y - firstVertex.y,\r\n        lastVertex.x - firstVertex.x,\r\n      );\r\n    }\r\n\r\n    if (largeArcFlag !== sweepFlag) {\r\n      arcCenterCoordinates = middle.add({\r\n        x: distanceMiddleArcCenter * Math.cos(theta + Math.PI / 2),\r\n        y: distanceMiddleArcCenter * Math.sin(theta + Math.PI / 2),\r\n      });\r\n    } else {\r\n      arcCenterCoordinates = middle.add({\r\n        x: distanceMiddleArcCenter * Math.cos(theta - Math.PI / 2),\r\n        y: distanceMiddleArcCenter * Math.sin(theta - Math.PI / 2),\r\n      });\r\n    }\r\n    const arcCenter = new Point({\r\n      layer: this.layer,\r\n      coordinates: arcCenterCoordinates,\r\n      shapeId: this.id,\r\n      type: 'arcCenter',\r\n      visible: false,\r\n    });\r\n    if (app.environment.name == 'Geometrie' && this.name != 'Custom')\r\n      arcCenter.visible = true;\r\n\r\n    return arcCenter;\r\n  }\r\n\r\n  setCtxForDrawing(ctx, scaling) {\r\n    ctx.strokeStyle = this.strokeColor;\r\n    ctx.fillStyle = this.fillColor;\r\n    if (this.isOverlappingAnotherInTangram) ctx.fillStyle = '#F00';\r\n    ctx.globalAlpha = this.fillOpacity;\r\n    ctx.lineWidth = this.strokeWidth * app.workspace.zoomLevel;\r\n    if (scaling == 'no scale') ctx.lineWidth = this.strokeWidth;\r\n  }\r\n\r\n  /* #################################################################### */\r\n  /* ################################ IS ################################ */\r\n  /* #################################################################### */\r\n\r\n  isCircle() {\r\n    return (\r\n      this.name == 'Circle' ||\r\n      this.name.startsWith('Disque') ||\r\n      (this.segments.length == 1 &&\r\n        this.segments[0].isArc() &&\r\n        this.segments[0].vertexes[0].coordinates.equal(\r\n          this.segments[0].vertexes[1].coordinates,\r\n        ))\r\n    );\r\n  }\r\n\r\n  isCoordinatesInPath(coordinates) {\r\n    const ctx = app.invisibleCanvasLayer.ctx;\r\n    const canvasCoordinates = coordinates.toCanvasCoordinates();\r\n    const selected = ctx.isPointInPath(\r\n      new Path2D(this.getSVGPath()),\r\n      canvasCoordinates.x,\r\n      canvasCoordinates.y,\r\n    );\r\n    return selected;\r\n  }\r\n\r\n  isSegmentInside(segment) {\r\n    return (\r\n      this.isCoordinatesInPath(segment.vertexes[0]) &&\r\n      this.isCoordinatesInPath(segment.vertexes[1]) &&\r\n      (!(\r\n        this.isCoordinatesOnBorder(segment.vertexes[0]) &&\r\n        this.isCoordinatesOnBorder(segment.vertexes[1])\r\n      ) ||\r\n        (this.isCoordinatesInPath(segment.middle) &&\r\n          !this.isCoordinatesOnBorder(segment.middle)))\r\n    );\r\n  }\r\n\r\n  /* #################################################################### */\r\n  /* ############################# OVERLAP ############################## */\r\n  /* #################################################################### */\r\n\r\n  /**\r\n   * V├®rifie si cette figure se superpose avec une autre figure.\r\n   * @param  {Shape} shape L'autre figure\r\n   * @return {overlap}     true: si les 2 figures se superposent\r\n   *    consid├®r├® vrai si deux segments sont confondu mais n'ont qu'un point commun ! => peut-etre probleme dans environnement libre\r\n   */\r\n  overlapsWith(shape) {\r\n    const s1 = this,\r\n      s2 = shape,\r\n      s1_segments = s1.segments,\r\n      s2_segments = s2.segments;\r\n\r\n    // s1 in s2 ? if a point of s1 is in s2\r\n    if (this.isThisInsideAnotherShape(shape)) return true;\r\n    // s2 in s1 ? if a point of s2 is in s1\r\n    if (shape.isThisInsideAnotherShape(this)) return true;\r\n\r\n    // check if intersect segments\r\n    if (this.doesThisIntersectAnotherShape(s1_segments, s2_segments))\r\n      return true;\r\n\r\n    return false;\r\n  }\r\n\r\n  isThisInsideAnotherShape(shape) {\r\n    const s1_segments = this.segments,\r\n      s2_segments = shape.segments;\r\n    for (const s1_segment of s1_segments) {\r\n      if (\r\n        s2_segments.some(\r\n          (s2_segment) =>\r\n            s2_segment.contains(s1_segment) || s1_segment.contains(s2_segment),\r\n        )\r\n      )\r\n        continue;\r\n      if (\r\n        (shape.isCoordinatesInPath(s1_segment.vertexes[0].coordinates) &&\r\n          !shape.isCoordinatesOnBorder(s1_segment.vertexes[0].coordinates)) ||\r\n        (shape.isCoordinatesInPath(s1_segment.vertexes[1].coordinates) &&\r\n          !shape.isCoordinatesOnBorder(s1_segment.vertexes[1].coordinates)) ||\r\n        (shape.isCoordinatesInPath(s1_segment.middle) &&\r\n          !shape.isCoordinatesOnBorder(s1_segment.middle))\r\n      )\r\n        return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  doesThisIntersectAnotherShape(s1_segments, s2_segments) {\r\n    if (\r\n      s1_segments.some((s1_segment) =>\r\n        s2_segments.some((s2_segment) =>\r\n          s1_segment.doesIntersect(s2_segment, true),\r\n        ),\r\n      )\r\n    ) {\r\n      console.info('shape intersects another');\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /* #################################################################### */\r\n  /* ############################ TRANSFORM ############################# */\r\n  /* #################################################################### */\r\n\r\n  reverse() {\r\n    this.segments.forEach((seg) => {\r\n      if (seg.arcCenter) seg.counterclockwise = !seg.counterclockwise;\r\n    });\r\n    if (this.isBiface) this.fillColor = getComplementaryColor(this.fillColor);\r\n    this.isReversed = !this.isReversed;\r\n  }\r\n\r\n  /**\r\n   * move the shape with coordinates\r\n   * @param {Coordinates} coordinates\r\n   * @param {Boolean} negativeTranslation true if the coordinates must be reversed\r\n   */\r\n  translate(coordinates, negativeTranslation = false) {\r\n    this.points.forEach((pt) => pt.translate(coordinates, negativeTranslation));\r\n  }\r\n\r\n  /**\r\n   * scale the shape with scaleRatio\r\n   * @param {Number}    scaleRatio\r\n   */\r\n  scale(scaleRatio) {\r\n    this.points.forEach((pt) => pt.multiply(scaleRatio));\r\n  }\r\n\r\n  /**\r\n   * Applique une homoth├®tie\r\n   * @param {Number} scaling   scale factor\r\n   * @param {Point}  center    center of the transformation\r\n   */\r\n  homothety(scaling, center = Coordinates.nullCoordinates) {\r\n    const saveCenter = new Coordinates(center);\r\n    const newCenter = center.multiply(scaling);\r\n    this.scale(scaling);\r\n    this.translate(saveCenter.substract(newCenter));\r\n  }\r\n\r\n  rotate(angle, center) {\r\n    this.points.forEach(\r\n      (pt) => (pt.coordinates = pt.coordinates.rotate(angle, center)),\r\n    );\r\n  }\r\n\r\n  /* #################################################################### */\r\n  /* ############################## OTHER ############################### */\r\n  /* #################################################################### */\r\n\r\n  /**\r\n   * convertit la shape en commande de path svg\r\n   */\r\n  getSVGPath(scaling = 'scale') {\r\n    const path = this.segments\r\n      .map((seg) => seg.getSVGPath(scaling, false, false))\r\n      .join('\\n');\r\n    return path;\r\n  }\r\n\r\n  /**\r\n   * convertit la shape en balise path de svg\r\n   */\r\n  toSVG() {\r\n    if (\r\n      this.geometryObject &&\r\n      (this.geometryObject.geometryIsVisible === false ||\r\n        this.geometryObject.geometryIsHidden === true ||\r\n        this.geometryObject.geometryIsConstaintDraw === true)\r\n    ) {\r\n      return '';\r\n    }\r\n\r\n    const shapePath = this.getSVGPath();\r\n\r\n    const fillAttributes = {\r\n      d: shapePath,\r\n      fill: this.fillColor,\r\n      'fill-opacity': this.fillOpacity,\r\n      'stroke-width': 0,\r\n      'stroke-opacity': 0,\r\n    };\r\n\r\n    let fillPath = '<path';\r\n    for (const [key, value] of Object.entries(fillAttributes)) {\r\n      fillPath += ' ' + key + '=\"' + value + '\"';\r\n    }\r\n    fillPath += '/>\\n';\r\n\r\n    let totalStrokePath = '';\r\n    this.segments.forEach((seg) => {\r\n      const segmentPath = seg.getSVGPath('scale', true);\r\n      const segmentColor = seg.color ? seg.color : this.strokeColor;\r\n      let strokeWidth = 1;\r\n      if (seg.width != 1) strokeWidth = seg.width;\r\n      else strokeWidth = this.strokeWidth;\r\n\r\n      const strokeAttributes = {\r\n        d: segmentPath,\r\n        stroke: segmentColor,\r\n        'fill-opacity': 0,\r\n        'stroke-width': this.strokeWidth,\r\n        'stroke-opacity': 1, // toujours ├á 1 ?\r\n      };\r\n\r\n      let strokePath = '<path';\r\n      for (const [key, value] of Object.entries(strokeAttributes)) {\r\n        strokePath += ' ' + key + '=\"' + value + '\"';\r\n      }\r\n      strokePath += '/>\\n';\r\n      totalStrokePath += strokePath;\r\n    });\r\n\r\n    const pointToDraw = [];\r\n    if (app.settings.areShapesPointed && this.name != 'silhouette') {\r\n      if (this.isSegment()) pointToDraw.push(this.segments[0].vertexes[0]);\r\n      if (!this.isCircle())\r\n        this.segments.forEach((seg) => pointToDraw.push(seg.vertexes[1]));\r\n    }\r\n\r\n    this.segments.forEach((seg) => {\r\n      //Points sur les segments\r\n      seg.divisionPoints.forEach((pt) => {\r\n        pointToDraw.push(pt);\r\n      });\r\n    });\r\n    if (this.isCenterShown) pointToDraw.push(this.center);\r\n\r\n    const point_tags = pointToDraw\r\n      .filter((pt) => {\r\n        pt.visible && pt.geometryIsVisible && !pt.geometryIsHidden;\r\n      })\r\n      .map((pt) => pt.svg)\r\n      .join('\\n');\r\n\r\n    const comment =\r\n      '<!-- ' + this.name.replace('├®', 'e').replace('├¿', 'e') + ' -->\\n';\r\n\r\n    return comment + fillPath + totalStrokePath + point_tags + '\\n';\r\n  }\r\n\r\n  cleanSameDirectionSegment() {\r\n    for (let i = 0; i < this.segments.length; i++) {\r\n      const nextIdx = mod(i + 1, this.segmentIds.length);\r\n      if (nextIdx == i) break;\r\n      if (\r\n        this.segments[i].hasSameDirection(this.segments[nextIdx], 1, 0, false)\r\n      ) {\r\n        if (this.name == 'Circle' && this.segments[0].radius < 0.001) {\r\n          const coord = this.segments[0].arcCenter.coordinates;\r\n          const counterclockwise = this.segments[0].counterclockwise;\r\n          this.pointIds.forEach((ptId) => removeObjectById(ptId));\r\n          this.segmentIds.forEach((segId) => removeObjectById(segId));\r\n          this.pointIds = [];\r\n          this.segmentIds = [];\r\n          new Point({\r\n            coordinates: coord,\r\n            shapeId: this.id,\r\n            layer: this.layer,\r\n            type: 'vertex',\r\n            idx: 0,\r\n            visible: this.isPointed,\r\n          });\r\n          new Point({\r\n            coordinates: coord,\r\n            shapeId: this.id,\r\n            layer: this.layer,\r\n            type: 'arcCenter',\r\n            visible: this.isPointed,\r\n          });\r\n          new Segment({\r\n            shapeId: this.id,\r\n            layer: this.layer,\r\n            idx: 0,\r\n            vertexIds: [this.pointIds[0]],\r\n            arcCenterId: this.pointIds[1],\r\n            counterclockwise,\r\n          });\r\n        } else {\r\n          const middlePointId = this.segments[i].vertexIds[1];\r\n          const ptIdx = this.pointIds.findIndex(\r\n            (ptId) => ptId == middlePointId,\r\n          );\r\n          this.pointIds.splice(ptIdx, 1);\r\n          removeObjectById(middlePointId);\r\n          this.segments[i].vertexIds[1] = this.segments[nextIdx].vertexIds[1];\r\n          let idx = this.segments[i].vertexes[1].segmentIds.findIndex(\r\n            (id) => id == this.segmentIds[nextIdx],\r\n          );\r\n          this.segments[i].vertexes[1].segmentIds[idx] = this.segments[i].id;\r\n          if (this.segments[nextIdx].arcCenterId) {\r\n            removeObjectById(this.segments[nextIdx].arcCenterId);\r\n            idx = this.pointIds.findIndex(\r\n              (id) => id == this.segments[nextIdx].arcCenterId,\r\n            );\r\n            this.pointIds.splice(idx, 1);\r\n          }\r\n          removeObjectById(this.segmentIds[nextIdx]);\r\n          this.segmentIds.splice(nextIdx, 1);\r\n        }\r\n        i--; // try to merge this new segment again!\r\n      }\r\n    }\r\n    this.segments.forEach((seg, idx) => (seg.idx = idx));\r\n    this.vertexes.forEach((vx, idx) => (vx.idx = idx));\r\n  }\r\n\r\n  saveData() {\r\n    const data = super.saveData();\r\n    data.type = 'RegularShape';\r\n    if (this.fillColor !== '#aaa') data.fillColor = this.fillColor;\r\n    if (this.fillOpacity !== 0.7) data.fillOpacity = this.fillOpacity;\r\n    return data;\r\n  }\r\n\r\n  static loadFromData(data) {\r\n    if (!data.position) data.position = 'main';\r\n    const shape = new RegularShape({ layer: data.position });\r\n    Object.assign(shape, data);\r\n    shape.segmentIds = [...data.segmentIds];\r\n    shape.pointIds = [...data.pointIds];\r\n    if (data.geometryObject)\r\n      shape.geometryObject = GeometryObject.loadFromData(data.geometryObject);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Objects\\Shapes\\Shape.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":59,"column":12,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":59,"endColumn":14,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1620,1622],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":91,"column":51,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":91,"endColumn":53,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[2777,2779],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":194,"column":54,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":194,"endColumn":56,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5725,5727],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":195,"column":32,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":195,"endColumn":34,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5776,5778],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":195,"column":62,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":195,"endColumn":64,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5806,5808],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":199,"column":55,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":199,"endColumn":57,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6022,6024],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":204,"column":36,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":204,"endColumn":38,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6178,6180],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":210,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":210,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[6441,6443],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":226,"column":59,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":226,"endColumn":61,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6992,6994],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"prefer-const","severity":1,"message":"'middle' is never reassigned. Use 'const' instead.","line":283,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":283,"endColumn":15},{"ruleId":"prefer-const","severity":1,"message":"'isHorizontal' is never reassigned. Use 'const' instead.","line":286,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":286,"endColumn":19},{"ruleId":"prefer-const","severity":1,"message":"'isVertical' is never reassigned. Use 'const' instead.","line":287,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":287,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'coordinates' is defined but never used. Allowed unused args must match /^_/u.","line":388,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":388,"endColumn":34,"suggestions":[{"messageId":"removeVar","data":{"varName":"coordinates"},"fix":{"range":[11428,11439],"text":""},"desc":"Remove unused variable 'coordinates'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'segment' is defined but never used. Allowed unused args must match /^_/u.","line":392,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":392,"endColumn":26,"suggestions":[{"messageId":"removeVar","data":{"varName":"segment"},"fix":{"range":[11488,11495],"text":""},"desc":"Remove unused variable 'segment'."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":552,"column":52,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":552,"endColumn":54,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[16581,16583],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":578,"column":19,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":578,"endColumn":21,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[17427,17429],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":583,"column":62,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":583,"endColumn":64,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[17667,17669],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":588,"column":22,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":588,"endColumn":24,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[17939,17941],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":594,"column":24,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":594,"endColumn":26,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[18239,18241],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":14,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app } from '../../App';\r\nimport {\r\n  addInfoToId,\r\n  getComplementaryColor,\r\n  mod,\r\n  removeObjectById,\r\n  uniqId,\r\n} from '../../Tools/general';\r\nimport { Bounds } from '../Bounds';\r\nimport { Coordinates } from '../Coordinates';\r\nimport { Point } from '../Point';\r\nimport { Segment } from '../Segment';\r\n\r\n/**\r\n * Repr├®sente une figure\r\n */\r\nexport class Shape {\r\n  /**\r\n   * @param {String}                      id\r\n   * @param {String}                      layer\r\n   * @param {String}                      path\r\n   * @param {[String]}                    segmentIds\r\n   * @param {[String]}                    pointIds\r\n   * @param {String}                      name\r\n   * @param {String}                      familyName\r\n   * @param {String}                      color - '#rrggbb'\r\n   * @param {Number}                      opacity - between 0 and 1\r\n   * @param {Number}                      size - 1, 2 or 3\r\n   * @param {String}                      borderColor - '#rrggbb'\r\n   * @param {Boolean}                     isCenterShown\r\n   * @param {Boolean}                     isReversed\r\n   * @param {Boolean}                     isBiface\r\n   */\r\n  constructor({\r\n    id,\r\n    layer,\r\n\r\n    path = undefined,\r\n    segmentIds = [],\r\n    pointIds = [],\r\n    divisionPointInfos = [],\r\n    segmentsColor = null,\r\n    pointsColor = null,\r\n\r\n    name = 'Custom',\r\n    familyName = 'Custom',\r\n\r\n    strokeColor = '#000',\r\n    strokeWidth = 1,\r\n\r\n    isPointed = true,\r\n    size = 2,\r\n    _isCenterShown = undefined,\r\n    isReversed = false,\r\n    isBiface = false,\r\n\r\n    geometryObject = null,\r\n  }) {\r\n    if (id == undefined) id = uniqId(layer, 'shape');\r\n    else id = addInfoToId(id, layer, 'shape');\r\n    this.id = id;\r\n    this.layer = layer;\r\n    this.canvasLayer.shapes.push(this);\r\n\r\n    this.name = name;\r\n    this.familyName = familyName;\r\n\r\n    this.isPointed = isPointed; // used for path construcion, do not move\r\n    if (path) {\r\n      this.setSegmentsFromPath(path);\r\n      this._isCenterShown = false;\r\n      if (_isCenterShown === undefined) this.isCenterShown = this.isCircle();\r\n      else this.isCenterShown = _isCenterShown;\r\n      this.pointIds = [\r\n        ...this.pointIds,\r\n        ...divisionPointInfos.map((dInfo) => {\r\n          const segment = this.segments[dInfo.segmentIdx];\r\n          const newPoint = new Point({\r\n            layer: this.layer,\r\n            segmentIds: [segment.id],\r\n            shapeId: this.id,\r\n            type: 'divisionPoint',\r\n            coordinates: dInfo.coordinates,\r\n            ratio: dInfo.ratio,\r\n            color: dInfo.color,\r\n          });\r\n          segment.divisionPointIds.push(newPoint.id);\r\n          return newPoint.id;\r\n        }),\r\n      ];\r\n      if (this.isCircle() && app.environment.name != 'Geometrie') {\r\n        this.vertexes[0].visible = false;\r\n      }\r\n    } else {\r\n      this.pointIds = [...pointIds];\r\n      this.segmentIds = [...segmentIds];\r\n      this._isCenterShown = false;\r\n      if (_isCenterShown === undefined) this.isCenterShown = this.isCircle();\r\n      else this.isCenterShown = _isCenterShown;\r\n    }\r\n\r\n    this.strokeColor = strokeColor;\r\n    this.strokeWidth = strokeWidth;\r\n\r\n    this.size = parseInt(size);\r\n    this.isReversed = isReversed;\r\n    this.isBiface = isBiface;\r\n\r\n    if (segmentsColor) {\r\n      segmentsColor.forEach(\r\n        (segColor, idx) => (this.segments[idx].color = segColor),\r\n      );\r\n    }\r\n    if (pointsColor) {\r\n      pointsColor.forEach((ptColor, idx) => (this.points[idx].color = ptColor));\r\n    }\r\n\r\n    if (geometryObject) {\r\n      this.geometryObject = geometryObject;\r\n    }\r\n  }\r\n\r\n  /* #################################################################### */\r\n  /* ############################## GET/SET ############################# */\r\n  /* #################################################################### */\r\n\r\n  get canvasLayer() {\r\n    return app[this.layer + 'CanvasLayer'];\r\n  }\r\n\r\n  get segments() {\r\n    const segments = this.segmentIds.map((segId) =>\r\n      this.canvasLayer.segments.find((seg) => seg.id === segId),\r\n    );\r\n    return segments;\r\n  }\r\n\r\n  get points() {\r\n    const points = this.pointIds.map((ptId) =>\r\n      this.canvasLayer.points.find((pt) => pt.id === ptId),\r\n    );\r\n    return points;\r\n  }\r\n\r\n  get vertexes() {\r\n    const vertexes = this.points.filter((pt) => pt.type === 'vertex');\r\n    return vertexes;\r\n  }\r\n\r\n  get divisionPoints() {\r\n    const divisionPoints = this.points.filter(\r\n      (pt) => pt.type === 'divisionPoint',\r\n    );\r\n    return divisionPoints;\r\n  }\r\n\r\n  get center() {\r\n    const center = this.points.filter((pt) => pt.type === 'shapeCenter')[0];\r\n    return center;\r\n  }\r\n\r\n  get centerCoordinates() {\r\n    if (this.isCircle()) {\r\n      const center = this.segments[0].arcCenter;\r\n      return new Coordinates(center.coordinates);\r\n    } else {\r\n      let totalCoordinates = Coordinates.nullCoordinates;\r\n      this.vertexes.forEach((vertex) => {\r\n        totalCoordinates = totalCoordinates.add(vertex.coordinates);\r\n      });\r\n      const averageCoordinates = totalCoordinates.multiply(\r\n        1 / this.vertexes.length,\r\n      );\r\n      return averageCoordinates;\r\n    }\r\n  }\r\n\r\n  get isCenterShown() {\r\n    const isCenterShown = this._isCenterShown;\r\n    return isCenterShown;\r\n  }\r\n\r\n  set isCenterShown(value) {\r\n    if (value && !this.isCenterShown) {\r\n      const centerCoordinates = this.centerCoordinates;\r\n      new Point({\r\n        coordinates: centerCoordinates,\r\n        shapeId: this.id,\r\n        layer: this.layer,\r\n        type: 'shapeCenter',\r\n        // visible: this.isPointed,\r\n      });\r\n    } else if (!value && this.isCenterShown) {\r\n      const point = this.points.find((pt) => pt.type == 'shapeCenter');\r\n      if (app.environment.name == 'Geometrie' && point.layer == 'main') {\r\n        const shapesToDelete = [];\r\n        this.geometryObject.geometryChildShapeIds.forEach((sId) => {\r\n          const s = findObjectById(sId);\r\n          if (s && s.points.some((pt) => pt.reference == point.id)) {\r\n            shapesToDelete.push(s);\r\n          }\r\n        });\r\n        shapesToDelete.forEach((s) => {\r\n          if (app.environment.name == 'Geometrie') deleteChildren(s);\r\n          removeObjectById(s.id);\r\n        });\r\n        for (let i = 0; i < app.mainCanvasLayer.shapes.length; i++) {\r\n          const s = app.mainCanvasLayer.shapes[i];\r\n          s.points\r\n            .filter((pt) => pt.type != 'divisionPoint')\r\n            .forEach((pt) => {\r\n              if (pt.reference && !findObjectById(pt.reference))\r\n                pt.reference = null;\r\n            });\r\n          if (\r\n            s.geometryObject.geometryPointOnTheFlyChildId &&\r\n            !findObjectById(s.geometryObject.geometryPointOnTheFlyChildId)\r\n          ) {\r\n            deleteChildren(s);\r\n            i--;\r\n          }\r\n        }\r\n      }\r\n      const pointId = point.id;\r\n      removeObjectById(pointId);\r\n      const index = this.pointIds.findIndex((pt) => pt.id == pointId);\r\n      this.pointIds.splice(index, 1);\r\n    }\r\n    this._isCenterShown = value;\r\n  }\r\n\r\n  /**\r\n   * moyenne des vertexes et medianes, pour l'offset de cut\r\n   */\r\n  get fake_center() {\r\n    if (this.isCircle()) {\r\n      const center = this.segments[0].arcCenter;\r\n      return new Coordinates(center);\r\n    } else {\r\n      const total = {\r\n        x: 0,\r\n        y: 0,\r\n        amount: 0,\r\n      };\r\n      this.vertexes.forEach((vertex) => {\r\n        total.x += vertex.x;\r\n        total.y += vertex.y;\r\n        total.amount++;\r\n      });\r\n      this.segments.forEach((seg) => {\r\n        total.x += seg.middle.x;\r\n        total.y += seg.middle.y;\r\n        total.amount++;\r\n      });\r\n\r\n      return new Coordinates(total).multiply(1 / total.amount);\r\n    }\r\n  }\r\n\r\n  get bounds() {\r\n    const segmentBounds = this.segments.map((seg) => seg.bounds);\r\n    return Bounds.getOuterBounds(...segmentBounds);\r\n  }\r\n\r\n  getCommonsCoordinates(shape) {\r\n    const commonsCoordinates = [];\r\n    this.points.forEach((point1) => {\r\n      shape.points.forEach((point2) => {\r\n        if (point1.coordinates.equal(point2.coordinates))\r\n          commonsCoordinates.push(point1.coordinates);\r\n      });\r\n    });\r\n    return commonsCoordinates;\r\n  }\r\n\r\n  getArcCenterFromSVG(\r\n    firstVertex,\r\n    lastVertex,\r\n    radius,\r\n    largeArcFlag,\r\n    sweepFlag,\r\n  ) {\r\n    let middle = firstVertex.coordinates\r\n        .add(lastVertex.coordinates)\r\n        .multiply(1 / 2),\r\n      isHorizontal = Math.abs(firstVertex.y - lastVertex.y) < 0.01,\r\n      isVertical = Math.abs(firstVertex.x - lastVertex.x) < 0.01,\r\n      distanceMiddleArcCenter = Math.sqrt(\r\n        Math.pow(radius, 2) -\r\n          (Math.pow(firstVertex.x - lastVertex.x, 2) +\r\n            Math.pow(firstVertex.y - lastVertex.y, 2)) /\r\n            4,\r\n      );\r\n\r\n    if (isNaN(distanceMiddleArcCenter)) distanceMiddleArcCenter = 0;\r\n\r\n    let theta, arcCenterCoordinates;\r\n    // theta is the angle between the segment firstvertex - lastvertex and the x-axis\r\n\r\n    if (isHorizontal) {\r\n      theta = firstVertex.x < lastVertex.x ? 0 : Math.PI;\r\n    } else if (isVertical) {\r\n      theta = firstVertex.y < lastVertex.y ? Math.PI / 2 : (Math.PI * 3) / 2;\r\n    } else {\r\n      theta = Math.atan2(\r\n        lastVertex.y - firstVertex.y,\r\n        lastVertex.x - firstVertex.x,\r\n      );\r\n    }\r\n\r\n    if (largeArcFlag !== sweepFlag) {\r\n      arcCenterCoordinates = middle.add({\r\n        x: distanceMiddleArcCenter * Math.cos(theta + Math.PI / 2),\r\n        y: distanceMiddleArcCenter * Math.sin(theta + Math.PI / 2),\r\n      });\r\n    } else {\r\n      arcCenterCoordinates = middle.add({\r\n        x: distanceMiddleArcCenter * Math.cos(theta - Math.PI / 2),\r\n        y: distanceMiddleArcCenter * Math.sin(theta - Math.PI / 2),\r\n      });\r\n    }\r\n    const arcCenter = new Point({\r\n      layer: this.layer,\r\n      coordinates: arcCenterCoordinates,\r\n      shapeId: this.id,\r\n      type: 'arcCenter',\r\n      visible: false,\r\n    });\r\n\r\n    return arcCenter;\r\n  }\r\n\r\n  /* #################################################################### */\r\n  /* ################################ IS ################################ */\r\n  /* #################################################################### */\r\n\r\n  isCircle() {\r\n    return false;\r\n  }\r\n\r\n  isSegment() {\r\n    return false;\r\n  }\r\n\r\n  isCircleArc() {\r\n    return false;\r\n  }\r\n\r\n  isStraightLine() {\r\n    return false;\r\n  }\r\n\r\n  isSemiStraightLine() {\r\n    return false;\r\n  }\r\n\r\n  isPoint() {\r\n    return false;\r\n  }\r\n\r\n  contains(object) {\r\n    if (object instanceof Point) {\r\n      if (\r\n        this.allOutlinePoints.some((outline_point) =>\r\n          outline_point.equal(object),\r\n        )\r\n      )\r\n        return true;\r\n      if (this.isCenterShown && this.center.equal(object)) return true;\r\n      return false;\r\n    } else if (object instanceof Segment) {\r\n      if (this.segments.some((segment) => segment.equal(object))) return true;\r\n      return false;\r\n    } else if (object instanceof Coordinates) {\r\n      if (this.points.some((pt) => pt.coordinates.equal(object))) return true;\r\n      // if (this.isCenterShown && this.center.equal(object)) return true;\r\n      return false;\r\n    } else {\r\n      console.info('unsupported object');\r\n      return false;\r\n    }\r\n  }\r\n\r\n  isCoordinatesOnBorder(coordinates) {\r\n    return this.segments.some((seg) => seg.isCoordinatesOnSegment(coordinates));\r\n  }\r\n\r\n  isCoordinatesInPath(coordinates) {\r\n    return false;\r\n  }\r\n\r\n  isSegmentInside(segment) {\r\n    return false;\r\n  }\r\n\r\n  /* #################################################################### */\r\n  /* ############################# OVERLAP ############################## */\r\n  /* #################################################################### */\r\n\r\n  /**\r\n   * V├®rifie si cette figure se superpose avec une autre figure.\r\n   * @param  {Shape} shape L'autre figure\r\n   * @return {overlap}     true: si les 2 figures se superposent\r\n   *    consid├®r├® vrai si deux segments sont confondu mais n'ont qu'un point commun ! => peut-etre probleme dans environnement libre\r\n   */\r\n  overlapsWith(shape) {\r\n    if (this.isThisInsideAnotherShape(shape)) return true;\r\n    if (shape.isThisInsideAnotherShape(this)) return true;\r\n\r\n    if (this.doesIntersectAnotherShape(this.segments, shape.segments))\r\n      return true;\r\n\r\n    return false;\r\n  }\r\n\r\n  isThisInsideAnotherShape(shape) {\r\n    const s1_segments = this.segments,\r\n      s2_segments = shape.segments;\r\n    for (const s1_segment of s1_segments) {\r\n      if (\r\n        s2_segments.some(\r\n          (s2_segment) =>\r\n            s2_segment.contains(s1_segment) || s1_segment.contains(s2_segment),\r\n        )\r\n      )\r\n        continue;\r\n      if (\r\n        shape.isCoordinatesInPath(s1_segment.vertexes[0].coordinates) &&\r\n        shape.isCoordinatesInPath(s1_segment.vertexes[1].coordinates) &&\r\n        shape.isCoordinatesInPath(s1_segment.middle) &&\r\n        !(\r\n          shape.isCoordinatesOnBorder(s1_segment.vertexes[0].coordinates) &&\r\n          shape.isCoordinatesOnBorder(s1_segment.vertexes[1].coordinates) &&\r\n          shape.isCoordinatesOnBorder(s1_segment.middle)\r\n        )\r\n      ) {\r\n        console.info('shape inside another');\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  doesIntersectAnotherShape(s1_segments, s2_segments) {\r\n    if (\r\n      s1_segments.some((s1_segment) =>\r\n        s2_segments.some((s2_segment) =>\r\n          s1_segment.doesIntersect(s2_segment, true),\r\n        ),\r\n      )\r\n    ) {\r\n      console.info('shape intersects another');\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /* #################################################################### */\r\n  /* ############################ TRANSFORM ############################# */\r\n  /* #################################################################### */\r\n\r\n  reverse() {\r\n    this.segments.forEach((seg) => {\r\n      if (seg.arcCenter) seg.counterclockwise = !seg.counterclockwise;\r\n    });\r\n    if (this.isBiface) this.color = getComplementaryColor(this.color);\r\n    this.isReversed = !this.isReversed;\r\n  }\r\n\r\n  /**\r\n   * move the shape with coordinates\r\n   * @param {Coordinates} coordinates\r\n   * @param {Boolean} negativeTranslation true if the coordinates must be reversed\r\n   */\r\n  translate(coordinates, negativeTranslation = false) {\r\n    if (negativeTranslation) coordinates = coordinates.multiply(-1);\r\n    this.points.forEach((pt) => pt.translate(coordinates));\r\n  }\r\n\r\n  /**\r\n   * scale the shape with scaleRatio\r\n   * @param {Number}    scaleRatio\r\n   */\r\n  scale(scaleRatio) {\r\n    this.points.forEach((pt) => pt.multiply(scaleRatio));\r\n  }\r\n\r\n  /**\r\n   * Applique une homoth├®tie\r\n   * @param {Number} scaling   scale factor\r\n   * @param {Point}  center    center of the transformation\r\n   */\r\n  homothety(scaling, center = Coordinates.nullCoordinates) {\r\n    const saveCenter = new Coordinates(center);\r\n    const newCenter = center.multiply(scaling);\r\n    this.scale(scaling);\r\n    this.translate(saveCenter.substract(newCenter));\r\n  }\r\n\r\n  rotate(angle, center) {\r\n    this.points.forEach(\r\n      (pt) => (pt.coordinates = pt.coordinates.rotate(angle, center)),\r\n    );\r\n  }\r\n\r\n  recomputeSegmentPoints() {\r\n    this.segments.forEach((seg) => {\r\n      seg.points.forEach((pt) => pt.recomputeSegmentPoint());\r\n    });\r\n  }\r\n\r\n  /* #################################################################### */\r\n  /* ############################## OTHER ############################### */\r\n  /* #################################################################### */\r\n\r\n  /**\r\n   * convertit la shape en commande de path svg\r\n   */\r\n  getSVGPath(scaling = 'scale', infiniteCheck = true) {\r\n    // if (this.isPoint()) {\r\n    //   path = `M ${this.points[0].coordinates.x} ${this.points[0].coordinates.y}`\r\n    // } else {\r\n    const path = this.segments\r\n      .map((seg) => seg.getSVGPath(scaling, false, infiniteCheck))\r\n      .join('\\n');\r\n    // }\r\n    return path;\r\n  }\r\n\r\n  /**\r\n   * convertit la shape en balise path de svg\r\n   */\r\n  toSVG() {\r\n    const path = this.getSVGPath();\r\n\r\n    const attributes = {\r\n      d: path,\r\n      fill: this.fillColor,\r\n      'fill-opacity': this.fillOpacity,\r\n      stroke: this.strokeColor,\r\n      'stroke-opacity': 1, // toujours ├á 1 ?\r\n      'stroke-width': this.strokeWidth,\r\n    };\r\n\r\n    let path_tag = '<path';\r\n    for (const [key, value] of Object.entries(attributes)) {\r\n      path_tag += ' ' + key + '=\"' + value + '\"';\r\n    }\r\n    path_tag += '/>\\n';\r\n\r\n    let point_tags = '';\r\n    if (app.settings.areShapesPointed && this.name != 'silhouette') {\r\n      if (this.isSegment())\r\n        point_tags += this.segments[0].vertexes[0].toSVG('#000', 1);\r\n      if (!this.isCircle())\r\n        this.segments.forEach(\r\n          (seg) => (point_tags += seg.vertexes[1].toSVG('#000', 1)),\r\n        );\r\n    }\r\n\r\n    this.segments.forEach((seg) => {\r\n      //Points sur les segments\r\n      seg.divisionPoints.forEach((pt) => {\r\n        point_tags += pt.toSVG('#000', 1);\r\n      });\r\n    });\r\n    if (this.isCenterShown) point_tags += this.center.toSVG('#000', 1);\r\n\r\n    const comment =\r\n      '<!-- ' + this.name.replace('├®', 'e').replace('├¿', 'e') + ' -->\\n';\r\n\r\n    return comment + path_tag + point_tags + '\\n';\r\n  }\r\n\r\n  cleanSameDirectionSegment() {\r\n    for (let i = 0; i < this.segments.length; i++) {\r\n      const nextIdx = mod(i + 1, this.segmentIds.length);\r\n      if (nextIdx == i) break;\r\n      if (\r\n        this.segments[i].hasSameDirection(this.segments[nextIdx], 1, 0, false)\r\n      ) {\r\n        const middlePointId = this.segments[i].vertexIds[1];\r\n        const ptIdx = this.pointIds.findIndex((ptId) => ptId == middlePointId);\r\n        this.pointIds.splice(ptIdx, 1);\r\n        removeObjectById(middlePointId);\r\n        this.segments[i].vertexIds[1] = this.segments[nextIdx].vertexIds[1];\r\n        let idx = this.segments[i].vertexes[1].segmentIds.findIndex(\r\n          (id) => id == this.segmentIds[nextIdx],\r\n        );\r\n        this.segments[i].vertexes[1].segmentIds[idx] = this.segments[i].id;\r\n        if (this.segments[nextIdx].arcCenterId) {\r\n          removeObjectById(this.segments[nextIdx].arcCenterId);\r\n          idx = this.pointIds.findIndex(\r\n            (id) => id == this.segments[nextIdx].arcCenterId,\r\n          );\r\n          this.pointIds.splice(idx, 1);\r\n        }\r\n        removeObjectById(this.segmentIds[nextIdx]);\r\n        this.segmentIds.splice(nextIdx, 1);\r\n        i--; // try to merge this new segment again!\r\n      }\r\n    }\r\n    this.segments.forEach((seg, idx) => (seg.idx = idx));\r\n    this.vertexes.forEach((vx, idx) => (vx.idx = idx));\r\n  }\r\n\r\n  // check if property is different from default value is for save size reduction\r\n  saveData() {\r\n    const data = {\r\n      id: this.id,\r\n      position: this.layer,\r\n      type: 'Shape',\r\n\r\n      path: this.getSVGPath(false),\r\n      segmentIds: [...this.segmentIds],\r\n      pointIds: [...this.pointIds],\r\n\r\n      // name: this.name,\r\n      // familyName: this.familyName,\r\n\r\n      // strokeColor: this.strokeColor,\r\n      // strokeWidth: this.strokeWidth,\r\n\r\n      // isPointed: this.isPointed,\r\n      // size: this.size,\r\n      _isCenterShown: this.isCenterShown,\r\n      // isReversed: this.isReversed,\r\n      // isBiface: this.isBiface,\r\n\r\n      // isOverlappingAnotherInTangram: this.isOverlappingAnotherInTangram,\r\n    };\r\n    if (this.name !== 'Custom') data.name = this.name;\r\n    if (this.familyName !== 'Custom') data.familyName = this.familyName;\r\n    if (this.strokeColor !== '#000') data.strokeColor = this.strokeColor;\r\n    if (this.strokeWidth !== 1) data.strokeWidth = this.strokeWidth;\r\n    if (this.isPointed !== true) data.isPointed = this.isPointed;\r\n    if (this.size !== 2) data.size = this.size;\r\n    if (this.isReversed !== false) data.isReversed = this.isReversed;\r\n    if (this.isBiface !== false) data.isBiface = this.isBiface;\r\n\r\n    if (this.isOverlappingAnotherInTangram)\r\n      data.isOverlappingAnotherInTangram = this.isOverlappingAnotherInTangram;\r\n\r\n    if (this.geometryObject) {\r\n      data.geometryObject = this.geometryObject.saveData();\r\n    }\r\n    return data;\r\n  }\r\n\r\n  static loadFromData(data) {\r\n    if (!data.position) data.position = 'main';\r\n    const shape = new Shape({ layer: data.position });\r\n    Object.assign(shape, data);\r\n    shape.segmentIds = [...data.segmentIds];\r\n    shape.pointIds = [...data.pointIds];\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Objects\\Shapes\\SinglePointShape.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used. Allowed unused args must match /^_/u.","line":15,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":7,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[405,408],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'layer' is defined but never used. Allowed unused args must match /^_/u.","line":16,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":10,"suggestions":[{"messageId":"removeVar","data":{"varName":"layer"},"fix":{"range":[407,419],"text":""},"desc":"Remove unused variable 'layer'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'path' is assigned a value but never used. Allowed unused args must match /^_/u.","line":18,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":9,"suggestions":[{"messageId":"removeVar","data":{"varName":"path"},"fix":{"range":[419,444],"text":""},"desc":"Remove unused variable 'path'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'segmentIds' is assigned a value but never used. Allowed unused args must match /^_/u.","line":19,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"segmentIds"},"fix":{"range":[444,466],"text":""},"desc":"Remove unused variable 'segmentIds'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'pointIds' is assigned a value but never used. Allowed unused args must match /^_/u.","line":20,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"pointIds"},"fix":{"range":[466,486],"text":""},"desc":"Remove unused variable 'pointIds'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'divisionPointInfos' is assigned a value but never used. Allowed unused args must match /^_/u.","line":21,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":23,"suggestions":[{"messageId":"removeVar","data":{"varName":"divisionPointInfos"},"fix":{"range":[486,516],"text":""},"desc":"Remove unused variable 'divisionPointInfos'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'name' is assigned a value but never used. Allowed unused args must match /^_/u.","line":23,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":9,"suggestions":[{"messageId":"removeVar","data":{"varName":"name"},"fix":{"range":[516,540],"text":""},"desc":"Remove unused variable 'name'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'familyName' is assigned a value but never used. Allowed unused args must match /^_/u.","line":24,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"familyName"},"fix":{"range":[540,568],"text":""},"desc":"Remove unused variable 'familyName'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'strokeColor' is assigned a value but never used. Allowed unused args must match /^_/u.","line":26,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"strokeColor"},"fix":{"range":[568,597],"text":""},"desc":"Remove unused variable 'strokeColor'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'strokeWidth' is assigned a value but never used. Allowed unused args must match /^_/u.","line":27,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"strokeWidth"},"fix":{"range":[597,619],"text":""},"desc":"Remove unused variable 'strokeWidth'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'isPointed' is assigned a value but never used. Allowed unused args must match /^_/u.","line":29,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":29,"endColumn":14,"suggestions":[{"messageId":"removeVar","data":{"varName":"isPointed"},"fix":{"range":[619,644],"text":""},"desc":"Remove unused variable 'isPointed'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'size' is assigned a value but never used. Allowed unused args must match /^_/u.","line":30,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":30,"endColumn":9,"suggestions":[{"messageId":"removeVar","data":{"varName":"size"},"fix":{"range":[644,659],"text":""},"desc":"Remove unused variable 'size'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'isReversed' is assigned a value but never used. Allowed unused args must match /^_/u.","line":32,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"isReversed"},"fix":{"range":[692,717],"text":""},"desc":"Remove unused variable 'isReversed'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'isBiface' is assigned a value but never used. Allowed unused args must match /^_/u.","line":33,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":33,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"isBiface"},"fix":{"range":[717,740],"text":""},"desc":"Remove unused variable 'isBiface'."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":106,"column":54,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":106,"endColumn":56,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2934,2936],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":107,"column":32,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":107,"endColumn":34,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2985,2987],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":107,"column":62,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":107,"endColumn":64,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3015,3017],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":111,"column":55,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":111,"endColumn":57,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3231,3233],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":116,"column":36,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":116,"endColumn":38,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3387,3389],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":122,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":122,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[3650,3652],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":138,"column":59,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":138,"endColumn":61,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4201,4203],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'firstVertex' is defined but never used. Allowed unused vars must match /^_/u.","line":148,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":148,"endColumn":20,"suggestions":[{"messageId":"removeVar","data":{"varName":"firstVertex"},"fix":{"range":[4443,4455],"text":""},"desc":"Remove unused variable 'firstVertex'."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":157,"column":28,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":157,"endColumn":30,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[4632,4634],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'startVertex' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":177,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":177,"endColumn":22},{"ruleId":"no-unused-vars","severity":1,"message":"'lastVertex' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":177,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":177,"endColumn":35},{"ruleId":"prefer-const","severity":1,"message":"'middle' is never reassigned. Use 'const' instead.","line":244,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":244,"endColumn":15},{"ruleId":"prefer-const","severity":1,"message":"'isHorizontal' is never reassigned. Use 'const' instead.","line":247,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":247,"endColumn":19},{"ruleId":"prefer-const","severity":1,"message":"'isVertical' is never reassigned. Use 'const' instead.","line":248,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":248,"endColumn":17},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":300,"column":17,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":300,"endColumn":19,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8765,8767],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":437,"column":17,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":437,"endColumn":19,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[13374,13376],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":479,"column":52,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":479,"endColumn":54,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[14478,14480],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":509,"column":19,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":509,"endColumn":21,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[15428,15430],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":514,"column":62,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":514,"endColumn":64,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[15668,15670],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":519,"column":22,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":519,"endColumn":24,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[15940,15942],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":525,"column":24,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":525,"endColumn":26,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[16240,16242],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":15,"fatalErrorCount":0,"warningCount":20,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app } from '../../App';\r\nimport {\r\n  getComplementaryColor,\r\n  mod,\r\n  removeObjectById,\r\n} from '../../Tools/general';\r\nimport { Bounds } from '../Bounds';\r\nimport { Coordinates } from '../Coordinates';\r\nimport { Point } from '../Point';\r\nimport { GeometryObject } from './GeometryObject';\r\nimport { Shape } from './Shape';\r\n\r\nexport class SinglePointShape extends Shape {\r\n  constructor({\r\n    id,\r\n    layer,\r\n\r\n    path = undefined,\r\n    segmentIds = [],\r\n    pointIds = [],\r\n    divisionPointInfos = [],\r\n\r\n    name = 'Custom',\r\n    familyName = 'Custom',\r\n\r\n    strokeColor = '#000',\r\n    strokeWidth = 1,\r\n\r\n    isPointed = true,\r\n    size = 2,\r\n    _isCenterShown = undefined,\r\n    isReversed = false,\r\n    isBiface = false,\r\n  }) {\r\n    super(arguments[0]);\r\n  }\r\n\r\n  /* #################################################################### */\r\n  /* ############################## GET/SET ############################# */\r\n  /* #################################################################### */\r\n\r\n  get segments() {\r\n    const segments = this.segmentIds.map((segId) =>\r\n      this.canvasLayer.segments.find((seg) => seg.id === segId),\r\n    );\r\n    return segments;\r\n  }\r\n\r\n  get points() {\r\n    // if (this.isCircle() && app.environment.name !== 'Geometrie') => doit-on inclure le point du cercle dans Grandeurs et Cubes ?\r\n    const points = this.pointIds.map((ptId) =>\r\n      this.canvasLayer.points.find((pt) => pt.id === ptId),\r\n    );\r\n    return points;\r\n  }\r\n\r\n  get vertexes() {\r\n    const vertexes = this.points.filter((pt) => pt.type === 'vertex');\r\n    return vertexes;\r\n  }\r\n\r\n  get divisionPoints() {\r\n    const divisionPoints = this.points.filter(\r\n      (pt) => pt.type === 'divisionPoint',\r\n    );\r\n    return divisionPoints;\r\n  }\r\n\r\n  get center() {\r\n    const center = this.points.filter((pt) => pt.type === 'shapeCenter')[0];\r\n    return center;\r\n  }\r\n\r\n  get centerCoordinates() {\r\n    if (this.isCircle()) {\r\n      const center = this.segments[0].arcCenter;\r\n      return new Coordinates(center.coordinates);\r\n    } else {\r\n      let totalCoordinates = Coordinates.nullCoordinates;\r\n      this.vertexes.forEach((vertex) => {\r\n        totalCoordinates = totalCoordinates.add(vertex.coordinates);\r\n      });\r\n      const averageCoordinates = totalCoordinates.multiply(\r\n        1 / this.vertexes.length,\r\n      );\r\n      return averageCoordinates;\r\n    }\r\n  }\r\n\r\n  get isCenterShown() {\r\n    const isCenterShown = this._isCenterShown;\r\n    return isCenterShown;\r\n  }\r\n\r\n  set isCenterShown(value) {\r\n    if (value && !this.isCenterShown) {\r\n      const centerCoordinates = this.centerCoordinates;\r\n      new Point({\r\n        coordinates: centerCoordinates,\r\n        shapeId: this.id,\r\n        layer: this.layer,\r\n        type: 'shapeCenter',\r\n        // visible: this.isPointed,\r\n      });\r\n    } else if (!value && this.isCenterShown) {\r\n      const point = this.points.find((pt) => pt.type == 'shapeCenter');\r\n      if (app.environment.name == 'Geometrie' && point.layer == 'main') {\r\n        const shapesToDelete = [];\r\n        this.geometryObject.geometryChildShapeIds.forEach((sId) => {\r\n          const s = findObjectById(sId);\r\n          if (s && s.points.some((pt) => pt.reference == point.id)) {\r\n            shapesToDelete.push(s);\r\n          }\r\n        });\r\n        shapesToDelete.forEach((s) => {\r\n          if (app.environment.name == 'Geometrie') deleteChildren(s);\r\n          removeObjectById(s.id);\r\n        });\r\n        for (let i = 0; i < app.mainCanvasLayer.shapes.length; i++) {\r\n          const s = app.mainCanvasLayer.shapes[i];\r\n          s.points\r\n            .filter((pt) => pt.type != 'divisionPoint')\r\n            .forEach((pt) => {\r\n              if (pt.reference && !findObjectById(pt.reference))\r\n                pt.reference = null;\r\n            });\r\n          if (\r\n            s.geometryObject.geometryPointOnTheFlyChildId &&\r\n            !findObjectById(s.geometryObject.geometryPointOnTheFlyChildId)\r\n          ) {\r\n            deleteChildren(s);\r\n            i--;\r\n          }\r\n        }\r\n      }\r\n      const pointId = point.id;\r\n      removeObjectById(pointId);\r\n      const index = this.pointIds.findIndex((pt) => pt.id == pointId);\r\n      this.pointIds.splice(index, 1);\r\n    }\r\n    this._isCenterShown = value;\r\n  }\r\n\r\n  setSegmentsFromPath(path) {\r\n    const allPathElements = path\r\n      .split(/[ \\n]/)\r\n      .filter((element) => element !== '');\r\n    let firstVertex, lastVertex, startVertex;\r\n\r\n    let vertexIdx = 0;\r\n\r\n    this.pointIds = [];\r\n    this.segmentIds = [];\r\n\r\n    let nextVertexCoordinates = null;\r\n\r\n    if (allPathElements[0] != 'M')\r\n      startVertex = lastVertex = new Point({\r\n        coordinates: Coordinates.nullCoordinates,\r\n        shapeId: this.id,\r\n        layer: this.layer,\r\n        type: 'vertex',\r\n        idx: vertexIdx++,\r\n        visible: this.isPointed,\r\n      });\r\n\r\n    while (allPathElements.length) {\r\n      const element = allPathElements.shift();\r\n\r\n      switch (element) {\r\n        case 'M':\r\n        case 'm':\r\n          nextVertexCoordinates = new Coordinates({\r\n            x: allPathElements.shift(),\r\n            y: allPathElements.shift(),\r\n          });\r\n          startVertex = lastVertex = new Point({\r\n            coordinates: nextVertexCoordinates,\r\n            shapeId: this.id,\r\n            layer: this.layer,\r\n            type: 'vertex',\r\n            idx: vertexIdx++,\r\n            visible: this.isPointed,\r\n          });\r\n          break;\r\n\r\n        default:\r\n          break;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * moyenne des vertexes et medianes, pour l'offset de cut\r\n   */\r\n  get fake_center() {\r\n    if (this.isCircle()) {\r\n      const center = this.segments[0].arcCenter;\r\n      return new Coordinates(center);\r\n    } else {\r\n      const total = {\r\n        x: 0,\r\n        y: 0,\r\n        amount: 0,\r\n      };\r\n      this.vertexes.forEach((vertex) => {\r\n        total.x += vertex.x;\r\n        total.y += vertex.y;\r\n        total.amount++;\r\n      });\r\n      this.segments.forEach((seg) => {\r\n        total.x += seg.middle.x;\r\n        total.y += seg.middle.y;\r\n        total.amount++;\r\n      });\r\n\r\n      return new Coordinates(total).multiply(1 / total.amount);\r\n    }\r\n  }\r\n\r\n  get bounds() {\r\n    const segmentBounds = this.segments.map((seg) => seg.bounds);\r\n    return Bounds.getOuterBounds(...segmentBounds);\r\n  }\r\n\r\n  getCommonsCoordinates(shape) {\r\n    const commonsCoordinates = [];\r\n    this.points.forEach((point1) => {\r\n      shape.points.forEach((point2) => {\r\n        if (point1.coordinates.equal(point2.coordinates))\r\n          commonsCoordinates.push(point1.coordinates);\r\n      });\r\n    });\r\n    return commonsCoordinates;\r\n  }\r\n\r\n  getArcCenterFromSVG(\r\n    firstVertex,\r\n    lastVertex,\r\n    radius,\r\n    largeArcFlag,\r\n    sweepFlag,\r\n  ) {\r\n    let middle = firstVertex.coordinates\r\n        .add(lastVertex.coordinates)\r\n        .multiply(1 / 2),\r\n      isHorizontal = Math.abs(firstVertex.y - lastVertex.y) < 0.01,\r\n      isVertical = Math.abs(firstVertex.x - lastVertex.x) < 0.01,\r\n      distanceMiddleArcCenter = Math.sqrt(\r\n        Math.pow(radius, 2) -\r\n          (Math.pow(firstVertex.x - lastVertex.x, 2) +\r\n            Math.pow(firstVertex.y - lastVertex.y, 2)) /\r\n            4,\r\n      );\r\n\r\n    if (isNaN(distanceMiddleArcCenter)) distanceMiddleArcCenter = 0;\r\n\r\n    let theta, arcCenterCoordinates;\r\n    // theta is the angle between the segment firstvertex - lastvertex and the x-axis\r\n\r\n    if (isHorizontal) {\r\n      theta = firstVertex.x < lastVertex.x ? 0 : Math.PI;\r\n    } else if (isVertical) {\r\n      theta = firstVertex.y < lastVertex.y ? Math.PI / 2 : (Math.PI * 3) / 2;\r\n    } else {\r\n      theta = Math.atan2(\r\n        lastVertex.y - firstVertex.y,\r\n        lastVertex.x - firstVertex.x,\r\n      );\r\n    }\r\n\r\n    if (largeArcFlag !== sweepFlag) {\r\n      arcCenterCoordinates = middle.add({\r\n        x: distanceMiddleArcCenter * Math.cos(theta + Math.PI / 2),\r\n        y: distanceMiddleArcCenter * Math.sin(theta + Math.PI / 2),\r\n      });\r\n    } else {\r\n      arcCenterCoordinates = middle.add({\r\n        x: distanceMiddleArcCenter * Math.cos(theta - Math.PI / 2),\r\n        y: distanceMiddleArcCenter * Math.sin(theta - Math.PI / 2),\r\n      });\r\n    }\r\n    const arcCenter = new Point({\r\n      layer: this.layer,\r\n      coordinates: arcCenterCoordinates,\r\n      shapeId: this.id,\r\n      type: 'arcCenter',\r\n      visible: false,\r\n    });\r\n\r\n    return arcCenter;\r\n  }\r\n\r\n  setCtxForDrawing(ctx, scaling) {\r\n    ctx.strokeStyle = this.strokeColor;\r\n    ctx.fillStyle = this.fillColor;\r\n    if (this.isOverlappingAnotherInTangram) ctx.fillStyle = '#F00';\r\n    ctx.globalAlpha = this.fillOpacity;\r\n    ctx.lineWidth = this.strokeWidth * app.workspace.zoomLevel;\r\n    if (scaling == 'no scale') ctx.lineWidth = this.strokeWidth;\r\n  }\r\n\r\n  /* #################################################################### */\r\n  /* ################################ IS ################################ */\r\n  /* #################################################################### */\r\n\r\n  isPoint() {\r\n    return true;\r\n  }\r\n\r\n  /* #################################################################### */\r\n  /* ############################# OVERLAP ############################## */\r\n  /* #################################################################### */\r\n\r\n  /**\r\n   * V├®rifie si cette figure se superpose avec une autre figure.\r\n   * @param  {Shape} shape L'autre figure\r\n   * @return {overlap}     true: si les 2 figures se superposent\r\n   *    consid├®r├® vrai si deux segments sont confondu mais n'ont qu'un point commun ! => peut-etre probleme dans environnement libre\r\n   */\r\n  overlapsWith(shape) {\r\n    const s1 = this,\r\n      s2 = shape,\r\n      s1_segments = s1.segments,\r\n      s2_segments = s2.segments;\r\n\r\n    // s1 in s2 ? if a point of s1 is in s2\r\n    if (this.isThisInsideAnotherShape(shape)) return true;\r\n    // s2 in s1 ? if a point of s2 is in s1\r\n    if (shape.isThisInsideAnotherShape(this)) return true;\r\n\r\n    // check if intersect segments\r\n    if (this.doesThisIntersectAnotherShape(s1_segments, s2_segments))\r\n      return true;\r\n\r\n    return false;\r\n  }\r\n\r\n  isThisInsideAnotherShape(shape) {\r\n    const s1_segments = this.segments,\r\n      s2_segments = shape.segments;\r\n    for (const s1_segment of s1_segments) {\r\n      if (\r\n        s2_segments.some(\r\n          (s2_segment) =>\r\n            s2_segment.contains(s1_segment) || s1_segment.contains(s2_segment),\r\n        )\r\n      )\r\n        continue;\r\n      if (\r\n        shape.isCoordinatesInPath(s1_segment.vertexes[0].coordinates) &&\r\n        shape.isCoordinatesInPath(s1_segment.vertexes[1].coordinates) &&\r\n        shape.isCoordinatesInPath(s1_segment.middle) &&\r\n        !(\r\n          shape.isCoordinatesOnBorder(s1_segment.vertexes[0].coordinates) &&\r\n          shape.isCoordinatesOnBorder(s1_segment.vertexes[1].coordinates) &&\r\n          shape.isCoordinatesOnBorder(s1_segment.middle)\r\n        )\r\n      ) {\r\n        console.info('shape inside another');\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  doesThisIntersectAnotherShape(s1_segments, s2_segments) {\r\n    if (\r\n      s1_segments.some((s1_segment) =>\r\n        s2_segments.some((s2_segment) =>\r\n          s1_segment.doesIntersect(s2_segment, true),\r\n        ),\r\n      )\r\n    ) {\r\n      console.info('shape intersects another');\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /* #################################################################### */\r\n  /* ############################ TRANSFORM ############################# */\r\n  /* #################################################################### */\r\n\r\n  reverse() {\r\n    this.segments.forEach((seg) => {\r\n      if (seg.arcCenter) seg.counterclockwise = !seg.counterclockwise;\r\n    });\r\n    if (this.isBiface) this.fillColor = getComplementaryColor(this.fillColor);\r\n    this.isReversed = !this.isReversed;\r\n  }\r\n\r\n  /**\r\n   * move the shape with coordinates\r\n   * @param {Coordinates} coordinates\r\n   * @param {Boolean} negativeTranslation true if the coordinates must be reversed\r\n   */\r\n  translate(coordinates, negativeTranslation = false) {\r\n    this.points.forEach((pt) => pt.translate(coordinates, negativeTranslation));\r\n  }\r\n\r\n  /**\r\n   * scale the shape with scaleRatio\r\n   * @param {Number}    scaleRatio\r\n   */\r\n  scale(scaleRatio) {\r\n    this.points.forEach((pt) => pt.multiply(scaleRatio));\r\n  }\r\n\r\n  /**\r\n   * Applique une homoth├®tie\r\n   * @param {Number} scaling   scale factor\r\n   * @param {Point}  center    center of the transformation\r\n   */\r\n  homothety(scaling, center = Coordinates.nullCoordinates) {\r\n    const saveCenter = new Coordinates(center);\r\n    const newCenter = center.multiply(scaling);\r\n    this.scale(scaling);\r\n    this.translate(saveCenter.substract(newCenter));\r\n  }\r\n\r\n  rotate(angle, center) {\r\n    this.points.forEach(\r\n      (pt) => (pt.coordinates = pt.coordinates.rotate(angle, center)),\r\n    );\r\n  }\r\n\r\n  /* #################################################################### */\r\n  /* ############################## OTHER ############################### */\r\n  /* #################################################################### */\r\n\r\n  /**\r\n   * convertit la shape en commande de path svg\r\n   */\r\n  getSVGPath(scaling = 'scale') {\r\n    let pointsCoordinates = this.points.map((pt) => pt.coordinates);\r\n    if (scaling == 'scale') {\r\n      pointsCoordinates = pointsCoordinates.map((coord) =>\r\n        coord.toCanvasCoordinates(),\r\n      );\r\n    }\r\n    const path = pointsCoordinates\r\n      .map((coord) => `M ${coord.x} ${coord.y}`)\r\n      .join(' ');\r\n    return path;\r\n  }\r\n\r\n  /**\r\n   * convertit la shape en balise path de svg\r\n   */\r\n  toSVG() {\r\n    if (\r\n      this.geometryObject &&\r\n      (this.geometryObject.geometryIsVisible === false ||\r\n        this.geometryObject.geometryIsHidden === true ||\r\n        this.geometryObject.geometryIsConstaintDraw === true)\r\n    ) {\r\n      return '';\r\n    }\r\n\r\n    const path = this.getSVGPath();\r\n\r\n    const attributes = {\r\n      d: path,\r\n      stroke: this.strokeColor,\r\n      fill: '#000',\r\n      'fill-opacity': 0,\r\n      'stroke-width': this.strokeWidth,\r\n      'stroke-opacity': 1, // toujours ├á 1 ?\r\n    };\r\n\r\n    let path_tag = '<path';\r\n    for (const [key, value] of Object.entries(attributes)) {\r\n      path_tag += ' ' + key + '=\"' + value + '\"';\r\n    }\r\n    path_tag += '/>\\n';\r\n\r\n    const pointToDraw = [];\r\n    if (app.settings.areShapesPointed && this.name != 'silhouette') {\r\n      if (this.isSegment()) pointToDraw.push(this.segments[0].vertexes[0]);\r\n      if (!this.isCircle())\r\n        this.segments.forEach((seg) => pointToDraw.push(seg.vertexes[1]));\r\n    }\r\n\r\n    this.segments.forEach((seg) => {\r\n      //Points sur les segments\r\n      seg.divisionPoints.forEach((pt) => {\r\n        pointToDraw.push(pt);\r\n      });\r\n    });\r\n    if (this.isCenterShown) pointToDraw.push(this.center);\r\n\r\n    const point_tags = pointToDraw\r\n      .filter((pt) => {\r\n        pt.visible && pt.geometryIsVisible && !pt.geometryIsHidden;\r\n      })\r\n      .map((pt) => pt.svg)\r\n      .join('\\n');\r\n\r\n    const comment =\r\n      '<!-- ' + this.name.replace('├®', 'e').replace('├¿', 'e') + ' -->\\n';\r\n\r\n    return comment + path_tag + point_tags + '\\n';\r\n  }\r\n\r\n  cleanSameDirectionSegment() {\r\n    for (let i = 0; i < this.segments.length; i++) {\r\n      const nextIdx = mod(i + 1, this.segmentIds.length);\r\n      if (nextIdx == i) break;\r\n      if (\r\n        this.segments[i].hasSameDirection(this.segments[nextIdx], 1, 0, false)\r\n      ) {\r\n        const middlePointId = this.segments[i].vertexIds[1];\r\n        const ptIdx = this.pointIds.findIndex((ptId) => ptId == middlePointId);\r\n        this.pointIds.splice(ptIdx, 1);\r\n        removeObjectById(middlePointId);\r\n        this.segments[i].vertexIds[1] = this.segments[nextIdx].vertexIds[1];\r\n        let idx = this.segments[i].vertexes[1].segmentIds.findIndex(\r\n          (id) => id == this.segmentIds[nextIdx],\r\n        );\r\n        this.segments[i].vertexes[1].segmentIds[idx] = this.segments[i].id;\r\n        if (this.segments[nextIdx].arcCenterId) {\r\n          removeObjectById(this.segments[nextIdx].arcCenterId);\r\n          idx = this.pointIds.findIndex(\r\n            (id) => id == this.segments[nextIdx].arcCenterId,\r\n          );\r\n          this.pointIds.splice(idx, 1);\r\n        }\r\n        removeObjectById(this.segmentIds[nextIdx]);\r\n        this.segmentIds.splice(nextIdx, 1);\r\n        i--; // try to merge this new segment again!\r\n      }\r\n    }\r\n    this.segments.forEach((seg, idx) => (seg.idx = idx));\r\n    this.vertexes.forEach((vx, idx) => (vx.idx = idx));\r\n  }\r\n\r\n  saveData() {\r\n    const data = super.saveData();\r\n    data.type = 'SinglePointShape';\r\n    // data.fillColor = this.fillColor;\r\n    // data.fillOpacity = this.fillOpacity;\r\n    return data;\r\n  }\r\n\r\n  static loadFromData(data) {\r\n    if (!data.position) {\r\n      data.position = 'main';\r\n    }\r\n    const shape = new SinglePointShape({\r\n      layer: data.position,\r\n    });\r\n    Object.assign(shape, data);\r\n    shape.segmentIds = [...data.segmentIds];\r\n    shape.pointIds = [...data.pointIds];\r\n    if (data.geometryObject)\r\n      shape.geometryObject = GeometryObject.loadFromData(data.geometryObject);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Objects\\Shapes\\StripLineShape.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used. Allowed unused args must match /^_/u.","line":13,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":7,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[400,403],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'layer' is defined but never used. Allowed unused args must match /^_/u.","line":14,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":10,"suggestions":[{"messageId":"removeVar","data":{"varName":"layer"},"fix":{"range":[402,414],"text":""},"desc":"Remove unused variable 'layer'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'path' is assigned a value but never used. Allowed unused args must match /^_/u.","line":16,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":9,"suggestions":[{"messageId":"removeVar","data":{"varName":"path"},"fix":{"range":[414,439],"text":""},"desc":"Remove unused variable 'path'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'segmentIds' is assigned a value but never used. Allowed unused args must match /^_/u.","line":17,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"segmentIds"},"fix":{"range":[439,461],"text":""},"desc":"Remove unused variable 'segmentIds'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'pointIds' is assigned a value but never used. Allowed unused args must match /^_/u.","line":18,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"pointIds"},"fix":{"range":[461,481],"text":""},"desc":"Remove unused variable 'pointIds'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'divisionPointInfos' is assigned a value but never used. Allowed unused args must match /^_/u.","line":19,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":23,"suggestions":[{"messageId":"removeVar","data":{"varName":"divisionPointInfos"},"fix":{"range":[481,511],"text":""},"desc":"Remove unused variable 'divisionPointInfos'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'name' is assigned a value but never used. Allowed unused args must match /^_/u.","line":21,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":9,"suggestions":[{"messageId":"removeVar","data":{"varName":"name"},"fix":{"range":[511,535],"text":""},"desc":"Remove unused variable 'name'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'familyName' is assigned a value but never used. Allowed unused args must match /^_/u.","line":22,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"familyName"},"fix":{"range":[535,563],"text":""},"desc":"Remove unused variable 'familyName'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'strokeColor' is assigned a value but never used. Allowed unused args must match /^_/u.","line":24,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"strokeColor"},"fix":{"range":[563,592],"text":""},"desc":"Remove unused variable 'strokeColor'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'strokeWidth' is assigned a value but never used. Allowed unused args must match /^_/u.","line":25,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"strokeWidth"},"fix":{"range":[592,614],"text":""},"desc":"Remove unused variable 'strokeWidth'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'isPointed' is assigned a value but never used. Allowed unused args must match /^_/u.","line":29,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":29,"endColumn":14,"suggestions":[{"messageId":"removeVar","data":{"varName":"isPointed"},"fix":{"range":[663,688],"text":""},"desc":"Remove unused variable 'isPointed'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'size' is assigned a value but never used. Allowed unused args must match /^_/u.","line":30,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":30,"endColumn":9,"suggestions":[{"messageId":"removeVar","data":{"varName":"size"},"fix":{"range":[688,703],"text":""},"desc":"Remove unused variable 'size'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'isReversed' is assigned a value but never used. Allowed unused args must match /^_/u.","line":32,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"isReversed"},"fix":{"range":[736,761],"text":""},"desc":"Remove unused variable 'isReversed'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'isBiface' is assigned a value but never used. Allowed unused args must match /^_/u.","line":33,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":33,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"isBiface"},"fix":{"range":[761,784],"text":""},"desc":"Remove unused variable 'isBiface'."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":40,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":40,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[924,926],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":69,"column":20,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":69,"endColumn":22,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1834,1836],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":70,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":70,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[1875,1877],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":90,"column":28,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":90,"endColumn":30,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[2427,2429],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'ry' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":144,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":144,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"ry"},"fix":{"range":[3988,4031],"text":""},"desc":"Remove unused variable 'ry'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'xAxisRotation' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":145,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":145,"endColumn":26,"suggestions":[{"messageId":"removeVar","data":{"varName":"xAxisRotation"},"fix":{"range":[4031,4085],"text":""},"desc":"Remove unused variable 'xAxisRotation'."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":157,"column":26,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":157,"endColumn":28,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4526,4528],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":157,"column":58,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":157,"endColumn":60,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[4558,4560],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":182,"column":41,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":182,"endColumn":43,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5313,5315],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":205,"column":17,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":205,"endColumn":19,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5812,5814],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":223,"column":27,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":223,"endColumn":29,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6491,6493],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":296,"column":21,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":296,"endColumn":23,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[8614,8616],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'strokeWidth' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":297,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":297,"endColumn":23},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":316,"column":52,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":316,"endColumn":54,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[9238,9240],"text":"!=="},"desc":"Use '!==' instead of '!='."}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":17,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app } from '../../App';\r\nimport { Coordinates } from '../Coordinates';\r\nimport { Point } from '../Point';\r\nimport { Segment } from '../Segment';\r\nimport { GeometryObject } from './GeometryObject';\r\nimport { Shape } from './Shape';\r\n\r\n/**\r\n * Repr├®sente une figure lin├®aire (segment, demi-droite, droite, arc de cercle)\r\n */\r\nexport class StripLineShape extends Shape {\r\n  constructor({\r\n    id,\r\n    layer,\r\n\r\n    path = undefined,\r\n    segmentIds = [],\r\n    pointIds = [],\r\n    divisionPointInfos = [],\r\n\r\n    name = 'Custom',\r\n    familyName = 'Custom',\r\n\r\n    strokeColor = '#000',\r\n    strokeWidth = 1,\r\n    fillColor = '#ddd',\r\n    fillOpacity = 0.7,\r\n\r\n    isPointed = true,\r\n    size = 2,\r\n    _isCenterShown = undefined,\r\n    isReversed = false,\r\n    isBiface = false,\r\n  }) {\r\n    super(arguments[0]);\r\n\r\n    this.fillColor = fillColor;\r\n    this.fillOpacity = fillOpacity;\r\n\r\n    if (this.segments.length == 2) {\r\n      this.segments[0].isInfinite = true;\r\n      this.segments[1].isInfinite = true;\r\n    }\r\n  }\r\n\r\n  /* #################################################################### */\r\n  /* ############################## GET/SET ############################# */\r\n  /* #################################################################### */\r\n\r\n  setSegmentsFromPath(path) {\r\n    const allPathElements = path\r\n      .split(/[ \\n]/)\r\n      .filter((element) => element !== '');\r\n    let firstVertex, lastVertex, startVertex;\r\n\r\n    let segmentIdx = 0;\r\n    let vertexIdx = 0;\r\n\r\n    this.pointIds = [];\r\n    this.segmentIds = [];\r\n\r\n    let nextVertexCoordinates = null;\r\n\r\n    const createLineTo = (x, y) => {\r\n      const coordinates = new Coordinates({ x, y });\r\n      firstVertex = lastVertex;\r\n      lastVertex = this.points.find((pt) => pt.coordinates.equal(coordinates));\r\n      if (\r\n        lastVertex == undefined ||\r\n        lastVertex.type != 'vertex' ||\r\n        this.points[this.points.length - 1].coordinates.equal(coordinates)\r\n      ) {\r\n        lastVertex = new Point({\r\n          coordinates: coordinates,\r\n          shapeId: this.id,\r\n          layer: this.layer,\r\n          type: 'vertex',\r\n          idx: vertexIdx++,\r\n          visible: this.isPointed,\r\n        });\r\n      }\r\n      new Segment({\r\n        shapeId: this.id,\r\n        layer: this.layer,\r\n        idx: segmentIdx++,\r\n        vertexIds: [firstVertex.id, lastVertex.id],\r\n      });\r\n    };\r\n\r\n    if (allPathElements[0] != 'M')\r\n      startVertex = lastVertex = new Point({\r\n        coordinates: Coordinates.nullCoordinates,\r\n        shapeId: this.id,\r\n        layer: this.layer,\r\n        type: 'vertex',\r\n        idx: vertexIdx++,\r\n        visible: this.isPointed,\r\n      });\r\n\r\n    while (allPathElements.length) {\r\n      const element = allPathElements.shift();\r\n\r\n      switch (element) {\r\n        case 'M':\r\n        case 'm':\r\n          nextVertexCoordinates = new Coordinates({\r\n            x: allPathElements.shift(),\r\n            y: allPathElements.shift(),\r\n          });\r\n          if (this.contains(nextVertexCoordinates)) {\r\n            startVertex = lastVertex = this.points.find((pt) =>\r\n              pt.coordinates.equal(nextVertexCoordinates),\r\n            );\r\n          } else {\r\n            startVertex = lastVertex = new Point({\r\n              coordinates: nextVertexCoordinates,\r\n              shapeId: this.id,\r\n              layer: this.layer,\r\n              type: 'vertex',\r\n              idx: vertexIdx++,\r\n              visible: this.isPointed,\r\n            });\r\n          }\r\n          break;\r\n\r\n        case 'L':\r\n        case 'l':\r\n          createLineTo(allPathElements.shift(), allPathElements.shift());\r\n          break;\r\n\r\n        case 'H':\r\n        case 'h':\r\n          createLineTo(allPathElements.shift(), lastVertex.y);\r\n          break;\r\n\r\n        case 'V':\r\n        case 'v':\r\n          createLineTo(lastVertex.x, allPathElements.shift());\r\n          break;\r\n\r\n        case 'A':\r\n        case 'a':\r\n          const rx = allPathElements.shift(),\r\n            ry = allPathElements.shift(),\r\n            xAxisRotation = allPathElements.shift(),\r\n            largeArcFlag = allPathElements.shift(),\r\n            sweepFlag = allPathElements.shift();\r\n\r\n          firstVertex = lastVertex;\r\n          nextVertexCoordinates = new Coordinates({\r\n            x: allPathElements.shift(),\r\n            y: allPathElements.shift(),\r\n          });\r\n          lastVertex = this.points.find((pt) =>\r\n            pt.coordinates.equal(nextVertexCoordinates),\r\n          );\r\n          if (lastVertex == undefined || lastVertex.type != 'vertex') {\r\n            lastVertex = new Point({\r\n              coordinates: nextVertexCoordinates,\r\n              shapeId: this.id,\r\n              layer: this.layer,\r\n              type: 'vertex',\r\n              idx: vertexIdx++,\r\n              visible: this.isPointed,\r\n            });\r\n          }\r\n\r\n          const arcCenter = this.getArcCenterFromSVG(\r\n            firstVertex,\r\n            lastVertex,\r\n            rx,\r\n            largeArcFlag,\r\n            sweepFlag,\r\n          );\r\n\r\n          new Segment({\r\n            shapeId: this.id,\r\n            layer: this.layer,\r\n            idx: segmentIdx++,\r\n            vertexIds: [firstVertex.id, lastVertex.id],\r\n            arcCenterId: arcCenter.id,\r\n            counterclockwise: sweepFlag == 0,\r\n          });\r\n\r\n          this.cleanSameDirectionSegment();\r\n\r\n          break;\r\n\r\n        case 'Z':\r\n        case 'z':\r\n          createLineTo(startVertex.x, startVertex.y);\r\n          break;\r\n\r\n        default:\r\n          break;\r\n      }\r\n    }\r\n  }\r\n\r\n  setCtxForDrawing(ctx, scaling) {\r\n    ctx.strokeStyle = this.strokeColor;\r\n    ctx.fillStyle = this.fillColor;\r\n    ctx.globalAlpha = this.fillOpacity;\r\n    ctx.lineWidth = this.strokeWidth * app.workspace.zoomLevel;\r\n    if (scaling == 'no scale') ctx.lineWidth = this.strokeWidth;\r\n  }\r\n\r\n  /* #################################################################### */\r\n  /* ################################ IS ################################ */\r\n  /* #################################################################### */\r\n\r\n  isSegment() {\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * V├®rifie si une coordonn├®e est ├á l'int├®rieur de la figure ou non\r\n   * @param  {Coordinates}  coord  les coordonn├®es\r\n   */\r\n  isCoordinatesInPath(coord) {\r\n    const firstProjection = this.segments[0].projectionOnSegment(coord);\r\n    const secondProjection = this.segments[1].projectionOnSegment(coord);\r\n    if (firstProjection.x == secondProjection.x) {\r\n      return (\r\n        (firstProjection.y - coord.y > 0) ^ (secondProjection.y - coord.y > 0)\r\n      );\r\n    } else {\r\n      return (\r\n        (firstProjection.x - coord.x > 0) ^ (secondProjection.x - coord.x > 0)\r\n      );\r\n    }\r\n  }\r\n\r\n  /* #################################################################### */\r\n  /* ############################## OTHER ############################### */\r\n  /* #################################################################### */\r\n\r\n  /**\r\n   * convertit la shape en commande de path svg\r\n   */\r\n  getSVGPath(\r\n    scaling = 'scale',\r\n    infiniteCheck = true,\r\n    forDrawing = false,\r\n    forDrawingButInvisible = false,\r\n  ) {\r\n    let path; //= '';\r\n    path = this.segments\r\n      .map((seg) => seg.getSVGPath(scaling, false, infiniteCheck))\r\n      .join(' ')\r\n      .split(' ');\r\n    if (forDrawing || forDrawingButInvisible) {\r\n      const deletedElements = path.splice(6, 3);\r\n      path.push('L', deletedElements[1], deletedElements[2]);\r\n      path.push('L', path[1], path[2]);\r\n    }\r\n    path = path.join(' ');\r\n\r\n    return path;\r\n  }\r\n\r\n  /**\r\n   * convertit la shape en balise path de svg\r\n   */\r\n  toSVG() {\r\n    if (\r\n      this.geometryObject &&\r\n      (this.geometryObject.geometryIsVisible === false ||\r\n        this.geometryObject.geometryIsHidden === true ||\r\n        this.geometryObject.geometryIsConstaintDraw === true)\r\n    ) {\r\n      return '';\r\n    }\r\n\r\n    const shapePath = this.getSVGPath('scale', true, true);\r\n\r\n    const fillAttributes = {\r\n      d: shapePath,\r\n      fill: this.fillColor,\r\n      'fill-opacity': this.fillOpacity,\r\n      'stroke-width': 0,\r\n      'stroke-opacity': 0,\r\n    };\r\n\r\n    let fillPath = '<path';\r\n    for (const [key, value] of Object.entries(fillAttributes)) {\r\n      fillPath += ' ' + key + '=\"' + value + '\"';\r\n    }\r\n    fillPath += '/>\\n';\r\n\r\n    let totalStrokePath = '';\r\n    this.segments.forEach((seg) => {\r\n      const segmentPath = seg.getSVGPath('scale', true);\r\n      const segmentColor = seg.color ? seg.color : this.strokeColor;\r\n      let strokeWidth = 1;\r\n      if (seg.width != 1) strokeWidth = seg.width;\r\n      else strokeWidth = this.strokeWidth;\r\n\r\n      const strokeAttributes = {\r\n        d: segmentPath,\r\n        stroke: segmentColor,\r\n        'fill-opacity': 0,\r\n        'stroke-width': this.strokeWidth,\r\n        'stroke-opacity': 1, // toujours ├á 1 ?\r\n      };\r\n\r\n      let strokePath = '<path';\r\n      for (const [key, value] of Object.entries(strokeAttributes)) {\r\n        strokePath += ' ' + key + '=\"' + value + '\"';\r\n      }\r\n      strokePath += '/>\\n';\r\n      totalStrokePath += strokePath;\r\n    });\r\n\r\n    const pointToDraw = [];\r\n    if (app.settings.areShapesPointed && this.name != 'silhouette') {\r\n      if (this.isSegment()) pointToDraw.push(this.segments[0].vertexes[0]);\r\n      if (!this.isCircle())\r\n        this.segments.forEach((seg) => pointToDraw.push(seg.vertexes[1]));\r\n    }\r\n\r\n    this.segments.forEach((seg) => {\r\n      //Points sur les segments\r\n      seg.divisionPoints.forEach((pt) => {\r\n        pointToDraw.push(pt);\r\n      });\r\n    });\r\n    if (this.isCenterShown) pointToDraw.push(this.center);\r\n\r\n    const point_tags = pointToDraw\r\n      .filter((pt) => {\r\n        pt.visible && pt.geometryIsVisible && !pt.geometryIsHidden;\r\n      })\r\n      .map((pt) => pt.svg)\r\n      .join('\\n');\r\n\r\n    const comment =\r\n      '<!-- ' + this.name.replace('├®', 'e').replace('├¿', 'e') + ' -->\\n';\r\n\r\n    return comment + fillPath + totalStrokePath + point_tags + '\\n';\r\n  }\r\n\r\n  saveData() {\r\n    const data = super.saveData();\r\n    data.type = 'StripLineShape';\r\n    if (this.fillColor !== '#aaa') data.fillColor = this.fillColor;\r\n    if (this.fillOpacity !== 0.7) data.fillOpacity = this.fillOpacity;\r\n    return data;\r\n  }\r\n\r\n  static loadFromData(data) {\r\n    if (!data.position) {\r\n      data.position = 'main';\r\n    }\r\n    const shape = new StripLineShape({\r\n      layer: data.position,\r\n    });\r\n    Object.assign(shape, data);\r\n    shape.segmentIds = [...data.segmentIds];\r\n    shape.pointIds = [...data.pointIds];\r\n    if (data.geometryObject)\r\n      shape.geometryObject = GeometryObject.loadFromData(data.geometryObject);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Objects\\Text.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":59,"column":19,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":59,"endColumn":21,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1459,1461],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":61,"column":21,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":61,"endColumn":23,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1548,1550],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":66,"column":22,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":66,"endColumn":24,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[1752,1754],"text":"!=="},"desc":"Use '!==' instead of '!='."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app } from '../App';\r\nimport { GroupManager } from '../Managers/GroupManager';\r\nimport { uniqId } from '../Tools/general';\r\nimport { Coordinates } from './Coordinates';\r\n\r\n/**\r\n * Repr├®sente un texte affich├® ├á l'├®cran\r\n */\r\nexport class Text {\r\n  /**\r\n   * @param {String}                      id\r\n   * @param {Coordinates}                 coordinates\r\n   * @param {Number}                      x\r\n   * @param {Number}                      y\r\n   * @param {String}                      message   // message to display\r\n   * @param {String}                      type      // group or biface\r\n   * @param {String}                      referenceId\r\n   */\r\n  constructor({\r\n    id = uniqId(),\r\n    layer,\r\n    coordinates = undefined,\r\n    x = 0,\r\n    y = 0,\r\n    message = '',\r\n    type = '',\r\n    referenceId = undefined,\r\n    color = '#000',\r\n    size = 1,\r\n  }) {\r\n    this.id = id;\r\n    this.layer = layer;\r\n    this.canvasLayer.texts.push(this);\r\n\r\n    if (coordinates !== undefined)\r\n      this.coordinates = new Coordinates(coordinates);\r\n    else\r\n      this.coordinates = new Coordinates({\r\n        x: parseFloat(x),\r\n        y: parseFloat(y),\r\n      });\r\n\r\n    this.message = message;\r\n    this.type = type;\r\n    this.referenceId = referenceId;\r\n    this.color = color;\r\n    this.size = size;\r\n  }\r\n\r\n  get x() {\r\n    return this.coordinates.x;\r\n  }\r\n\r\n  get y() {\r\n    return this.coordinates.y;\r\n  }\r\n\r\n  updateMessage() {\r\n    if (this.type == 'group') {\r\n      const shape = app.mainCanvasLayer.shapes.find(\r\n        (s) => s.id == this.referenceId,\r\n      );\r\n      const group = GroupManager.getShapeGroup(shape);\r\n      if (group == null) return;\r\n      const groupIndex = GroupManager.getGroupIndex(group);\r\n      if (groupIndex != -1) this.message = 'Groupe ' + (groupIndex + 1);\r\n    }\r\n  }\r\n\r\n  get canvasLayer() {\r\n    return app[this.layer + 'CanvasLayer'];\r\n  }\r\n\r\n  // /**\r\n  //  * convertit en balise circle de svg\r\n  //  */\r\n  // toSVG(color = '#000', size = 1) {\r\n  //   let canvasCoordinates = this.coordinates.toCanvasCoordinates();\r\n  //   return (\r\n  //     '<circle cx=\"' +\r\n  //     canvasCoordinates.x +\r\n  //     '\" cy=\"' +\r\n  //     canvasCoordinates.y +\r\n  //     '\" r=\"' +\r\n  //     size * 2 + // * app.workspace.zoomLevel +\r\n  //     '\" fill=\"' +\r\n  //     color +\r\n  //     '\" />\\n'\r\n  //   );\r\n  // }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Objects\\Workspace.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Point' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"Point"},"fix":{"range":[31,72],"text":""},"desc":"Remove unused variable 'Point'."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":66,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":66,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2199,2201],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":128,"column":15,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":128,"endColumn":17,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[3906,3908],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":153,"column":28,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":153,"endColumn":30,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4803,4805],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":184,"column":48,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":184,"endColumn":50,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5734,5736],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":193,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":193,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6044,6046],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":199,"column":33,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":199,"endColumn":35,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[6268,6270],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":205,"column":24,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":205,"endColumn":26,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[6420,6422],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":206,"column":32,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":206,"endColumn":34,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[6493,6495],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":206,"column":63,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":206,"endColumn":65,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[6524,6526],"text":"!=="},"desc":"Use '!==' instead of '!='."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app } from '../App';\r\nimport { Point } from '../Objects/Point';\r\nimport { uniqId } from '../Tools/general';\r\nimport { CharacteristicElements } from './CharacteristicElements';\r\nimport { Coordinates } from './Coordinates';\r\nimport { ShapeGroup } from './ShapeGroup';\r\n\r\n// Note: Tangram backObjects loading moved to SolutionCheckerTool\r\n// to prevent premature silhouette display before level selection\r\n\r\n/**\r\n * Repr├®sente un projet, qui peut ├¬tre sauvegard├®/restaur├®. Un utilisateur peut\r\n * travailler sur plusieurs projets en m├¬me temps.\r\n */\r\nexport class Workspace {\r\n  constructor() {\r\n    // Identifiant unique de l'espace de travail\r\n    this.id = uniqId();\r\n\r\n    // Liste des figures du projet ([Shape])\r\n    this.shapes = [];\r\n\r\n    // Liste des segments du projet ([Segment])\r\n    this.segments = [];\r\n\r\n    // Liste des points du projet ([Point])\r\n    this.points = [];\r\n\r\n    // Liste des groupes cr├®├®s par l'utilisateur\r\n    this.shapeGroups = [];\r\n\r\n    // Liste des id de shapes a ne pas redessiner pendant une action\r\n    this.editingShapesIds = [];\r\n\r\n    // Coordonn├®es du dernier ├®v├®nement\r\n    this.lastKnownMouseCoordinates = Coordinates.nullCoordinates;\r\n\r\n    // Couleur s├®lectionn├®e pour border- ou backgroundColor\r\n    this.selectedColor = '#000';\r\n\r\n    // Opacit├® s├®lectionn├®e dans le popup\r\n    this.selectedOpacity = 0.7;\r\n\r\n    // contrainte de s├®lection pour figures, segments et points\r\n    this.selectionConstraints = {};\r\n\r\n    // Niveau de zoom de l'interface\r\n    this.zoomLevel = 1;\r\n\r\n    /**\r\n     * d├®calage du canvas (translation horizontale et verticale), un chiffre\r\n     * positif signifie un d├®calage horizontal vers la droite ou vertical\r\n     * vers le bas.\r\n     * ->Le zoom du plan est appliqu├® apr├¿s la translation du plan.\r\n     */\r\n    this.translateOffset = Coordinates.nullCoordinates;\r\n\r\n    // Initialiser les ├®l├®ments caract├®ristiques pour G├®om├®trie\r\n    this.translationLastCharacteristicElements = [];\r\n    this.orthogonalSymetryLastCharacteristicElements = [];\r\n    this.centralSymetryLastCharacteristicElements = [];\r\n    this.rotationLastCharacteristicElements = [];\r\n  }\r\n\r\n  initGeometrie() {\r\n    if (app.environment.name == 'Geometrie') {\r\n      this.orthogonalSymetryLastCharacteristicElements = [];\r\n      this.centralSymetryLastCharacteristicElements = [];\r\n      this.translationLastCharacteristicElements = [];\r\n      this.rotationLastCharacteristicElements = [];\r\n    }\r\n  }\r\n\r\n  set selectionConstraints(value) {\r\n    this.pvSelectCstr = value;\r\n  }\r\n\r\n  get selectionConstraints() {\r\n    return this.pvSelectCstr;\r\n  }\r\n\r\n  /**\r\n   * Initialise l'espace de travail ├á partir d'un objet de donn├®es\r\n   * @param {Object|null} wsdata - Les donn├®es de l'espace de travail\r\n   */\r\n  async initFromObject(wsdata) {\r\n    this.zoomLevel = wsdata?.zoomLevel || 1;\r\n    if (!wsdata) {\r\n      await this.resetWorkspace();\r\n      return;\r\n    }\r\n\r\n    // Validation des donn├®es d'entr├®e\r\n    if (typeof wsdata !== 'object') {\r\n      console.error('Workspace: Donn├®es invalides pass├®es ├á initFromObject');\r\n      await this.resetWorkspace();\r\n      return;\r\n    }\r\n\r\n    this.id = wsdata.id;\r\n\r\n    const scale = wsdata.canvasSize\r\n      ? Math.min(\r\n        app.canvasWidth / wsdata.canvasSize.width,\r\n        app.canvasHeight / wsdata.canvasSize.height,\r\n      )\r\n      : 1;\r\n\r\n    // Chargement des objets principaux avec validation\r\n    try {\r\n      if (\r\n        app.mainCanvasLayer &&\r\n        typeof app.mainCanvasLayer.loadFromData === 'function'\r\n      ) {\r\n        await app.mainCanvasLayer.loadFromData(wsdata.objects);\r\n      } else {\r\n        console.error(\r\n          'Workspace: mainCanvasLayer non disponible pour le chargement',\r\n        );\r\n      }\r\n    } catch (error) {\r\n      console.error(\r\n        'Workspace: Erreur lors du chargement des objets principaux:',\r\n        error,\r\n      );\r\n    }\r\n\r\n    if (scale != 1) this.setZoomLevel(scale);\r\n\r\n    // Note: backObjects loading for Tangram is handled by SolutionCheckerTool\r\n    // after level selection to prevent premature silhouette display\r\n\r\n    if (!wsdata.shapeGroups) wsdata.shapeGroups = [];\r\n\r\n    try {\r\n      this.shapeGroups = wsdata.shapeGroups\r\n        .map((groupData) => {\r\n          if (!groupData || typeof groupData !== 'object') {\r\n            console.warn('Workspace: Donn├®es de groupe invalides ignor├®es');\r\n            return null;\r\n          }\r\n          const group = new ShapeGroup(0, 1);\r\n          group.initFromObject(groupData);\r\n          return group;\r\n        })\r\n        .filter((group) => group !== null); // Filtrer les groupes invalides\r\n    } catch (error) {\r\n      console.error('Workspace: Erreur lors du chargement des groupes:', error);\r\n      this.shapeGroups = [];\r\n    }\r\n\r\n    if (\r\n      app.environment.name == 'Geometrie' &&\r\n      wsdata.translationLastCharacteristicElements\r\n    ) {\r\n      this.translationLastCharacteristicElements =\r\n        wsdata.translationLastCharacteristicElements.map(\r\n          (element) => new CharacteristicElements(element),\r\n        );\r\n    }\r\n\r\n    this.setTranslateOffset(\r\n      new Coordinates({\r\n        x: wsdata.translateOffset ? wsdata.translateOffset.x * scale : 0,\r\n        y: wsdata.translateOffset ? wsdata.translateOffset.y * scale : 0,\r\n      }),\r\n    );\r\n    this.setZoomLevel(wsdata.zoomLevel * scale || scale, false);\r\n\r\n    // Note: Refresh events for Tangram are handled by SolutionCheckerTool\r\n    // after silhouette positioning\r\n  }\r\n\r\n\r\n\r\n  get data() {\r\n    const wsdata = {};\r\n\r\n    wsdata.id = this.id;\r\n\r\n    wsdata.objects = app.mainCanvasLayer.saveData();\r\n    if (app.tangramCanvasLayer) {\r\n      let mustEraseShapes = false;\r\n      if (app.tangramCanvasLayer.shapes.length == 0) {\r\n        window.dispatchEvent(new CustomEvent('create-silhouette'));\r\n        mustEraseShapes = true;\r\n      }\r\n      wsdata.backObjects = app.tangramCanvasLayer.saveData();\r\n      if (mustEraseShapes) {\r\n        app.tangramCanvasLayer.removeAllObjects();\r\n      }\r\n    }\r\n    if (app.environment.name == 'Geometrie') {\r\n      wsdata.translationLastCharacteristicElements =\r\n        this.translationLastCharacteristicElements.map((element) =>\r\n          element.saveData(),\r\n        );\r\n    }\r\n    if (this.shapeGroups.length != 0) {\r\n      wsdata.shapeGroups = this.shapeGroups.map((group) => {\r\n        return group.saveToObject();\r\n      });\r\n    }\r\n\r\n    if (this.zoomLevel != 1) wsdata.zoomLevel = this.zoomLevel;\r\n    if (this.translateOffset.x != 0 || this.translateOffset.y != 0) {\r\n      wsdata.translateOffset = this.translateOffset;\r\n    }\r\n\r\n    wsdata.canvasSize = { width: app.canvasWidth, height: app.canvasHeight };\r\n\r\n    return wsdata;\r\n  }\r\n\r\n  /**\r\n   * D├®finir le niveau de zoom de l'espace de travail\r\n   * @param {float}  newZoomLevel     Le niveau de zoom (1: zoom normal)\r\n   * @param {Boolean} [doRefresh=true] false: ne pas rafraichir les canvas\r\n   */\r\n  setZoomLevel(newZoomLevel, doRefresh = true) {\r\n    if (newZoomLevel < app.settings.minZoomLevel)\r\n      newZoomLevel = app.settings.minZoomLevel;\r\n    if (newZoomLevel > app.settings.maxZoomLevel)\r\n      newZoomLevel = app.settings.maxZoomLevel;\r\n\r\n    this.zoomLevel = newZoomLevel;\r\n\r\n    if (doRefresh) {\r\n      window.dispatchEvent(new CustomEvent('refresh'));\r\n      window.dispatchEvent(new CustomEvent('refreshUpper'));\r\n      window.dispatchEvent(new CustomEvent('refreshGrid'));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * D├®finir la translation du plan (pour cet espace de travail)\r\n   * @param {Point}  newOffset        Le d├®calage par rapport ├á (0, 0)\r\n   * @param {Boolean} [doRefresh=true] false: ne pas rafraichir les canvas\r\n   */\r\n  setTranslateOffset(newOffset, doRefresh = true) {\r\n    this.translateOffset = newOffset;\r\n\r\n    if (doRefresh) {\r\n      window.dispatchEvent(new CustomEvent('refresh'));\r\n      window.dispatchEvent(new CustomEvent('refreshUpper'));\r\n      window.dispatchEvent(new CustomEvent('refreshGrid'));\r\n    }\r\n  }\r\n\r\n  toSVG() {\r\n    let svg_data = `<svg width=\"${app.canvasWidth}\" height=\"${app.canvasHeight}\" viewBox=\"0 0 ${app.canvasWidth} ${app.canvasHeight}\" encoding=\"UTF-8\" xmlns=\"http://www.w3.org/2000/svg\" >\\n\\n`;\r\n    if (app.gridCanvasLayer) svg_data += app.gridCanvasLayer.toSVG();\r\n    svg_data += app.mainCanvasLayer.toSVG();\r\n    if (app.tangramCanvasLayer) {\r\n      svg_data += `<g id=\"silhouette\" transform=\"translate(${app.canvasWidth / 2}, 0)\">`;\r\n      svg_data += app.tangramCanvasLayer.toSVG();\r\n      svg_data += '</g>';\r\n      if (app.workspace.limited) {\r\n        svg_data += `<rect x=\"${app.canvasWidth / 2}\" width=\"${app.canvasWidth / 2}\" height=\"${app.canvasHeight}\" style=\"fill:rgb(255,0,0, 0.2);\" />`;\r\n      }\r\n    }\r\n    svg_data += '</svg>';\r\n\r\n    return svg_data;\r\n  }\r\n\r\n  async resetWorkspace() {\r\n    this.translateOffset = Coordinates.nullCoordinates;\r\n    await app.mainCanvasLayer.loadFromData(null);\r\n    app.tangramCanvasLayer?.clear();\r\n    app.gridCanvasLayer?.clear();\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\States\\BaseGeometryTool.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\States\\BaseShapeCreationTool.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'setState' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":23,"suggestions":[{"messageId":"removeVar","data":{"varName":"setState"},"fix":{"range":[41,51],"text":""},"desc":"Remove unused variable 'setState'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'removeObjectById' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":45,"suggestions":[{"messageId":"removeVar","data":{"varName":"removeObjectById"},"fix":{"range":[413,431],"text":""},"desc":"Remove unused variable 'removeObjectById'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'collisionIndex' is defined but never used. Allowed unused args must match /^_/u.","line":221,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":221,"endColumn":42,"suggestions":[{"messageId":"removeVar","data":{"varName":"collisionIndex"},"fix":{"range":[6232,6246],"text":""},"desc":"Remove unused variable 'collisionIndex'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'pointNumber' is defined but never used. Allowed unused args must match /^_/u.","line":402,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":402,"endColumn":29,"suggestions":[{"messageId":"removeVar","data":{"varName":"pointNumber"},"fix":{"range":[11318,11329],"text":""},"desc":"Remove unused variable 'pointNumber'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { html } from 'lit';\r\nimport { app, setState } from '../../Core/App';\r\nimport { SelectManager } from '../../Core/Managers/SelectManager';\r\nimport { Coordinates } from '../../Core/Objects/Coordinates';\r\nimport { Point } from '../../Core/Objects/Point';\r\nimport { Segment } from '../../Core/Objects/Segment';\r\nimport { BaseGeometryTool } from '../../Core/States/BaseGeometryTool';\r\nimport { findObjectsByName, removeObjectById } from '../../Core/Tools/general';\r\n\r\n/**\r\n * Classe de base pour tous les outils de cr├®ation de formes g├®om├®triques\r\n * Factorise le code commun entre CreateTriangle, CreateQuadrilateral, CreateCircle, etc.\r\n */\r\nexport class BaseShapeCreationTool extends BaseGeometryTool {\r\n  constructor(name, title, familyName, templatesImport) {\r\n    super(name, title, 'geometryCreator');\r\n\r\n    this.familyName = familyName;\r\n    this.templatesImport = templatesImport;\r\n    this.selectedTemplate = null;\r\n    this.shapeDefinition = null;\r\n  }\r\n\r\n  /**\r\n   * Aide standardis├®e pour tous les outils de cr├®ation\r\n   */\r\n  getHelpText() {\r\n    return html`\r\n      <h3>${this.title}</h3>\r\n      <p>Vous avez s├®lectionn├® l'outil <b>\"${this.title}\"</b>.</p>\r\n    `;\r\n  }\r\n\r\n  /**\r\n   * D├®marrage standardis├® avec s├®lecteur de forme\r\n   */\r\n  async start() {\r\n    if (!this.validateInput('start')) return;\r\n\r\n    this.standardStart();\r\n\r\n    try {\r\n      // Charger dynamiquement le composant shape-selector\r\n      await import('@components/shape-selector');\r\n\r\n      const elem = document.createElement('shape-selector');\r\n      elem.family = this.familyName;\r\n      elem.templatesNames = this.templatesImport;\r\n      elem.selectedTemplate = app.tool.selectedTemplate;\r\n      elem.type = 'Geometry';\r\n      elem.nextStep = 'drawFirstPoint';\r\n\r\n      document.querySelector('body').appendChild(elem);\r\n    } catch (error) {\r\n      console.error('Erreur lors du chargement du s├®lecteur de forme:', error);\r\n      this.showErrorNotification('Erreur lors du chargement des templates');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialisation du premier point (commune ├á tous les outils)\r\n   */\r\n  async drawFirstPoint() {\r\n    if (!this.validateInput('drawFirstPoint')) return;\r\n\r\n    app.upperCanvasLayer.removeAllObjects();\r\n\r\n    try {\r\n      // Charger la d├®finition de la forme s├®lectionn├®e\r\n      await this.loadShapeDefinition();\r\n\r\n      this.resetDrawingState();\r\n      this.safeSetState('drawPoint');\r\n    } catch (error) {\r\n      console.error('Erreur lors du chargement de la d├®finition:', error);\r\n      this.showErrorNotification(\"Erreur lors de l'initialisation\");\r\n    }\r\n  }\r\n\r\n  /**\r\n   * M├®thode abstraite pour charger la d├®finition de forme sp├®cifique\r\n   * ├Ç surcharger dans les classes filles\r\n   */\r\n  async loadShapeDefinition() {\r\n    throw new Error(\r\n      'loadShapeDefinition doit ├¬tre impl├®ment├®e dans la classe fille',\r\n    );\r\n  }\r\n\r\n  /**\r\n   * R├®initialisation de l'├®tat de dessin\r\n   */\r\n  resetDrawingState() {\r\n    this.points = [];\r\n    this.segments = [];\r\n    this.numberOfPointsDrawn = 0;\r\n  }\r\n\r\n  /**\r\n   * Gestion standardis├®e du drawing point\r\n   */\r\n  drawPoint() {\r\n    if (!this.validateInput('drawPoint')) return;\r\n\r\n    this.removeListeners();\r\n    this.stopAnimation();\r\n\r\n    this.getConstraints(this.numberOfPointsDrawn);\r\n    this.mouseDownId = app.addListener('canvasMouseDown', this.handler);\r\n  }\r\n\r\n  /**\r\n   * Animation standardis├®e du point\r\n   */\r\n  animatePoint() {\r\n    this.removeListeners();\r\n    this.animate();\r\n\r\n    // Masquer les contraintes pendant l'animation\r\n    findObjectsByName('constraints', 'upper').forEach((s) => {\r\n      if (s.geometryObject) {\r\n        s.geometryObject.geometryIsVisible = false;\r\n      }\r\n    });\r\n\r\n    this.mouseUpId = app.addListener('canvasMouseUp', this.handler);\r\n  }\r\n\r\n  /**\r\n   * Gestion standardis├®e du mouseDown\r\n   */\r\n  canvasMouseDown() {\r\n    const newCoordinates = this.getValidMouseCoordinates();\r\n    if (!newCoordinates) return;\r\n\r\n    // V├®rifier les contraintes si applicables\r\n    if (this.constraints && this.constraints.type === 'isConstrained') {\r\n      if (!this.constraints.projectionOnConstraints(newCoordinates, true)) {\r\n        this.showInfoNotification(\r\n          'Veuillez placer le point sur la contrainte.',\r\n        );\r\n        return;\r\n      }\r\n    }\r\n\r\n    this.addPointToShape(newCoordinates);\r\n    this.updateShapePreview();\r\n    this.safeSetState('animatePoint');\r\n  }\r\n\r\n  /**\r\n   * Ajouter un point ├á la forme en cours de cr├®ation\r\n   */\r\n  addPointToShape(coordinates) {\r\n    const point = new Point({\r\n      layer: 'upper',\r\n      coordinates: coordinates,\r\n      color: app.settings.temporaryDrawColor,\r\n      size: 2,\r\n    });\r\n\r\n    this.points[this.numberOfPointsDrawn] = point;\r\n    this.numberOfPointsDrawn++;\r\n\r\n    // Ajouter un segment si ce n'est pas le premier point\r\n    if (this.numberOfPointsDrawn > 1) {\r\n      const segment = new Segment({\r\n        layer: 'upper',\r\n        vertexIds: [\r\n          this.points[this.numberOfPointsDrawn - 2].id,\r\n          this.points[this.numberOfPointsDrawn - 1].id,\r\n        ],\r\n      });\r\n      this.segments.push(segment);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Mise ├á jour de l'aper├ºu de la forme\r\n   * ├Ç surcharger dans les classes filles si n├®cessaire\r\n   */\r\n  updateShapePreview() {\r\n    // Impl├®mentation par d├®faut - peut ├¬tre surcharg├®e\r\n  }\r\n\r\n  /**\r\n   * Gestion standardis├®e du mouseUp\r\n   */\r\n  canvasMouseUp() {\r\n    // V├®rifier les points trop proches (magn├®tisme)\r\n    if (this.checkPointMagnetism()) return;\r\n\r\n    if (this.numberOfPointsDrawn === this.numberOfPointsRequired()) {\r\n      this.completeShape();\r\n    } else {\r\n      this.continueDrawing();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * V├®rifier si le dernier point est trop proche d'un point existant\r\n   */\r\n  checkPointMagnetism() {\r\n    for (let i = 0; i < this.numberOfPointsDrawn - 1; i++) {\r\n      if (\r\n        SelectManager.areCoordinatesInMagnetismDistance(\r\n          this.points[i].coordinates,\r\n          this.points[this.numberOfPointsDrawn - 1].coordinates,\r\n        )\r\n      ) {\r\n        this.handleMagnetismCollision(i);\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * G├®rer la collision par magn├®tisme\r\n   */\r\n  handleMagnetismCollision(collisionIndex) {\r\n    this.showInfoNotification('Veuillez placer le point autre part.');\r\n    this.rollbackLastPoint();\r\n    this.safeSetState('drawPoint');\r\n  }\r\n\r\n  /**\r\n   * Annuler le dernier point ajout├®\r\n   */\r\n  rollbackLastPoint() {\r\n    if (this.numberOfPointsDrawn > 0) {\r\n      this.numberOfPointsDrawn--;\r\n      this.points.pop();\r\n      if (this.segments.length > 0) {\r\n        this.segments.pop();\r\n      }\r\n      this.refreshShapePreview();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Continuer le dessin apr├¿s un point\r\n   */\r\n  continueDrawing() {\r\n    this.getConstraints(this.numberOfPointsDrawn);\r\n    this.safeSetState('drawPoint');\r\n  }\r\n\r\n  /**\r\n   * Terminer la forme\r\n   */\r\n  completeShape() {\r\n    this.stopAnimation();\r\n\r\n    this.safeExecuteAction(async () => {\r\n      await this.executeAction();\r\n      this.safeSetState('drawFirstPoint');\r\n    }, 'cr├®ation de forme');\r\n  }\r\n\r\n  /**\r\n   * Ajustement standardis├® des points\r\n   */\r\n  adjustPoint(point) {\r\n    if (!this.validateInput('adjustPoint', { point })) return;\r\n\r\n    point.adjustedOn = undefined;\r\n\r\n    if (this.constraints && this.constraints.isFree) {\r\n      this.adjustPointFree(point);\r\n    } else if (this.constraints) {\r\n      this.adjustPointConstrained(point);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Ajustement libre (magn├®tisme avec grille/points/segments)\r\n   */\r\n  adjustPointFree(point) {\r\n    // Tentative d'ajustement sur un point existant\r\n    let constraints = SelectManager.getEmptySelectionConstraints().points;\r\n    constraints.canSelect = true;\r\n\r\n    const adjustedPoint = SelectManager.selectPoint(\r\n      point.coordinates,\r\n      constraints,\r\n      false,\r\n    );\r\n    if (adjustedPoint) {\r\n      point.coordinates = new Coordinates(adjustedPoint.coordinates);\r\n      point.adjustedOn = adjustedPoint;\r\n      return;\r\n    }\r\n\r\n    // Tentative d'ajustement sur la grille\r\n    if (app.gridCanvasLayer) {\r\n      const gridPoint = app.gridCanvasLayer.getClosestGridPoint(\r\n        point.coordinates.toCanvasCoordinates(),\r\n      );\r\n      if (gridPoint) {\r\n        const gridPointInWorldSpace = gridPoint.fromCanvasCoordinates();\r\n        point.coordinates = new Coordinates(gridPointInWorldSpace);\r\n        point.adjustedOn = gridPointInWorldSpace;\r\n        return;\r\n      }\r\n    }\r\n\r\n    // Tentative d'ajustement sur un segment\r\n    constraints = SelectManager.getEmptySelectionConstraints().segments;\r\n    constraints.canSelect = true;\r\n\r\n    const adjustedSegment = SelectManager.selectSegment(\r\n      point.coordinates,\r\n      constraints,\r\n    );\r\n    if (adjustedSegment) {\r\n      point.coordinates = adjustedSegment.projectionOnSegment(\r\n        point.coordinates,\r\n      );\r\n      point.adjustedOn = adjustedSegment;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Ajustement contraint\r\n   */\r\n  adjustPointConstrained(point) {\r\n    let adjustedCoordinates = this.constraints.projectionOnConstraints(\r\n      point.coordinates,\r\n    );\r\n\r\n    // Chercher des intersections avec d'autres segments\r\n    const constraints = SelectManager.getEmptySelectionConstraints().segments;\r\n    constraints.canSelect = true;\r\n    constraints.numberOfObjects = 'allInDistance';\r\n\r\n    const adjustedSegments = SelectManager.selectSegment(\r\n      adjustedCoordinates,\r\n      constraints,\r\n    );\r\n\r\n    if (adjustedSegments && this.constraints.segments) {\r\n      const adjustedSegment = adjustedSegments\r\n        .filter((seg) => !seg.isParalleleWith(this.constraints.segments[0]))\r\n        .sort((seg1, seg2) => {\r\n          const dist1 = seg1\r\n            .projectionOnSegment(adjustedCoordinates)\r\n            .dist(adjustedCoordinates);\r\n          const dist2 = seg2\r\n            .projectionOnSegment(adjustedCoordinates)\r\n            .dist(adjustedCoordinates);\r\n          return dist1 - dist2;\r\n        })[0];\r\n\r\n      if (adjustedSegment) {\r\n        const intersections = adjustedSegment.intersectionWith(\r\n          this.constraints.segments[0],\r\n        );\r\n        if (intersections && intersections.length > 0) {\r\n          adjustedCoordinates = intersections.sort(\r\n            (i1, i2) =>\r\n              i1.dist(adjustedCoordinates) - i2.dist(adjustedCoordinates),\r\n          )[0];\r\n          point.adjustedOn = adjustedSegment;\r\n        }\r\n      }\r\n    }\r\n\r\n    point.coordinates = new Coordinates(adjustedCoordinates);\r\n  }\r\n\r\n  /**\r\n   * Rafra├«chissement de l'├®tat sup├®rieur\r\n   */\r\n  refreshStateUpper() {\r\n    if (\r\n      app.tool.currentStep === 'animatePoint' &&\r\n      this.numberOfPointsDrawn > 0\r\n    ) {\r\n      const lastPoint = this.points[this.numberOfPointsDrawn - 1];\r\n      const newCoordinates = this.getValidMouseCoordinates();\r\n\r\n      if (newCoordinates && lastPoint) {\r\n        lastPoint.coordinates = newCoordinates;\r\n        this.adjustPoint(lastPoint);\r\n        this.refreshShapePreview();\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Rafra├«chir l'aper├ºu de la forme - ├á surcharger si n├®cessaire\r\n   */\r\n  refreshShapePreview() {\r\n    // Impl├®mentation par d├®faut vide\r\n  }\r\n\r\n  /**\r\n   * Obtenir les contraintes pour un point donn├®\r\n   * ├Ç impl├®menter dans les classes filles\r\n   */\r\n  getConstraints(pointNumber) {\r\n    // Impl├®mentation par d├®faut - pas de contraintes\r\n    this.constraints = { isFree: true };\r\n  }\r\n\r\n  /**\r\n   * Nombre de points requis pour la forme\r\n   * ├Ç impl├®menter dans les classes filles\r\n   */\r\n  numberOfPointsRequired() {\r\n    throw new Error(\r\n      'numberOfPointsRequired doit ├¬tre impl├®ment├®e dans la classe fille',\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Ex├®cution de l'action finale\r\n   * ├Ç impl├®menter dans les classes filles\r\n   */\r\n  async executeAction() {\r\n    throw new Error('executeAction doit ├¬tre impl├®ment├®e dans la classe fille');\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\States\\Tool.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":18,"column":21,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":18,"endColumn":23,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[472,474],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":83,"column":20,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":83,"endColumn":22,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2235,2237],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":86,"column":32,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":86,"endColumn":34,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2333,2335],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":88,"column":39,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":88,"endColumn":41,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2427,2429],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":92,"column":22,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":92,"endColumn":24,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2507,2509],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":100,"column":29,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":100,"endColumn":31,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2800,2802],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app } from '../App';\r\n\r\n/**\r\n * Cette classe abstraite repr├®sente un ├®tat possible de l'application\r\n */\r\nexport class Tool {\r\n  constructor(name, title, type) {\r\n    if (this.constructor === Tool) {\r\n      throw new TypeError(\r\n        'Abstract class \"Tool\" cannot be instantiated directly',\r\n      );\r\n    }\r\n    this.name = name;\r\n    this.title = title;\r\n    this.type = type;\r\n\r\n    window.addEventListener('refreshStateUpper', () => {\r\n      if (this.name == app.tool?.name) this.refreshStateUpper();\r\n    });\r\n\r\n    this.handler = (event) => this.eventHandler(event);\r\n\r\n    window.addEventListener('tool-updated', this.handler);\r\n  }\r\n\r\n  /**\r\n   * Appel├®e par la fonction de dessin, lorsqu'il faut dessiner l'action en cours\r\n   */\r\n  refreshStateUpper() {}\r\n\r\n  /**\r\n   * Ex├®cuter les actions li├®e ├á l'├®tat.\r\n   */\r\n  executeAction() {\r\n    this._executeAction();\r\n    window.dispatchEvent(new CustomEvent('refresh'));\r\n    window.dispatchEvent(\r\n      new CustomEvent('actions-executed', { detail: { name: this.title } }),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * (appel├® quand l'utilisateur s├®lectionne le state)\r\n   */\r\n  start() {\r\n    console.error('start() not implemented');\r\n  }\r\n\r\n  /**\r\n   * (appel├® si changement de state)\r\n   */\r\n  end() {\r\n    console.error('end() not implemented');\r\n  }\r\n\r\n  /**\r\n   * Gere l'animation de d├®placement\r\n   * override pour changer d'animation\r\n   */\r\n  animate() {\r\n    window.dispatchEvent(new CustomEvent('refreshUpper'));\r\n    this.requestAnimFrameId = window.requestAnimationFrame(() =>\r\n      this.animate(),\r\n    );\r\n  }\r\n\r\n  stopAnimation() {\r\n    window.cancelAnimationFrame(this.requestAnimFrameId);\r\n  }\r\n\r\n  removeListeners() {\r\n    app.removeListener('canvasMouseMove', this.mouseMoveId);\r\n    app.removeListener('canvasMouseDown', this.mouseDownId);\r\n    app.removeListener('canvasMouseUp', this.mouseUpId);\r\n    app.removeListener('canvasClick', this.mouseClickId);\r\n    app.removeListener('objectSelected', this.objectSelectedId);\r\n    app.removeListener('canvasTouchMove', this.touchMoveId);\r\n    app.removeListener('canvasTouchEnd', this.touchEndId);\r\n    app.removeListener('canvasLongPress', this.longPressId);\r\n  }\r\n\r\n  eventHandler(event) {\r\n    if (event.type == 'tool-updated') {\r\n      if (!app.tool) {\r\n        this.end();\r\n      } else if (app.tool.name == this.name) {\r\n        this[app.tool.currentStep]();\r\n      } else if (app.tool.currentStep == 'start') {\r\n        this.end();\r\n      }\r\n    } else {\r\n      if (event.type == 'objectSelected') {\r\n        this.objectSelected(event.detail.object);\r\n      } else if (\r\n        ['canvasTouchStart', 'canvasTouchMove', 'canvasTouchEnd'].includes(\r\n          event.type,\r\n        )\r\n      ) {\r\n        this[event.type](event.detail.touches);\r\n      } else if (event.type == 'canvasMouseWheel') {\r\n        this[event.type](event.detail.deltaY);\r\n      } else {\r\n        this[event.type]();\r\n      }\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Tools\\automatic_adjustment.js","messages":[{"ruleId":"prefer-const","severity":1,"message":"'fixedCoordAngle' is never reassigned. Use 'const' instead.","line":30,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":30,"endColumn":22},{"ruleId":"prefer-const","severity":1,"message":"'movingCoordAngle' is never reassigned. Use 'const' instead.","line":31,"column":5,"nodeType":"Identifier","messageId":"useConst","endLine":31,"endColumn":21},{"ruleId":"prefer-const","severity":1,"message":"'center' is never reassigned. Use 'const' instead.","line":33,"column":5,"nodeType":"Identifier","messageId":"useConst","endLine":33,"endColumn":11},{"ruleId":"prefer-const","severity":1,"message":"'moving1NewCoords' is never reassigned. Use 'const' instead.","line":34,"column":5,"nodeType":"Identifier","messageId":"useConst","endLine":34,"endColumn":21},{"ruleId":"prefer-const","severity":1,"message":"'translation' is never reassigned. Use 'const' instead.","line":35,"column":5,"nodeType":"Identifier","messageId":"useConst","endLine":35,"endColumn":16},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":59,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":59,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[2283,2285],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":61,"column":22,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":61,"endColumn":24,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2343,2345],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":61,"column":57,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":61,"endColumn":59,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2378,2380],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":70,"column":21,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":70,"endColumn":23,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[2696,2698],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":70,"column":48,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":70,"endColumn":50,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[2723,2725],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":71,"column":26,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":71,"endColumn":28,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[2762,2764],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":123,"column":28,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":123,"endColumn":30,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4577,4579],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"prefer-const","severity":1,"message":"'cPtListGrid' is never reassigned. Use 'const' instead.","line":135,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":135,"endColumn":18},{"ruleId":"prefer-const","severity":1,"message":"'cPtListShape' is never reassigned. Use 'const' instead.","line":137,"column":5,"nodeType":"Identifier","messageId":"useConst","endLine":137,"endColumn":17},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":192,"column":27,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":192,"endColumn":29,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7213,7215],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":192,"column":56,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":192,"endColumn":58,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7242,7244],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { gridStore } from '../../../store/gridStore.js';\r\nimport { getAllChildrenInGeometry } from '../../GeometryTools/general';\r\nimport { app } from '../App';\r\nimport { SelectManager } from '../Managers/SelectManager';\r\nimport { Coordinates } from '../Objects/Coordinates';\r\nimport { addInfoToId } from './general';\r\n\r\nfunction reduceAngle(angle) {\r\n  while (angle < -Math.PI) angle += 2 * Math.PI;\r\n  while (angle >= Math.PI) angle -= 2 * Math.PI;\r\n  return angle;\r\n}\r\n\r\n/**\r\n * Renvoie la transformation qu'il faut appliquer aux figures pour que les 2\r\n * segments reliant les points de e1 et e2 soient superpos├®s.\r\n * @param  {{'moving': Object, 'fixed': Object}} e1 1er point commun\r\n * @param  {{'moving': Object, 'fixed': Object}} e2 2eme point commun\r\n * @param  {[Shape]} shapes       Le groupe de figures que l'on d├®place\r\n * @param  {Shape} mainShape      La figure principale\r\n * @return {{rotationAngle: float, translation: Coordinates}}\r\n */\r\nfunction computeTransformation(e1, e2, shapes, mainShape) {\r\n  const maxRotateAngle = 0.25; //radians\r\n  const fix1 = e1.fixed.coordinates,\r\n    fix2 = e2.fixed.coordinates,\r\n    moving1 = e1.moving.coordinates,\r\n    moving2 = e2.moving.coordinates;\r\n\r\n  let fixedCoordAngle = fix1.angleWith(fix2),\r\n    movingCoordAngle = moving1.angleWith(moving2),\r\n    rotationAngle = fixedCoordAngle - movingCoordAngle,\r\n    center = mainShape.centerCoordinates,\r\n    moving1NewCoords = moving1.rotate(rotationAngle, center),\r\n    translation = fix1.substract(moving1NewCoords);\r\n\r\n  rotationAngle = reduceAngle(rotationAngle);\r\n\r\n  if (Math.abs(rotationAngle) > maxRotateAngle) return undefined;\r\n\r\n  return {\r\n    rotationAngle: rotationAngle,\r\n    translation: translation,\r\n  };\r\n}\r\n\r\n/*\r\n    V├®rifie:\r\n    - Que les 2 points moving sont de la m├¬me figure => pourquoi ?\r\n    - Qu'aucun des 2 points moving n'est un centre\r\n    - Que les 2 segments form├®s ont la m├¬me longueur\r\n    (- Que les 2 points moving sont sur le m├¬me segment et/ou aux extr├®mit├®s\r\n      d'un m├¬me segment.)*\r\n    - Si les 2 points fixed ne sont pas de grille, alors ils doivent\r\n      faire partie (du m├¬me segment)* de la m├¬me figure.\r\n    * Les () indiquent que ce n'est pas/plus le cas\r\n  */\r\nfunction checkCompatibility(e1, e2) {\r\n  if (e1.moving.shapeId != e2.moving.shapeId) return false;\r\n\r\n  if (e1.moving.type == 'shapeCenter' || e2.moving.type == 'shapeCenter')\r\n    return false;\r\n\r\n  const d1 = e1.fixed.coordinates.dist(e2.fixed.coordinates),\r\n    d2 = e1.moving.coordinates.dist(e2.moving.coordinates);\r\n  if (Math.abs(d1 - d2) > 1) return false;\r\n\r\n  // if (!e1.moving.shape.contains(new Segment(e1.moving, e2.moving))) return false;\r\n\r\n  if (e1.fixed.type != 'grid' && e2.fixed.type != 'grid') {\r\n    if (e1.fixed.shapeId != e2.fixed.shapeId) return false;\r\n    // if (!e1.fixed.shape.contains(new Segment(e1.fixed, e2.fixed))) return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction bestPossibility(possibilities) {\r\n  possibilities.filter(Boolean);\r\n  const best = possibilities.sort((poss1, poss2) => {\r\n    const rot1 = Math.abs(reduceAngle(poss1.rotationAngle)),\r\n      rot2 = Math.abs(reduceAngle(poss2.rotationAngle));\r\n    if (Math.abs(rot1 - rot2) < 0.001)\r\n      // equalit├® d'angle\r\n      return poss1.translation.dist(Coordinates.nullCoordinates) >\r\n        poss2.translation.dist(Coordinates.nullCoordinates)\r\n        ? 1\r\n        : -1;\r\n    else return rot1 - rot2;\r\n  })[0];\r\n\r\n  return best;\r\n}\r\n\r\n/**\r\n * Calcule la transformation (d├®placement et/ou rotation) qu'il faut appliquer ├á\r\n * un groupe de figures en fonction de la grille et de l'ajustement automatique.\r\n * @param  {[Shape]} shapes       Le groupe de figures que l'on d├®place\r\n * @param  {Shape} mainShape      La figure principale\r\n * @return {Object}\r\n *          {\r\n *              'rotationAngle': float,     // Rotation ├á effectuer\r\n *              'tranlation': Coordinates   // D├®placement ├á effectuer (apr├¿s la rotation)\r\n *          }\r\n *\r\n */\r\nexport function getShapeAdjustment(shapes, mainShape, blacklistShapeIds) {\r\n  const grid = gridStore.getState().isVisible,\r\n    // tangram = app.tangram.isSilhouetteShown,\r\n    automaticAdjustment = app.settings.automaticAdjustment,\r\n    transformation = {\r\n      rotationAngle: 0,\r\n      translation: Coordinates.nullCoordinates,\r\n    };\r\n\r\n  if (!grid && !automaticAdjustment) return transformation;\r\n\r\n  // if (grid && tangram) {\r\n  //   console.error('le Tangram et la Grille ne doivent pas ├¬tre activ├®s en m├¬me temps');\r\n  // }\r\n\r\n  const shapesAndAllChildren = [...shapes];\r\n  if (app.environment.name == 'Geometrie') {\r\n    shapes.forEach((s) => getAllChildrenInGeometry(s, shapesAndAllChildren));\r\n  }\r\n\r\n  //G├®n├®rer la liste des points du groupe de figures\r\n  const ptList = [];\r\n  shapes.forEach((s) => {\r\n    ptList.push(...s.vertexes, ...s.divisionPoints);\r\n    if (s.isCenterShown) ptList.push(s.center);\r\n  });\r\n\r\n  // Pour chaque point, calculer le(s) point(s) le(s) plus proche(s).\r\n  let cPtListGrid = [],\r\n    cPtListBorder = [],\r\n    cPtListShape = [];\r\n  ptList.forEach((point) => {\r\n    if (grid) {\r\n      // point.coordinates sont en espace \"monde\"\r\n      const checkingCoordsInWorldSpace = point.coordinates;\r\n      // Convertir les coordonn├®es du point de la figure en espace canevas pour getClosestGridPoint\r\n      const checkingCoordsInCanvasSpace =\r\n        checkingCoordsInWorldSpace.toCanvasCoordinates();\r\n\r\n      // getClosestGridPoint attend des coordonn├®es canevas et renvoie des coordonn├®es canevas\r\n      const closestGridPointInCanvasSpace =\r\n        app.gridCanvasLayer.getClosestGridPoint(checkingCoordsInCanvasSpace);\r\n\r\n      if (closestGridPointInCanvasSpace) {\r\n        // Reconvertir le point de grille trouv├® en espace \"monde\" pour la coh├®rence\r\n        const closestGridPointInWorldSpace =\r\n          closestGridPointInCanvasSpace.fromCanvasCoordinates();\r\n\r\n        cPtListGrid.push({\r\n          fixed: {\r\n            // Assurer une structure compatible avec ce qu'attendent les fonctions consommatrices\r\n            coordinates: closestGridPointInWorldSpace, // Coordonn├®es en espace monde\r\n            type: 'grid',\r\n          },\r\n          moving: point, // point.coordinates est d├®j├á en espace monde\r\n          dist: closestGridPointInWorldSpace.dist(checkingCoordsInWorldSpace), // Distance calcul├®e en espace monde\r\n        });\r\n      }\r\n    }\r\n    const constr = SelectManager.getEmptySelectionConstraints().points;\r\n    constr.canSelect = true;\r\n    constr.types = ['vertex', 'divisionPoint', 'shapeCenter'];\r\n    if (blacklistShapeIds) {\r\n      constr.blacklist = blacklistShapeIds.map((sId) => {\r\n        return { shapeId: sId };\r\n      });\r\n    } else {\r\n      constr.blacklist = shapesAndAllChildren.map((s) => {\r\n        return { shapeId: addInfoToId(s.id, 'main') };\r\n      });\r\n    }\r\n    constr.numberOfObjects = 'allInDistance';\r\n    const pts = SelectManager.selectPoint(point, constr, false);\r\n    if (pts) {\r\n      pts.forEach((pt) => {\r\n        cPtListShape.push({\r\n          fixed: pt,\r\n          moving: point,\r\n          dist: pt.coordinates.dist(point.coordinates),\r\n        });\r\n      });\r\n    }\r\n  });\r\n\r\n  cPtListBorder = cPtListShape.filter(\r\n    (pt) => pt.fixed.type == 'vertex' || pt.fixed.type == 'divisionPoint',\r\n  );\r\n\r\n  const possibilities = [];\r\n\r\n  if (grid) {\r\n    //segment: 2 points de la grille ?\r\n    for (let i = 0; i < cPtListGrid.length; i++) {\r\n      for (let j = i + 1; j < cPtListGrid.length; j++) {\r\n        const e1 = cPtListGrid[i],\r\n          e2 = cPtListGrid[j];\r\n        if (checkCompatibility(e1, e2)) {\r\n          const t = computeTransformation(e1, e2, shapes, mainShape);\r\n          possibilities.push(t);\r\n        }\r\n      }\r\n    }\r\n\r\n    /*\r\n        La grille attire les figures vers ses points. Mais si l'ajustement automatique\r\n        n'est pas activ├®, la figure est uniquement translat├®e: il n'y a pas de l├®g├¿re\r\n        rotation (d'ajustement) possible.\r\n         */\r\n    if (automaticAdjustment) {\r\n      //segment: 1 point de la grille et 1 point d'une autre figure ?\r\n      for (let i = 0; i < cPtListGrid.length; i++) {\r\n        for (let j = 0; j < cPtListBorder.length; j++) {\r\n          const e1 = cPtListGrid[i],\r\n            e2 = cPtListBorder[j];\r\n          if (checkCompatibility(e1, e2)) {\r\n            const t = computeTransformation(e1, e2, shapes, mainShape);\r\n            possibilities.push(t);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  if (possibilities.filter(Boolean).length > 0) {\r\n    return bestPossibility(possibilities);\r\n  }\r\n\r\n  if (automaticAdjustment) {\r\n    //segment: 2 points d'autres figures ?\r\n    for (let i = 0; i < cPtListBorder.length; i++) {\r\n      for (let j = i + 1; j < cPtListBorder.length; j++) {\r\n        const e1 = cPtListBorder[i],\r\n          e2 = cPtListBorder[j];\r\n        if (checkCompatibility(e1, e2)) {\r\n          const t = computeTransformation(e1, e2, shapes, mainShape);\r\n          possibilities.push(t);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  if (possibilities.filter(Boolean).length > 0) {\r\n    return bestPossibility(possibilities);\r\n  }\r\n\r\n  if (grid) {\r\n    //point: un seul point de la grille?\r\n    let best = null,\r\n      bestDist = 1000 * 1000;\r\n    for (let i = 0; i < cPtListGrid.length; i++) {\r\n      const e = cPtListGrid[i];\r\n      if (e.dist < bestDist) {\r\n        bestDist = e.dist;\r\n        best = e;\r\n      }\r\n    }\r\n    if (best) {\r\n      transformation.translation = best.fixed.coordinates.substract(\r\n        best.moving.coordinates,\r\n      );\r\n      return transformation;\r\n    }\r\n  }\r\n\r\n  if (automaticAdjustment) {\r\n    //point un seul point d'une autre figure?\r\n    let best = null,\r\n      bestDist = 1000 * 1000;\r\n    for (let i = 0; i < cPtListShape.length; i++) {\r\n      const e = cPtListShape[i];\r\n      if (e.dist < bestDist) {\r\n        bestDist = e.dist;\r\n        best = e;\r\n      }\r\n    }\r\n    if (best) {\r\n      transformation.translation = best.fixed.coordinates.substract(\r\n        best.moving.coordinates,\r\n      );\r\n      return transformation;\r\n    }\r\n  }\r\n\r\n  //Rien n'a ├®t├® trouv├®, aucune transformation ├á faire.\r\n  return transformation;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Tools\\general.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":31,"column":22,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":31,"endColumn":24,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[880,882],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":79,"column":20,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":79,"endColumn":22,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2101,2103],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":156,"column":20,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":156,"endColumn":22,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3676,3678],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":235,"column":17,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":235,"endColumn":19,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5248,5250],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":255,"column":18,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":255,"endColumn":20,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[5940,5942],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":255,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":255,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[5962,5964],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":266,"column":21,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":266,"endColumn":23,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6290,6292],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":276,"column":21,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":276,"endColumn":23,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6562,6564],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":283,"column":23,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":283,"endColumn":25,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6764,6766],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":292,"column":13,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":292,"endColumn":15,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6973,6975],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":295,"column":18,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":295,"endColumn":20,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7113,7115],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"//ce fichier est un peu trop fourre-tout\r\n//par exemple: faudrait s├®parer les fonctions sur le couleurs dans un autre fichier\r\n\r\nimport { app } from '../App.js';\r\n\r\nconst layerOrder = [\r\n  'upper',\r\n  'main',\r\n  'tangram',\r\n  'grid',\r\n  'background',\r\n  'invisible',\r\n];\r\nconst objectTypeOrder = ['shape', 'segment', 'point'];\r\n/**\r\n * Calcule la moyene de x couleurs.\r\n * @param {String} colors couleurs (RGB) sous la figure #xxxxxx ou #xxx (lettres minuscules ou majuscules)\r\n */\r\nexport function getAverageColor(...colors) {\r\n  const regex = /^#([0-9a-fA-F]{3}){1,2}$/,\r\n    arglen = colors.length;\r\n  for (let i = 0; i < arglen; i++) {\r\n    if (!regex.test(colors[i])) {\r\n      console.error(\r\n        \"getAverageColor: une couleur n'a pas ├®t├® reconnue: \" + colors[i],\r\n      );\r\n      return;\r\n    }\r\n  }\r\n  const usableColors = colors.map((color) => {\r\n    if (color.length == 4) {\r\n      return (\r\n        '#' +\r\n        color[1] +\r\n        color[1] +\r\n        color[2] +\r\n        color[2] +\r\n        color[3] +\r\n        color[3]\r\n      ).toUpperCase();\r\n    } else {\r\n      return color.toUpperCase();\r\n    }\r\n  });\r\n\r\n  let red = 0,\r\n    green = 0,\r\n    blue = 0;\r\n  usableColors.forEach((color) => {\r\n    red += parseInt(color[1] + color[2], 16);\r\n    green += parseInt(color[3] + color[4], 16);\r\n    blue += parseInt(color[5] + color[6], 16);\r\n  });\r\n\r\n  red = Math.floor(red / usableColors.length);\r\n  green = Math.floor(green / usableColors.length);\r\n  blue = Math.floor(blue / usableColors.length);\r\n\r\n  return (\r\n    '#' +\r\n    red.toString(16).padStart(2, '0') +\r\n    green.toString(16).padStart(2, '0') +\r\n    blue.toString(16).padStart(2, '0')\r\n  );\r\n}\r\n\r\n/**\r\n * Calcule la couleur compl├®mentaire d'une couleur.\r\n * @param color: couleur (RGB) sous la figure #xxxxxx ou #xxx (lettres minuscules ou majuscules)\r\n */\r\nexport function getComplementaryColor(color) {\r\n  const regex = /^#([0-9a-fA-F]{3}){1,2}$/;\r\n  if (!regex.test(color)) {\r\n    console.error(\r\n      \"App.getComplementaryColor: la couleur n'a pas ├®t├® reconnue: \" + color,\r\n    );\r\n    return;\r\n  }\r\n  if (color.length == 4)\r\n    //transfigure #abc en #aabbcc\r\n    color =\r\n      '#' +\r\n      color[1] +\r\n      '' +\r\n      color[1] +\r\n      '' +\r\n      color[2] +\r\n      '' +\r\n      color[2] +\r\n      '' +\r\n      color[3] +\r\n      '' +\r\n      color[3];\r\n  color = color.toUpperCase();\r\n\r\n  const hexTodec = function (hex) {\r\n    //transfigure un nombre hexad├®cimal ├á 2 chiffres en un nombre d├®cimal\r\n    const conversion = {\r\n      0: 0,\r\n      1: 1,\r\n      2: 2,\r\n      3: 3,\r\n      4: 4,\r\n      5: 5,\r\n      6: 6,\r\n      7: 7,\r\n      8: 8,\r\n      9: 9,\r\n      A: 10,\r\n      B: 11,\r\n      C: 12,\r\n      D: 13,\r\n      E: 14,\r\n      F: 15,\r\n    };\r\n    return conversion[hex[0]] * 16 + conversion[hex[1]];\r\n  };\r\n  const decToHex = function (dec) {\r\n    //transfigure un nombre d├®cimal de 0 ├á 255 en hexad├®cimal\r\n    const conversion = [\r\n      '0',\r\n      '1',\r\n      '2',\r\n      '3',\r\n      '4',\r\n      '5',\r\n      '6',\r\n      '7',\r\n      '8',\r\n      '9',\r\n      'A',\r\n      'B',\r\n      'C',\r\n      'D',\r\n      'E',\r\n      'F',\r\n    ];\r\n    return conversion[parseInt(dec / 16)] + conversion[dec % 16];\r\n  };\r\n\r\n  const red = 255 - hexTodec(color[1] + color[2]),\r\n    green = 255 - hexTodec(color[3] + color[4]),\r\n    blue = 255 - hexTodec(color[5] + color[6]);\r\n\r\n  return '#' + decToHex(red) + decToHex(green) + decToHex(blue);\r\n}\r\n\r\nexport function RGBFromColor(color) {\r\n  const regex = /^#([0-9a-fA-F]{3}){1,2}$/;\r\n  if (!regex.test(color)) {\r\n    console.error(\r\n      \"App.getComplementaryColor: la couleur n'a pas ├®t├® reconnue: \" + color,\r\n    );\r\n    return;\r\n  }\r\n  if (color.length == 4)\r\n    //transfigure #abc en #aabbcc\r\n    color =\r\n      '#' +\r\n      color[1] +\r\n      '' +\r\n      color[1] +\r\n      '' +\r\n      color[2] +\r\n      '' +\r\n      color[2] +\r\n      '' +\r\n      color[3] +\r\n      '' +\r\n      color[3];\r\n  color = color.toUpperCase();\r\n\r\n  const hexTodec = function (hex) {\r\n    //transfigure un nombre hexad├®cimal ├á 2 chiffres en un nombre d├®cimal\r\n    const conversion = {\r\n      0: 0,\r\n      1: 1,\r\n      2: 2,\r\n      3: 3,\r\n      4: 4,\r\n      5: 5,\r\n      6: 6,\r\n      7: 7,\r\n      8: 8,\r\n      9: 9,\r\n      A: 10,\r\n      B: 11,\r\n      C: 12,\r\n      D: 13,\r\n      E: 14,\r\n      F: 15,\r\n    };\r\n    return conversion[hex[0]] * 16 + conversion[hex[1]];\r\n  };\r\n\r\n  const red = hexTodec(color[1] + color[2]),\r\n    green = hexTodec(color[3] + color[4]),\r\n    blue = hexTodec(color[5] + color[6]);\r\n\r\n  return { red, green, blue };\r\n}\r\n\r\nexport function rgb2hex(rgb) {\r\n  rgb = rgb.match(/^rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)$/);\r\n  return '#' + hex(rgb[1]) + hex(rgb[2]) + hex(rgb[3]);\r\n}\r\n\r\nexport function hex(x) {\r\n  const hexDigits = new Array(\r\n    '0',\r\n    '1',\r\n    '2',\r\n    '3',\r\n    '4',\r\n    '5',\r\n    '6',\r\n    '7',\r\n    '8',\r\n    '9',\r\n    'a',\r\n    'b',\r\n    'c',\r\n    'd',\r\n    'e',\r\n    'f',\r\n  );\r\n  return isNaN(x) ? '00' : hexDigits[(x - (x % 16)) / 16] + hexDigits[x % 16];\r\n}\r\n\r\n// je trouve cette fonction pas tr├¿s utile et je me demande comment\r\n// le changement de layer est tenu en compte\r\nexport function addInfoToId(id, layer, objectType = undefined) {\r\n  if (!id) return;\r\n  let objectTypeId = id[9];\r\n  if (id.length == 10) id = id.substring(0, 8);\r\n  else id = id.substring(id.length - 8, id.length);\r\n  const layerId = layerOrder.indexOf(layer);\r\n  if (objectType) {\r\n    objectTypeId = objectTypeOrder.indexOf(objectType);\r\n  }\r\n  const result = id + layerId + objectTypeId;\r\n  return result;\r\n}\r\n\r\n/**\r\n * G├®n├¿re un identifiant unique (bas├® sur le timetamp actuel et Math.random())\r\n * @return {String} un identifiant unique\r\n */\r\nexport function uniqId(layer, objectType) {\r\n  const timestamp = new Date().getTime() % 65536;\r\n  const randInt = Math.floor(Math.random() * 65536);\r\n  let result =\r\n    timestamp.toString(16).padStart(4, '0') +\r\n    randInt.toString(16).padStart(4, '0');\r\n  if (objectType != undefined && layer != undefined) {\r\n    result = addInfoToId(result, layer, objectType);\r\n  }\r\n  return result;\r\n}\r\n\r\nexport function findObjectById(id) {\r\n  if (!id) return;\r\n  const layer = layerOrder[id[8]];\r\n  const objectType = objectTypeOrder[id[9]];\r\n  const object = app[layer + 'CanvasLayer'][objectType + 's'].find(\r\n    (obj) => obj.id == id,\r\n  );\r\n  return object;\r\n}\r\n\r\nexport function findIndexById(id) {\r\n  if (!id) return -1;\r\n  const layer = layerOrder[id[8]];\r\n  const objectType = objectTypeOrder[id[9]];\r\n  const index = app[layer + 'CanvasLayer'][objectType + 's'].findIndex(\r\n    (obj) => obj.id == id,\r\n  );\r\n  return index;\r\n}\r\n\r\nexport function findObjectsByName(name, layer, objectType = 'shape') {\r\n  const objects = app[layer + 'CanvasLayer'][objectType + 's'].filter(\r\n    (obj) => obj.name == name,\r\n  );\r\n  return objects;\r\n}\r\n\r\nexport function removeObjectById(id) {\r\n  if (!id) return -1;\r\n  const objectType = objectTypeOrder[id[9]];\r\n  const index = findIndexById(id, objectType);\r\n  if (index == -1) return;\r\n  const layer = layerOrder[id[8]];\r\n  const object = app[layer + 'CanvasLayer'][objectType + 's'][index];\r\n  if (objectType == 'shape') {\r\n    object.segments.forEach((seg) => removeObjectById(seg.id));\r\n    object.points.forEach((pt) => removeObjectById(pt.id));\r\n  }\r\n  app[layer + 'CanvasLayer'][objectType + 's'].splice(index, 1);\r\n}\r\n\r\n/**\r\n * Fonction modulo (renvoie valeur positive, contrairement ├á % dans certains cas)\r\n * @param  {[type]} x [description]\r\n * @param  {[type]} n [description]\r\n * @return {[type]}   [description]\r\n */\r\nexport function mod(x, n) {\r\n  return ((x % n) + n) % n;\r\n}\r\n\r\n/**\r\n * create an element and add it to document\r\n * @param {String} name  name of the element to create\r\n */\r\nexport function createElem(name) {\r\n  const elem = document.createElement(name);\r\n  elem.style.display = 'block';\r\n  document.body.appendChild(elem);\r\n  return elem;\r\n}\r\n\r\nexport function isAlmostInfinite(number) {\r\n  const isReallyBigNumber = !isFinite(number) || Math.abs(number) > 1000000000;\r\n  return isReallyBigNumber;\r\n}\r\n\r\nexport function range(start, end) {\r\n  const numberOfelems = end - start;\r\n  return Array.apply(0, Array(numberOfelems)).map(\r\n    (element, index) => index + start,\r\n  );\r\n}\r\n\r\nexport function goToHomePage() {\r\n  // Optimisation : ├®viter le rechargement complet de la page\r\n  // R├®initialiser l'├®tat de l'application au lieu de recharger\r\n  try {\r\n    // R├®initialiser l'environnement et l'├®tat\r\n    if (typeof window !== 'undefined' && window.app) {\r\n      // R├®initialiser l'environnement ├á undefined pour retourner ├á la s├®lection\r\n      window.app.environment = undefined;\r\n\r\n      // D├®clencher l'├®v├®nement de changement d'├®tat pour mettre ├á jour l'UI\r\n      window.dispatchEvent(new CustomEvent('state-changed'));\r\n\r\n      // Nettoyer l'URL sans recharger la page\r\n      const url = new URL(window.location);\r\n      url.search = ''; // Supprimer tous les param├¿tres de requ├¬te\r\n      window.history.pushState({}, '', url.toString());\r\n    } else {\r\n      // Fallback : rechargement traditionnel si l'app n'est pas disponible\r\n      window.location = window.location.href.split('?')[0];\r\n    }\r\n  } catch (error) {\r\n    console.warn(\r\n      '[NAVIGATION] Erreur lors de la navigation optimis├®e, utilisation du fallback:',\r\n      error,\r\n    );\r\n    // Fallback en cas d'erreur\r\n    window.location = window.location.href.split('?')[0];\r\n  }\r\n}\r\n\r\nexport function capitalizeFirstLetter(string) {\r\n  return string.charAt(0).toUpperCase() + string.slice(1);\r\n}\r\n\r\nexport function getExtension(filename) {\r\n  return filename.slice(((filename.lastIndexOf('.') - 1) >>> 0) + 2);\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Tools\\geometry.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":53,"column":21,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":53,"endColumn":23,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1635,1637],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":80,"column":14,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":80,"endColumn":16,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2393,2395],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Renvoie true si le point est dans le polygone, false sinon.\r\n * @param  {[Point]} polygon Coordonn├®es des points du polygone\r\n * @param  {Point} point   Coordonn├®es du point\r\n * @return {boolean}         true si le point est dans le polygone\r\n * @copyright: https://sidvind.com/wiki/Point-in-polygon:_Jordan_Curve_Theorem\r\n */\r\nexport function isPointInPolygon(polygon, point) {\r\n  /* Iterate through each line */\r\n  let crossings = 0;\r\n  const nb_pts = polygon.length;\r\n\r\n  for (let i = 0; i < nb_pts; i++) {\r\n    let x1, x2;\r\n    /* This is done to ensure that we get the same result when\r\n           the line goes from left to right and right to left */\r\n    if (polygon[i].x < polygon[(i + 1) % nb_pts].x) {\r\n      x1 = polygon[i].x;\r\n      x2 = polygon[(i + 1) % nb_pts].x;\r\n    } else {\r\n      x1 = polygon[(i + 1) % nb_pts].x;\r\n      x2 = polygon[i].x;\r\n    }\r\n\r\n    /* First check if the ray is possible to cross the line */\r\n    if (\r\n      point.x > x1 &&\r\n      point.x <= x2 &&\r\n      (point.y < polygon[i].y || point.y <= polygon[(i + 1) % nb_pts].y)\r\n    ) {\r\n      const eps = 0.000001;\r\n\r\n      /* Find the equation of the line */\r\n      const dx = polygon[(i + 1) % nb_pts].x - polygon[i].x;\r\n      const dy = polygon[(i + 1) % nb_pts].y - polygon[i].y;\r\n      let k;\r\n\r\n      if (Math.abs(dx) < eps) {\r\n        k = Infinity; // math.h\r\n      } else {\r\n        k = dy / dx;\r\n      }\r\n\r\n      const m = polygon[i].y - k * polygon[i].x;\r\n\r\n      /* Find if the ray crosses the line */\r\n      const y2 = k * point.x + m;\r\n      if (point.y <= y2) {\r\n        crossings++;\r\n      }\r\n    }\r\n  }\r\n  if (crossings % 2 == 1) {\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * V├®rifie si 3 points sont colin├®aires\r\n * @param  {Point} pt1\r\n * @param  {Point} pt2\r\n * @param  {Point} pt3\r\n * @return {Boolean}\r\n */\r\nexport function collinear(pt1, pt2, pt3) {\r\n  const [x1, y1] = [pt2.x - pt1.x, pt2.y - pt1.y],\r\n    [x2, y2] = [pt3.x - pt1.x, pt3.y - pt1.y];\r\n  return Math.abs(x1 * y2 - x2 * y1) < 1e-12;\r\n}\r\n\r\n/**\r\n * Renvoie l'angle ├®quivalent dans l'intervalle [0, 2*Math.PI[\r\n * @param  {[type]} angle en radians\r\n * @return {[type]}       angle ├®quivalent dans l'intervalle [0, 2*Math.PI[\r\n */\r\nexport function positiveAngle(angle) {\r\n  let val = angle % (2 * Math.PI); //angle dans l'intervalle ]2*Math.PI, 2*Math.PI[\r\n  if (val < 0) val += 2 * Math.PI;\r\n  return val == 0 ? 0 : val; // ├®viter de retourner -0.\r\n}\r\n\r\n/**\r\n * V├®rifie si un angle est entre 2 autres angles\r\n * @param  {[type]} srcAngle  angle de d├®part, en radians, dans l'intervalle [0, 2*Math.PI[\r\n * @param  {[type]} dstAngle  angle d'arriv├®e, en radians, dans l'intervalle [0, 2*Math.PI[\r\n * @param  {[type]} direction true si sens anti-horloger, false si sens horloger\r\n * @param  {[type]} angle     l'angle, dans l'intervalle [0, 2*Math.PI[\r\n * @return {[type]}           true si l'angle est dans l'intervalle, false sinon.\r\n * @note: si srcAngle = dstAngle, l'angle est d'office compris entre les 2.\r\n */\r\nexport function isAngleBetweenTwoAngles(srcAngle, dstAngle, direction, angle) {\r\n  if (!direction) {\r\n    //Sens horloger\r\n    if (dstAngle > srcAngle) {\r\n      //situation normale\r\n      return srcAngle <= angle && angle <= dstAngle;\r\n    } else {\r\n      //l'angle de destination ├®tait plus grand que 2*Math.PI\r\n      return srcAngle <= angle || angle <= dstAngle;\r\n    }\r\n  } else {\r\n    //Le sens inverse\r\n    if (dstAngle < srcAngle) {\r\n      //situation normale.\r\n      return srcAngle >= angle && angle >= dstAngle;\r\n    } else {\r\n      //l'angle de destination ├®tait plus petit que z├®ro\r\n      return srcAngle >= angle || angle >= dstAngle;\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Renvoie un valeur dans l'intervalle [0, 2*Math.PI[ de Math.atan2.\r\n * Attention aux arguments: y puis x (comme pour atan2).\r\n * @param  {float} y premier argument de Math.atan2\r\n * @param  {float} x second argument de Math.atan2\r\n * @return {[type]}\tl'angle en radians entre la partie positive de l'axe\r\n * \t\t\t\t\tdes x d'un plan, et le point (x,y) de ce plan.\r\n */\r\nexport function positiveAtan2(y, x) {\r\n  let val = Math.atan2(y, x);\r\n  if (val < 0) val += 2 * Math.PI;\r\n  if (2 * Math.PI - val < 0.00001) val = 0;\r\n  return val;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Tools\\shapesTools.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":62,"column":28,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":62,"endColumn":30,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2260,2262],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":120,"column":14,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":120,"endColumn":16,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4325,4327],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app } from '../App';\r\nimport { CharacteristicElements } from '../Objects/CharacteristicElements';\r\nimport { GeometryObject } from '../Objects/Shapes/GeometryObject';\r\nimport { addInfoToId } from './general';\r\n\r\nexport function duplicateShape(s, layer = 'upper') {\r\n  const newShape = new s.constructor({\r\n    ...s,\r\n    layer,\r\n    path: s.getSVGPath('no scale', false, false),\r\n    divisionPointInfos: s.divisionPoints.map((dp) => {\r\n      return {\r\n        coordinates: dp.coordinates,\r\n        ratio: dp.ratio,\r\n        segmentIdx: dp.segments[0].idx,\r\n        id: addInfoToId(dp.id, layer),\r\n        color: dp.color,\r\n      };\r\n    }),\r\n    segmentsColor: s.segments.map((seg) => {\r\n      return seg.color;\r\n    }),\r\n    pointsColor: s.points.map((pt) => {\r\n      return pt.color;\r\n    }),\r\n  });\r\n  const segIds = newShape.segments.map(\r\n    (seg, idx) => (seg.id = addInfoToId(s.segments[idx].id, layer)),\r\n  );\r\n  const ptIds = newShape.points.map(\r\n    (pt, idx) => (pt.id = addInfoToId(s.points[idx].id, layer)),\r\n  );\r\n  newShape.segmentIds = [...segIds];\r\n  newShape.pointIds = [...ptIds];\r\n  newShape.segments.forEach((seg, idx) => {\r\n    seg.isInfinite = s.segments[idx].isInfinite;\r\n    seg.isSemiInfinite = s.segments[idx].isSemiInfinite;\r\n    seg.vertexIds = s.segments[idx].vertexIds.map((id) =>\r\n      addInfoToId(id, layer),\r\n    );\r\n    seg.divisionPointIds = s.segments[idx].divisionPointIds.map((id) =>\r\n      addInfoToId(id, layer),\r\n    );\r\n    seg.arcCenterId = addInfoToId(s.segments[idx].arcCenterId, layer);\r\n  });\r\n  newShape.points.forEach((pt, idx) => {\r\n    pt.segmentIds = s.points[idx].segmentIds.map((id) =>\r\n      addInfoToId(id, layer),\r\n    );\r\n    // pt.coordinates = new Coordinates(s.points[idx].coordinates);\r\n    pt.reference = addInfoToId(s.points[idx].reference, layer);\r\n    pt.type = s.points[idx].type;\r\n    pt.ratio = s.points[idx].ratio;\r\n    pt.visible = s.points[idx].visible;\r\n    pt.transformConstraints = s.points[idx].transformConstraints;\r\n    pt.endpointIds = s.points[idx].endpointIds?.map((id) =>\r\n      addInfoToId(id, layer),\r\n    );\r\n    pt.geometryIsVisible = s.points[idx].geometryIsVisible;\r\n    pt.geometryIsHidden = s.points[idx].geometryIsHidden;\r\n  });\r\n  if (app.environment.name == 'Geometrie') {\r\n    let newCharacteristicElements = null;\r\n    const characteristicElements =\r\n      s.geometryObject.geometryTransformationCharacteristicElements;\r\n    if (characteristicElements && characteristicElements.elementIds) {\r\n      newCharacteristicElements = new CharacteristicElements({\r\n        ...characteristicElements,\r\n        elementIds: characteristicElements.elementIds.map((elId) =>\r\n          addInfoToId(elId, layer),\r\n        ),\r\n      });\r\n    }\r\n    newShape.geometryObject = new GeometryObject({\r\n      ...s.geometryObject,\r\n      geometryChildShapeIds: s.geometryObject.geometryChildShapeIds.map((id) =>\r\n        addInfoToId(id, layer),\r\n      ),\r\n      geometryParentObjectId1: addInfoToId(\r\n        s.geometryObject.geometryParentObjectId1,\r\n        layer,\r\n      ),\r\n      geometryParentObjectId2: addInfoToId(\r\n        s.geometryObject.geometryParentObjectId2,\r\n        layer,\r\n      ),\r\n      geometryTransformationChildShapeIds:\r\n        s.geometryObject.geometryTransformationChildShapeIds.map((id) =>\r\n          addInfoToId(id, layer),\r\n        ),\r\n      geometryTransformationParentShapeId: addInfoToId(\r\n        s.geometryObject.geometryTransformationParentShapeId,\r\n        layer,\r\n      ),\r\n      geometryTransformationCharacteristicElements: newCharacteristicElements,\r\n      geometryDuplicateChildShapeIds:\r\n        s.geometryObject.geometryDuplicateChildShapeIds.map((id) =>\r\n          addInfoToId(id, layer),\r\n        ),\r\n      geometryDuplicateParentShapeId: addInfoToId(\r\n        s.geometryObject.geometryDuplicateParentShapeId,\r\n        layer,\r\n      ),\r\n      geometryMultipliedChildShapeIds:\r\n        s.geometryObject.geometryMultipliedChildShapeIds.map((id) =>\r\n          addInfoToId(id, layer),\r\n        ),\r\n      geometryMultipliedParentShapeId: addInfoToId(\r\n        s.geometryObject.geometryMultipliedParentShapeId,\r\n        layer,\r\n      ),\r\n    });\r\n  }\r\n  return newShape;\r\n}\r\n\r\nexport function compareIdBetweenLayers(id1, id2) {\r\n  id1 = id1.substring(0, 8);\r\n  id2 = id2.substring(0, 8);\r\n  return id1 == id2;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Core\\Tools\\version-migration.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\CreateCircle\\CreateCircleTool.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":122,"column":29,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":122,"endColumn":31,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3490,3492],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":133,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":133,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3818,3820],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":156,"column":51,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":156,"endColumn":53,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4731,4733],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":169,"column":51,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":169,"endColumn":53,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5260,5262],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":199,"column":51,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":199,"endColumn":53,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6534,6536],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":230,"column":43,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":230,"endColumn":45,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7811,7813],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":232,"column":42,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":232,"endColumn":44,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7875,7877],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":233,"column":42,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":233,"endColumn":44,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7936,7938],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":252,"column":44,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":252,"endColumn":46,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8616,8618],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":275,"column":32,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":275,"endColumn":34,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[9284,9286],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":302,"column":34,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":302,"endColumn":36,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[10128,10130],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":304,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":304,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[10216,10218],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":305,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":305,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[10275,10277],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":442,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":442,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[15007,15009],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":448,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":448,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[15288,15290],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":449,"column":34,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":449,"endColumn":36,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[15343,15345],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":464,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":464,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[15958,15960],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":465,"column":34,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":465,"endColumn":36,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[16013,16015],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":485,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":485,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[16699,16701],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":486,"column":45,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":486,"endColumn":47,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[16785,16787],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":488,"column":45,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":488,"endColumn":47,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[16882,16884],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":490,"column":45,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":490,"endColumn":47,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[16978,16980],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":492,"column":45,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":492,"endColumn":47,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[17077,17079],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":498,"column":17,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":498,"endColumn":19,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[17220,17222],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":500,"column":24,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":500,"endColumn":26,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[17312,17314],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":502,"column":24,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":502,"endColumn":26,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[17404,17406],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":503,"column":42,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":503,"endColumn":44,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[17454,17456],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":512,"column":49,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":512,"endColumn":51,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[17785,17787],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":526,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":526,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[18151,18153],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":548,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":548,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[18777,18779],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":559,"column":47,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":559,"endColumn":49,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[19160,19162],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":588,"column":47,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":588,"endColumn":49,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[20048,20050],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":621,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":621,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[21118,21120],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'idx' is defined but never used. Allowed unused args must match /^_/u.","line":640,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":640,"endColumn":28,"suggestions":[{"messageId":"removeVar","data":{"varName":"idx"},"fix":{"range":[21706,21711],"text":""},"desc":"Remove unused variable 'idx'."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":645,"column":20,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":645,"endColumn":22,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[21833,21835],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":649,"column":27,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":649,"endColumn":29,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[22057,22059],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":652,"column":27,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":652,"endColumn":29,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[22224,22226],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":36,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { html } from 'lit';\r\nimport { app, setState } from '../Core/App';\r\nimport { SelectManager } from '../Core/Managers/SelectManager';\r\nimport { Coordinates } from '../Core/Objects/Coordinates';\r\nimport { GeometryConstraint } from '../Core/Objects/GeometryConstraint';\r\nimport { Point } from '../Core/Objects/Point';\r\nimport { Segment } from '../Core/Objects/Segment';\r\nimport { ArrowLineShape } from '../Core/Objects/Shapes/ArrowLineShape';\r\nimport { GeometryObject } from '../Core/Objects/Shapes/GeometryObject';\r\nimport { LineShape } from '../Core/Objects/Shapes/LineShape';\r\nimport { RegularShape } from '../Core/Objects/Shapes/RegularShape';\r\nimport circles from '../Core/ShapesKits/circles.json';\r\nimport { Tool } from '../Core/States/Tool';\r\nimport { findObjectsByName } from '../Core/Tools/general';\r\nimport { isAngleBetweenTwoAngles } from '../Core/Tools/geometry';\r\nimport { linkNewlyCreatedPoint } from '../GeometryTools/general';\r\nimport { computeConstructionSpec } from '../GeometryTools/recomputeShape';\r\n\r\n/**\r\n * Ajout de figures sur l'espace de travail\r\n */\r\nexport class CreateCircleTool extends Tool {\r\n  constructor() {\r\n    super('createCircle', 'Construire un arc', 'geometryCreator');\r\n\r\n    // show-quadrilaterals -> select-points -> select-direction\r\n    this.currentStep = null;\r\n\r\n    // points of the shape to create\r\n    this.points = [];\r\n\r\n    // points drawn by the user\r\n    this.numberOfPointsDrawn = 0;\r\n\r\n    this.clockwise = undefined;\r\n  }\r\n\r\n  /**\r\n   * Renvoie l'aide ├á afficher ├á l'utilisateur\r\n   * @return {String} L'aide, en HTML\r\n   */\r\n  getHelpText() {\r\n    const toolName = this.title;\r\n    return html`\r\n      <h3>${toolName}</h3>\r\n      <p>Vous avez s├®lectionn├® l'outil <b>\"${toolName}\"</b>.</p>\r\n    `;\r\n  }\r\n\r\n  start() {\r\n    this.removeListeners();\r\n    this.stopAnimation();\r\n\r\n    import('@components/shape-selector');\r\n    const elem = document.createElement('shape-selector');\r\n    elem.family = 'Arcs';\r\n    elem.templatesNames = circles;\r\n    elem.selectedTemplate = app.tool.selectedTemplate;\r\n    elem.type = 'Geometry';\r\n    elem.nextStep = 'drawFirstPoint';\r\n    document.querySelector('body').appendChild(elem);\r\n  }\r\n\r\n  async drawFirstPoint() {\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.removeListeners();\r\n    this.stopAnimation();\r\n\r\n    this.points = [];\r\n    this.segments = [];\r\n    this.numberOfPointsDrawn = 0;\r\n\r\n    setTimeout(\r\n      () =>\r\n        setState({\r\n          tool: { ...app.tool, name: this.name, currentStep: 'drawPoint' },\r\n        }),\r\n      50,\r\n    );\r\n  }\r\n\r\n  drawPoint() {\r\n    this.removeListeners();\r\n    this.stopAnimation();\r\n\r\n    this.getConstraints(this.numberOfPointsDrawn);\r\n\r\n    this.mouseDownId = app.addListener('canvasMouseDown', this.handler);\r\n  }\r\n\r\n  animatePoint() {\r\n    this.removeListeners();\r\n    this.animate();\r\n\r\n    findObjectsByName('constraints', 'upper').forEach(\r\n      (s) => (s.geometryObject.geometryIsVisible = false),\r\n    );\r\n\r\n    this.mouseUpId = app.addListener('canvasMouseUp', this.handler);\r\n  }\r\n\r\n  showArrow() {\r\n    this.removeListeners();\r\n    this.stopAnimation();\r\n\r\n    window.setTimeout(\r\n      () => (this.mouseClickId = app.addListener('canvasClick', this.handler)),\r\n    );\r\n  }\r\n\r\n  end() {\r\n    this.removeListeners();\r\n    this.stopAnimation();\r\n  }\r\n\r\n  canvasMouseDown() {\r\n    const newCoordinates = new Coordinates(\r\n      app.workspace.lastKnownMouseCoordinates,\r\n    );\r\n\r\n    if (\r\n      this.constraints.type == 'isConstrained' &&\r\n      !this.constraints.projectionOnConstraints(newCoordinates, true)\r\n    ) {\r\n      window.dispatchEvent(\r\n        new CustomEvent('show-notif', {\r\n          detail: { message: 'Veuillez placer le point sur la contrainte.' },\r\n        }),\r\n      );\r\n      return;\r\n    }\r\n\r\n    if (app.tool.currentStep == 'drawPoint') {\r\n      this.points[this.numberOfPointsDrawn] = new Point({\r\n        layer: 'upper',\r\n        coordinates: newCoordinates,\r\n        color: app.settings.temporaryDrawColor,\r\n        size: 2,\r\n      });\r\n      this.numberOfPointsDrawn++;\r\n      if (this.numberOfPointsDrawn === 2) {\r\n        if (app.tool.selectedTemplate.name === 'Circle') {\r\n          const seg = new Segment({\r\n            layer: 'upper',\r\n            vertexIds: [this.points[1].id, this.points[1].id],\r\n            arcCenterId: this.points[0].id,\r\n          });\r\n          this.segments.push(seg);\r\n          new RegularShape({\r\n            layer: 'upper',\r\n            segmentIds: this.segments.map((seg) => seg.id),\r\n            pointIds: this.points.map((pt) => pt.id),\r\n            strokeColor: app.settings.temporaryDrawColor,\r\n            fillOpacity: 0,\r\n          });\r\n        } else if (app.tool.selectedTemplate.name == 'CirclePart') {\r\n          const seg = new Segment({\r\n            layer: 'upper',\r\n            vertexIds: [this.points[0].id, this.points[1].id],\r\n          });\r\n          this.segments.push(seg);\r\n          new RegularShape({\r\n            layer: 'upper',\r\n            segmentIds: this.segments.map((seg) => seg.id),\r\n            pointIds: this.points.map((pt) => pt.id),\r\n            strokeColor: app.settings.temporaryDrawColor,\r\n            fillOpacity: 0,\r\n          });\r\n        } else if (app.tool.selectedTemplate.name == '30degreesArc') {\r\n          const angle =\r\n            this.points[0].coordinates.angleWith(this.points[1].coordinates) +\r\n            Math.PI / 6;\r\n          const radius = this.points[0].coordinates.dist(\r\n            this.points[1].coordinates,\r\n          );\r\n          const thirdPointCoordinates = new Coordinates({\r\n            x: this.points[0].coordinates.x + Math.cos(angle) * radius,\r\n            y: this.points[0].coordinates.y + Math.sin(angle) * radius,\r\n          });\r\n          this.points[this.numberOfPointsDrawn] = new Point({\r\n            layer: 'upper',\r\n            coordinates: thirdPointCoordinates,\r\n            color: app.settings.temporaryDrawColor,\r\n            size: 2,\r\n          });\r\n          const seg = new Segment({\r\n            layer: 'upper',\r\n            vertexIds: [this.points[1].id, this.points[2].id],\r\n            arcCenterId: this.points[0].id,\r\n          });\r\n          this.segments.push(seg);\r\n          new ArrowLineShape({\r\n            layer: 'upper',\r\n            segmentIds: this.segments.map((seg) => seg.id),\r\n            pointIds: this.points.map((pt) => pt.id),\r\n            strokeColor: app.settings.temporaryDrawColor,\r\n            fillOpacity: 0,\r\n          });\r\n        } else if (app.tool.selectedTemplate.name == '45degreesArc') {\r\n          const angle =\r\n            this.points[0].coordinates.angleWith(this.points[1].coordinates) +\r\n            Math.PI / 4;\r\n          const radius = this.points[0].coordinates.dist(\r\n            this.points[1].coordinates,\r\n          );\r\n          const thirdPointCoordinates = new Coordinates({\r\n            x: this.points[0].coordinates.x + Math.cos(angle) * radius,\r\n            y: this.points[0].coordinates.y + Math.sin(angle) * radius,\r\n          });\r\n          this.points[this.numberOfPointsDrawn] = new Point({\r\n            layer: 'upper',\r\n            coordinates: thirdPointCoordinates,\r\n            color: app.settings.temporaryDrawColor,\r\n            size: 2,\r\n          });\r\n          const seg = new Segment({\r\n            layer: 'upper',\r\n            vertexIds: [this.points[1].id, this.points[2].id],\r\n            arcCenterId: this.points[0].id,\r\n          });\r\n          this.segments.push(seg);\r\n          new ArrowLineShape({\r\n            layer: 'upper',\r\n            segmentIds: this.segments.map((seg) => seg.id),\r\n            pointIds: this.points.map((pt) => pt.id),\r\n            strokeColor: app.settings.temporaryDrawColor,\r\n            fillOpacity: 0,\r\n          });\r\n        }\r\n      } else if (this.numberOfPointsDrawn == 3) {\r\n        if (\r\n          app.tool.selectedTemplate.name == 'CirclePart' ||\r\n          app.tool.selectedTemplate.name == 'CircleArc'\r\n        ) {\r\n          let seg = new Segment({\r\n            layer: 'upper',\r\n            vertexIds: [this.points[1].id, this.points[2].id],\r\n            arcCenterId: this.points[0].id,\r\n            color: app.settings.referenceDrawColor,\r\n            width: 2,\r\n          });\r\n          this.segments.push(seg);\r\n          seg = new Segment({\r\n            layer: 'upper',\r\n            vertexIds: [this.points[2].id, this.points[1].id],\r\n            arcCenterId: this.points[0].id,\r\n            color: app.settings.referenceDrawColor2,\r\n            width: 2,\r\n          });\r\n          this.segments.push(seg);\r\n        }\r\n        if (app.tool.selectedTemplate.name == 'CirclePart') {\r\n          const seg = new Segment({\r\n            layer: 'upper',\r\n            vertexIds: [this.points[2].id, this.points[0].id],\r\n          });\r\n          this.segments.push(seg);\r\n        }\r\n        new RegularShape({\r\n          layer: 'upper',\r\n          segmentIds: this.segments.map((seg) => seg.id),\r\n          pointIds: this.points.map((pt) => pt.id),\r\n          strokeColor: app.settings.temporaryDrawColor,\r\n          fillOpacity: 0,\r\n        });\r\n      }\r\n      setState({\r\n        tool: { ...app.tool, name: this.name, currentStep: 'animatePoint' },\r\n      });\r\n    }\r\n  }\r\n\r\n  canvasMouseUp() {\r\n    if (\r\n      this.numberOfPointsDrawn == 2 &&\r\n      SelectManager.areCoordinatesInMagnetismDistance(\r\n        this.points[0].coordinates,\r\n        this.points[1].coordinates,\r\n      )\r\n    ) {\r\n      const firstPointCoordinates = this.points[0].coordinates;\r\n      this.numberOfPointsDrawn = 1;\r\n      app.upperCanvasLayer.removeAllObjects();\r\n      this.points[0] = new Point({\r\n        layer: 'upper',\r\n        coordinates: firstPointCoordinates,\r\n        color: app.settings.temporaryDrawColor,\r\n        size: 2,\r\n      });\r\n      this.segments = [];\r\n      window.dispatchEvent(\r\n        new CustomEvent('show-notif', {\r\n          detail: { message: 'Veuillez placer le point autre part.' },\r\n        }),\r\n      );\r\n      setState({\r\n        tool: { ...app.tool, name: this.name, currentStep: 'drawPoint' },\r\n      });\r\n      return;\r\n    }\r\n\r\n    if (this.numberOfPointsDrawn == this.numberOfPointsRequired()) {\r\n      if (\r\n        app.tool.selectedTemplate.name == 'CirclePart' ||\r\n        app.tool.selectedTemplate.name == 'CircleArc'\r\n      ) {\r\n        this.stopAnimation();\r\n        setState({\r\n          tool: { ...app.tool, name: this.name, currentStep: 'showArrow' },\r\n        });\r\n      } else {\r\n        this.stopAnimation();\r\n        this.executeAction();\r\n        app.upperCanvasLayer.removeAllObjects();\r\n        setState({\r\n          tool: { ...app.tool, name: this.name, currentStep: 'drawFirstPoint' },\r\n        });\r\n      }\r\n    } else {\r\n      this.getConstraints(this.numberOfPointsDrawn);\r\n      setState({\r\n        tool: { ...app.tool, name: this.name, currentStep: 'drawPoint' },\r\n      });\r\n    }\r\n  }\r\n\r\n  canvasClick() {\r\n    const angle = this.points[0].coordinates.angleWith(\r\n      app.workspace.lastKnownMouseCoordinates,\r\n    );\r\n    const startAngle = this.points[0].coordinates.angleWith(\r\n      this.points[1].coordinates,\r\n    );\r\n    const endAngle = this.points[0].coordinates.angleWith(\r\n      this.points[2].coordinates,\r\n    );\r\n    const isAngleInside = isAngleBetweenTwoAngles(\r\n      startAngle,\r\n      endAngle,\r\n      false,\r\n      angle,\r\n    );\r\n    this.clockwise = isAngleInside;\r\n    this.executeAction();\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    setState({\r\n      tool: { ...app.tool, name: this.name, currentStep: 'drawFirstPoint' },\r\n    });\r\n  }\r\n\r\n  adjustPoint(point) {\r\n    point.adjustedOn = undefined;\r\n    if (this.constraints.isFree) {\r\n      let constraints = SelectManager.getEmptySelectionConstraints().points;\r\n      constraints.canSelect = true;\r\n      let adjustedPoint;\r\n      if (\r\n        (adjustedPoint = SelectManager.selectPoint(\r\n          point.coordinates,\r\n          constraints,\r\n          false,\r\n        ))\r\n      ) {\r\n        point.coordinates = new Coordinates(adjustedPoint.coordinates);\r\n        point.adjustedOn = adjustedPoint;\r\n      } else if (\r\n        (adjustedPoint = app.gridCanvasLayer.getClosestGridPoint(\r\n          point.coordinates.toCanvasCoordinates(),\r\n        ))\r\n      ) {\r\n        const adjustedPointInWorldSpace = adjustedPoint.fromCanvasCoordinates();\r\n        point.coordinates = new Coordinates(adjustedPointInWorldSpace);\r\n        point.adjustedOn = adjustedPointInWorldSpace;\r\n      } else {\r\n        constraints = SelectManager.getEmptySelectionConstraints().segments;\r\n        constraints.canSelect = true;\r\n        const adjustedSegment = SelectManager.selectSegment(\r\n          point.coordinates,\r\n          constraints,\r\n        );\r\n        if (adjustedSegment) {\r\n          point.coordinates = adjustedSegment.projectionOnSegment(\r\n            point.coordinates,\r\n          );\r\n          point.adjustedOn = adjustedSegment;\r\n        }\r\n      }\r\n    } else {\r\n      let adjustedCoordinates = this.constraints.projectionOnConstraints(\r\n        point.coordinates,\r\n      );\r\n\r\n      const constraints = SelectManager.getEmptySelectionConstraints().segments;\r\n      constraints.canSelect = true;\r\n      constraints.numberOfObjects = 'allInDistance';\r\n      const adjustedSegments = SelectManager.selectSegment(\r\n        adjustedCoordinates,\r\n        constraints,\r\n      );\r\n      if (adjustedSegments) {\r\n        const adjustedSegment = adjustedSegments\r\n          .filter((seg) => !seg.isParalleleWith(this.constraints.segments[0]))\r\n          .sort((seg1, seg2) =>\r\n            seg1\r\n              .projectionOnSegment(adjustedCoordinates)\r\n              .dist(adjustedCoordinates) >\r\n            seg2\r\n              .projectionOnSegment(adjustedCoordinates)\r\n              .dist(adjustedCoordinates)\r\n              ? 1\r\n              : -1,\r\n          )[0];\r\n        if (adjustedSegment) {\r\n          adjustedCoordinates = adjustedSegment\r\n            .intersectionWith(this.constraints.segments[0])\r\n            .sort((intersection1, intersection2) =>\r\n              intersection1.dist(adjustedCoordinates) >\r\n              intersection2.dist(adjustedCoordinates)\r\n                ? 1\r\n                : -1,\r\n            )[0];\r\n          point.adjustedOn = adjustedSegment;\r\n        }\r\n      }\r\n      // let constraints = SelectManager.getEmptySelectionConstraints().segments;\r\n      // constraints.canSelect = true;\r\n      // let adjustedSegment = SelectManager.selectSegment(\r\n      //   adjustedCoordinates,\r\n      //   constraints,\r\n      // );\r\n      // if (adjustedSegment) {\r\n      //   adjustedCoordinates = adjustedSegment.intersectionWith(this.constraints.segments[0]).sort((intersection1, intersection2) =>\r\n      //     intersection1.dist(point.coordinates) > intersection2.dist(point.coordinates) ? 1 : -1\r\n      //   )[0];\r\n      //   point.adjustedOn = adjustedSegment;\r\n      // }\r\n      point.coordinates = new Coordinates(adjustedCoordinates);\r\n    }\r\n  }\r\n\r\n  refreshStateUpper() {\r\n    if (app.tool.currentStep == 'animatePoint') {\r\n      this.points[this.numberOfPointsDrawn - 1].coordinates = new Coordinates(\r\n        app.workspace.lastKnownMouseCoordinates,\r\n      );\r\n      this.adjustPoint(this.points[this.numberOfPointsDrawn - 1]);\r\n      if (\r\n        app.tool.selectedTemplate.name == '30degreesArc' &&\r\n        this.numberOfPointsDrawn == 2\r\n      ) {\r\n        const angle =\r\n          this.points[0].coordinates.angleWith(this.points[1].coordinates) +\r\n          Math.PI / 6;\r\n        const radius = this.points[0].coordinates.dist(\r\n          this.points[1].coordinates,\r\n        );\r\n        const thirdPointCoordinates = new Coordinates({\r\n          x: this.points[0].coordinates.x + Math.cos(angle) * radius,\r\n          y: this.points[0].coordinates.y + Math.sin(angle) * radius,\r\n        });\r\n        this.points[this.numberOfPointsDrawn].coordinates =\r\n          thirdPointCoordinates;\r\n      } else if (\r\n        app.tool.selectedTemplate.name == '45degreesArc' &&\r\n        this.numberOfPointsDrawn == 2\r\n      ) {\r\n        const angle =\r\n          this.points[0].coordinates.angleWith(this.points[1].coordinates) +\r\n          Math.PI / 4;\r\n        const radius = this.points[0].coordinates.dist(\r\n          this.points[1].coordinates,\r\n        );\r\n        const thirdPointCoordinates = new Coordinates({\r\n          x: this.points[0].coordinates.x + Math.cos(angle) * radius,\r\n          y: this.points[0].coordinates.y + Math.sin(angle) * radius,\r\n        });\r\n        this.points[this.numberOfPointsDrawn].coordinates =\r\n          thirdPointCoordinates;\r\n      }\r\n    }\r\n  }\r\n\r\n  numberOfPointsRequired() {\r\n    let numberOfPointsRequired = 0;\r\n    if (app.tool.selectedTemplate.name == 'Circle') numberOfPointsRequired = 2;\r\n    else if (app.tool.selectedTemplate.name == 'CirclePart')\r\n      numberOfPointsRequired = 3;\r\n    else if (app.tool.selectedTemplate.name == 'CircleArc')\r\n      numberOfPointsRequired = 3;\r\n    else if (app.tool.selectedTemplate.name == '30degreesArc')\r\n      numberOfPointsRequired = 2;\r\n    else if (app.tool.selectedTemplate.name == '45degreesArc')\r\n      numberOfPointsRequired = 2;\r\n    return numberOfPointsRequired;\r\n  }\r\n\r\n  getConstraints(pointNb) {\r\n    if (pointNb == 0) {\r\n      this.constraints = new GeometryConstraint('isFree');\r\n    } else if (pointNb == 1) {\r\n      this.constraints = new GeometryConstraint('isFree');\r\n    } else if (pointNb == 2) {\r\n      if (app.tool.selectedTemplate.name == 'CirclePart') {\r\n        const lines = [\r\n          [\r\n            this.points[1].coordinates,\r\n            this.points[1].coordinates,\r\n            this.points[0].coordinates,\r\n          ],\r\n        ];\r\n        this.constraints = new GeometryConstraint('isConstrained', lines);\r\n      } else if (app.tool.selectedTemplate.name == 'CircleArc') {\r\n        const lines = [\r\n          [\r\n            this.points[1].coordinates,\r\n            this.points[1].coordinates,\r\n            this.points[0].coordinates,\r\n          ],\r\n        ];\r\n        this.constraints = new GeometryConstraint('isConstrained', lines);\r\n      }\r\n    }\r\n  }\r\n\r\n  _executeAction() {\r\n    if (app.tool.selectedTemplate.name == 'CirclePart') {\r\n      this.points.push(\r\n        new Point({\r\n          layer: 'upper',\r\n          coordinates: this.points[0].coordinates,\r\n          type: 'arcCenter',\r\n        }),\r\n      );\r\n      this.points[3].adjustedOn = this.points[0];\r\n    }\r\n    const points = this.points.map(\r\n      (pt) =>\r\n        new Point({\r\n          layer: 'main',\r\n          coordinates: new Coordinates(pt.coordinates),\r\n          type: 'vertex',\r\n        }),\r\n    );\r\n    points.forEach((pt, idx) => (pt.adjustedOn = this.points[idx].adjustedOn));\r\n    const segments = [];\r\n\r\n    let idx = 0;\r\n    if (app.tool.selectedTemplate.name == 'Circle') {\r\n      points[0].type = 'arcCenter';\r\n      points[1].idx = 0;\r\n      [points[0], points[1]] = [points[1], points[0]];\r\n      const seg = new Segment({\r\n        layer: 'main',\r\n        idx: idx++,\r\n        vertexIds: [points[0].id, points[0].id],\r\n        arcCenterId: points[1].id,\r\n      });\r\n      segments.push(seg);\r\n    } else if (app.tool.selectedTemplate.name == 'CirclePart') {\r\n      points[0].type = 'vertex';\r\n      points[0].idx = 0;\r\n      points[1].type = 'vertex';\r\n      points[1].idx = 1;\r\n      points[2].type = 'vertex';\r\n      points[2].idx = 2;\r\n      points[3].type = 'arcCenter';\r\n      points[3].adjustedOn = points[0];\r\n      let seg = new Segment({\r\n        layer: 'main',\r\n        idx: idx++,\r\n        vertexIds: [points[0].id, points[1].id],\r\n      });\r\n      segments.push(seg);\r\n      seg = new Segment({\r\n        layer: 'main',\r\n        idx: idx++,\r\n        vertexIds: [points[1].id, points[2].id],\r\n        arcCenterId: points[3].id,\r\n        counterclockwise: !this.clockwise,\r\n      });\r\n      segments.push(seg);\r\n      seg = new Segment({\r\n        layer: 'main',\r\n        idx: idx++,\r\n        vertexIds: [points[2].id, points[0].id],\r\n      });\r\n      segments.push(seg);\r\n    } else if (app.tool.selectedTemplate.name == 'CircleArc') {\r\n      [points[0], points[1], points[2]] = [points[1], points[2], points[0]];\r\n      points[0].type = 'vertex';\r\n      points[0].idx = 0;\r\n      points[1].type = 'vertex';\r\n      points[1].idx = 1;\r\n      points[2].type = 'arcCenter';\r\n      const seg = new Segment({\r\n        layer: 'main',\r\n        idx: idx++,\r\n        vertexIds: [points[0].id, points[1].id],\r\n        arcCenterId: points[2].id,\r\n        counterclockwise: !this.clockwise,\r\n      });\r\n      segments.push(seg);\r\n    } else {\r\n      [points[0], points[1], points[2]] = [points[1], points[2], points[0]];\r\n      points[0].type = 'vertex';\r\n      points[0].idx = 0;\r\n      points[1].type = 'vertex';\r\n      points[1].idx = 1;\r\n      points[2].type = 'arcCenter';\r\n      const seg = new Segment({\r\n        layer: 'main',\r\n        idx: idx++,\r\n        vertexIds: [points[0].id, points[1].id],\r\n        arcCenterId: points[2].id,\r\n        counterclockwise: false,\r\n      });\r\n      segments.push(seg);\r\n    }\r\n\r\n    let constructor = RegularShape;\r\n    if (app.tool.selectedTemplate.name == 'CircleArc') constructor = LineShape;\r\n    else if (app.tool.selectedTemplate.name.endsWith('degreesArc'))\r\n      constructor = ArrowLineShape;\r\n\r\n    const shape = new constructor({\r\n      layer: 'main',\r\n      segmentIds: segments.map((seg) => seg.id),\r\n      pointIds: points.map((pt) => pt.id),\r\n      name: app.tool.selectedTemplate.name,\r\n      familyName: 'circle-shape',\r\n      fillOpacity: 0,\r\n      geometryObject: new GeometryObject({}),\r\n    });\r\n\r\n    segments.forEach((seg, idx) => {\r\n      seg.idx = idx;\r\n      seg.shapeId = shape.id;\r\n    });\r\n\r\n    points.forEach((pt, idx) => {\r\n      pt.shapeId = shape.id;\r\n    });\r\n\r\n    linkNewlyCreatedPoint(shape, shape.vertexes[0]);\r\n    if (shape.name == 'CirclePart') {\r\n      linkNewlyCreatedPoint(shape, shape.segments[1].arcCenter);\r\n      linkNewlyCreatedPoint(shape, shape.vertexes[1]);\r\n      linkNewlyCreatedPoint(shape, shape.vertexes[2]);\r\n    } else if (shape.name == 'CircleArc') {\r\n      linkNewlyCreatedPoint(shape, shape.segments[0].arcCenter);\r\n      linkNewlyCreatedPoint(shape, shape.vertexes[1]);\r\n    } else if (shape.name == 'Circle') {\r\n      linkNewlyCreatedPoint(shape, shape.segments[0].arcCenter);\r\n    } else {\r\n      linkNewlyCreatedPoint(shape, shape.segments[0].arcCenter);\r\n    }\r\n\r\n    computeConstructionSpec(shape);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\CreateCircle\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\CreateIrregular\\CreateIrregularTool.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":184,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":184,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5005,5007],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":201,"column":13,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":201,"endColumn":15,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[5463,5465],"text":"!=="},"desc":"Use '!==' instead of '!='."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { html } from 'lit';\r\nimport { app, setState } from '../Core/App';\r\nimport { SelectManager } from '../Core/Managers/SelectManager';\r\nimport { Coordinates } from '../Core/Objects/Coordinates';\r\nimport { Point } from '../Core/Objects/Point';\r\nimport { Segment } from '../Core/Objects/Segment';\r\nimport { GeometryObject } from '../Core/Objects/Shapes/GeometryObject';\r\nimport { RegularShape } from '../Core/Objects/Shapes/RegularShape';\r\nimport { Tool } from '../Core/States/Tool';\r\nimport { linkNewlyCreatedPoint } from '../GeometryTools/general';\r\n\r\n/**\r\n * Ajout de figures sur l'espace de travail\r\n */\r\nexport class CreateIrregularTool extends Tool {\r\n  constructor() {\r\n    super(\r\n      'createIrregularPolygon',\r\n      'Construire un polygone irr├®gulier',\r\n      'geometryCreator',\r\n    );\r\n\r\n    // listen-canvas-click\r\n    this.points = [];\r\n\r\n    this.shapeId = null;\r\n  }\r\n\r\n  /**\r\n   * Renvoie l'aide ├á afficher ├á l'utilisateur\r\n   * @return {String} L'aide, en HTML\r\n   */\r\n  getHelpText() {\r\n    const toolName = this.title;\r\n    return html`\r\n      <h3>${toolName}</h3>\r\n      <p>Vous avez s├®lectionn├® l'outil <b>\"${toolName}\"</b>.<br /></p>\r\n    `;\r\n  }\r\n\r\n  start() {\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.removeListeners();\r\n\r\n    this.points = [];\r\n    this.segments = [];\r\n\r\n    setTimeout(\r\n      () =>\r\n        setState({\r\n          tool: { ...app.tool, name: this.name, currentStep: 'drawPoint' },\r\n        }),\r\n      50,\r\n    );\r\n  }\r\n\r\n  drawPoint() {\r\n    this.removeListeners();\r\n    this.stopAnimation();\r\n\r\n    this.mouseDownId = app.addListener('canvasMouseDown', this.handler);\r\n  }\r\n\r\n  animatePoint() {\r\n    this.animate();\r\n\r\n    this.mouseUpId = app.addListener('canvasMouseUp', this.handler);\r\n  }\r\n\r\n  /**\r\n   * stopper l'├®tat\r\n   */\r\n  end() {\r\n    this.removeListeners();\r\n    this.stopAnimation();\r\n  }\r\n\r\n  canvasMouseDown() {\r\n    const newCoordinates = new Coordinates(\r\n      app.workspace.lastKnownMouseCoordinates,\r\n    );\r\n\r\n    this.points.push(\r\n      new Point({\r\n        layer: 'upper',\r\n        coordinates: newCoordinates,\r\n        color: app.settings.temporaryDrawColor,\r\n        size: 2,\r\n      }),\r\n    );\r\n    if (this.points.length > 1) {\r\n      const seg = new Segment({\r\n        layer: 'upper',\r\n        vertexIds: [\r\n          this.points[this.points.length - 2].id,\r\n          this.points[this.points.length - 1].id,\r\n        ],\r\n      });\r\n      this.segments.push(seg);\r\n      new RegularShape({\r\n        layer: 'upper',\r\n        segmentIds: [seg.id],\r\n        pointIds: seg.vertexIds,\r\n        strokeColor: app.settings.temporaryDrawColor,\r\n        fillOpacity: 0,\r\n      });\r\n    }\r\n    setState({\r\n      tool: { ...app.tool, name: this.name, currentStep: 'animatePoint' },\r\n    });\r\n  }\r\n\r\n  canvasMouseUp() {\r\n    if (\r\n      this.points.length > 2 &&\r\n      SelectManager.areCoordinatesInMagnetismDistance(\r\n        this.points[0].coordinates,\r\n        this.points[this.points.length - 1].coordinates,\r\n      )\r\n    ) {\r\n      this.stopAnimation();\r\n\r\n      this.executeAction();\r\n      app.upperCanvasLayer.removeAllObjects();\r\n      setState({\r\n        tool: { ...app.tool, name: this.name, currentStep: 'start' },\r\n      });\r\n    } else {\r\n      setState({\r\n        tool: { ...app.tool, name: this.name, currentStep: 'drawPoint' },\r\n      });\r\n    }\r\n  }\r\n\r\n  adjustPoint(point) {\r\n    point.adjustedOn = undefined;\r\n    if (\r\n      this.points.length > 2 &&\r\n      SelectManager.areCoordinatesInMagnetismDistance(\r\n        this.points[0].coordinates,\r\n        point.coordinates,\r\n      )\r\n    )\r\n      point.coordinates = new Coordinates(this.points[0].coordinates);\r\n    else {\r\n      let constraints = SelectManager.getEmptySelectionConstraints().points;\r\n      constraints.canSelect = true;\r\n      let adjustedPoint;\r\n      if (\r\n        (adjustedPoint = SelectManager.selectPoint(\r\n          point.coordinates,\r\n          constraints,\r\n          false,\r\n        ))\r\n      ) {\r\n        point.coordinates = new Coordinates(adjustedPoint.coordinates);\r\n        point.adjustedOn = adjustedPoint;\r\n      } else if (\r\n        (adjustedPoint = app.gridCanvasLayer.getClosestGridPoint(\r\n          point.coordinates.toCanvasCoordinates(),\r\n        ))\r\n      ) {\r\n        const adjustedPointInWorldSpace = adjustedPoint.fromCanvasCoordinates();\r\n        point.coordinates = new Coordinates(adjustedPointInWorldSpace);\r\n        point.adjustedOn = adjustedPointInWorldSpace;\r\n      } else {\r\n        constraints = SelectManager.getEmptySelectionConstraints().segments;\r\n        constraints.canSelect = true;\r\n        const adjustedSegment = SelectManager.selectSegment(\r\n          point.coordinates,\r\n          constraints,\r\n        );\r\n        if (adjustedSegment) {\r\n          point.coordinates = adjustedSegment.projectionOnSegment(\r\n            point.coordinates,\r\n          );\r\n          point.adjustedOn = adjustedSegment;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  refreshStateUpper() {\r\n    if (app.tool.currentStep == 'animatePoint') {\r\n      this.points[this.points.length - 1].coordinates = new Coordinates(\r\n        app.workspace.lastKnownMouseCoordinates,\r\n      );\r\n      this.adjustPoint(this.points[this.points.length - 1]);\r\n    }\r\n  }\r\n\r\n  _executeAction() {\r\n    const familyName = 'Irregular';\r\n\r\n    let path = [\r\n      'M',\r\n      this.points[0].coordinates.x,\r\n      this.points[0].coordinates.y,\r\n    ];\r\n    this.points.forEach((point, i) => {\r\n      if (i != 0) path.push('L', point.coordinates.x, point.coordinates.y);\r\n    });\r\n    // path.push('L', this.points[0].coordinates.x, this.points[0].coordinates.y);\r\n    path = path.join(' ');\r\n\r\n    const shape = new RegularShape({\r\n      layer: 'main',\r\n      path: path,\r\n      name: app.tool.selectedTemplate,\r\n      familyName: familyName,\r\n      fillOpacity: 0,\r\n      geometryObject: new GeometryObject({}),\r\n    });\r\n\r\n    shape.vertexes.forEach((vx, idx) => {\r\n      vx.adjustedOn = this.points[idx].adjustedOn;\r\n      linkNewlyCreatedPoint(shape, vx);\r\n    });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\CreateIrregular\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\CreateLine\\CreateLineTool.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":135,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":135,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[3990,3992],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":159,"column":29,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":159,"endColumn":31,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4559,4561],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":170,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":170,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4887,4889],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":178,"column":42,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":178,"endColumn":44,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5182,5184],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":179,"column":38,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":179,"endColumn":40,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5234,5236],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":200,"column":45,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":200,"endColumn":47,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6058,6060],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":223,"column":43,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":223,"endColumn":45,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6918,6920],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":246,"column":44,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":246,"endColumn":46,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7920,7922],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":269,"column":32,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":269,"endColumn":34,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8563,8565],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":296,"column":34,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":296,"endColumn":36,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[9407,9409],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":390,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":390,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[12659,12661],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":396,"column":34,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":396,"endColumn":36,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[12934,12936],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":397,"column":41,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":397,"endColumn":43,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[13011,13013],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":398,"column":42,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":398,"endColumn":44,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[13083,13085],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":399,"column":42,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":399,"endColumn":44,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[13159,13161],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":425,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":425,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[13767,13769],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":430,"column":47,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":430,"endColumn":49,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[14091,14093],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":439,"column":47,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":439,"endColumn":49,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[14507,14509],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":464,"column":17,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":464,"endColumn":19,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[15229,15231],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":466,"column":24,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":466,"endColumn":26,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[15321,15323],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":488,"column":24,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":488,"endColumn":26,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[16513,16515],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":515,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":515,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[17155,17157],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":523,"column":47,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":523,"endColumn":49,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[17434,17436],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":542,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":542,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[18010,18012],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":543,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":543,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[18071,18073],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":544,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":544,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[18141,18143],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":548,"column":42,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":548,"endColumn":44,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[18285,18287],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":549,"column":42,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":549,"endColumn":44,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[18357,18359],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":554,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":554,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[18515,18517],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":555,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":555,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[18580,18582],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":556,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":556,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[18654,18656],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":560,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":560,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[18809,18811],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":561,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":561,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[18865,18867],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":562,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":562,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[18930,18932],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":34,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { html } from 'lit';\r\nimport { app, setState } from '../Core/App';\r\nimport { SelectManager } from '../Core/Managers/SelectManager';\r\nimport { Coordinates } from '../Core/Objects/Coordinates';\r\nimport { GeometryConstraint } from '../Core/Objects/GeometryConstraint';\r\nimport { Point } from '../Core/Objects/Point';\r\nimport { Segment } from '../Core/Objects/Segment';\r\nimport { ArrowLineShape } from '../Core/Objects/Shapes/ArrowLineShape';\r\nimport { GeometryObject } from '../Core/Objects/Shapes/GeometryObject';\r\nimport { LineShape } from '../Core/Objects/Shapes/LineShape';\r\nimport { StripLineShape } from '../Core/Objects/Shapes/StripLineShape';\r\nimport lines from '../Core/ShapesKits/lines.json';\r\nimport { Tool } from '../Core/States/Tool';\r\nimport { findObjectById } from '../Core/Tools/general';\r\nimport { linkNewlyCreatedPoint } from '../GeometryTools/general';\r\nimport { computeConstructionSpec } from '../GeometryTools/recomputeShape';\r\n\r\n/**\r\n * Ajout de figures sur l'espace de travail\r\n */\r\nexport class CreateLineTool extends Tool {\r\n  constructor() {\r\n    super('createLine', 'Construire une ligne', 'geometryCreator');\r\n\r\n    // show-lines -> select-reference -> select-points\r\n    this.currentStep = null;\r\n\r\n    // points of the shape to create\r\n    this.points = [];\r\n\r\n    // points drawn by the user\r\n    this.numberOfPointsDrawn = 0;\r\n\r\n    // la r├®f├®rence pour la contruction de parall├¿les ou perpendiculaires\r\n    this.geometryParentObjectId = null;\r\n  }\r\n\r\n  /**\r\n   * Renvoie l'aide ├á afficher ├á l'utilisateur\r\n   * @return {String} L'aide, en HTML\r\n   */\r\n  getHelpText() {\r\n    const toolName = this.title;\r\n    return html`\r\n      <h3>${toolName}</h3>\r\n      <p>Vous avez s├®lectionn├® l'outil <b>\"${toolName}\"</b>.</p>\r\n    `;\r\n  }\r\n\r\n  start() {\r\n    this.removeListeners();\r\n    this.stopAnimation();\r\n    this.geometryParentObjectId = null;\r\n\r\n    import('@components/shape-selector');\r\n    const elem = document.createElement('shape-selector');\r\n    elem.family = 'Lignes';\r\n    elem.templatesNames = lines;\r\n    elem.selectedTemplate = app.tool.selectedTemplate;\r\n    elem.type = 'Geometry';\r\n    elem.nextStep = 'drawFirstPoint';\r\n    document.querySelector('body').appendChild(elem);\r\n  }\r\n\r\n  drawFirstPoint() {\r\n    this.removeListeners();\r\n    this.stopAnimation();\r\n\r\n    this.points = [];\r\n    this.segments = [];\r\n    this.numberOfPointsDrawn = 0;\r\n\r\n    if (\r\n      !app.tool.selectedTemplate.name.startsWith('Parallele') &&\r\n      !app.tool.selectedTemplate.name.startsWith('Perpendicular')\r\n    ) {\r\n      app.upperCanvasLayer.removeAllObjects();\r\n      setTimeout(\r\n        () =>\r\n          setState({\r\n            tool: { ...app.tool, name: this.name, currentStep: 'drawPoint' },\r\n          }),\r\n        50,\r\n      );\r\n    } else {\r\n      setTimeout(\r\n        () =>\r\n          setState({\r\n            tool: {\r\n              ...app.tool,\r\n              name: this.name,\r\n              currentStep: 'selectReference',\r\n            },\r\n          }),\r\n        50,\r\n      );\r\n    }\r\n  }\r\n\r\n  selectReference() {\r\n    app.upperCanvasLayer.removeAllObjects();\r\n\r\n    app.workspace.selectionConstraints =\r\n      app.fastSelectionConstraints.click_all_segments;\r\n    this.objectSelectedId = app.addListener('objectSelected', this.handler);\r\n  }\r\n\r\n  drawPoint() {\r\n    this.removeListeners();\r\n    this.stopAnimation();\r\n\r\n    this.getConstraints(this.numberOfPointsDrawn);\r\n\r\n    this.mouseDownId = app.addListener('canvasMouseDown', this.handler);\r\n  }\r\n\r\n  animatePoint() {\r\n    this.removeListeners();\r\n    this.animate();\r\n\r\n    this.mouseUpId = app.addListener('canvasMouseUp', this.handler);\r\n  }\r\n\r\n  end() {\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.removeListeners();\r\n    this.stopAnimation();\r\n  }\r\n\r\n  /**\r\n   * Appel├®e par ├®v├®nement du SelectManager lorsqu'un segment a ├®t├® s├®lectionn├®\r\n   * @param  {Segment} segment            Le segment s├®lectionn├®e\r\n   */\r\n  objectSelected(segment) {\r\n    if (app.tool.currentStep != 'selectReference') return;\r\n\r\n    if (segment.isArc()) return;\r\n\r\n    this.geometryParentObjectId = segment.id;\r\n\r\n    new LineShape({\r\n      layer: 'upper',\r\n      path: segment.getSVGPath('no-scale', true),\r\n      strokeColor: app.settings.referenceDrawColor,\r\n      strokeWidth: 2,\r\n    });\r\n\r\n    setState({\r\n      tool: { ...app.tool, name: this.name, currentStep: 'drawPoint' },\r\n    });\r\n  }\r\n\r\n  canvasMouseDown() {\r\n    const newCoordinates = new Coordinates(\r\n      app.workspace.lastKnownMouseCoordinates,\r\n    );\r\n\r\n    if (\r\n      this.constraints.type == 'isConstrained' &&\r\n      !this.constraints.projectionOnConstraints(newCoordinates, true)\r\n    ) {\r\n      window.dispatchEvent(\r\n        new CustomEvent('show-notif', {\r\n          detail: { message: 'Veuillez placer le point sur la contrainte.' },\r\n        }),\r\n      );\r\n      return;\r\n    }\r\n\r\n    if (app.tool.currentStep == 'drawPoint') {\r\n      this.points[this.numberOfPointsDrawn] = new Point({\r\n        layer: 'upper',\r\n        coordinates: newCoordinates,\r\n        color: app.settings.temporaryDrawColor,\r\n        size: 2,\r\n      });\r\n      this.numberOfPointsDrawn++;\r\n      if (app.tool.selectedTemplate.name == 'Strip') {\r\n        if (this.numberOfPointsDrawn == this.numberOfPointsRequired() - 1) {\r\n          const seg = new Segment({\r\n            layer: 'upper',\r\n            vertexIds: [this.points[0].id, this.points[1].id],\r\n            isInfinite: true,\r\n          });\r\n          this.segments.push(seg);\r\n          const familyName = 'Line';\r\n          const name = app.tool.selectedTemplate.name;\r\n          const shape = new LineShape({\r\n            layer: 'upper',\r\n            segmentIds: this.segments.map((seg) => seg.id),\r\n            pointIds: this.points.map((pt) => pt.id),\r\n            strokeColor: app.settings.temporaryDrawColor,\r\n            name,\r\n            familyName,\r\n          });\r\n          this.segments.forEach((seg, idx) => {\r\n            seg.idx = idx;\r\n            seg.shapeId = shape.id;\r\n          });\r\n        } else if (this.numberOfPointsDrawn == this.numberOfPointsRequired()) {\r\n          this.finishShape();\r\n          const seg = new Segment({\r\n            layer: 'upper',\r\n            vertexIds: [this.points[2].id, this.points[3].id],\r\n            isInfinite: true,\r\n          });\r\n          this.segments.push(seg);\r\n          const familyName = 'Line';\r\n          const name = app.tool.selectedTemplate.name;\r\n          const shape = new LineShape({\r\n            layer: 'upper',\r\n            segmentIds: this.segments.map((seg) => seg.id),\r\n            pointIds: this.points.map((pt) => pt.id),\r\n            strokeColor: app.settings.temporaryDrawColor,\r\n            name,\r\n            familyName,\r\n          });\r\n          this.segments.forEach((seg, idx) => {\r\n            seg.idx = idx;\r\n            seg.shapeId = shape.id;\r\n          });\r\n        }\r\n      } else if (this.numberOfPointsDrawn == this.numberOfPointsRequired()) {\r\n        if (this.numberOfPointsDrawn < 2) this.finishShape();\r\n        const seg = new Segment({\r\n          layer: 'upper',\r\n          vertexIds: [this.points[0].id, this.points[1].id],\r\n          // isInfinite: app.tool.selectedTemplate.endsWith('Parallele')\r\n        });\r\n        if (app.tool.selectedTemplate.name.endsWith('SemiStraightLine')) {\r\n          seg.isSemiInfinite = true;\r\n        } else if (app.tool.selectedTemplate.name.endsWith('StraightLine')) {\r\n          seg.isInfinite = true;\r\n        }\r\n        this.segments.push(seg);\r\n        const familyName = 'Line';\r\n        const name = app.tool.selectedTemplate.name;\r\n        let shape = new LineShape({\r\n          layer: 'upper',\r\n          segmentIds: this.segments.map((seg) => seg.id),\r\n          pointIds: this.points.map((pt) => pt.id),\r\n          strokeColor: app.settings.temporaryDrawColor,\r\n          name,\r\n          familyName,\r\n        });\r\n        if (app.tool.selectedTemplate.name == 'Vector') {\r\n          shape = new ArrowLineShape({\r\n            layer: 'upper',\r\n            segmentIds: this.segments.map((seg) => seg.id),\r\n            pointIds: this.points.map((pt) => pt.id),\r\n            strokeColor: app.settings.temporaryDrawColor,\r\n            name,\r\n            familyName,\r\n          });\r\n        }\r\n        this.segments.forEach((seg, idx) => {\r\n          seg.idx = idx;\r\n          seg.shapeId = shape.id;\r\n        });\r\n      }\r\n      setState({\r\n        tool: { ...app.tool, name: this.name, currentStep: 'animatePoint' },\r\n      });\r\n    }\r\n  }\r\n\r\n  canvasMouseUp() {\r\n    if (\r\n      this.numberOfPointsDrawn == 2 &&\r\n      SelectManager.areCoordinatesInMagnetismDistance(\r\n        this.points[0].coordinates,\r\n        this.points[1].coordinates,\r\n      )\r\n    ) {\r\n      const firstPointCoordinates = this.points[0].coordinates;\r\n      this.numberOfPointsDrawn = 1;\r\n      app.upperCanvasLayer.removeAllObjects();\r\n      this.points[0] = new Point({\r\n        layer: 'upper',\r\n        coordinates: firstPointCoordinates,\r\n        color: app.settings.temporaryDrawColor,\r\n        size: 2,\r\n      });\r\n      this.segments = [];\r\n      window.dispatchEvent(\r\n        new CustomEvent('show-notif', {\r\n          detail: { message: 'Veuillez placer le point autre part.' },\r\n        }),\r\n      );\r\n      setState({\r\n        tool: { ...app.tool, name: this.name, currentStep: 'drawPoint' },\r\n      });\r\n      return;\r\n    }\r\n\r\n    if (this.numberOfPointsDrawn == this.numberOfPointsRequired()) {\r\n      this.stopAnimation();\r\n      this.executeAction();\r\n      app.upperCanvasLayer.removeAllObjects();\r\n      setState({\r\n        tool: { ...app.tool, name: this.name, currentStep: 'drawFirstPoint' },\r\n      });\r\n    } else {\r\n      this.stopAnimation();\r\n      setState({\r\n        tool: { ...app.tool, name: this.name, currentStep: 'drawPoint' },\r\n      });\r\n    }\r\n  }\r\n\r\n  adjustPoint(point) {\r\n    point.adjustedOn = undefined;\r\n    if (this.constraints.isFree) {\r\n      let constraints = SelectManager.getEmptySelectionConstraints().points;\r\n      constraints.canSelect = true;\r\n      let adjustedPoint;\r\n      if (\r\n        (adjustedPoint = SelectManager.selectPoint(\r\n          point.coordinates,\r\n          constraints,\r\n          false,\r\n        ))\r\n      ) {\r\n        point.coordinates = new Coordinates(adjustedPoint.coordinates);\r\n        point.adjustedOn = adjustedPoint;\r\n      } else if (\r\n        (adjustedPoint = app.gridCanvasLayer.getClosestGridPoint(\r\n          point.coordinates.toCanvasCoordinates(),\r\n        ))\r\n      ) {\r\n        const adjustedPointInWorldSpace = adjustedPoint.fromCanvasCoordinates();\r\n        point.coordinates = new Coordinates(adjustedPointInWorldSpace);\r\n        point.adjustedOn = adjustedPointInWorldSpace;\r\n      } else {\r\n        constraints = SelectManager.getEmptySelectionConstraints().segments;\r\n        constraints.canSelect = true;\r\n        const adjustedSegment = SelectManager.selectSegment(\r\n          point.coordinates,\r\n          constraints,\r\n        );\r\n        if (adjustedSegment) {\r\n          point.coordinates = adjustedSegment.projectionOnSegment(\r\n            point.coordinates,\r\n          );\r\n          point.adjustedOn = adjustedSegment;\r\n        }\r\n      }\r\n    } else {\r\n      let adjustedCoordinates = this.constraints.projectionOnConstraints(\r\n        point.coordinates,\r\n      );\r\n\r\n      const constraints = SelectManager.getEmptySelectionConstraints().segments;\r\n      constraints.canSelect = true;\r\n      constraints.numberOfObjects = 'allInDistance';\r\n      const adjustedSegments = SelectManager.selectSegment(\r\n        adjustedCoordinates,\r\n        constraints,\r\n      );\r\n      if (adjustedSegments) {\r\n        const adjustedSegment = adjustedSegments\r\n          .filter((seg) => !seg.isParalleleWith(this.constraints.segments[0]))\r\n          .sort((seg1, seg2) =>\r\n            seg1\r\n              .projectionOnSegment(adjustedCoordinates)\r\n              .dist(adjustedCoordinates) >\r\n            seg2\r\n              .projectionOnSegment(adjustedCoordinates)\r\n              .dist(adjustedCoordinates)\r\n              ? 1\r\n              : -1,\r\n          )[0];\r\n        if (adjustedSegment) {\r\n          adjustedCoordinates = adjustedSegment\r\n            .intersectionWith(this.constraints.segments[0])\r\n            .sort((intersection1, intersection2) =>\r\n              intersection1.dist(adjustedCoordinates) >\r\n              intersection2.dist(adjustedCoordinates)\r\n                ? 1\r\n                : -1,\r\n            )[0];\r\n          point.adjustedOn = adjustedSegment;\r\n        }\r\n      }\r\n      point.coordinates = new Coordinates(adjustedCoordinates);\r\n    }\r\n  }\r\n\r\n  refreshStateUpper() {\r\n    if (app.tool.currentStep == 'animatePoint') {\r\n      this.points[this.numberOfPointsDrawn - 1].coordinates = new Coordinates(\r\n        app.workspace.lastKnownMouseCoordinates,\r\n      );\r\n      this.adjustPoint(this.points[this.numberOfPointsDrawn - 1]);\r\n      if (\r\n        this.numberOfPointsDrawn == this.numberOfPointsRequired() &&\r\n        (app.tool.selectedTemplate.name == 'ParalleleStraightLine' ||\r\n          app.tool.selectedTemplate.name == 'PerpendicularStraightLine' ||\r\n          app.tool.selectedTemplate.name == 'Strip')\r\n      ) {\r\n        this.finishShape();\r\n      }\r\n    }\r\n  }\r\n\r\n  numberOfPointsRequired() {\r\n    const pointsRequired = {\r\n      Segment: 2,\r\n      ParalleleSegment: 2,\r\n      PerpendicularSegment: 2,\r\n      SemiStraightLine: 2,\r\n      ParalleleSemiStraightLine: 2,\r\n      PerpendicularSemiStraightLine: 2,\r\n      StraightLine: 2,\r\n      ParalleleStraightLine: 1,\r\n      PerpendicularStraightLine: 1,\r\n      Strip: 3,\r\n      Vector: 2,\r\n    };\r\n    return pointsRequired[app.tool.selectedTemplate.name];\r\n  }\r\n\r\n  finishShape() {\r\n    let newCoordinates;\r\n    if (app.tool.selectedTemplate.name == 'ParalleleStraightLine') {\r\n      const referenceSegment = findObjectById(this.geometryParentObjectId);\r\n      newCoordinates = this.points[0].coordinates\r\n        .substract(referenceSegment.vertexes[0].coordinates)\r\n        .add(referenceSegment.vertexes[1].coordinates);\r\n    } else if (app.tool.selectedTemplate.name == 'PerpendicularStraightLine') {\r\n      const referenceSegment = findObjectById(this.geometryParentObjectId);\r\n      const angle = referenceSegment.getAngleWithHorizontal() + Math.PI / 2;\r\n      newCoordinates = this.points[0].coordinates.add(\r\n        new Coordinates({\r\n          x: 100 * Math.cos(angle),\r\n          y: 100 * Math.sin(angle),\r\n        }),\r\n      );\r\n    } else if (app.tool.selectedTemplate.name == 'Strip') {\r\n      const referenceSegment = this.segments[0];\r\n      newCoordinates = this.points[2].coordinates\r\n        .substract(referenceSegment.vertexes[0].coordinates)\r\n        .add(referenceSegment.vertexes[1].coordinates);\r\n    }\r\n\r\n    switch (this.points.length) {\r\n      case 1:\r\n      case 3:\r\n        this.points[this.points.length] = new Point({\r\n          layer: 'upper',\r\n          coordinates: newCoordinates,\r\n          color: app.settings.temporaryDrawColor,\r\n          size: 2,\r\n          visible: false,\r\n        });\r\n        break;\r\n      case 2:\r\n      case 4:\r\n        this.points[this.points.length - 1].coordinates = newCoordinates;\r\n    }\r\n  }\r\n\r\n  getConstraints(pointNb) {\r\n    if (pointNb == 0) {\r\n      this.constraints = new GeometryConstraint('isFree');\r\n    } else if (pointNb == 1) {\r\n      if (app.tool.selectedTemplate.name.startsWith('Parallele')) {\r\n        const referenceSegment = findObjectById(this.geometryParentObjectId);\r\n        const secondCoordinates = this.points[0].coordinates\r\n          .substract(referenceSegment.vertexes[0].coordinates)\r\n          .add(referenceSegment.vertexes[1].coordinates);\r\n        const lines = [[this.points[0].coordinates, secondCoordinates]];\r\n        this.constraints = new GeometryConstraint('isConstrained', lines);\r\n      } else if (app.tool.selectedTemplate.name.startsWith('Perpendicular')) {\r\n        const referenceSegment = findObjectById(this.geometryParentObjectId);\r\n        const angle = referenceSegment.getAngleWithHorizontal() + Math.PI / 2;\r\n        const secondCoordinates = this.points[0].coordinates.add(\r\n          new Coordinates({\r\n            x: 100 * Math.cos(angle),\r\n            y: 100 * Math.sin(angle),\r\n          }),\r\n        );\r\n        const lines = [[this.points[0].coordinates, secondCoordinates]];\r\n        this.constraints = new GeometryConstraint('isConstrained', lines);\r\n      } else {\r\n        this.constraints = new GeometryConstraint('isFree');\r\n      }\r\n    } else if (pointNb == 2) {\r\n      this.constraints = new GeometryConstraint('isFree');\r\n    }\r\n  }\r\n\r\n  _executeAction() {\r\n    let path = [\r\n      'M',\r\n      this.points[0].coordinates.x,\r\n      this.points[0].coordinates.y,\r\n      'L',\r\n      this.points[1].coordinates.x,\r\n      this.points[1].coordinates.y,\r\n    ];\r\n    if (this.points.length > 2) {\r\n      path.push(\r\n        'M',\r\n        this.points[2].coordinates.x,\r\n        this.points[2].coordinates.y,\r\n        'L',\r\n        this.points[3].coordinates.x,\r\n        this.points[3].coordinates.y,\r\n      );\r\n    }\r\n    path = path.join(' ');\r\n\r\n    let shape;\r\n    if (app.tool.selectedTemplate.name == 'Vector') {\r\n      shape = new ArrowLineShape({\r\n        layer: 'main',\r\n        path: path,\r\n        name: app.tool.selectedTemplate.name,\r\n        familyName: 'Line',\r\n        geometryObject: new GeometryObject({}),\r\n      });\r\n    } else if (app.tool.selectedTemplate.name == 'Strip') {\r\n      shape = new StripLineShape({\r\n        layer: 'main',\r\n        path: path,\r\n        name: app.tool.selectedTemplate.name,\r\n        fillOpacity: 0.7,\r\n        familyName: 'Line',\r\n        geometryObject: new GeometryObject({}),\r\n      });\r\n      shape.points[3].visible = false;\r\n    } else {\r\n      shape = new LineShape({\r\n        layer: 'main',\r\n        path: path,\r\n        name: app.tool.selectedTemplate.name,\r\n        familyName: 'Line',\r\n        geometryObject: new GeometryObject({}),\r\n      });\r\n      if (\r\n        app.tool.selectedTemplate.name == 'StraightLine' ||\r\n        app.tool.selectedTemplate.name == 'ParalleleStraightLine' ||\r\n        app.tool.selectedTemplate.name == 'PerpendicularStraightLine'\r\n      ) {\r\n        shape.segments[0].isInfinite = true;\r\n        if (\r\n          app.tool.selectedTemplate.name == 'ParalleleStraightLine' ||\r\n          app.tool.selectedTemplate.name == 'PerpendicularStraightLine'\r\n        ) {\r\n          shape.points[1].visible = false;\r\n        }\r\n      } else if (\r\n        app.tool.selectedTemplate.name == 'SemiStraightLine' ||\r\n        app.tool.selectedTemplate.name == 'ParalleleSemiStraightLine' ||\r\n        app.tool.selectedTemplate.name == 'PerpendicularSemiStraightLine'\r\n      ) {\r\n        shape.segments[0].isSemiInfinite = true;\r\n      } else if (\r\n        app.tool.selectedTemplate.name == 'Segment' ||\r\n        app.tool.selectedTemplate.name == 'ParalleleSegment' ||\r\n        app.tool.selectedTemplate.name == 'PerpendicularSegment'\r\n      ) {\r\n      }\r\n    }\r\n\r\n    if (this.geometryParentObjectId) {\r\n      shape.geometryObject.geometryParentObjectId1 =\r\n        this.geometryParentObjectId;\r\n      const reference = findObjectById(this.geometryParentObjectId);\r\n      reference.shape.geometryObject.geometryChildShapeIds.push(shape.id);\r\n    }\r\n\r\n    for (let i = 0; i < this.numberOfPointsRequired(); i++) {\r\n      shape.vertexes[i].adjustedOn = this.points[i].adjustedOn;\r\n      linkNewlyCreatedPoint(shape, shape.vertexes[i]);\r\n    }\r\n\r\n    computeConstructionSpec(shape);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\CreateLine\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\CreatePoint\\CreatePointTool.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":67,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":67,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2215,2217],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":101,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":101,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3152,3154],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":111,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":111,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3431,3433],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":177,"column":38,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":177,"endColumn":40,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5111,5113],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":178,"column":28,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":178,"endColumn":30,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5153,5155],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":219,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":219,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6650,6652],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":229,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":229,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6909,6911],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":237,"column":47,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":237,"endColumn":49,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7245,7247],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":262,"column":47,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":262,"endColumn":49,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8156,8158],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":284,"column":47,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":284,"endColumn":49,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[9016,9018],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":299,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":299,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[9574,9576],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import points from '@controllers/Core/ShapesKits/points.json';\r\nimport { html } from 'lit';\r\nimport { app, setState } from '../Core/App';\r\nimport { SelectManager } from '../Core/Managers/SelectManager';\r\nimport { Coordinates } from '../Core/Objects/Coordinates';\r\nimport { Point } from '../Core/Objects/Point';\r\nimport { GeometryObject } from '../Core/Objects/Shapes/GeometryObject';\r\nimport { LineShape } from '../Core/Objects/Shapes/LineShape';\r\nimport { RegularShape } from '../Core/Objects/Shapes/RegularShape';\r\nimport { SinglePointShape } from '../Core/Objects/Shapes/SinglePointShape';\r\nimport { Tool } from '../Core/States/Tool';\r\nimport { findObjectById } from '../Core/Tools/general';\r\nimport { computeConstructionSpec } from '../GeometryTools/recomputeShape';\r\n\r\n/**\r\n * Ajout de figures sur l'espace de travail\r\n */\r\nexport class CreatePointTool extends Tool {\r\n  constructor() {\r\n    super('createPoint', 'Construire un point', 'geometryCreator');\r\n\r\n    // show-lines -> select-reference -> select-points\r\n    this.currentStep = null;\r\n\r\n    // points of the shape to create\r\n    this.points = [];\r\n\r\n    // points drawn by the user\r\n    this.numberOfPointsDrawn = 0;\r\n\r\n    // la r├®f├®rence pour la contruction de parall├¿les ou perpendiculaires\r\n    this.geometryParentObjectId1 = null;\r\n  }\r\n\r\n  /**\r\n   * Renvoie l'aide ├á afficher ├á l'utilisateur\r\n   * @return {String} L'aide, en HTML\r\n   */\r\n  getHelpText() {\r\n    const toolName = this.title;\r\n    return html`\r\n      <h3>${toolName}</h3>\r\n      <p>Vous avez s├®lectionn├® l'outil <b>\"${toolName}\"</b>.</p>\r\n    `;\r\n  }\r\n\r\n  start() {\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.removeListeners();\r\n    this.stopAnimation();\r\n\r\n    import('@components/shape-selector');\r\n    const elem = document.createElement('shape-selector');\r\n    elem.family = 'Points';\r\n    elem.templatesNames = points;\r\n    elem.selectedTemplate = app.tool.selectedTemplate;\r\n    elem.type = 'Geometry';\r\n    elem.nextStep = 'drawPoint';\r\n    document.querySelector('body').appendChild(elem);\r\n  }\r\n\r\n  drawPoint() {\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.removeListeners();\r\n    this.stopAnimation();\r\n\r\n    if (app.tool.selectedTemplate.name == 'PointOnIntersection') {\r\n      app.workspace.selectionConstraints =\r\n        app.fastSelectionConstraints.click_all_segments;\r\n      this.objectSelectedId = app.addListener('objectSelected', this.handler);\r\n    } else {\r\n      this.mouseDownId = app.addListener('canvasMouseDown', this.handler);\r\n    }\r\n  }\r\n\r\n  selectSecondSegment() {}\r\n\r\n  animatePoint() {\r\n    this.removeListeners();\r\n    this.animate();\r\n\r\n    this.mouseUpId = app.addListener('canvasMouseUp', this.handler);\r\n  }\r\n\r\n  end() {\r\n    this.removeListeners();\r\n    this.stopAnimation();\r\n  }\r\n\r\n  objectSelected(segment) {\r\n    new LineShape({\r\n      layer: 'upper',\r\n      strokeColor: app.settings.temporaryDrawColor,\r\n      strokeWidth: 2,\r\n      path: segment.getSVGPath('no scale', true),\r\n      id: undefined,\r\n      fillColor: '#000',\r\n      fillOpacity: 0,\r\n    });\r\n    window.dispatchEvent(new CustomEvent('refreshUpper'));\r\n    if (app.tool.currentStep == 'drawPoint') {\r\n      this.geometryParentObjectId1 = segment.id;\r\n      setState({\r\n        tool: {\r\n          ...app.tool,\r\n          name: this.name,\r\n          currentStep: 'selectSecondSegment',\r\n        },\r\n      });\r\n    } else {\r\n      if (this.geometryParentObjectId1 == segment.id) {\r\n        window.dispatchEvent(\r\n          new CustomEvent('show-notif', {\r\n            detail: {\r\n              message: 'Veuillez s├®lectionner deux objets diff├®rents.',\r\n            },\r\n          }),\r\n        );\r\n        return;\r\n      }\r\n      this.geometryParentObjectId2 = segment.id;\r\n      this.executeAnimation();\r\n    }\r\n  }\r\n\r\n  executeAnimation() {\r\n    window.clearTimeout(this.timeoutRef);\r\n    this.timeoutRef = window.setTimeout(() => {\r\n      this.executeAction();\r\n      setState({\r\n        tool: { ...app.tool, name: this.name, currentStep: 'drawPoint' },\r\n      });\r\n    }, 200);\r\n  }\r\n\r\n  canvasMouseDown() {\r\n    // Validation des coordonn├®es\r\n    if (!app.workspace.lastKnownMouseCoordinates) {\r\n      console.error('Coordonn├®es de souris non disponibles');\r\n      return;\r\n    }\r\n\r\n    const newCoordinates = new Coordinates(\r\n      app.workspace.lastKnownMouseCoordinates,\r\n    );\r\n\r\n    this.point = new Point({\r\n      layer: 'upper',\r\n      coordinates: newCoordinates,\r\n      color: app.settings.temporaryDrawColor,\r\n      size: 2,\r\n    });\r\n\r\n    setState({\r\n      tool: { ...app.tool, name: this.name, currentStep: 'animatePoint' },\r\n    });\r\n  }\r\n\r\n  canvasMouseUp() {\r\n    this.stopAnimation();\r\n    this.executeAction();\r\n    setState({\r\n      tool: { ...app.tool, name: this.name, currentStep: 'drawPoint' },\r\n    });\r\n  }\r\n\r\n  adjustPoint(point) {\r\n    // Validation des param├¿tres d'entr├®e\r\n    if (!point || !point.coordinates) {\r\n      console.error('Point invalide fourni ├á adjustPoint');\r\n      return;\r\n    }\r\n\r\n    point.adjustedOn = undefined;\r\n    let reference, newCoord;\r\n    if (\r\n      app.tool.selectedTemplate.name == 'Point' ||\r\n      app.environment.name == 'Geometrie'\r\n    ) {\r\n      // Convertir les coordonn├®es du point en espace canvas pour getClosestGridPoint\r\n      const pointInCanvasSpace = point.coordinates.toCanvasCoordinates();\r\n      const gridPointInCanvasSpace =\r\n        app.gridCanvasLayer.getClosestGridPoint(pointInCanvasSpace);\r\n      if (gridPointInCanvasSpace) {\r\n        // Reconvertir le point de grille trouv├® en espace monde\r\n        const gridPointInWorldSpace =\r\n          gridPointInCanvasSpace.fromCanvasCoordinates();\r\n        point.coordinates = new Coordinates(gridPointInWorldSpace);\r\n        point.adjustedOn = gridPointInWorldSpace;\r\n      }\r\n    }\r\n    switch (app.tool.selectedTemplate.name) {\r\n      case 'PointOnLine':\r\n        reference = SelectManager.selectSegment(point.coordinates, {\r\n          canSelect: true,\r\n        });\r\n        if (reference) {\r\n          newCoord = reference.projectionOnSegment(point.coordinates);\r\n          this.geometryParentObjectId1 = reference.id;\r\n        } else {\r\n          this.geometryParentObjectId1 = null;\r\n        }\r\n        if (newCoord) point.coordinates = newCoord;\r\n        break;\r\n      case 'PointOnShape':\r\n        reference = SelectManager.selectShape(point.coordinates, {\r\n          canSelect: true,\r\n        });\r\n        if (reference) {\r\n          this.geometryParentObjectId1 = reference.id;\r\n        } else {\r\n          this.geometryParentObjectId1 = null;\r\n        }\r\n        break;\r\n    }\r\n  }\r\n\r\n  refreshStateUpper() {\r\n    if (app.tool.currentStep == 'animatePoint') {\r\n      this.point.coordinates = new Coordinates(\r\n        app.workspace.lastKnownMouseCoordinates,\r\n      );\r\n      this.adjustPoint(this.point);\r\n    }\r\n  }\r\n\r\n  _executeAction() {\r\n    let shape;\r\n    if (app.tool.selectedTemplate.name == 'Point') {\r\n      shape = new SinglePointShape({\r\n        layer: 'main',\r\n        path: `M ${this.point.coordinates.x} ${this.point.coordinates.y}`,\r\n        name: app.tool.selectedTemplate.name,\r\n        familyName: 'Point',\r\n        geometryObject: new GeometryObject({}),\r\n      });\r\n    } else if (app.tool.selectedTemplate.name == 'PointOnLine') {\r\n      if (!this.geometryParentObjectId1) {\r\n        window.dispatchEvent(\r\n          new CustomEvent('show-notif', {\r\n            detail: {\r\n              message: 'Veuillez choisir une ligne pour placer le point.',\r\n            },\r\n          }),\r\n        );\r\n        return;\r\n      }\r\n      shape = new SinglePointShape({\r\n        layer: 'main',\r\n        path: `M ${this.point.coordinates.x} ${this.point.coordinates.y}`,\r\n        name: app.tool.selectedTemplate.name,\r\n        familyName: 'Point',\r\n        geometryObject: new GeometryObject({}),\r\n      });\r\n      shape.geometryObject.geometryParentObjectId1 =\r\n        this.geometryParentObjectId1;\r\n\r\n      computeConstructionSpec(shape);\r\n\r\n      const reference = findObjectById(this.geometryParentObjectId1);\r\n      reference.shape.geometryObject.geometryChildShapeIds.push(shape.id);\r\n    } else if (app.tool.selectedTemplate.name == 'PointOnShape') {\r\n      if (!this.geometryParentObjectId1) {\r\n        window.dispatchEvent(\r\n          new CustomEvent('show-notif', {\r\n            detail: {\r\n              message: 'Veuillez choisir une figure pour placer le point.',\r\n            },\r\n          }),\r\n        );\r\n        return;\r\n      }\r\n      shape = new RegularShape({\r\n        layer: 'main',\r\n        path: `M ${this.point.coordinates.x} ${this.point.coordinates.y}`,\r\n        name: app.tool.selectedTemplate.name,\r\n        familyName: 'Point',\r\n        geometryObject: new GeometryObject({}),\r\n      });\r\n      shape.geometryObject.geometryParentObjectId1 =\r\n        this.geometryParentObjectId1;\r\n      const reference = findObjectById(this.geometryParentObjectId1);\r\n      reference.geometryObject.geometryChildShapeIds.push(shape.id);\r\n    } else if (app.tool.selectedTemplate.name == 'PointOnIntersection') {\r\n      const firstSeg = findObjectById(this.geometryParentObjectId1);\r\n      const secondSeg = findObjectById(this.geometryParentObjectId2);\r\n      const coords = firstSeg.intersectionWith(secondSeg);\r\n      if (!coords) {\r\n        window.dispatchEvent(\r\n          new CustomEvent('show-notif', {\r\n            detail: {\r\n              message:\r\n                \"Il n' a pas de point d'intersection entre les deux objets s├®lectionn├®s.\",\r\n            },\r\n          }),\r\n        );\r\n        return;\r\n      }\r\n      if (coords.length == 1)\r\n        coords[1] = new Coordinates({ x: coords[0].x, y: coords[0].y });\r\n      shape = new SinglePointShape({\r\n        layer: 'main',\r\n        path: coords.map((coord) => `M ${coord.x} ${coord.y}`).join(' '),\r\n        name: app.tool.selectedTemplate.name,\r\n        familyName: 'Point',\r\n        geometryObject: new GeometryObject({}),\r\n      });\r\n      shape.geometryObject.geometryParentObjectId1 =\r\n        this.geometryParentObjectId1;\r\n      shape.geometryObject.geometryParentObjectId2 =\r\n        this.geometryParentObjectId2;\r\n      firstSeg.shape.geometryObject.geometryChildShapeIds.push(shape.id);\r\n      secondSeg.shape.geometryObject.geometryChildShapeIds.push(shape.id);\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\CreatePoint\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\CreateQuadrilateral\\CreateQuadrilateralTool.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":112,"column":29,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":112,"endColumn":31,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3286,3288],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":140,"column":34,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":140,"endColumn":36,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4136,4138],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":181,"column":38,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":181,"endColumn":40,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5606,5608],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":193,"column":45,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":193,"endColumn":47,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6027,6029],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":224,"column":45,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":224,"endColumn":47,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7136,7138],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":279,"column":34,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":279,"endColumn":36,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8995,8997],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":373,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":373,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[12292,12294],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":379,"column":34,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":379,"endColumn":36,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[12567,12569],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":407,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":407,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[13254,13256],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":409,"column":47,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":409,"endColumn":49,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[13347,13349],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":438,"column":18,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":438,"endColumn":20,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[14384,14386],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":439,"column":18,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":439,"endColumn":20,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[14420,14422],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":440,"column":18,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":440,"endColumn":20,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[14454,14456],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":441,"column":18,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":441,"endColumn":20,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[14494,14496],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":442,"column":18,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":442,"endColumn":20,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[14538,14540],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":443,"column":18,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":443,"endColumn":20,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[14581,14583],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":444,"column":18,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":444,"endColumn":20,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[14615,14617],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":450,"column":18,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":450,"endColumn":20,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[14808,14810],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":451,"column":18,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":451,"endColumn":20,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[14852,14854],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":452,"column":18,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":452,"endColumn":20,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[14886,14888],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":20,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import quadrilateres from '@controllers/Core/ShapesKits/quadrilateres.json';\r\nimport { html } from 'lit';\r\nimport { app, setState } from '../Core/App';\r\nimport { SelectManager } from '../Core/Managers/SelectManager';\r\nimport { Coordinates } from '../Core/Objects/Coordinates';\r\nimport { Point } from '../Core/Objects/Point';\r\nimport { Segment } from '../Core/Objects/Segment';\r\nimport { GeometryObject } from '../Core/Objects/Shapes/GeometryObject';\r\nimport { RegularShape } from '../Core/Objects/Shapes/RegularShape';\r\nimport { Tool } from '../Core/States/Tool';\r\nimport { findObjectsByName, removeObjectById } from '../Core/Tools/general';\r\nimport { linkNewlyCreatedPoint } from '../GeometryTools/general';\r\nimport { computeConstructionSpec } from '../GeometryTools/recomputeShape';\r\n\r\n/**\r\n * Ajout de figures sur l'espace de travail\r\n */\r\nexport class CreateQuadrilateralTool extends Tool {\r\n  constructor() {\r\n    super(\r\n      'createQuadrilateral',\r\n      'Construire un quadrilat├¿re',\r\n      'geometryCreator',\r\n    );\r\n\r\n    // show-quadrilaterals -> select-points\r\n    this.currentStep = null;\r\n\r\n    // points of the shape to create\r\n    this.points = [];\r\n\r\n    // points drawn by the user\r\n    this.numberOfPointsDrawn = 0;\r\n\r\n    // Le tyle de figure que l'on va cr├®er (rectangle, IsoscelesTriangle, RightAngleIsoscelesTriangle, trap├¿ze)\r\n    this.quadrilateralSelected = null;\r\n  }\r\n\r\n  /**\r\n   * Renvoie l'aide ├á afficher ├á l'utilisateur\r\n   * @return {String} L'aide, en HTML\r\n   */\r\n  getHelpText() {\r\n    const toolName = this.title;\r\n    return html`\r\n      <h3>${toolName}</h3>\r\n      <p>Vous avez s├®lectionn├® l'outil <b>\"${toolName}\"</b>.</p>\r\n    `;\r\n  }\r\n\r\n  start() {\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.removeListeners();\r\n    this.stopAnimation();\r\n\r\n    import('@components/shape-selector');\r\n    const elem = document.createElement('shape-selector');\r\n    elem.family = 'Quadrilat├¿res';\r\n    elem.templatesNames = quadrilateres;\r\n    elem.selectedTemplate = app.tool.selectedTemplate;\r\n    elem.type = 'Geometry';\r\n    elem.nextStep = 'drawFirstPoint';\r\n    document.querySelector('body').appendChild(elem);\r\n  }\r\n\r\n  async drawFirstPoint() {\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    const quadrilateralsDef = await import(`./quadrilateralsDef.js`);\r\n    this.quadrilateralDef = quadrilateralsDef[app.tool.selectedTemplate.name];\r\n\r\n    this.points = [];\r\n    this.segments = [];\r\n    this.numberOfPointsDrawn = 0;\r\n\r\n    setTimeout(\r\n      () =>\r\n        setState({\r\n          tool: { ...app.tool, name: this.name, currentStep: 'drawPoint' },\r\n        }),\r\n      50,\r\n    );\r\n  }\r\n\r\n  drawPoint() {\r\n    this.removeListeners();\r\n    this.stopAnimation();\r\n\r\n    this.getConstraints(this.numberOfPointsDrawn);\r\n\r\n    this.mouseDownId = app.addListener('canvasMouseDown', this.handler);\r\n  }\r\n\r\n  animatePoint() {\r\n    this.removeListeners();\r\n    this.animate();\r\n\r\n    this.mouseUpId = app.addListener('canvasMouseUp', this.handler);\r\n  }\r\n\r\n  end() {\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.removeListeners();\r\n    this.stopAnimation();\r\n  }\r\n\r\n  canvasMouseDown() {\r\n    const newCoordinates = new Coordinates(\r\n      app.workspace.lastKnownMouseCoordinates,\r\n    );\r\n\r\n    if (\r\n      this.constraints.type == 'isConstrained' &&\r\n      !this.constraints.projectionOnConstraints(newCoordinates, true)\r\n    ) {\r\n      window.dispatchEvent(\r\n        new CustomEvent('show-notif', {\r\n          detail: { message: 'Veuillez placer le point sur la contrainte.' },\r\n        }),\r\n      );\r\n      return;\r\n    }\r\n\r\n    this.points[this.numberOfPointsDrawn] = new Point({\r\n      layer: 'upper',\r\n      coordinates: newCoordinates,\r\n      color: app.settings.temporaryDrawColor,\r\n      size: 2,\r\n    });\r\n    this.numberOfPointsDrawn++;\r\n    if (this.numberOfPointsDrawn > 1) {\r\n      const seg = new Segment({\r\n        layer: 'upper',\r\n        vertexIds: [\r\n          this.points[this.numberOfPointsDrawn - 2].id,\r\n          this.points[this.numberOfPointsDrawn - 1].id,\r\n        ],\r\n      });\r\n      this.segments.push(seg);\r\n    }\r\n    if (this.numberOfPointsDrawn == this.numberOfPointsRequired()) {\r\n      if (this.numberOfPointsDrawn < 4) this.finishShape();\r\n      const seg = new Segment({\r\n        layer: 'upper',\r\n        vertexIds: [this.points[3].id, this.points[0].id],\r\n      });\r\n      this.segments.push(seg);\r\n      const shape = new RegularShape({\r\n        layer: 'upper',\r\n        segmentIds: this.segments.map((seg) => seg.id),\r\n        pointIds: this.points.map((pt) => pt.id),\r\n        strokeColor: app.settings.temporaryDrawColor,\r\n        fillOpacity: 0,\r\n      });\r\n      this.segments.forEach((seg, idx) => {\r\n        seg.idx = idx;\r\n        seg.shapeId = shape.id;\r\n      });\r\n    } else if (this.numberOfPointsDrawn > 1) {\r\n      new RegularShape({\r\n        layer: 'upper',\r\n        segmentIds: [this.segments[this.numberOfPointsDrawn - 2].id],\r\n        pointIds: this.segments[this.numberOfPointsDrawn - 2].vertexIds,\r\n        strokeColor: app.settings.temporaryDrawColor,\r\n        fillOpacity: 0,\r\n      });\r\n    }\r\n    setState({\r\n      tool: { ...app.tool, name: this.name, currentStep: 'animatePoint' },\r\n    });\r\n  }\r\n\r\n  canvasMouseUp() {\r\n    for (let i = 0; i < this.numberOfPointsDrawn - 1; i++) {\r\n      if (\r\n        SelectManager.areCoordinatesInMagnetismDistance(\r\n          this.points[i].coordinates,\r\n          this.points[this.numberOfPointsDrawn - 1].coordinates,\r\n        )\r\n      ) {\r\n        const firstPointCoordinates = this.points[0].coordinates;\r\n        if (this.numberOfPointsDrawn == 2) {\r\n          app.upperCanvasLayer.removeAllObjects();\r\n          this.numberOfPointsDrawn = 1;\r\n          this.points = [\r\n            new Point({\r\n              layer: 'upper',\r\n              coordinates: firstPointCoordinates,\r\n              color: app.settings.temporaryDrawColor,\r\n              size: 2,\r\n            }),\r\n          ];\r\n          this.segments = [];\r\n        } else if (this.numberOfPointsDrawn == 3) {\r\n          const secondPointCoordinates = this.points[1].coordinates;\r\n          app.upperCanvasLayer.removeAllObjects();\r\n          this.numberOfPointsDrawn = 2;\r\n          this.points = [\r\n            new Point({\r\n              layer: 'upper',\r\n              coordinates: firstPointCoordinates,\r\n              color: app.settings.temporaryDrawColor,\r\n              size: 2,\r\n            }),\r\n            new Point({\r\n              layer: 'upper',\r\n              coordinates: secondPointCoordinates,\r\n              color: app.settings.temporaryDrawColor,\r\n              size: 2,\r\n            }),\r\n          ];\r\n          this.segments = [\r\n            new Segment({\r\n              layer: 'upper',\r\n              vertexIds: [this.points[0].id, this.points[1].id],\r\n            }),\r\n          ];\r\n          new RegularShape({\r\n            layer: 'upper',\r\n            segmentIds: [this.segments[0].id],\r\n            pointIds: this.segments[0].vertexIds,\r\n            strokeColor: app.settings.temporaryDrawColor,\r\n            fillOpacity: 0,\r\n          });\r\n        } else if (this.numberOfPointsDrawn == 4) {\r\n          const secondPointCoordinates = this.points[1].coordinates;\r\n          const thirdPointCoordinates = this.points[2].coordinates;\r\n          app.upperCanvasLayer.removeAllObjects();\r\n          this.numberOfPointsDrawn = 3;\r\n          this.points = [\r\n            new Point({\r\n              layer: 'upper',\r\n              coordinates: firstPointCoordinates,\r\n              color: app.settings.temporaryDrawColor,\r\n              size: 2,\r\n            }),\r\n            new Point({\r\n              layer: 'upper',\r\n              coordinates: secondPointCoordinates,\r\n              color: app.settings.temporaryDrawColor,\r\n              size: 2,\r\n            }),\r\n            new Point({\r\n              layer: 'upper',\r\n              coordinates: thirdPointCoordinates,\r\n              color: app.settings.temporaryDrawColor,\r\n              size: 2,\r\n            }),\r\n          ];\r\n          this.segments = [\r\n            new Segment({\r\n              layer: 'upper',\r\n              vertexIds: [this.points[0].id, this.points[1].id],\r\n            }),\r\n            new Segment({\r\n              layer: 'upper',\r\n              vertexIds: [this.points[1].id, this.points[2].id],\r\n            }),\r\n          ];\r\n          new RegularShape({\r\n            layer: 'upper',\r\n            segmentIds: this.segments.map((seg) => seg.id),\r\n            pointIds: this.points.map((pt) => pt.id),\r\n            strokeColor: app.settings.temporaryDrawColor,\r\n            fillOpacity: 0,\r\n          });\r\n        }\r\n        window.dispatchEvent(\r\n          new CustomEvent('show-notif', {\r\n            detail: { message: 'Veuillez placer le point autre part.' },\r\n          }),\r\n        );\r\n        setState({\r\n          tool: { ...app.tool, name: this.name, currentStep: 'drawPoint' },\r\n        });\r\n        return;\r\n      }\r\n    }\r\n\r\n    if (this.numberOfPointsDrawn == this.numberOfPointsRequired()) {\r\n      this.stopAnimation();\r\n      this.executeAction();\r\n      setState({\r\n        tool: { ...app.tool, name: this.name, currentStep: 'drawFirstPoint' },\r\n      });\r\n    } else {\r\n      this.getConstraints(this.numberOfPointsDrawn);\r\n      setState({\r\n        tool: { ...app.tool, name: this.name, currentStep: 'drawPoint' },\r\n      });\r\n    }\r\n  }\r\n\r\n  adjustPoint(point) {\r\n    point.adjustedOn = undefined;\r\n    if (this.constraints.isFree) {\r\n      let constraints = SelectManager.getEmptySelectionConstraints().points;\r\n      constraints.canSelect = true;\r\n      let adjustedPoint;\r\n      if (\r\n        (adjustedPoint = SelectManager.selectPoint(\r\n          point.coordinates,\r\n          constraints,\r\n          false,\r\n        ))\r\n      ) {\r\n        point.coordinates = new Coordinates(adjustedPoint.coordinates);\r\n        point.adjustedOn = adjustedPoint;\r\n      } else if (\r\n        (adjustedPoint = app.gridCanvasLayer.getClosestGridPoint(\r\n          point.coordinates.toCanvasCoordinates(),\r\n        ))\r\n      ) {\r\n        const adjustedPointInWorldSpace = adjustedPoint.fromCanvasCoordinates();\r\n        point.coordinates = new Coordinates(adjustedPointInWorldSpace);\r\n        point.adjustedOn = adjustedPointInWorldSpace;\r\n      } else {\r\n        constraints = SelectManager.getEmptySelectionConstraints().segments;\r\n        constraints.canSelect = true;\r\n        const adjustedSegment = SelectManager.selectSegment(\r\n          point.coordinates,\r\n          constraints,\r\n        );\r\n        if (adjustedSegment) {\r\n          point.coordinates = adjustedSegment.projectionOnSegment(\r\n            point.coordinates,\r\n          );\r\n          point.adjustedOn = adjustedSegment;\r\n        }\r\n      }\r\n    } else {\r\n      // This is the correct else for if (this.constraints.isFree)\r\n      let adjustedCoordinates = this.constraints.projectionOnConstraints(\r\n        point.coordinates,\r\n      );\r\n\r\n      const constraints = SelectManager.getEmptySelectionConstraints().segments;\r\n      constraints.canSelect = true;\r\n      constraints.numberOfObjects = 'allInDistance';\r\n      const adjustedSegments = SelectManager.selectSegment(\r\n        adjustedCoordinates,\r\n        constraints,\r\n      );\r\n      if (adjustedSegments) {\r\n        const adjustedSegment = adjustedSegments\r\n          .filter((seg) => !seg.isParalleleWith(this.constraints.segments[0]))\r\n          .sort((seg1, seg2) =>\r\n            seg1\r\n              .projectionOnSegment(adjustedCoordinates)\r\n              .dist(adjustedCoordinates) >\r\n            seg2\r\n              .projectionOnSegment(adjustedCoordinates)\r\n              .dist(adjustedCoordinates)\r\n              ? 1\r\n              : -1,\r\n          )[0];\r\n        if (adjustedSegment) {\r\n          adjustedCoordinates = adjustedSegment\r\n            .intersectionWith(this.constraints.segments[0])\r\n            .sort((intersection1, intersection2) =>\r\n              intersection1.dist(adjustedCoordinates) >\r\n              intersection2.dist(adjustedCoordinates)\r\n                ? 1\r\n                : -1,\r\n            )[0];\r\n          point.adjustedOn = adjustedSegment;\r\n        }\r\n      }\r\n      point.coordinates = new Coordinates(adjustedCoordinates);\r\n    }\r\n  }\r\n\r\n  refreshStateUpper() {\r\n    if (app.tool.currentStep == 'animatePoint') {\r\n      this.points[this.numberOfPointsDrawn - 1].coordinates = new Coordinates(\r\n        app.workspace.lastKnownMouseCoordinates,\r\n      );\r\n      this.adjustPoint(this.points[this.numberOfPointsDrawn - 1]);\r\n      if (\r\n        this.numberOfPointsDrawn == this.numberOfPointsRequired() &&\r\n        this.numberOfPointsDrawn < 4\r\n      ) {\r\n        this.finishShape();\r\n      }\r\n    }\r\n  }\r\n\r\n  numberOfPointsRequired() {\r\n    return this.quadrilateralDef.numberOfPointsRequired;\r\n  }\r\n\r\n  finishShape() {\r\n    this.quadrilateralDef.finishShape(this.points, this.segments);\r\n  }\r\n\r\n  getConstraints(pointNb) {\r\n    findObjectsByName('constraints', 'upper').forEach((obj) =>\r\n      removeObjectById(obj.id),\r\n    );\r\n    this.constraints = this.quadrilateralDef.constraints[pointNb](\r\n      this.points,\r\n      this.segments,\r\n    );\r\n  }\r\n\r\n  _executeAction() {\r\n    let familyName = '4-corner-shape';\r\n    if (app.tool.selectedTemplate.name == 'Square') {\r\n      familyName = 'Regular';\r\n    } else if (app.tool.selectedTemplate.name == 'IrregularQuadrilateral') {\r\n      familyName = 'Irregular';\r\n    }\r\n\r\n    let path = [\r\n      'M',\r\n      this.points[0].coordinates.x,\r\n      this.points[0].coordinates.y,\r\n    ];\r\n    path.push('L', this.points[1].coordinates.x, this.points[1].coordinates.y);\r\n    path.push('L', this.points[2].coordinates.x, this.points[2].coordinates.y);\r\n    path.push('L', this.points[3].coordinates.x, this.points[3].coordinates.y);\r\n    path.push('L', this.points[0].coordinates.x, this.points[0].coordinates.y);\r\n    path = path.join(' ');\r\n\r\n    const shape = new RegularShape({\r\n      layer: 'main',\r\n      path: path,\r\n      name: app.tool.selectedTemplate.name,\r\n      familyName: familyName,\r\n      fillOpacity: 0,\r\n      geometryObject: new GeometryObject({}),\r\n    });\r\n\r\n    shape.vertexes[0].adjustedOn = this.points[0].adjustedOn;\r\n    linkNewlyCreatedPoint(shape, shape.vertexes[0]);\r\n    shape.vertexes[1].adjustedOn = this.points[1].adjustedOn;\r\n    linkNewlyCreatedPoint(shape, shape.vertexes[1]);\r\n    if (\r\n      shape.name == 'Rectangle' ||\r\n      shape.name == 'Losange' ||\r\n      shape.name == 'Parallelogram' ||\r\n      shape.name == 'RightAngleTrapeze' ||\r\n      shape.name == 'IsoscelesTrapeze' ||\r\n      shape.name == 'Trapeze' ||\r\n      shape.name == 'IrregularQuadrilateral'\r\n    ) {\r\n      shape.vertexes[2].adjustedOn = this.points[2].adjustedOn;\r\n      linkNewlyCreatedPoint(shape, shape.vertexes[2]);\r\n    }\r\n    if (\r\n      shape.name == 'RightAngleTrapeze' ||\r\n      shape.name == 'Trapeze' ||\r\n      shape.name == 'IrregularQuadrilateral'\r\n    ) {\r\n      shape.vertexes[3].adjustedOn = this.points[3].adjustedOn;\r\n      linkNewlyCreatedPoint(shape, shape.vertexes[3]);\r\n    }\r\n    computeConstructionSpec(shape);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\CreateQuadrilateral\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\CreateQuadrilateral\\quadrilateralsDef.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":45,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":45,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1489,1491],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":84,"column":23,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":84,"endColumn":25,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2705,2707],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":117,"column":23,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":117,"endColumn":25,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3680,3682],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":142,"column":23,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":142,"endColumn":25,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4422,4424],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":206,"column":23,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":206,"endColumn":25,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6495,6497],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app } from '../Core/App';\r\nimport { Coordinates } from '../Core/Objects/Coordinates';\r\nimport { GeometryConstraint } from '../Core/Objects/GeometryConstraint';\r\nimport { Point } from '../Core/Objects/Point';\r\nimport { Segment } from '../Core/Objects/Segment';\r\n\r\nconst finishShapeEnd = (points, segments, numberOfPointsRequired) => {\r\n  if (segments.length < 4) {\r\n    if (numberOfPointsRequired < 3)\r\n      segments.push(\r\n        new Segment({\r\n          layer: 'upper',\r\n          vertexIds: [points[1].id, points[2].id],\r\n        }),\r\n      );\r\n    if (numberOfPointsRequired < 4)\r\n      segments.push(\r\n        new Segment({\r\n          layer: 'upper',\r\n          vertexIds: [points[2].id, points[3].id],\r\n        }),\r\n      );\r\n  }\r\n};\r\n\r\nexport const Square = {\r\n  numberOfPointsRequired: 2,\r\n  constraints: [\r\n    () => new GeometryConstraint('isFree'),\r\n    () => new GeometryConstraint('isFree'),\r\n  ],\r\n  finishShape: (points, segments) => {\r\n    const externalAngle = (Math.PI * 2) / 4;\r\n\r\n    const length = points[0].coordinates.dist(points[1].coordinates);\r\n\r\n    const startAngle = points[0].coordinates.angleWith(points[1].coordinates);\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      const dx = length * Math.cos(startAngle - externalAngle * (i + 1));\r\n      const dy = length * Math.sin(startAngle - externalAngle * (i + 1));\r\n      const newCoordinates = points[i + 1].coordinates.add(\r\n        new Coordinates({ x: dx, y: dy }),\r\n      );\r\n      if (points.length == i + 2) {\r\n        points[i + 2] = new Point({\r\n          layer: 'upper',\r\n          coordinates: newCoordinates,\r\n          color: app.settings.temporaryDrawColor,\r\n          size: 2,\r\n        });\r\n      } else {\r\n        points[i + 2].coordinates = newCoordinates;\r\n      }\r\n    }\r\n    finishShapeEnd(points, segments, Square.numberOfPointsRequired);\r\n  },\r\n};\r\n\r\nexport const Rectangle = {\r\n  numberOfPointsRequired: 3,\r\n  constraints: [\r\n    () => new GeometryConstraint('isFree'),\r\n    () => new GeometryConstraint('isFree'),\r\n    (points) => {\r\n      const angle = points[0].coordinates.angleWith(points[1].coordinates);\r\n      const perpendicularAngle = angle + Math.PI / 2;\r\n      const lines = [\r\n        [\r\n          points[1].coordinates,\r\n          new Coordinates({\r\n            x: points[1].x + Math.cos(perpendicularAngle) * 100,\r\n            y: points[1].y + Math.sin(perpendicularAngle) * 100,\r\n          }),\r\n        ],\r\n      ];\r\n      return new GeometryConstraint('isConstrained', lines);\r\n    },\r\n  ],\r\n  finishShape: (points, segments) => {\r\n    const newCoordinates = points[2].coordinates\r\n      .substract(points[1].coordinates)\r\n      .add(points[0].coordinates);\r\n    if (points.length == 3) {\r\n      points[3] = new Point({\r\n        layer: 'upper',\r\n        coordinates: newCoordinates,\r\n        color: app.settings.temporaryDrawColor,\r\n        size: 2,\r\n      });\r\n    } else {\r\n      points[3].coordinates = newCoordinates;\r\n    }\r\n    finishShapeEnd(points, segments, Rectangle.numberOfPointsRequired);\r\n  },\r\n};\r\n\r\nexport const Losange = {\r\n  numberOfPointsRequired: 3,\r\n  constraints: [\r\n    () => new GeometryConstraint('isFree'),\r\n    () => new GeometryConstraint('isFree'),\r\n    (points) => {\r\n      const lines = [\r\n        [points[0].coordinates, points[0].coordinates, points[1].coordinates],\r\n      ];\r\n      return new GeometryConstraint('isConstrained', lines);\r\n    },\r\n  ],\r\n  finishShape: (points, segments) => {\r\n    const diagonnalCenter = points[0].coordinates.middleWith(\r\n      points[2].coordinates,\r\n    );\r\n    const newCoordinates = diagonnalCenter\r\n      .multiply(2)\r\n      .substract(points[1].coordinates);\r\n    if (points.length == 3) {\r\n      points[3] = new Point({\r\n        layer: 'upper',\r\n        coordinates: newCoordinates,\r\n        color: app.settings.temporaryDrawColor,\r\n        size: 2,\r\n      });\r\n    } else {\r\n      points[3].coordinates = newCoordinates;\r\n    }\r\n    finishShapeEnd(points, segments, Losange.numberOfPointsRequired);\r\n  },\r\n};\r\n\r\nexport const Parallelogram = {\r\n  numberOfPointsRequired: 3,\r\n  constraints: [\r\n    () => new GeometryConstraint('isFree'),\r\n    () => new GeometryConstraint('isFree'),\r\n    () => new GeometryConstraint('isFree'),\r\n  ],\r\n  finishShape: (points, segments) => {\r\n    const newCoordinates = points[2].coordinates\r\n      .substract(points[1].coordinates)\r\n      .add(points[0].coordinates);\r\n    if (points.length == 3) {\r\n      points[3] = new Point({\r\n        layer: 'upper',\r\n        coordinates: newCoordinates,\r\n        color: app.settings.temporaryDrawColor,\r\n        size: 2,\r\n      });\r\n    } else {\r\n      points[3].coordinates = newCoordinates;\r\n    }\r\n    finishShapeEnd(points, segments, Parallelogram.numberOfPointsRequired);\r\n  },\r\n};\r\n\r\nexport const RightAngleTrapeze = {\r\n  numberOfPointsRequired: 4,\r\n  constraints: [\r\n    () => new GeometryConstraint('isFree'),\r\n    () => new GeometryConstraint('isFree'),\r\n    (points) => {\r\n      const angle = points[0].coordinates.angleWith(points[1].coordinates);\r\n      const perpendicularAngle = angle + Math.PI / 2;\r\n      const lines = [\r\n        [\r\n          points[1].coordinates,\r\n          new Coordinates({\r\n            x: points[1].x + Math.cos(perpendicularAngle) * 100,\r\n            y: points[1].y + Math.sin(perpendicularAngle) * 100,\r\n          }),\r\n        ],\r\n      ];\r\n      return new GeometryConstraint('isConstrained', lines);\r\n    },\r\n    (points) => {\r\n      const angle = points[1].coordinates.angleWith(points[2].coordinates);\r\n      const perpendicularAngle = angle + Math.PI / 2;\r\n      const lines = [\r\n        [\r\n          points[2].coordinates,\r\n          new Coordinates({\r\n            x: points[2].x + Math.cos(perpendicularAngle) * 100,\r\n            y: points[2].y + Math.sin(perpendicularAngle) * 100,\r\n          }),\r\n        ],\r\n      ];\r\n      return new GeometryConstraint('isConstrained', lines);\r\n    },\r\n  ],\r\n  finishShape: () => {},\r\n};\r\n\r\nexport const IsoscelesTrapeze = {\r\n  numberOfPointsRequired: 3,\r\n  constraints: [\r\n    () => new GeometryConstraint('isFree'),\r\n    () => new GeometryConstraint('isFree'),\r\n    () => new GeometryConstraint('isFree'),\r\n  ],\r\n  finishShape: (points, segments) => {\r\n    const projection = segments[0].projectionOnSegment(points[2].coordinates);\r\n    const middleOfSegment = segments[0].middle;\r\n    const newCoordinates = points[2].coordinates\r\n      .substract(projection.multiply(2))\r\n      .add(middleOfSegment.multiply(2));\r\n    if (points.length == 3) {\r\n      points[3] = new Point({\r\n        layer: 'upper',\r\n        coordinates: newCoordinates,\r\n        color: app.settings.temporaryDrawColor,\r\n        size: 2,\r\n      });\r\n    } else {\r\n      points[3].coordinates = newCoordinates;\r\n    }\r\n    finishShapeEnd(points, segments, IsoscelesTrapeze.numberOfPointsRequired);\r\n  },\r\n};\r\n\r\nexport const Trapeze = {\r\n  numberOfPointsRequired: 4,\r\n  constraints: [\r\n    () => new GeometryConstraint('isFree'),\r\n    () => new GeometryConstraint('isFree'),\r\n    () => new GeometryConstraint('isFree'),\r\n    (points) => {\r\n      const lines = [\r\n        [\r\n          points[2].coordinates,\r\n          points[2].coordinates\r\n            .substract(points[1].coordinates)\r\n            .add(points[0].coordinates),\r\n        ],\r\n      ];\r\n      return new GeometryConstraint('isConstrained', lines);\r\n    },\r\n  ],\r\n  finishShape: () => {},\r\n};\r\n\r\nexport const IrregularQuadrilateral = {\r\n  numberOfPointsRequired: 4,\r\n  constraints: [\r\n    () => new GeometryConstraint('isFree'),\r\n    () => new GeometryConstraint('isFree'),\r\n    () => new GeometryConstraint('isFree'),\r\n    () => new GeometryConstraint('isFree'),\r\n  ],\r\n  finishShape: () => {},\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\CreateRegular\\CreateRegularTool.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":128,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":128,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3205,3207],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":138,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":138,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3526,3528],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":221,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":221,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6172,6174],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":226,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":226,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6391,6393],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { html } from 'lit';\r\nimport { app, setState } from '../Core/App';\r\nimport { SelectManager } from '../Core/Managers/SelectManager';\r\nimport { Coordinates } from '../Core/Objects/Coordinates';\r\nimport { Point } from '../Core/Objects/Point';\r\nimport { GeometryObject } from '../Core/Objects/Shapes/GeometryObject';\r\nimport { RegularShape } from '../Core/Objects/Shapes/RegularShape';\r\nimport { Tool } from '../Core/States/Tool';\r\nimport { getShapeAdjustment } from '../Core/Tools/automatic_adjustment';\r\nimport {\r\n  createElem,\r\n  findObjectById,\r\n  removeObjectById,\r\n} from '../Core/Tools/general';\r\nimport { linkNewlyCreatedPoint } from '../GeometryTools/general';\r\n\r\n/**\r\n * Ajout de figures sur l'espace de travail\r\n */\r\nexport class CreateRegularTool extends Tool {\r\n  constructor() {\r\n    super(\r\n      'createRegularPolygon',\r\n      'Construire un polygone r├®gulier',\r\n      'geometryCreator',\r\n    );\r\n\r\n    // start -> listen -> selectSecondPoint\r\n    this.currentStep = null;\r\n\r\n    // numbre of points in the shape\r\n    this.numberOfPoints = 4;\r\n  }\r\n\r\n  /**\r\n   * Renvoie l'aide ├á afficher ├á l'utilisateur\r\n   * @return {String} L'aide, en HTML\r\n   */\r\n  getHelpText() {\r\n    const toolName = this.title;\r\n    return html`\r\n      <h3>${toolName}</h3>\r\n      <p>Vous avez s├®lectionn├® l'outil <b>\"${toolName}\"</b>.<br /></p>\r\n    `;\r\n  }\r\n\r\n  /**\r\n   * (r├®-)initialiser l'├®tat\r\n   */\r\n  start() {\r\n    this.removeListeners();\r\n\r\n    createElem('regular-popup');\r\n  }\r\n\r\n  drawFirstPoint() {\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.removeListeners();\r\n\r\n    this.mouseDownId = app.addListener('canvasMouseDown', this.handler);\r\n  }\r\n\r\n  animateFirstPoint() {\r\n    this.removeListeners();\r\n\r\n    const newCoordinates = new Coordinates(\r\n      app.workspace.lastKnownMouseCoordinates,\r\n    );\r\n    this.firstPoint = new Point({\r\n      layer: 'upper',\r\n      coordinates: newCoordinates,\r\n      color: app.settings.temporaryDrawColor,\r\n      size: 2,\r\n    });\r\n\r\n    this.mouseUpId = app.addListener('canvasMouseUp', this.handler);\r\n    this.animate();\r\n  }\r\n\r\n  drawSecondPoint() {\r\n    this.removeListeners();\r\n\r\n    this.mouseDownId = app.addListener('canvasMouseDown', this.handler);\r\n  }\r\n\r\n  animateSecondPoint() {\r\n    this.removeListeners();\r\n\r\n    const newCoordinates = new Coordinates(\r\n      app.workspace.lastKnownMouseCoordinates,\r\n    );\r\n    this.secondPoint = new Point({\r\n      layer: 'upper',\r\n      coordinates: newCoordinates,\r\n      color: app.settings.temporaryDrawColor,\r\n      size: 2,\r\n    });\r\n\r\n    this.mouseUpId = app.addListener('canvasMouseUp', this.handler);\r\n    this.animate();\r\n  }\r\n\r\n  /**\r\n   * stopper l'├®tat\r\n   */\r\n  end() {\r\n    this.removeListeners();\r\n    this.stopAnimation();\r\n  }\r\n\r\n  /**\r\n   * Main event handler\r\n   */\r\n  // _actionHandle(event) {\r\n  //   if (event.type == 'canvasMouseDown') {\r\n  //     this.canvasMouseDown();\r\n  //   } else if (event.type == 'canvasMouseUp') {\r\n  //     this.canvasMouseUp();\r\n  //   }\r\n  // }\r\n\r\n  // setNumberOfPoints(points) {\r\n  //   this.numberOfPoints = parseInt(points);\r\n  //   this.currentStep = 'listen-canvas-click';\r\n  // }\r\n\r\n  canvasMouseDown() {\r\n    if (app.tool.currentStep == 'drawFirstPoint') {\r\n      setState({ tool: { ...app.tool, currentStep: 'animateFirstPoint' } });\r\n    } else {\r\n      setState({ tool: { ...app.tool, currentStep: 'animateSecondPoint' } });\r\n    }\r\n\r\n    window.dispatchEvent(new CustomEvent('refreshUpper'));\r\n  }\r\n\r\n  canvasMouseUp() {\r\n    if (app.tool.currentStep == 'animateFirstPoint') {\r\n      this.stopAnimation();\r\n      this.adjustPoint(this.firstPoint);\r\n      window.dispatchEvent(new CustomEvent('refreshUpper'));\r\n\r\n      setState({ tool: { ...app.tool, currentStep: 'drawSecondPoint' } });\r\n    } else {\r\n      this.stopAnimation();\r\n      if (\r\n        SelectManager.areCoordinatesInMagnetismDistance(\r\n          this.firstPoint.coordinates,\r\n          this.secondPoint.coordinates,\r\n        )\r\n      ) {\r\n        const firstPointCoordinates = this.firstPoint.coordinates;\r\n        app.upperCanvasLayer.removeAllObjects();\r\n        this.firstPoint = new Point({\r\n          layer: 'upper',\r\n          coordinates: firstPointCoordinates,\r\n          color: app.settings.temporaryDrawColor,\r\n          size: 2,\r\n        });\r\n        window.dispatchEvent(\r\n          new CustomEvent('show-notif', {\r\n            detail: { message: 'Veuillez placer le point autre part.' },\r\n          }),\r\n        );\r\n        setState({\r\n          tool: {\r\n            ...app.tool,\r\n            name: this.name,\r\n            currentStep: 'drawSecondPoint',\r\n          },\r\n        });\r\n        return;\r\n      }\r\n      this.adjustPoint(this.secondPoint);\r\n      this.executeAction();\r\n      setState({\r\n        tool: { ...app.tool, name: this.name, currentStep: 'drawFirstPoint' },\r\n      });\r\n    }\r\n  }\r\n\r\n  adjustPoint(point) {\r\n    point.adjustedOn = undefined;\r\n    let constraints = SelectManager.getEmptySelectionConstraints().points;\r\n    constraints.canSelect = true;\r\n    let adjustedPoint;\r\n    if (\r\n      (adjustedPoint = SelectManager.selectPoint(\r\n        point.coordinates,\r\n        constraints,\r\n        false,\r\n      ))\r\n    ) {\r\n      point.coordinates = new Coordinates(adjustedPoint.coordinates);\r\n      point.adjustedOn = adjustedPoint;\r\n    } else if (\r\n      (adjustedPoint = app.gridCanvasLayer.getClosestGridPoint(\r\n        point.coordinates.toCanvasCoordinates(),\r\n      ))\r\n    ) {\r\n      const adjustedPointInWorldSpace = adjustedPoint.fromCanvasCoordinates();\r\n      point.coordinates = new Coordinates(adjustedPointInWorldSpace);\r\n      point.adjustedOn = adjustedPointInWorldSpace;\r\n    } else {\r\n      constraints = SelectManager.getEmptySelectionConstraints().segments;\r\n      constraints.canSelect = true;\r\n      const adjustedSegment = SelectManager.selectSegment(\r\n        point.coordinates,\r\n        constraints,\r\n      );\r\n      if (adjustedSegment) {\r\n        point.coordinates = adjustedSegment.projectionOnSegment(\r\n          point.coordinates,\r\n        );\r\n        point.adjustedOn = adjustedSegment;\r\n      }\r\n    }\r\n  }\r\n\r\n  refreshStateUpper() {\r\n    if (app.tool.currentStep == 'animateFirstPoint') {\r\n      this.firstPoint.coordinates = new Coordinates(\r\n        app.workspace.lastKnownMouseCoordinates,\r\n      );\r\n      this.adjustPoint(this.firstPoint);\r\n    } else if (app.tool.currentStep == 'animateSecondPoint') {\r\n      this.secondPoint.coordinates = new Coordinates(\r\n        app.workspace.lastKnownMouseCoordinates,\r\n      );\r\n      this.adjustPoint(this.secondPoint);\r\n\r\n      const path = this.getPath(\r\n        this.firstPoint.coordinates,\r\n        this.secondPoint.coordinates,\r\n      );\r\n\r\n      if (this.shapeDrawnId) removeObjectById(this.shapeDrawnId);\r\n\r\n      const shape = new RegularShape({\r\n        path: path,\r\n        layer: 'upper',\r\n        strokeColor: app.settings.temporaryDrawColor,\r\n        fillOpacity: 0,\r\n      });\r\n      this.shapeDrawnId = shape.id;\r\n      shape.vertexes.forEach((vx) => {\r\n        vx.color = app.settings.temporaryDrawColor;\r\n        vx.size = 2;\r\n      });\r\n    }\r\n  }\r\n\r\n  getPath(firstCoordinates, secondCoordinates) {\r\n    this.numberOfPoints = app.settings.numberOfRegularPoints;\r\n    const externalAngle = (Math.PI * 2) / this.numberOfPoints;\r\n\r\n    let path = [\r\n      'M',\r\n      firstCoordinates.x,\r\n      firstCoordinates.y,\r\n      'L',\r\n      secondCoordinates.x,\r\n      secondCoordinates.y,\r\n    ];\r\n\r\n    const length = firstCoordinates.dist(secondCoordinates);\r\n\r\n    const startAngle = Math.atan2(\r\n      -(firstCoordinates.y - secondCoordinates.y),\r\n      -(firstCoordinates.x - secondCoordinates.x),\r\n    );\r\n\r\n    let currentCoordinates = secondCoordinates;\r\n\r\n    for (let i = 0; i < this.numberOfPoints - 2; i++) {\r\n      const dx = length * Math.cos(startAngle - (i + 1) * externalAngle);\r\n      const dy = length * Math.sin(startAngle - (i + 1) * externalAngle);\r\n\r\n      currentCoordinates = currentCoordinates.add({ x: dx, y: dy });\r\n\r\n      path.push('L', currentCoordinates.x, currentCoordinates.y);\r\n    }\r\n\r\n    path.push('L', firstCoordinates.x, firstCoordinates.y);\r\n\r\n    path = path.join(' ');\r\n\r\n    return path;\r\n  }\r\n\r\n  executeAction() {\r\n    const shapeDrawn = findObjectById(this.shapeDrawnId);\r\n\r\n    const shape = new RegularShape({\r\n      ...shapeDrawn,\r\n      layer: 'main',\r\n      path: shapeDrawn.getSVGPath('no-scale'),\r\n      familyName: 'Regular',\r\n      strokeColor: '#000000',\r\n      fillOpacity: 0,\r\n      geometryObject: new GeometryObject({}),\r\n    });\r\n\r\n    const transformation = getShapeAdjustment([shape], shape);\r\n    shape.rotate(transformation.rotationAngle, shape.centerCoordinates);\r\n    shape.translate(transformation.translation);\r\n    shape.vertexes[0].adjustedOn = this.firstPoint.adjustedOn;\r\n    shape.vertexes[1].adjustedOn = this.secondPoint.adjustedOn;\r\n    linkNewlyCreatedPoint(shape, shape.vertexes[0]);\r\n    linkNewlyCreatedPoint(shape, shape.vertexes[1]);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\CreateRegular\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\CreateRegular\\regular-popup.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":137,"column":44,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":137,"endColumn":46,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3884,3886],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":148,"column":44,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":148,"endColumn":46,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4200,4202],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import '@components/color-button';\r\nimport { TemplatePopup } from '@components/popups/template-popup';\r\nimport { css, html, LitElement } from 'lit';\r\nimport { app, setState } from '../Core/App';\r\n\r\nclass RegularPopup extends LitElement {\r\n  constructor() {\r\n    super();\r\n\r\n    window.addEventListener(\r\n      'close-popup',\r\n      () => {\r\n        this.submitAndClose();\r\n      },\r\n      {\r\n        once: true,\r\n      },\r\n    );\r\n\r\n    this.updateProperties = () => {\r\n      this.points = app.settings.numberOfRegularPoints;\r\n    };\r\n    this.updateProperties();\r\n\r\n    this.eventHandler = () => {\r\n      this.updateProperties();\r\n    };\r\n    window.addEventListener('settings-changed', this.eventHandler);\r\n  }\r\n\r\n  static get properties() {\r\n    return {\r\n      points: Number,\r\n    };\r\n  }\r\n\r\n  static get styles() {\r\n    return [\r\n      TemplatePopup.template_popup_styles(),\r\n      css`\r\n        select {\r\n          width: 2rem;\r\n        }\r\n\r\n        input {\r\n          display: inline;\r\n          width: 60%;\r\n        }\r\n\r\n        #hello {\r\n          height: 3em;\r\n          width: 100%;\r\n          display: flex;\r\n          justify-content: center;\r\n        }\r\n\r\n        .clickable {\r\n          cursor: pointer;\r\n          padding: 10px;\r\n          padding-top: 1em;\r\n        }\r\n      `,\r\n    ];\r\n  }\r\n\r\n  render() {\r\n    return html`\r\n      <template-popup>\r\n        <h2 slot=\"title\">Construire un polygone r├®gulier</h2>\r\n        <div slot=\"body\" id=\"body\">\r\n          <label for=\"settings_divide_number_of_parts\"\r\n            >Construire un polygone ├á ${this.points} cot├®s\r\n          </label>\r\n          <div id=\"hello\">\r\n            <div class=\"clickable\" @click=\"${this.decrementNumberOfPoints}\">\r\n              -\r\n            </div>\r\n            <input\r\n              id=\"myRange\"\r\n              type=\"range\"\r\n              min=\"3\"\r\n              max=\"20\"\r\n              value=\"${this.points}\"\r\n              list=\"level\"\r\n              @input=\"${this.changeNumberOfPoints}\"\r\n            />\r\n            <datalist id=\"level\">\r\n              <option value=\"3\" label=\"3\">3</option>\r\n              <option value=\"4\" label=\"4\">4</option>\r\n              <option value=\"5\" label=\"5\">5</option>\r\n              <option value=\"6\" label=\"6\">6</option>\r\n              <option value=\"7\" label=\"7\">7</option>\r\n              <option value=\"8\" label=\"8\">8</option>\r\n              <option value=\"9\" label=\"9\">9</option>\r\n              <option value=\"10\" label=\"10\">10</option>\r\n              <option value=\"11\" label=\"11\">11</option>\r\n              <option value=\"12\" label=\"12\">12</option>\r\n              <option value=\"13\" label=\"13\">13</option>\r\n              <option value=\"14\" label=\"14\">14</option>\r\n              <option value=\"15\" label=\"15\">15</option>\r\n              <option value=\"16\" label=\"16\">16</option>\r\n              <option value=\"17\" label=\"17\">17</option>\r\n              <option value=\"18\" label=\"18\">18</option>\r\n              <option value=\"19\" label=\"19\">19</option>\r\n              <option value=\"20\" label=\"20\">20</option>\r\n            </datalist>\r\n            <div class=\"clickable\" @click=\"${this.incrementNumberOfPoints}\">\r\n              +\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div slot=\"footer\">\r\n          <color-button\r\n            @click=\"${() =>\r\n              window.dispatchEvent(new CustomEvent('close-popup'))}\"\r\n            innerText=\"Ok\"\r\n            backgroundColor=\"${getComputedStyle(\r\n              document.documentElement,\r\n            ).getPropertyValue('--theme-color')}\"\r\n          ></color-button>\r\n        </div>\r\n      </template-popup>\r\n    `;\r\n  }\r\n\r\n  changeNumberOfPoints(event) {\r\n    setState({\r\n      settings: {\r\n        ...app.settings,\r\n        numberOfRegularPoints: parseInt(event.target.value),\r\n      },\r\n    });\r\n  }\r\n\r\n  decrementNumberOfPoints() {\r\n    if (app.settings.numberOfRegularPoints == 3) return;\r\n    setState({\r\n      settings: {\r\n        ...app.settings,\r\n        numberOfRegularPoints: app.settings.numberOfRegularPoints - 1,\r\n      },\r\n    });\r\n    this.shadowRoot.querySelector('#myRange').value = this.points;\r\n  }\r\n\r\n  incrementNumberOfPoints() {\r\n    if (app.settings.numberOfRegularPoints == 20) return;\r\n    setState({\r\n      settings: {\r\n        ...app.settings,\r\n        numberOfRegularPoints: app.settings.numberOfRegularPoints + 1,\r\n      },\r\n    });\r\n    this.shadowRoot.querySelector('#myRange').value = this.points;\r\n  }\r\n\r\n  submit() {\r\n    setState({\r\n      tool: {\r\n        ...app.tool,\r\n        name: 'createRegularPolygon',\r\n        currentStep: 'drawFirstPoint',\r\n      },\r\n    });\r\n  }\r\n\r\n  close() {\r\n    this.remove();\r\n    window.removeEventListener('settings-changed', this.eventHandler);\r\n  }\r\n\r\n  submitAndClose() {\r\n    this.submit();\r\n    this.close();\r\n  }\r\n}\r\ncustomElements.define('regular-popup', RegularPopup);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\CreateTriangle\\CreateTriangleTool.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":84,"column":29,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":84,"endColumn":31,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2377,2379],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":112,"column":34,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":112,"endColumn":36,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3199,3201],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":153,"column":38,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":153,"endColumn":40,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4574,4576],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":165,"column":45,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":165,"endColumn":47,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4983,4985],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":209,"column":34,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":209,"endColumn":36,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6368,6370],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":314,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":314,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[10093,10095],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":320,"column":34,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":320,"endColumn":36,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[10362,10364],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":353,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":353,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[11128,11130],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":355,"column":47,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":355,"endColumn":49,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[11232,11234],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":383,"column":18,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":383,"endColumn":20,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[12155,12157],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":384,"column":18,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":384,"endColumn":20,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[12199,12201],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":385,"column":18,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":385,"endColumn":20,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[12242,12244],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":12,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app, setState } from '../Core/App';\nimport { SelectManager } from '../Core/Managers/SelectManager';\nimport { Coordinates } from '../Core/Objects/Coordinates';\nimport { Point } from '../Core/Objects/Point';\nimport { Segment } from '../Core/Objects/Segment';\nimport { GeometryObject } from '../Core/Objects/Shapes/GeometryObject';\nimport { RegularShape } from '../Core/Objects/Shapes/RegularShape';\nimport triangles from '../Core/ShapesKits/triangles.json';\nimport { BaseShapeCreationTool } from '../Core/States/BaseShapeCreationTool';\nimport { linkNewlyCreatedPoint } from '../GeometryTools/general';\nimport { computeConstructionSpec } from '../GeometryTools/recomputeShape';\n\n/**\n * Outil de cr├®ation de triangles - Refactoris├® avec BaseShapeCreationTool\n */\nexport class CreateTriangleTool extends BaseShapeCreationTool {\n  constructor() {\n    super('createTriangle', 'Construire un triangle', 'Triangles', triangles);\n    this.triangleDef = null;\n  }\n\n  /**\n   * Chargement de la d├®finition du triangle s├®lectionn├®\n   */\n  async loadShapeDefinition() {\n    const triangleDef = await import(`./trianglesDef.js`);\n    this.triangleDef = triangleDef[app.tool.selectedTemplate.name];\n\n    if (!this.triangleDef) {\n      throw new Error(\n        `D├®finition non trouv├®e pour ${app.tool.selectedTemplate.name}`,\n      );\n    }\n  }\n\n  async drawFirstPoint() {\n    app.upperCanvasLayer.removeAllObjects();\n    const triangleDef = await import(`./trianglesDef.js`);\n    this.triangleDef = triangleDef[app.tool.selectedTemplate.name];\n\n    this.points = [];\n    this.segments = [];\n    this.numberOfPointsDrawn = 0;\n\n    setTimeout(\n      () =>\n        setState({\n          tool: { ...app.tool, name: this.name, currentStep: 'drawPoint' },\n        }),\n      50,\n    );\n  }\n\n  drawPoint() {\n    this.removeListeners();\n    this.stopAnimation();\n\n    this.getConstraints(this.numberOfPointsDrawn);\n\n    this.mouseDownId = app.addListener('canvasMouseDown', this.handler);\n  }\n\n  animatePoint() {\n    this.removeListeners();\n    this.animate();\n\n    this.mouseUpId = app.addListener('canvasMouseUp', this.handler);\n  }\n\n  /**\n   * stopper l'├®tat\n   */\n  end() {\n    this.removeListeners();\n    this.stopAnimation();\n  }\n\n  canvasMouseDown() {\n    const newCoordinates = new Coordinates(\n      app.workspace.lastKnownMouseCoordinates,\n    );\n\n    if (\n      this.constraints.type == 'isConstrained' &&\n      !this.constraints.projectionOnConstraints(newCoordinates, true)\n    ) {\n      window.dispatchEvent(\n        new CustomEvent('show-notif', {\n          detail: { message: 'Veuillez placer le point sur la contrainte.' },\n        }),\n      );\n      return;\n    }\n\n    this.points[this.numberOfPointsDrawn] = new Point({\n      layer: 'upper',\n      coordinates: newCoordinates,\n      color: app.settings.temporaryDrawColor,\n      size: 2,\n    });\n    this.numberOfPointsDrawn++;\n    if (this.numberOfPointsDrawn > 1) {\n      const seg = new Segment({\n        layer: 'upper',\n        vertexIds: [\n          this.points[this.numberOfPointsDrawn - 2].id,\n          this.points[this.numberOfPointsDrawn - 1].id,\n        ],\n      });\n      this.segments.push(seg);\n    }\n    if (this.numberOfPointsDrawn == this.numberOfPointsRequired()) {\n      if (this.numberOfPointsDrawn < 3) this.finishShape();\n      const seg = new Segment({\n        layer: 'upper',\n        vertexIds: [this.points[2].id, this.points[0].id],\n      });\n      this.segments.push(seg);\n      const shape = new RegularShape({\n        layer: 'upper',\n        segmentIds: this.segments.map((seg) => seg.id),\n        pointIds: this.points.map((pt) => pt.id),\n        strokeColor: app.settings.temporaryDrawColor,\n        fillOpacity: 0,\n      });\n      this.segments.forEach((seg, idx) => {\n        seg.idx = idx;\n        seg.shapeId = shape.id;\n      });\n    } else if (this.numberOfPointsDrawn > 1) {\n      new RegularShape({\n        layer: 'upper',\n        segmentIds: [this.segments[0].id],\n        pointIds: this.segments[0].vertexIds,\n        strokeColor: app.settings.temporaryDrawColor,\n        fillOpacity: 0,\n      });\n    }\n    setState({\n      tool: { ...app.tool, name: this.name, currentStep: 'animatePoint' },\n    });\n  }\n\n  canvasMouseUp() {\n    for (let i = 0; i < this.numberOfPointsDrawn - 1; i++) {\n      if (\n        SelectManager.areCoordinatesInMagnetismDistance(\n          this.points[i].coordinates,\n          this.points[this.numberOfPointsDrawn - 1].coordinates,\n        )\n      ) {\n        const firstPointCoordinates = this.points[0].coordinates;\n        if (this.numberOfPointsDrawn == 2) {\n          app.upperCanvasLayer.removeAllObjects();\n          this.numberOfPointsDrawn = 1;\n          this.points = [\n            new Point({\n              layer: 'upper',\n              coordinates: firstPointCoordinates,\n              color: app.settings.temporaryDrawColor,\n              size: 2,\n            }),\n          ];\n          this.segments = [];\n        } else if (this.numberOfPointsDrawn == 3) {\n          const secondPointCoordinates = this.points[1].coordinates;\n          app.upperCanvasLayer.removeAllObjects();\n          this.numberOfPointsDrawn = 2;\n          this.points = [\n            new Point({\n              layer: 'upper',\n              coordinates: firstPointCoordinates,\n              color: app.settings.temporaryDrawColor,\n              size: 2,\n            }),\n            new Point({\n              layer: 'upper',\n              coordinates: secondPointCoordinates,\n              color: app.settings.temporaryDrawColor,\n              size: 2,\n            }),\n          ];\n          this.segments = [\n            new Segment({\n              layer: 'upper',\n              vertexIds: [this.points[0].id, this.points[1].id],\n            }),\n          ];\n          new RegularShape({\n            layer: 'upper',\n            segmentIds: [this.segments[0].id],\n            pointIds: this.segments[0].vertexIds,\n            strokeColor: app.settings.temporaryDrawColor,\n            fillOpacity: 0,\n          });\n        }\n        window.dispatchEvent(\n          new CustomEvent('show-notif', {\n            detail: { message: 'Veuillez placer le point autre part.' },\n          }),\n        );\n        setState({\n          tool: { ...app.tool, name: this.name, currentStep: 'drawPoint' },\n        });\n        return;\n      }\n    }\n\n    if (this.numberOfPointsDrawn == this.numberOfPointsRequired()) {\n      this.stopAnimation();\n      this.executeAction();\n      app.upperCanvasLayer.removeAllObjects();\n      setState({\n        tool: { ...app.tool, name: this.name, currentStep: 'drawFirstPoint' },\n      });\n    } else {\n      setState({\n        tool: { ...app.tool, name: this.name, currentStep: 'drawPoint' },\n      });\n    }\n  }\n\n  adjustPoint(point) {\n    point.adjustedOn = undefined;\n    if (this.constraints.isFree) {\n      let constraints = SelectManager.getEmptySelectionConstraints().points;\n      constraints.canSelect = true;\n      let adjustedPoint;\n      if (\n        (adjustedPoint = SelectManager.selectPoint(\n          point.coordinates,\n          constraints,\n          false,\n        ))\n      ) {\n        point.coordinates = new Coordinates(adjustedPoint.coordinates);\n        point.adjustedOn = adjustedPoint;\n      } else if (\n        (adjustedPoint = app.gridCanvasLayer.getClosestGridPoint(\n          point.coordinates.toCanvasCoordinates(),\n        ))\n      ) {\n        const adjustedPointInWorldSpace = adjustedPoint.fromCanvasCoordinates();\n        point.coordinates = new Coordinates(adjustedPointInWorldSpace);\n        point.adjustedOn = adjustedPointInWorldSpace;\n      } else {\n        constraints = SelectManager.getEmptySelectionConstraints().segments;\n        constraints.canSelect = true;\n        const adjustedSegment = SelectManager.selectSegment(\n          point.coordinates,\n          constraints,\n        );\n        if (adjustedSegment) {\n          point.coordinates = adjustedSegment.projectionOnSegment(\n            point.coordinates,\n          );\n          point.adjustedOn = adjustedSegment;\n        }\n      }\n    } else {\n      let adjustedCoordinates = this.constraints.projectionOnConstraints(\n        point.coordinates,\n      );\n\n      const constraints = SelectManager.getEmptySelectionConstraints().segments;\n      constraints.canSelect = true;\n      constraints.numberOfObjects = 'allInDistance';\n      const adjustedSegments = SelectManager.selectSegment(\n        adjustedCoordinates,\n        constraints,\n      );\n      if (adjustedSegments) {\n        const adjustedSegment = adjustedSegments\n          .filter((seg) => !seg.isParalleleWith(this.constraints.segments[0]))\n          .sort((seg1, seg2) =>\n            seg1\n              .projectionOnSegment(adjustedCoordinates)\n              .dist(adjustedCoordinates) >\n            seg2\n              .projectionOnSegment(adjustedCoordinates)\n              .dist(adjustedCoordinates)\n              ? 1\n              : -1,\n          )[0];\n        if (adjustedSegment) {\n          adjustedCoordinates = adjustedSegment\n            .intersectionWith(this.constraints.segments[0])\n            .sort((intersection1, intersection2) =>\n              intersection1.dist(adjustedCoordinates) >\n              intersection2.dist(adjustedCoordinates)\n                ? 1\n                : -1,\n            )[0];\n          point.adjustedOn = adjustedSegment;\n        }\n      }\n      // let constraints = SelectManager.getEmptySelectionConstraints().segments;\n      // constraints.canSelect = true;\n      // let adjustedSegment = SelectManager.selectSegment(\n      //   adjustedCoordinates,\n      //   constraints,\n      // );\n      // if (adjustedSegment) {\n      //   adjustedCoordinates = adjustedSegment.intersectionWith(this.constraints.segments[0]).sort((intersection1, intersection2) =>\n      //     intersection1.dist(adjustedCoordinates) > intersection2.dist(adjustedCoordinates) ? 1 : -1\n      //   )[0];\n      //   point.adjustedOn = adjustedSegment;\n      // }\n      point.coordinates = new Coordinates(adjustedCoordinates);\n    }\n  }\n\n  refreshStateUpper() {\n    if (app.tool.currentStep == 'animatePoint') {\n      this.points[this.numberOfPointsDrawn - 1].coordinates = new Coordinates(\n        app.workspace.lastKnownMouseCoordinates,\n      );\n      this.adjustPoint(this.points[this.numberOfPointsDrawn - 1]);\n      if (\n        this.numberOfPointsDrawn == this.numberOfPointsRequired() &&\n        this.numberOfPointsDrawn < 3\n      ) {\n        this.finishShape();\n      }\n    }\n  }\n\n  numberOfPointsRequired() {\n    return this.triangleDef.numberOfPointsToRequired;\n  }\n\n  finishShape() {\n    this.triangleDef.finishShape(this.points, this.segments);\n  }\n\n  getConstraints(pointNb) {\n    this.constraints = this.triangleDef.constraints[pointNb](\n      this.points,\n      this.segments,\n    );\n  }\n\n  async executeAction() {\n    this._executeAction();\n    window.dispatchEvent(new CustomEvent('refresh'));\n    window.dispatchEvent(\n      new CustomEvent('actions-executed', { detail: { name: this.title } }),\n    );\n  }\n\n  _executeAction() {\n    let familyName = '3-corner-shape';\n    if (app.tool.selectedTemplate.name == 'EquilateralTriangle') {\n      familyName = 'Regular';\n    } else if (app.tool.selectedTemplate.name == 'IrregularTriangle') {\n      familyName = 'Irregular';\n    }\n\n    let path = [\n      'M',\n      this.points[0].coordinates.x,\n      this.points[0].coordinates.y,\n    ];\n    path.push('L', this.points[1].coordinates.x, this.points[1].coordinates.y);\n    path.push('L', this.points[2].coordinates.x, this.points[2].coordinates.y);\n    path.push('L', this.points[0].coordinates.x, this.points[0].coordinates.y);\n    path = path.join(' ');\n\n    const shape = new RegularShape({\n      layer: 'main',\n      path: path,\n      name: app.tool.selectedTemplate.name,\n      familyName: familyName,\n      fillOpacity: 0,\n      geometryObject: new GeometryObject({}),\n    });\n\n    shape.vertexes[0].adjustedOn = this.points[0].adjustedOn;\n    linkNewlyCreatedPoint(shape, shape.vertexes[0]);\n    shape.vertexes[1].adjustedOn = this.points[1].adjustedOn;\n    linkNewlyCreatedPoint(shape, shape.vertexes[1]);\n    if (\n      shape.name == 'RightAngleTriangle' ||\n      shape.name == 'IsoscelesTriangle' ||\n      shape.name == 'IrregularTriangle'\n    ) {\n      shape.vertexes[2].adjustedOn = this.points[2].adjustedOn;\n      linkNewlyCreatedPoint(shape, shape.vertexes[2]);\n    }\n    computeConstructionSpec(shape);\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\CreateTriangle\\CreateTriangleToolRefactored.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\CreateTriangle\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\CreateTriangle\\trianglesDef.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":27,"column":23,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":27,"endColumn":25,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[956,958],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":38,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":38,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1231,1233],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app } from '../Core/App';\r\nimport { Coordinates } from '../Core/Objects/Coordinates';\r\nimport { GeometryConstraint } from '../Core/Objects/GeometryConstraint';\r\nimport { Point } from '../Core/Objects/Point';\r\nimport { Segment } from '../Core/Objects/Segment';\r\n\r\nexport const EquilateralTriangle = {\r\n  numberOfPointsToRequired: 2,\r\n  constraints: [\r\n    () => new GeometryConstraint('isFree'),\r\n    () => new GeometryConstraint('isFree'),\r\n  ],\r\n  finishShape: (points, segments) => {\r\n    const externalAngle = (Math.PI * 2) / 3;\r\n\r\n    const length = points[0].coordinates.dist(points[1].coordinates);\r\n\r\n    const startAngle = points[0].coordinates.angleWith(points[1].coordinates);\r\n\r\n    const dx = length * Math.cos(startAngle - externalAngle);\r\n    const dy = length * Math.sin(startAngle - externalAngle);\r\n\r\n    const newCoordinates = points[1].coordinates.add(\r\n      new Coordinates({ x: dx, y: dy }),\r\n    );\r\n\r\n    if (points.length == 2) {\r\n      points[2] = new Point({\r\n        layer: 'upper',\r\n        coordinates: newCoordinates,\r\n        color: app.settings.temporaryDrawColor,\r\n        size: 2,\r\n      });\r\n    } else {\r\n      points[2].coordinates = newCoordinates;\r\n    }\r\n\r\n    if (segments.length == 1) {\r\n      segments.push(\r\n        new Segment({\r\n          layer: 'upper',\r\n          vertexIds: [points[1].id, points[2].id],\r\n        }),\r\n      );\r\n    }\r\n  },\r\n};\r\n\r\nexport const RightAngleIsoscelesTriangle = {\r\n  numberOfPointsToRequired: 3,\r\n  constraints: [\r\n    () => new GeometryConstraint('isFree'),\r\n    () => new GeometryConstraint('isFree'),\r\n    (points) => {\r\n      const angle = points[0].coordinates.angleWith(points[1].coordinates);\r\n      const length = points[0].coordinates.dist(points[1].coordinates);\r\n      const perpendicularAngle = angle + Math.PI / 2;\r\n      const constraintsPoints = [\r\n        points[1].coordinates.add(\r\n          new Coordinates({\r\n            x: Math.cos(perpendicularAngle) * length,\r\n            y: Math.sin(perpendicularAngle) * length,\r\n          }),\r\n        ),\r\n        points[1].coordinates.substract(\r\n          new Coordinates({\r\n            x: Math.cos(perpendicularAngle) * length,\r\n            y: Math.sin(perpendicularAngle) * length,\r\n          }),\r\n        ),\r\n      ];\r\n      return new GeometryConstraint('isConstrained', [], constraintsPoints);\r\n    },\r\n  ],\r\n  finishShape: () => {},\r\n};\r\n\r\nexport const RightAngleTriangle = {\r\n  numberOfPointsToRequired: 3,\r\n  constraints: [\r\n    () => new GeometryConstraint('isFree'),\r\n    () => new GeometryConstraint('isFree'),\r\n    (points) => {\r\n      const angle = points[0].coordinates.angleWith(points[1].coordinates);\r\n      const perpendicularAngle = angle + Math.PI / 2;\r\n      const lines = [\r\n        [\r\n          points[1].coordinates,\r\n          new Coordinates({\r\n            x: points[1].x + Math.cos(perpendicularAngle) * 100,\r\n            y: points[1].y + Math.sin(perpendicularAngle) * 100,\r\n          }),\r\n        ],\r\n      ];\r\n      return new GeometryConstraint('isConstrained', lines);\r\n    },\r\n  ],\r\n  finishShape: () => {},\r\n};\r\n\r\nexport const IsoscelesTriangle = {\r\n  numberOfPointsToRequired: 3,\r\n  constraints: [\r\n    () => new GeometryConstraint('isFree'),\r\n    () => new GeometryConstraint('isFree'),\r\n    (points) => {\r\n      const angle = points[0].coordinates.angleWith(points[1].coordinates);\r\n      const middle = points[0].coordinates.middleWith(points[1].coordinates);\r\n      const perpendicularAngle = angle + Math.PI / 2;\r\n      const lines = [\r\n        [\r\n          middle,\r\n          new Coordinates({\r\n            x: middle.x + Math.cos(perpendicularAngle) * 100,\r\n            y: middle.y + Math.sin(perpendicularAngle) * 100,\r\n          }),\r\n        ],\r\n      ];\r\n      return new GeometryConstraint('isConstrained', lines);\r\n    },\r\n  ],\r\n  finishShape: () => {},\r\n};\r\n\r\nexport const IrregularTriangle = {\r\n  numberOfPointsToRequired: 3,\r\n  constraints: [\r\n    () => new GeometryConstraint('isFree'),\r\n    () => new GeometryConstraint('isFree'),\r\n    () => new GeometryConstraint('isFree'),\r\n  ],\r\n  finishShape: () => {},\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Create\\CreateTool.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":114,"column":31,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":114,"endColumn":33,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3539,3541],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":132,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":132,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[4218,4220],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":164,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":164,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[5142,5144],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":174,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":174,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[5576,5578],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":178,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":178,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5676,5678],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'shape' is defined but never used. Allowed unused args must match /^_/u.","line":187,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":187,"endColumn":23,"suggestions":[{"messageId":"removeVar","data":{"varName":"shape"},"fix":{"range":[6001,6006],"text":""},"desc":"Remove unused variable 'shape'."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":209,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":209,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[6650,6652],"text":"!=="},"desc":"Use '!==' instead of '!='."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { html } from 'lit';\r\nimport { getFamily } from '../../store/kit';\r\nimport { app, setState } from '../Core/App';\r\nimport { Coordinates } from '../Core/Objects/Coordinates';\r\nimport { CubeShape } from '../Core/Objects/Shapes/CubeShape';\r\nimport { LineShape } from '../Core/Objects/Shapes/LineShape';\r\nimport { RegularShape } from '../Core/Objects/Shapes/RegularShape';\r\nimport { Tool } from '../Core/States/Tool';\r\nimport { getShapeAdjustment } from '../Core/Tools/automatic_adjustment';\r\n\r\n/**\r\n * Ajout de figures sur l'espace de travail\r\n */\r\nexport class CreateTool extends Tool {\r\n  constructor() {\r\n    super('create', 'Ajouter une figure');\r\n\r\n    // start -> listen -> move\r\n    this.currentStep = null;\r\n\r\n    this.selectedFamily = null;\r\n\r\n    this.selectedTemplate = null;\r\n\r\n    this.shapeToCreate = null;\r\n  }\r\n\r\n  /**\r\n   * Renvoie l'aide ├á afficher ├á l'utilisateur\r\n   * @return {String} L'aide, en HTML\r\n   */\r\n  getHelpText() {\r\n    const toolName = this.title;\r\n    return html`\r\n      <h3>${toolName}</h3>\r\n      <p>\r\n        Vous avez s├®lectionn├® l'outil <b>\"${toolName}\"</b>.<br />\r\n        Apr├¿s avoir s├®lectionn├® une famille de figures dans le menu, vous devez\r\n        appuyer sur une des figures dans le menu qui appara├«t en bas de l'├®cran.\r\n        Appuyez ensuite sur l'├®cran pour ajouter une figure.<br /><br />\r\n        <b>Note:</b> vous pouvez appuyer sur l'├®cran puis bouger votre doigt\r\n        sans le relacher, pour positionner plus pr├®cis├®ment la nouvelle figure.\r\n      </p>\r\n    `;\r\n  }\r\n\r\n  /**\r\n   * (r├®-)initialiser l'├®tat\r\n   * @param  {String} family Nom de la famille s├®lectionn├®e\r\n   */\r\n  start() {\r\n    // S'assurer que l'outil pr├®c├®dent soit compl├¿tement arr├¬t├®\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.stopAnimation();\r\n    this.removeListeners();\r\n\r\n    // Laisser le temps ├á l'ancien outil de se terminer proprement\r\n    setTimeout(() => {\r\n      this.openShapeList();\r\n    }, 100);\r\n  }\r\n\r\n  listen() {\r\n    // V├®rifier que l'outil actif est bien 'create'\r\n    if (app.tool.name !== 'create') {\r\n      console.warn(\r\n        \"CreateTool.listen() appel├® mais l'outil actif n'est pas create:\",\r\n        app.tool.name,\r\n      );\r\n      return;\r\n    }\r\n\r\n    // Nettoyer agressivement les contours de groupes\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.stopAnimation();\r\n    this.removeListeners();\r\n    this.mouseDownId = app.addListener('canvasMouseDown', this.handler);\r\n\r\n    // S'assurer qu'on nettoie ├á nouveau apr├¿s un petit d├®lai au cas o├╣ quelque chose redessinerait\r\n    setTimeout(() => {\r\n      if (app.tool.name === 'create') {\r\n        app.upperCanvasLayer.removeAllObjects();\r\n      }\r\n    }, 100);\r\n  }\r\n\r\n  move() {\r\n    // S'assurer que les contours de groupes sont supprim├®s pendant le d├®placement\r\n    this.removeListeners();\r\n    this.mouseUpId = app.addListener('canvasMouseUp', this.handler);\r\n  }\r\n\r\n  /**\r\n   * stopper l'├®tat\r\n   */\r\n  end() {\r\n    this.shapesList = null;\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.stopAnimation();\r\n    this.removeListeners();\r\n  }\r\n\r\n  openShapeList() {\r\n    // Nettoyer les contours de groupes r├®siduels\r\n    app.upperCanvasLayer.removeAllObjects();\r\n\r\n    // Force reset de l'├®tat de l'outil pour s'assurer qu'aucun ancien outil n'est actif\r\n    if (app.tool.name !== 'create') {\r\n      setState({ tool: { name: 'create', currentStep: 'start' } });\r\n      return;\r\n    }\r\n\r\n    const shapeTemplates = getFamily(app.tool.selectedFamily).shapeTemplates;\r\n    if (shapeTemplates.length == 1) {\r\n      const selectedTemplate = shapeTemplates[0];\r\n      setState({\r\n        tool: { ...app.tool, currentStep: 'listen', selectedTemplate },\r\n      });\r\n    } else if (!this.shapesList) {\r\n      import('../../components/shape-selector');\r\n      const elem = document.createElement('shape-selector');\r\n      elem.family = app.tool.selectedFamily;\r\n      elem.templatesNames = getFamily(app.tool.selectedFamily).shapeTemplates;\r\n      elem.selectedTemplate = app.tool.selectedTemplate;\r\n      elem.type = 'Create';\r\n      elem.nextStep = 'listen';\r\n      document.querySelector('body').appendChild(elem);\r\n    }\r\n  }\r\n\r\n  canvasMouseDown() {\r\n    if (app.tool.currentStep != 'listen') return;\r\n\r\n    // Nettoyer avant de commencer la cr├®ation\r\n    app.upperCanvasLayer.removeAllObjects();\r\n\r\n    const selectedTemplate = app.tool.selectedTemplate;\r\n\r\n    if (selectedTemplate?.name && selectedTemplate.name.startsWith('Segment')) {\r\n      this.shapeToCreate = new LineShape({\r\n        ...selectedTemplate,\r\n        layer: 'upper',\r\n      });\r\n    } else {\r\n      this.shapeToCreate = new RegularShape({\r\n        ...selectedTemplate,\r\n        layer: 'upper',\r\n      });\r\n    }\r\n    const shapeSize = app.settings.shapesSize;\r\n\r\n    this.shapeToCreate.size = shapeSize;\r\n    this.shapeToCreate.scale(shapeSize);\r\n\r\n    this.currentShapePos = Coordinates.nullCoordinates;\r\n\r\n    if (this.shapeToCreate.isCircle()) this.shapeToCreate.isCenterShown = true;\r\n\r\n    setState({ tool: { ...app.tool, currentStep: 'move' } });\r\n    this.animate();\r\n  }\r\n\r\n  canvasMouseUp() {\r\n    if (app.tool.currentStep != 'move') return;\r\n\r\n    this.executeAction();\r\n    // Nettoyer l'upperCanvasLayer apr├¿s la cr├®ation pour ├®viter les contours de groupe r├®siduels\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    setState({ tool: { ...app.tool, name: this.name, currentStep: 'listen' } });\r\n  }\r\n\r\n  refreshStateUpper() {\r\n    // Nettoyer en permanence les contours de groupes r├®siduels quand on utilise l'outil Create\r\n    if (app.tool.currentStep != 'move') {\r\n      app.upperCanvasLayer.removeAllObjects();\r\n    }\r\n\r\n    if (app.tool.currentStep == 'move') {\r\n      this.shapeToCreate.translate(\r\n        app.workspace.lastKnownMouseCoordinates.substract(this.currentShapePos),\r\n      );\r\n      this.currentShapePos = app.workspace.lastKnownMouseCoordinates;\r\n    }\r\n  }\r\n\r\n  // Override objectSelected pour emp├¬cher les actions de l'ancien outil Group\r\n  objectSelected(shape) {\r\n    // Ne rien faire - emp├¬che les actions du GroupTool qui pourrait encore ├¬tre actif\r\n    return;\r\n  }\r\n\r\n  _executeAction() {\r\n    const selectedTemplate = app.tool.selectedTemplate;\r\n    if (!selectedTemplate?.name) {\r\n      console.warn('No template selected');\r\n      return;\r\n    }\r\n\r\n    const shapeSize = app.settings.shapesSize,\r\n      shapeCoordinates = app.workspace.lastKnownMouseCoordinates;\r\n\r\n    let shape;\r\n    if (selectedTemplate.name.startsWith('Segment')) {\r\n      shape = new LineShape({\r\n        ...selectedTemplate,\r\n        size: shapeSize,\r\n        layer: 'main',\r\n      });\r\n    } else if (app.environment.name != 'Cubes') {\r\n      shape = new RegularShape({\r\n        ...selectedTemplate,\r\n        size: shapeSize,\r\n        layer: 'main',\r\n      });\r\n    } else {\r\n      shape = new CubeShape({\r\n        ...selectedTemplate,\r\n        size: shapeSize,\r\n        layer: 'main',\r\n      });\r\n    }\r\n    shape.scale(shapeSize);\r\n    shape.translate(shapeCoordinates);\r\n\r\n    const transformation = getShapeAdjustment([shape], shape);\r\n    shape.rotate(transformation.rotationAngle, shape.centerCoordinates);\r\n    shape.translate(transformation.translation);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Create\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Cut\\CutTool.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":119,"column":21,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":119,"endColumn":23,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[3400,3402],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":127,"column":21,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":127,"endColumn":23,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[3596,3598],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":165,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":165,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4619,4621],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":172,"column":26,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":172,"endColumn":28,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4870,4872],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":173,"column":32,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":173,"endColumn":34,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[4924,4926],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":192,"column":26,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":192,"endColumn":28,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5459,5461],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":208,"column":35,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":208,"endColumn":37,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6076,6078],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":225,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":225,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6546,6548],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":235,"column":39,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":235,"endColumn":41,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6966,6968],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":253,"column":38,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":253,"endColumn":40,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7655,7657],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":271,"column":36,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":271,"endColumn":38,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8390,8392],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":272,"column":65,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":272,"endColumn":67,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8479,8481],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":286,"column":21,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":286,"endColumn":23,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8962,8964],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":288,"column":19,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":288,"endColumn":21,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[9010,9012],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":290,"column":17,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":290,"endColumn":19,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[9054,9056],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":294,"column":28,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":294,"endColumn":30,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[9118,9120],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":309,"column":18,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":309,"endColumn":20,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[9489,9491],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":322,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":322,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[9978,9980],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":332,"column":22,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":332,"endColumn":24,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[10270,10272],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":356,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":356,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[11026,11028],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"prefer-const","severity":1,"message":"'pt1' is never reassigned. Use 'const' instead.","line":357,"column":11,"nodeType":"Identifier","messageId":"useConst","endLine":357,"endColumn":14},{"ruleId":"prefer-const","severity":1,"message":"'shape' is never reassigned. Use 'const' instead.","line":359,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":359,"endColumn":14},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":363,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":363,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[11245,11247],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":369,"column":24,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":369,"endColumn":26,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[11490,11492],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":379,"column":22,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":379,"endColumn":24,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[11846,11848],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":392,"column":27,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":392,"endColumn":29,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[12196,12198],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":401,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":401,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[12456,12458],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":428,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":428,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[13235,13237],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"prefer-const","severity":1,"message":"'length' is never reassigned. Use 'const' instead.","line":460,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":460,"endColumn":15},{"ruleId":"prefer-const","severity":1,"message":"'part' is never reassigned. Use 'const' instead.","line":461,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":461,"endColumn":11},{"ruleId":"prefer-const","severity":1,"message":"'precision' is never reassigned. Use 'const' instead.","line":462,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":462,"endColumn":16},{"ruleId":"prefer-const","severity":1,"message":"'amountOfParts' is never reassigned. Use 'const' instead.","line":463,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":463,"endColumn":20},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":495,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":495,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[15553,15555],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":512,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":512,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[16258,16260],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":520,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":520,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[16554,16556],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"prefer-const","severity":1,"message":"'shape' is never reassigned. Use 'const' instead.","line":534,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":534,"endColumn":12},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":581,"column":18,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":581,"endColumn":20,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[18217,18219],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":583,"column":24,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":583,"endColumn":26,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[18282,18284],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":589,"column":20,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":589,"endColumn":22,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[18457,18459],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":591,"column":26,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":591,"endColumn":28,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[18526,18528],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":598,"column":26,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":598,"endColumn":28,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[18779,18781],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":608,"column":26,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":608,"endColumn":28,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[19091,19093],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":640,"column":27,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":640,"endColumn":29,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[20101,20103],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":646,"column":17,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":646,"endColumn":19,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[20345,20347],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":667,"column":24,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":667,"endColumn":26,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[20977,20979],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":676,"column":20,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":676,"endColumn":22,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[21261,21263],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":678,"column":23,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":678,"endColumn":25,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[21327,21329],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":694,"column":24,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":694,"endColumn":26,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[21792,21794],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":706,"column":27,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":706,"endColumn":29,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[22281,22283],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":712,"column":17,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":712,"endColumn":19,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[22525,22527],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":751,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":751,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[23669,23671],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":761,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":761,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[24000,24002],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":766,"column":24,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":766,"endColumn":26,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[24208,24210],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":797,"column":36,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":797,"endColumn":38,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[25460,25462],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":832,"column":36,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":832,"endColumn":38,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[26717,26719],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":875,"column":38,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":875,"endColumn":40,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[27895,27897],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":890,"column":17,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":890,"endColumn":19,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[28446,28448],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"prefer-const","severity":1,"message":"'radius' is never reassigned. Use 'const' instead.","line":898,"column":11,"nodeType":"Identifier","messageId":"useConst","endLine":898,"endColumn":17},{"ruleId":"prefer-const","severity":1,"message":"'firstAngle' is never reassigned. Use 'const' instead.","line":899,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":899,"endColumn":19}],"suppressedMessages":[],"errorCount":50,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { html } from 'lit';\r\nimport { app, setState } from '../Core/App';\r\nimport { Coordinates } from '../Core/Objects/Coordinates';\r\nimport { Point } from '../Core/Objects/Point';\r\nimport { Segment } from '../Core/Objects/Segment';\r\nimport { GeometryObject } from '../Core/Objects/Shapes/GeometryObject';\r\nimport { Tool } from '../Core/States/Tool';\r\nimport { findObjectById } from '../Core/Tools/general';\r\n\r\n/**\r\n * D├®couper une figure\r\n */\r\nexport class CutTool extends Tool {\r\n  constructor() {\r\n    super('cut', 'D├®couper', 'operation');\r\n\r\n    // listen-canvas-click -> select-second-point -> select-third-point -> showing-points\r\n    this.currentStep = null;\r\n\r\n    this.timeoutRef = null;\r\n\r\n    this.drawColor = '#E90CC8';\r\n  }\r\n\r\n  /**\r\n   * Renvoie l'aide ├á afficher ├á l'utilisateur\r\n   * @return {String} L'aide, en HTML\r\n   */\r\n  getHelpText() {\r\n    const toolName = this.title;\r\n    return html`\r\n      <h3>${toolName}</h3>\r\n      <p>\r\n        Vous avez s├®lectionn├® l'outil <b>\"${toolName}\"</b>. Cet outil permet de\r\n        d├®couper une figure en deux nouvelles figures, tout en laissant la\r\n        figure d'origine intacte.<br /><br />\r\n\r\n        Pour d├®couper une figure, touchez un premier sommet de la figure, puis\r\n        ├®ventuellement le centre de la figure (non obligatoire), et enfin un\r\n        second sommet de la figure.<br /><br />\r\n\r\n        <b>Note:</b> il n'est pas toujours possible de d├®couper une figure en\r\n        s├®lectionnant deux sommets quelconques. La ligne de d├®coupe doit en\r\n        effet rester ├á l'int├®rieur de la figure, sans quoi la d├®coupe ne sera\r\n        pas r├®alis├®e.\r\n      </p>\r\n    `;\r\n  }\r\n\r\n  start() {\r\n    setTimeout(\r\n      () =>\r\n        setState({\r\n          tool: { ...app.tool, name: this.name, currentStep: 'listen' },\r\n        }),\r\n      50,\r\n    );\r\n  }\r\n\r\n  listen() {\r\n    this.removeListeners();\r\n    app.upperCanvasLayer.removeAllObjects();\r\n\r\n    this.setSelectionConstraints();\r\n    this.objectSelectedId = app.addListener('objectSelected', this.handler);\r\n  }\r\n\r\n  selectSecondPoint() {\r\n    this.removeListeners();\r\n    app.upperCanvasLayer.removeAllObjects();\r\n\r\n    new Point({\r\n      coordinates: findObjectById(app.tool.firstPointIds[0]).coordinates,\r\n      layer: 'upper',\r\n      color: this.drawColor,\r\n      size: 2,\r\n    });\r\n\r\n    this.setSelectionConstraints();\r\n    this.objectSelectedId = app.addListener('objectSelected', this.handler);\r\n  }\r\n\r\n  selectThirdPoint() {\r\n    this.removeListeners();\r\n    app.upperCanvasLayer.removeAllObjects();\r\n\r\n    const firstPoint = this.firstPoint;\r\n    const centerPoint = this.centerPoint;\r\n    new Point({\r\n      coordinates: firstPoint.coordinates,\r\n      layer: 'upper',\r\n      color: this.drawColor,\r\n      size: 2,\r\n    });\r\n    new Point({\r\n      coordinates: centerPoint.coordinates,\r\n      layer: 'upper',\r\n      color: this.drawColor,\r\n      size: 2,\r\n    });\r\n\r\n    this.setSelectionConstraints();\r\n    this.objectSelectedId = app.addListener('objectSelected', this.handler);\r\n  }\r\n\r\n  cut() {\r\n    this.removeListeners();\r\n    app.upperCanvasLayer.removeAllObjects();\r\n\r\n    const firstPoint = this.firstPoint;\r\n    const centerPoint = this.centerPoint;\r\n    const secondPoint = this.secondPoint;\r\n    new Point({\r\n      coordinates: firstPoint.coordinates,\r\n      layer: 'upper',\r\n      color: this.drawColor,\r\n      size: 2,\r\n    });\r\n    if (centerPoint != undefined) {\r\n      new Point({\r\n        coordinates: centerPoint.coordinates,\r\n        layer: 'upper',\r\n        color: this.drawColor,\r\n        size: 2,\r\n      });\r\n    }\r\n    if (secondPoint != undefined) {\r\n      new Point({\r\n        coordinates: secondPoint.coordinates,\r\n        layer: 'upper',\r\n        color: this.drawColor,\r\n        size: 2,\r\n      });\r\n    }\r\n  }\r\n\r\n  end() {\r\n    this.removeListeners();\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    window.clearTimeout(this.timeoutRef);\r\n  }\r\n\r\n  get firstPoint() {\r\n    const firstPoint = findObjectById(app.tool.firstPointId);\r\n    return firstPoint;\r\n  }\r\n\r\n  get centerPoint() {\r\n    const centerPoint = findObjectById(app.tool.centerPointId);\r\n    return centerPoint;\r\n  }\r\n\r\n  get secondPoint() {\r\n    const secondPoint = findObjectById(app.tool.secondPointId);\r\n    return secondPoint;\r\n  }\r\n\r\n  /**\r\n   * Appel├®e par ├®v├®nement du SelectManager lorsqu'un point a ├®t├® s├®lectionn├®e (click)\r\n   * @param  {Object} object            L'├®l├®ment s├®lectionn├®\r\n   * @param  {Point} mouseCoordinates Les coordonn├®es du click\r\n   * @param  {Event} event            l'├®v├®nement javascript\r\n   */\r\n  objectSelected(object) {\r\n    if (app.tool.currentStep == 'listen') {\r\n      // On a s├®lectionn├® le premier point\r\n      let segmentCut = false;\r\n      for (let i = 0; i < object.length; i++) {\r\n        const shape = object[i].shape;\r\n        if (\r\n          shape.isSegment() &&\r\n          object[0].type == 'divisionPoint' &&\r\n          app.environment.name != 'Geometrie'\r\n        ) {\r\n          segmentCut = true;\r\n          setState({\r\n            tool: {\r\n              ...app.tool,\r\n              currentStep: 'cut',\r\n              firstPointId: object[0].id,\r\n              centerPointId: undefined,\r\n              secondPointId: undefined,\r\n              shapeId: shape.id,\r\n            },\r\n          });\r\n          break;\r\n        }\r\n      }\r\n      if (!segmentCut) {\r\n        for (let i = 0; i < object.length; i++) {\r\n          let shape = object[i].shape;\r\n          if (shape.name == 'PointOnLine') {\r\n            shape = findObjectById(\r\n              shape.geometryObject.geometryParentObjectId1,\r\n            ).shape;\r\n          } else if (shape.name.startsWith('PointOnIntersection')) {\r\n            shape = findObjectById(\r\n              shape.geometryObject.geometryParentObjectId1,\r\n            ).shape;\r\n            if (shape.isSegment()) {\r\n              shape = findObjectById(\r\n                object[i].shape.geometryObject.geometryParentObjectId2,\r\n              ).shape;\r\n            }\r\n          }\r\n          if (\r\n            shape.isSegment() ||\r\n            (app.environment.name == 'Geometrie' &&\r\n              shape.geometryObject.geometryPointOnTheFlyChildId)\r\n          ) {\r\n            object.splice(i, 1);\r\n            i--;\r\n          }\r\n        }\r\n        if (object.length) {\r\n          setState({\r\n            tool: {\r\n              ...app.tool,\r\n              currentStep: 'selectSecondPoint',\r\n              firstPointIds: object.map((pt) => pt.id),\r\n            },\r\n          });\r\n        }\r\n      }\r\n    } else if (app.tool.currentStep == 'selectSecondPoint') {\r\n      const firstPoints = app.tool.firstPointIds.map((ptId) =>\r\n        findObjectById(ptId),\r\n      );\r\n      const newObjects = [...object];\r\n      const cutPoints = [];\r\n      for (let i = 0; i < firstPoints.length; i++) {\r\n        for (let j = 0; j < newObjects.length; j++) {\r\n          let firstShapeIds = [firstPoints[i].shapeId];\r\n          if (\r\n            firstPoints[i].shape.name == 'PointOnLine' ||\r\n            firstPoints[i].shape.name.startsWith('PointOnIntersection')\r\n          ) {\r\n            firstShapeIds = [\r\n              findObjectById(\r\n                firstPoints[i].shape.geometryObject.geometryParentObjectId1,\r\n              ).shapeId,\r\n            ];\r\n          }\r\n          if (firstPoints[i].shape.name.startsWith('PointOnIntersection')) {\r\n            firstShapeIds.push(\r\n              findObjectById(\r\n                firstPoints[i].shape.geometryObject.geometryParentObjectId2,\r\n              ).shapeId,\r\n            );\r\n          }\r\n          let secondShapeIds = [newObjects[j].shapeId];\r\n          if (\r\n            newObjects[j].shape.name == 'PointOnLine' ||\r\n            newObjects[j].shape.name.startsWith('PointOnIntersection')\r\n          ) {\r\n            secondShapeIds = [\r\n              findObjectById(\r\n                newObjects[j].shape.geometryObject.geometryParentObjectId1,\r\n              ).shapeId,\r\n            ];\r\n          }\r\n          if (newObjects[j].shape.name.startsWith('PointOnIntersection')) {\r\n            secondShapeIds.push(\r\n              findObjectById(\r\n                newObjects[j].shape.geometryObject.geometryParentObjectId2,\r\n              ).shapeId,\r\n            );\r\n          }\r\n          for (let k = 0; k < firstShapeIds.length; k++) {\r\n            for (let l = 0; l < secondShapeIds.length; l++) {\r\n              if (firstShapeIds[k] == secondShapeIds[l]) {\r\n                if (findObjectById(firstShapeIds[k]).familyName == 'Line')\r\n                  break;\r\n                firstPoints[i].cutSeg = k;\r\n                newObjects[j].cutSeg = l;\r\n                cutPoints.push([\r\n                  firstPoints[i],\r\n                  newObjects[j],\r\n                  firstShapeIds[k],\r\n                ]);\r\n                firstPoints.splice(i, 1);\r\n                newObjects.splice(j, 1);\r\n                this.shapeId = firstShapeIds[k];\r\n                i = -1;\r\n              }\r\n              if (i == -1) break;\r\n            }\r\n            if (i == -1) break;\r\n          }\r\n          if (i == -1) break;\r\n        }\r\n      }\r\n\r\n      if (cutPoints.length == 0) {\r\n        window.dispatchEvent(\r\n          new CustomEvent('show-notif', {\r\n            detail: {\r\n              message:\r\n                'Les points de d├®coupe doivent appartenir ├á la m├¬me figure.',\r\n            },\r\n          }),\r\n        );\r\n        return;\r\n      }\r\n\r\n      const pt1 = cutPoints[0][0];\r\n      const pt2 = cutPoints[0][1];\r\n\r\n      if (pt1.id == pt2.id) {\r\n        // D├®s├®lectionner le premier point\r\n        setState({\r\n          tool: { ...app.tool, currentStep: 'listen', firstPointId: undefined },\r\n        });\r\n      } else {\r\n        for (let i = 0; i < cutPoints.length; i++) {\r\n          const shape = findObjectById(cutPoints[0][2]);\r\n          if (!this.isLineValid(shape, cutPoints[i][0], cutPoints[i][1])) {\r\n            cutPoints.splice(i, 1);\r\n            i = -1;\r\n          }\r\n        }\r\n        if (cutPoints.length == 0) {\r\n          window.dispatchEvent(\r\n            new CustomEvent('show-notif', {\r\n              detail: {\r\n                message: 'Les points de d├®coupe doivent pouvoir ├¬tre reli├®s.',\r\n              },\r\n            }),\r\n          );\r\n          return;\r\n        }\r\n        if (pt2.type == 'shapeCenter') {\r\n          // On a s├®lectionn├® le second point: le centre\r\n          setState({\r\n            tool: {\r\n              ...app.tool,\r\n              currentStep: 'selectThirdPoint',\r\n              firstPointId: pt1.id,\r\n              centerPointId: pt2.id,\r\n              shapeId: pt2.shape.id,\r\n            },\r\n          });\r\n        } else {\r\n          // On a s├®lectionn├® le second point: un autre point\r\n          setState({\r\n            tool: {\r\n              ...app.tool,\r\n              currentStep: 'cut',\r\n              firstPointId: cutPoints[0][0].id,\r\n              secondPointId: cutPoints[0][1].id,\r\n              shapeId: cutPoints[0][2],\r\n            },\r\n          });\r\n        }\r\n      }\r\n    } else if (app.tool.currentStep == 'selectThirdPoint') {\r\n      let pt1 = this.firstPoint,\r\n        pt2,\r\n        shape = this.centerPoint.shape;\r\n      object.forEach((pt) => {\r\n        let pt2Shape = pt.shape;\r\n        if (\r\n          pt2Shape.name == 'PointOnLine' ||\r\n          pt2Shape.name.startsWith('PointOnIntersection')\r\n        ) {\r\n          const tmpShape = findObjectById(\r\n            pt.shape.geometryObject['geometryParentObjectId1'],\r\n          ).shape;\r\n          if (shape.id == tmpShape.id) {\r\n            pt2Shape = tmpShape;\r\n            pt.cutSeg = 0;\r\n          } else if (pt2Shape.name.startsWith('PointOnIntersection')) {\r\n            pt2Shape = findObjectById(\r\n              pt.shape.geometryObject['geometryParentObjectId2'],\r\n            ).shape;\r\n            pt.cutSeg = 1;\r\n          }\r\n        }\r\n        if (shape.id == pt2Shape.id) {\r\n          pt2 = pt;\r\n        }\r\n      });\r\n      if (!pt2) {\r\n        window.dispatchEvent(\r\n          new CustomEvent('show-notif', {\r\n            detail: {\r\n              message:\r\n                'Les points de d├®coupe doivent appartenir ├á la m├¬me figure.',\r\n            },\r\n          }),\r\n        );\r\n      } else if (pt2.type == 'shapeCenter') {\r\n        // D├®s├®lectionner le centre\r\n        setState({\r\n          tool: {\r\n            ...app.tool,\r\n            currentStep: 'selectSecondPoint',\r\n            centerPointId: undefined,\r\n          },\r\n        });\r\n      } else if (pt1.id == pt2.id) {\r\n        // D├®s├®lectionner le premier point et le centre\r\n        setState({\r\n          tool: {\r\n            ...app.tool,\r\n            currentStep: 'listen',\r\n            firstPointId: undefined,\r\n            centerPointId: undefined,\r\n          },\r\n        });\r\n      } else {\r\n        if (this.isLineValid(shape, this.centerPoint, pt2)) {\r\n          setState({\r\n            tool: { ...app.tool, currentStep: 'cut', secondPointId: pt2.id },\r\n          });\r\n        } else {\r\n          window.dispatchEvent(\r\n            new CustomEvent('show-notif', {\r\n              detail: {\r\n                message: 'Les points de d├®coupe doivent pouvoir ├¬tre reli├®s.',\r\n              },\r\n            }),\r\n          );\r\n        }\r\n      }\r\n    }\r\n\r\n    if (app.tool.currentStep == 'cut') {\r\n      this.executeAnimation();\r\n    }\r\n    // window.dispatchEvent(new CustomEvent('refresh'));\r\n  }\r\n\r\n  executeAnimation() {\r\n    window.clearTimeout(this.timeoutRef);\r\n    this.timeoutRef = window.setTimeout(() => {\r\n      this.executeAction();\r\n      setState({\r\n        tool: {\r\n          ...app.tool,\r\n          name: this.name,\r\n          currentStep: 'listen',\r\n          firstPointId: undefined,\r\n          secondPointId: undefined,\r\n          centerPointId: undefined,\r\n        },\r\n      });\r\n    }, 200);\r\n  }\r\n\r\n  /**\r\n   * V├®rifie si le segment de droite reliant pt1 et pt2 :\r\n   * - reste bien ├á l'int├®rieur de la figure ou non,\r\n   * - ne soit pas confondu (ou en partie confondu) avec un autre segment (au moins 1/5 commun),\r\n   * - ne contient pas un autre sommet de la figure,\r\n   * - n'intersecte pas un autre segment de la figure\r\n   * @return {Boolean}     Retourne false s'il sort de la figure.\r\n   */\r\n  isLineValid(shape, pt1, pt2) {\r\n    let length = pt1.coordinates.dist(pt2.coordinates),\r\n      part = pt2.coordinates.substract(pt1.coordinates).multiply(1 / length),\r\n      precision = 1, // px\r\n      amountOfParts = length / precision,\r\n      pointsInBorder = 0;\r\n    for (let i = 1; i < amountOfParts - 1; i++) {\r\n      const coord = pt1.coordinates.add(part.multiply(i));\r\n      if (!shape.isCoordinatesInPath(coord)) {\r\n        return false;\r\n      }\r\n      pointsInBorder += shape.isCoordinatesOnBorder(coord) ? 1 : 0;\r\n    }\r\n    if (pointsInBorder > amountOfParts / 5) {\r\n      return false;\r\n    }\r\n    const junction = new Segment({\r\n      layer: 'invisible',\r\n      vertexCoordinates: [pt1.coordinates, pt2.coordinates],\r\n      createFromNothing: true,\r\n    });\r\n    if (shape.segments.some((seg) => seg.doesIntersect(junction, true))) {\r\n      return false;\r\n    }\r\n    return shape.vertexes.every(\r\n      (vertex) =>\r\n        vertex.coordinates.equal(pt1.coordinates) ||\r\n        vertex.coordinates.equal(pt2.coordinates) ||\r\n        !junction.isCoordinatesOnSegment(vertex.coordinates),\r\n    );\r\n  }\r\n\r\n  setSelectionConstraints() {\r\n    window.dispatchEvent(new CustomEvent('reset-selection-constraints'));\r\n    app.workspace.selectionConstraints.eventType = 'click';\r\n    app.workspace.selectionConstraints.points.canSelect = true;\r\n    if (app.tool.currentStep == 'listen') {\r\n      app.workspace.selectionConstraints.points.types = [\r\n        'vertex',\r\n        'divisionPoint',\r\n      ];\r\n      app.workspace.selectionConstraints.points.whitelist = null;\r\n      app.workspace.selectionConstraints.points.blacklist =\r\n        app.mainCanvasLayer.shapes\r\n          .filter(\r\n            (s) => s.isStraightLine() || s.isSemiStraightLine(),\r\n            // && (app.environment.name != 'Geometrie' || !s.geometryObject.geometryIsConstaintDraw)\r\n          )\r\n          .map((s) => {\r\n            return { shapeId: s.id };\r\n          });\r\n      app.workspace.selectionConstraints.points.numberOfObjects =\r\n        'allSuperimposed';\r\n    } else if (app.tool.currentStep == 'selectSecondPoint') {\r\n      app.workspace.selectionConstraints.points.types = [\r\n        'vertex',\r\n        'divisionPoint',\r\n        'shapeCenter',\r\n      ];\r\n      app.workspace.selectionConstraints.points.numberOfObjects =\r\n        'allSuperimposed';\r\n    } else if (app.tool.currentStep == 'selectThirdPoint') {\r\n      app.workspace.selectionConstraints.points.types = [\r\n        'vertex',\r\n        'divisionPoint',\r\n        'shapeCenter',\r\n      ];\r\n      app.workspace.selectionConstraints.points.numberOfObjects =\r\n        'allSuperimposed';\r\n    }\r\n  }\r\n\r\n  _executeAction() {\r\n    let pt1 = this.firstPoint,\r\n      pt2 = this.secondPoint,\r\n      shape = findObjectById(app.tool.shapeId),\r\n      firstPath,\r\n      secondPath;\r\n\r\n    if (shape.isSegment()) {\r\n      firstPath = [\r\n        'M',\r\n        shape.segments[0].vertexes[0].x,\r\n        shape.segments[0].vertexes[0].y,\r\n        'L',\r\n        pt1.x,\r\n        pt1.y,\r\n      ];\r\n      secondPath = [\r\n        'M',\r\n        pt1.x,\r\n        pt1.y,\r\n        'L',\r\n        shape.segments[0].vertexes[1].x,\r\n        shape.segments[0].vertexes[1].y,\r\n      ];\r\n    } else {\r\n      if (pt1.coordinates.equal(shape.segments[0].vertexes[0].coordinates)) {\r\n        pt1 = shape.segments[0].vertexes[0];\r\n      }\r\n      if (\r\n        pt1.coordinates.equal(\r\n          shape.segments[shape.segments.length - 1].vertexes[1].coordinates,\r\n        )\r\n      ) {\r\n        pt1 = shape.segments[shape.segments.length - 1].vertexes[1];\r\n      }\r\n      if (pt2) {\r\n        if (pt2.coordinates.equal(shape.segments[0].vertexes[0].coordinates)) {\r\n          pt2 = shape.segments[0].vertexes[0];\r\n        }\r\n        if (\r\n          pt2.coordinates.equal(\r\n            shape.segments[shape.segments.length - 1].vertexes[1].coordinates,\r\n          )\r\n        ) {\r\n          pt2 = shape.segments[shape.segments.length - 1].vertexes[1];\r\n        }\r\n      }\r\n\r\n      // Trier les 2 points:\r\n      if (\r\n        pt1.type == 'vertex' &&\r\n        pt1.idx === 0 &&\r\n        pt1.shape.name != 'PointOnLine' &&\r\n        !pt1.shape.name.startsWith('PointOnIntersection')\r\n      ) {\r\n        [pt1, pt2] = [pt2, pt1];\r\n      } else if (\r\n        !(\r\n          pt2.type == 'vertex' &&\r\n          pt2.idx === 0 &&\r\n          pt2.shape.name != 'PointOnLine' &&\r\n          !pt2.shape.name.startsWith('PointOnIntersection')\r\n        )\r\n      ) {\r\n        let pt1Idx = pt1.idx || pt1.segments[0]?.idx;\r\n        let pt2Idx = pt2.idx || pt2.segments[0]?.idx;\r\n        if (\r\n          pt1.shape.name == 'PointOnLine' ||\r\n          pt1.shape.name.startsWith('PointOnIntersection')\r\n        ) {\r\n          pt1Idx = findObjectById(\r\n            pt1.shape.geometryObject[\r\n              'geometryParentObjectId' + (pt1.cutSeg + 1)\r\n            ],\r\n          ).idx;\r\n        }\r\n        if (\r\n          pt2.shape.name == 'PointOnLine' ||\r\n          pt2.shape.name.startsWith('PointOnIntersection')\r\n        ) {\r\n          pt2Idx = findObjectById(\r\n            pt2.shape.geometryObject[\r\n              'geometryParentObjectId' + (pt2.cutSeg + 1)\r\n            ],\r\n          ).idx;\r\n        }\r\n        if (pt1Idx > pt2Idx) {\r\n          [pt1, pt2] = [pt2, pt1];\r\n        } else if (pt1Idx === pt2Idx) {\r\n          if ((pt1.ratio || 0) > (pt2.ratio || 0)) {\r\n            [pt1, pt2] = [pt2, pt1];\r\n          }\r\n          // [pt1, pt2] = [pt2, pt1];\r\n        }\r\n      }\r\n\r\n      const nbOfSegments = shape.segmentIds.length;\r\n      this.currentPoint = shape.vertexes[0];\r\n\r\n      firstPath = [\r\n        'M',\r\n        this.currentPoint.coordinates.x,\r\n        this.currentPoint.coordinates.y,\r\n      ];\r\n      for (let i = 0; i < nbOfSegments; i++) {\r\n        if (pt1.type === 'divisionPoint' && pt1.segments[0].idx === i) {\r\n          this.addPathElem(firstPath, pt1);\r\n          break;\r\n        } else if (\r\n          (pt1.shape.name == 'PointOnLine' ||\r\n            pt1.shape.name.startsWith('PointOnIntersection')) &&\r\n          findObjectById(\r\n            pt1.shape.geometryObject[\r\n              'geometryParentObjectId' + (pt1.cutSeg + 1)\r\n            ],\r\n          ).idx == i\r\n        ) {\r\n          this.addPathElem(firstPath, pt1);\r\n          break;\r\n        } else if (shape.vertexes[i + 1]) {\r\n          this.addPathElem(firstPath, shape.vertexes[i + 1]);\r\n        }\r\n        if (\r\n          pt1.type === 'vertex' &&\r\n          !pt1.shape.name.startsWith('PointOn') &&\r\n          pt1.idx === i + 1\r\n        ) {\r\n          break;\r\n        }\r\n      }\r\n      if (this.centerPoint) {\r\n        this.addPathElem(firstPath, this.centerPoint, false);\r\n      }\r\n      this.addPathElem(firstPath, pt2, false);\r\n      let endJunctionIndex = pt2.idx || pt2.segments[0]?.idx;\r\n      if (\r\n        pt2.shape.name == 'PointOnLine' ||\r\n        pt2.shape.name.startsWith('PointOnIntersection')\r\n      ) {\r\n        endJunctionIndex = findObjectById(\r\n          pt2.shape.geometryObject['geometryParentObjectId' + (pt2.cutSeg + 1)],\r\n        ).idx;\r\n      }\r\n      if (\r\n        !(\r\n          pt2.type == 'vertex' &&\r\n          pt2.idx === 0 &&\r\n          pt2.shapeId == app.tool.shapeId\r\n        )\r\n      ) {\r\n        for (let i = endJunctionIndex + 1; i <= nbOfSegments; i++) {\r\n          this.addPathElem(firstPath, shape.vertexes[i % nbOfSegments]);\r\n        }\r\n      }\r\n\r\n      this.currentPoint = pt1;\r\n      secondPath = [\r\n        'M',\r\n        this.currentPoint.coordinates.x,\r\n        this.currentPoint.coordinates.y,\r\n      ];\r\n      endJunctionIndex = pt1.idx || pt1.segments[0]?.idx;\r\n      if (\r\n        pt1.shape.name == 'PointOnLine' ||\r\n        pt1.shape.name.startsWith('PointOnIntersection')\r\n      ) {\r\n        endJunctionIndex = findObjectById(\r\n          pt1.shape.geometryObject['geometryParentObjectId' + (pt1.cutSeg + 1)],\r\n        ).idx;\r\n      }\r\n      for (let i = endJunctionIndex; i < nbOfSegments; i++) {\r\n        if (pt2.type === 'divisionPoint' && pt2.segments[0].idx === i) {\r\n          this.addPathElem(secondPath, pt2);\r\n          break;\r\n        } else if (\r\n          (pt2.shape.name == 'PointOnLine' ||\r\n            pt2.shape.name.startsWith('PointOnIntersection')) &&\r\n          findObjectById(\r\n            pt2.shape.geometryObject[\r\n              'geometryParentObjectId' + (pt2.cutSeg + 1)\r\n            ],\r\n          ).idx == i\r\n        ) {\r\n          this.addPathElem(secondPath, pt2);\r\n          break;\r\n        } else {\r\n          this.addPathElem(secondPath, shape.vertexes[(i + 1) % nbOfSegments]);\r\n        }\r\n        // je ne sais pas pourquoi mais ├ºa a l'air de marcher\r\n        if (\r\n          pt2.type === 'vertex' && //&& !pt1.shape.name.startsWith('PointOn')\r\n          pt2.idx === (i + 1) % nbOfSegments\r\n        ) {\r\n          break;\r\n        }\r\n      }\r\n      if (this.centerPoint) {\r\n        this.addPathElem(secondPath, this.centerPoint, false);\r\n      }\r\n      this.addPathElem(secondPath, pt1, false);\r\n    }\r\n\r\n    firstPath = firstPath.join(' ');\r\n    secondPath = secondPath.join(' ');\r\n\r\n    const shape1 = new shape.constructor({\r\n      layer: 'main',\r\n      path: firstPath,\r\n      fillColor: shape.fillColor,\r\n      fillOpacity: shape.fillOpacity,\r\n      strokeColor: shape.strokeColor,\r\n    });\r\n    const shape2 = new shape.constructor({\r\n      layer: 'main',\r\n      path: secondPath,\r\n      fillColor: shape.fillColor,\r\n      fillOpacity: shape.fillOpacity,\r\n      strokeColor: shape.strokeColor,\r\n    });\r\n\r\n    if (app.environment.name == 'Geometrie') {\r\n      shape1.geometryObject = new GeometryObject({});\r\n      shape1.familyName = 'duplicate';\r\n      shape2.geometryObject = new GeometryObject({});\r\n      shape2.familyName = 'duplicate';\r\n    }\r\n\r\n    shape1.cleanSameDirectionSegment();\r\n    shape2.cleanSameDirectionSegment();\r\n\r\n    if (app.environment.name == 'Geometrie') {\r\n      let allPointsOfParent = shape.geometryObject.geometryChildShapeIds\r\n        .map((childId) => findObjectById(childId))\r\n        .filter(\r\n          (child) =>\r\n            child.name == 'PointOnLine' ||\r\n            child.name.startsWith('PointOnIntersection'),\r\n        )\r\n        .map((child) => child.vertexes[0]);\r\n      allPointsOfParent = [...allPointsOfParent, ...shape.points];\r\n\r\n      const shape1Hidden = new shape.constructor({\r\n        layer: 'main',\r\n        familyName: 'Irregular',\r\n        name: 'cut',\r\n        path: shape1.getSVGPath('no scale', false),\r\n        fillColor: shape.fillColor,\r\n        fillOpacity: shape.fillOpacity,\r\n        strokeColor: shape.strokeColor,\r\n        geometryObject: new GeometryObject({\r\n          geometryIsVisibleByChoice: false,\r\n          geometryIsVisible: false,\r\n          geometryDuplicateChildShapeIds: [shape1.id],\r\n        }),\r\n      });\r\n      shape1.geometryObject.geometryDuplicateParentShapeId = shape1Hidden.id;\r\n      shape1Hidden.points.forEach((vertex) => {\r\n        const parentVertex = allPointsOfParent.find((vx) =>\r\n          vx.coordinates.equal(vertex.coordinates),\r\n        );\r\n        if (!parentVertex) {\r\n          console.info('no parent vertex for ', vertex);\r\n        } else {\r\n          vertex.reference = parentVertex.id;\r\n          if (\r\n            !parentVertex.shape.geometryObject.geometryChildShapeIds.find(\r\n              (childId) => childId == shape1Hidden.id,\r\n            )\r\n          ) {\r\n            parentVertex.shape.geometryObject.geometryChildShapeIds.push(\r\n              shape1Hidden.id,\r\n            );\r\n          }\r\n        }\r\n      });\r\n\r\n      const shape2Hidden = new shape.constructor({\r\n        layer: 'main',\r\n        familyName: 'Irregular',\r\n        name: 'cut',\r\n        path: shape2.getSVGPath('no scale', false),\r\n        fillColor: shape.fillColor,\r\n        fillOpacity: shape.fillOpacity,\r\n        strokeColor: shape.strokeColor,\r\n        geometryObject: new GeometryObject({\r\n          geometryIsVisibleByChoice: false,\r\n          geometryIsVisible: false,\r\n          geometryDuplicateChildShapeIds: [shape2.id],\r\n        }),\r\n      });\r\n      shape2.geometryObject.geometryDuplicateParentShapeId = shape2Hidden.id;\r\n      shape2Hidden.points.forEach((vertex) => {\r\n        const parentVertex = allPointsOfParent.find((vx) =>\r\n          vx.coordinates.equal(vertex.coordinates),\r\n        );\r\n        if (!parentVertex) {\r\n          console.info('no parent vertex for ', vertex);\r\n        } else {\r\n          vertex.reference = parentVertex.id;\r\n          if (\r\n            !parentVertex.shape.geometryObject.geometryChildShapeIds.find(\r\n              (childId) => childId == shape2Hidden.id,\r\n            )\r\n          )\r\n            parentVertex.shape.geometryObject.geometryChildShapeIds.push(\r\n              shape2Hidden.id,\r\n            );\r\n        }\r\n      });\r\n    }\r\n\r\n    // Modifier les coordonn├®es\r\n    const center1 = shape1.fake_center,\r\n      center2 = shape2.fake_center,\r\n      difference = center2.substract(center1),\r\n      distance = center2.dist(center1),\r\n      myOffset = 20, //px\r\n      offset = difference.multiply(myOffset / distance);\r\n\r\n    shape1.translate(offset.multiply(-1));\r\n    if (shape.isSegment()) {\r\n      shape1.translate(\r\n        new Coordinates({\r\n          x: -shape.segments[0].direction.y,\r\n          y: shape.segments[0].direction.x,\r\n        }).multiply(myOffset / 2),\r\n      );\r\n    }\r\n\r\n    shape2.translate(offset);\r\n    if (shape.isSegment()) {\r\n      shape2.translate(\r\n        new Coordinates({\r\n          x: shape.segments[0].direction.y,\r\n          y: -shape.segments[0].direction.x,\r\n        }).multiply(myOffset / 2),\r\n      );\r\n    }\r\n  }\r\n\r\n  addPathElem(path, nextPoint, mustFollowArc) {\r\n    let segment;\r\n    if (mustFollowArc !== false) {\r\n      if (\r\n        this.currentPoint.shape.name == 'PointOnLine' ||\r\n        this.currentPoint.shape.name.startsWith('PointOnIntersection')\r\n      ) {\r\n        segment = findObjectById(\r\n          this.currentPoint.shape.geometryObject[\r\n            'geometryParentObjectId' + (this.currentPoint.cutSeg + 1)\r\n          ],\r\n        );\r\n      } else {\r\n        const segmentIdx = Number.isInteger(this.currentPoint.idx)\r\n          ? this.currentPoint.idx\r\n          : this.currentPoint.segments[0].idx;\r\n        segment = this.currentPoint.shape.segments[segmentIdx];\r\n      }\r\n    }\r\n    if (segment == undefined || !segment.isArc() || mustFollowArc === false) {\r\n      path.push('L', nextPoint.coordinates.x, nextPoint.coordinates.y);\r\n      this.currentPoint = nextPoint;\r\n    } else {\r\n      const firstCoord = this.currentPoint.coordinates;\r\n      const secondCoord = nextPoint.coordinates;\r\n\r\n      const centerCoordinates = segment.arcCenter.coordinates;\r\n      let radius = centerCoordinates.dist(secondCoord),\r\n        firstAngle = centerCoordinates.angleWith(firstCoord),\r\n        secondAngle = centerCoordinates.angleWith(secondCoord);\r\n\r\n      if (secondAngle < firstAngle) secondAngle += 2 * Math.PI;\r\n      let largeArcFlag = secondAngle - firstAngle > Math.PI ? 1 : 0,\r\n        sweepFlag = 1;\r\n      if (segment.counterclockwise) {\r\n        sweepFlag = Math.abs(sweepFlag - 1);\r\n        largeArcFlag = Math.abs(largeArcFlag - 1);\r\n      }\r\n      path.push(\r\n        'A',\r\n        radius,\r\n        radius,\r\n        0,\r\n        largeArcFlag,\r\n        sweepFlag,\r\n        secondCoord.x,\r\n        secondCoord.y,\r\n      );\r\n      this.currentPoint = nextPoint;\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Cut\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Delete\\DeleteTool.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":94,"column":19,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":94,"endColumn":21,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2670,2672],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":96,"column":34,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":96,"endColumn":36,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2762,2764],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":103,"column":26,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":103,"endColumn":28,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2958,2960],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":106,"column":32,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":106,"endColumn":34,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3112,3114],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":110,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":110,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3257,3259],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":114,"column":35,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":114,"endColumn":37,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[3447,3449],"text":"!=="},"desc":"Use '!==' instead of '!='."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { html } from 'lit';\r\nimport { app, setState } from '../Core/App';\r\nimport { GroupManager } from '../Core/Managers/GroupManager';\r\nimport { ShapeManager } from '../Core/Managers/ShapeManager';\r\nimport { Shape } from '../Core/Objects/Shapes/Shape';\r\nimport { Tool } from '../Core/States/Tool';\r\nimport { findObjectById, removeObjectById } from '../Core/Tools/general';\r\nimport {\r\n  deleteChildren,\r\n  deleteChildrenOfDivisionPoint,\r\n  deleteSubDivisionPoints,\r\n} from '../GeometryTools/deleteShape';\r\n\r\n/**\r\n * Supprimer une figure (et supprime le groupe dont la figure faisait partie s'il\r\n * ne restait que 2 figures dans le groupe)\r\n */\r\nexport class DeleteTool extends Tool {\r\n  constructor() {\r\n    super('delete', 'Supprimer', 'tool');\r\n  }\r\n\r\n  /**\r\n   * Renvoie l'aide ├á afficher ├á l'utilisateur\r\n   * @return {String} L'aide, en HTML\r\n   */\r\n  getHelpText() {\r\n    const toolName = this.title;\r\n    return html`\r\n      <h3>${toolName}</h3>\r\n      <p>\r\n        Vous avez s├®lectionn├® l'outil <b>\"${toolName}\"</b>.<br />\r\n        Touchez une figure pour la supprimer de l'espace de travail.\r\n      </p>\r\n    `;\r\n  }\r\n\r\n  /**\r\n   * initialiser l'├®tat\r\n   */\r\n  start() {\r\n    setTimeout(\r\n      () =>\r\n        setState({\r\n          tool: { ...app.tool, name: this.name, currentStep: 'listen' },\r\n        }),\r\n      50,\r\n    );\r\n  }\r\n\r\n  listen() {\r\n    this.removeListeners();\r\n\r\n    this.setSelectionConstraints();\r\n    this.objectSelectedId = app.addListener('objectSelected', this.handler);\r\n  }\r\n\r\n  /**\r\n   * stopper l'├®tat\r\n   */\r\n  end() {\r\n    this.removeListeners();\r\n  }\r\n\r\n  setSelectionConstraints() {\r\n    window.dispatchEvent(new CustomEvent('reset-selection-constraints'));\r\n    app.workspace.selectionConstraints.eventType = 'click';\r\n    app.workspace.selectionConstraints.shapes.canSelect = true;\r\n    app.workspace.selectionConstraints.points.canSelect = true;\r\n    app.workspace.selectionConstraints.points.types = ['divisionPoint'];\r\n  }\r\n\r\n  /**\r\n   * Appel├®e par ├®v├®nement du SelectManager lorsqu'une figure ou un point a ├®t├® s├®lectionn├® (click)\r\n   * @param  {Object} object            La figure ou le point s├®lectionn├®\r\n   */\r\n  objectSelected(object) {\r\n    if (!object) return;\r\n\r\n    if (object instanceof Shape) {\r\n      this.mode = 'shape';\r\n      this.involvedShapes = ShapeManager.getAllBindedShapes(object);\r\n      this.userGroup = GroupManager.getShapeGroup(object);\r\n    } else {\r\n      // point\r\n      this.point = object;\r\n      this.mode = 'divisionPoint';\r\n    }\r\n    this.executeAction();\r\n    setState({ tool: { ...app.tool, name: this.name, currentStep: 'listen' } });\r\n  }\r\n\r\n  _executeAction() {\r\n    if (this.mode == 'shape') {\r\n      this.involvedShapes.forEach((s) => {\r\n        if (app.environment.name == 'Geometrie') deleteChildren(s);\r\n        removeObjectById(s.id);\r\n      });\r\n\r\n      if (this.userGroup) {\r\n        GroupManager.deleteGroup(this.userGroup);\r\n      }\r\n    } else if (this.mode == 'divisionPoint') {\r\n      const segment = this.point.segments[0];\r\n      deleteSubDivisionPoints(segment, this.point);\r\n      if (app.environment.name == 'Geometrie')\r\n        deleteChildrenOfDivisionPoint(this.point);\r\n      segment.deletePoint(this.point);\r\n    }\r\n    if (app.environment.name == 'Geometrie') {\r\n      for (let i = 0; i < app.mainCanvasLayer.shapes.length; i++) {\r\n        const s = app.mainCanvasLayer.shapes[i];\r\n        s.points\r\n          .filter((pt) => pt.type != 'divisionPoint')\r\n          .forEach((pt) => {\r\n            if (pt.reference && !findObjectById(pt.reference))\r\n              pt.reference = null;\r\n          });\r\n        if (\r\n          s.geometryObject.geometryPointOnTheFlyChildId &&\r\n          !findObjectById(s.geometryObject.geometryPointOnTheFlyChildId)\r\n        ) {\r\n          deleteChildren(s);\r\n          i--;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Delete\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Divide\\DivideTool.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":117,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":117,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3811,3813],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":128,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":128,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4350,4352],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":132,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":132,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4575,4577],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":150,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":150,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5278,5280],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":188,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":188,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6441,6443],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":206,"column":43,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":206,"endColumn":45,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7207,7209],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":219,"column":42,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":219,"endColumn":44,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7818,7820],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":231,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":231,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8491,8493],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":242,"column":35,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":242,"endColumn":37,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8805,8807],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":295,"column":41,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":295,"endColumn":43,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[10592,10594],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"prefer-const","severity":1,"message":"'centerCoordinates' is never reassigned. Use 'const' instead.","line":299,"column":17,"nodeType":"Identifier","messageId":"useConst","endLine":299,"endColumn":34},{"ruleId":"prefer-const","severity":1,"message":"'firstAngle' is never reassigned. Use 'const' instead.","line":300,"column":15,"nodeType":"Identifier","messageId":"useConst","endLine":300,"endColumn":25},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":370,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":370,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[13026,13028],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":380,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":380,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[13378,13380],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":398,"column":19,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":398,"endColumn":21,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[13873,13875],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":406,"column":26,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":406,"endColumn":28,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[14206,14208],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"prefer-const","severity":1,"message":"'shape' is never reassigned. Use 'const' instead.","line":452,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":452,"endColumn":14},{"ruleId":"prefer-const","severity":1,"message":"'center' is never reassigned. Use 'const' instead.","line":453,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":453,"endColumn":13},{"ruleId":"prefer-const","severity":1,"message":"'firstAngle' is never reassigned. Use 'const' instead.","line":454,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":454,"endColumn":17},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":472,"column":31,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":472,"endColumn":33,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[16559,16561],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"prefer-const","severity":1,"message":"'radius' is never reassigned. Use 'const' instead.","line":476,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":476,"endColumn":13},{"ruleId":"no-unused-vars","severity":1,"message":"'shape' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":516,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":516,"endColumn":14,"suggestions":[{"messageId":"removeVar","data":{"varName":"shape"},"fix":{"range":[17971,17998],"text":""},"desc":"Remove unused variable 'shape'."}]},{"ruleId":"prefer-const","severity":1,"message":"'shape' is never reassigned. Use 'const' instead.","line":516,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":516,"endColumn":14},{"ruleId":"prefer-const","severity":1,"message":"'centerCoordinates' is never reassigned. Use 'const' instead.","line":517,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":517,"endColumn":24}],"suppressedMessages":[],"errorCount":15,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { html } from 'lit';\r\nimport { app, setState } from '../Core/App';\r\nimport { Coordinates } from '../Core/Objects/Coordinates';\r\nimport { Point } from '../Core/Objects/Point';\r\nimport { Segment } from '../Core/Objects/Segment';\r\nimport { ArrowLineShape } from '../Core/Objects/Shapes/ArrowLineShape';\r\nimport { GeometryObject } from '../Core/Objects/Shapes/GeometryObject';\r\nimport { LineShape } from '../Core/Objects/Shapes/LineShape';\r\nimport { Tool } from '../Core/States/Tool';\r\nimport { findObjectById, removeObjectById } from '../Core/Tools/general';\r\n\r\n/**\r\n * D├®couper un segment (ou partie de segment) en X parties (ajoute X-1 points)\r\n */\r\nexport class DivideTool extends Tool {\r\n  constructor() {\r\n    super('divide', 'Diviser', 'operation');\r\n\r\n    // choose-nb-parts -> listen-canvas-click -> select-second-point -> showing-points\r\n    //                                        -> showing-segment\r\n    this.currentStep = null;\r\n\r\n    this.timeoutRef = null;\r\n\r\n    this.drawColors = [\r\n      '#E90CC8',\r\n      app.settings.referenceDrawColor,\r\n      app.settings.referenceDrawColor2,\r\n      '#3e6aed',\r\n      '#21eb53',\r\n    ];\r\n\r\n    this.numberOfParts = 2;\r\n  }\r\n\r\n  /**\r\n   * Renvoie l'aide ├á afficher ├á l'utilisateur\r\n   * @return {String} L'aide, en HTML\r\n   */\r\n  getHelpText() {\r\n    const toolName = this.title;\r\n    return html`\r\n      <h3>${toolName}</h3>\r\n      <p>\r\n        Vous avez s├®lectionn├® l'outil <b>\"${toolName}\"</b>. Cet outil permet de\r\n        diviser un segment d'une figure en plusieurs parties (d├®limit├®es par des\r\n        points).<br />\r\n        Apr├¿s avoir choisit en combien de partie vous souhaitez diviser le\r\n        segment, touchez le segment que vous souhaitez diviser.<br />\r\n        Il est ├®galement possible de s├®lectionner deux points situ├®s sur le m├¬me\r\n        segment, afin de diviser le segment form├® par ces deux points.<br /><br />\r\n\r\n        <b>Note:</b> il est ├®galement possible de diviser un arc de cercle, soit\r\n        en touchant l'arc lui-m├¬me, soit en s├®lectionnant deux points situ├®s sur\r\n        cet arc. Dans ce dernier cas, la division est effectu├®e dans le sens\r\n        horlogique.\r\n      </p>\r\n    `;\r\n  }\r\n\r\n  start() {\r\n    window.clearTimeout(this.timeoutRef);\r\n    this.removeListeners();\r\n    const popup = document.createElement('divide-popup');\r\n    popup.parts = app.settings.numberOfDivisionParts;\r\n    document.querySelector('body').appendChild(popup);\r\n  }\r\n\r\n  selectObject() {\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    window.clearTimeout(this.timeoutRef);\r\n    this.removeListeners();\r\n\r\n    this.setSelectionConstraints();\r\n    this.objectSelectedId = app.addListener('objectSelected', this.handler);\r\n  }\r\n\r\n  selectSecondPoint() {\r\n    window.clearTimeout(this.timeoutRef);\r\n    this.removeListeners();\r\n\r\n    const firstPoint = findObjectById(app.tool.firstPointIds[0]);\r\n    new Point({\r\n      coordinates: firstPoint.coordinates,\r\n      layer: 'upper',\r\n      color: this.drawColors[0],\r\n      size: 2,\r\n    });\r\n\r\n    this.setSelectionConstraints();\r\n    this.objectSelectedId = app.addListener('objectSelected', this.handler);\r\n  }\r\n\r\n  chooseArcDirection() {\r\n    this.removeListeners();\r\n    this.setSelectionConstraints();\r\n    this.objectSelectedId = app.addListener('objectSelected', this.handler);\r\n  }\r\n\r\n  divide() {\r\n    this.removeListeners();\r\n  }\r\n\r\n  end() {\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    window.clearTimeout(this.timeoutRef);\r\n    this.removeListeners();\r\n  }\r\n\r\n  setSelectionConstraints() {\r\n    window.dispatchEvent(new CustomEvent('reset-selection-constraints'));\r\n    app.workspace.selectionConstraints.eventType = 'click';\r\n    app.workspace.selectionConstraints.points.types = [\r\n      'vertex',\r\n      'divisionPoint',\r\n    ];\r\n    if (app.tool.currentStep == 'selectObject') {\r\n      app.workspace.selectionConstraints.segments.canSelect = true;\r\n      app.workspace.selectionConstraints.segments.blacklist =\r\n        app.mainCanvasLayer.shapes\r\n          .filter((s) => s.isStraightLine() || s.isSemiStraightLine())\r\n          .map((s) => {\r\n            return { shapeId: s.id };\r\n          });\r\n      app.workspace.selectionConstraints.points.canSelect = true;\r\n      app.workspace.selectionConstraints.points.numberOfObjects =\r\n        'allSuperimposed';\r\n    } else if (app.tool.currentStep == 'selectSecondPoint') {\r\n      app.workspace.selectionConstraints.points.canSelect = true;\r\n      app.workspace.selectionConstraints.points.numberOfObjects =\r\n        'allSuperimposed';\r\n    } else if (app.tool.currentStep == 'chooseArcDirection') {\r\n      app.workspace.selectionConstraints.segments.canSelect = true;\r\n      app.workspace.selectionConstraints.segments.whitelist = this.lines.map(\r\n        (ln) => {\r\n          return { shapeId: ln.id };\r\n        },\r\n      );\r\n      app.workspace.selectionConstraints.segments.canSelectFromUpper = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Appel├®e par ├®v├®nement du SelectManager lorsqu'un point/segment a ├®t├® s├®lectionn├®e (click)\r\n   * @param  {Object} object            L'├®l├®ment s├®lectionn├®\r\n   * @param  {Point} mouseCoordinates Les coordonn├®es du click\r\n   * @param  {Event} event            l'├®v├®nement javascript\r\n   */\r\n  objectSelected(object) {\r\n    if (app.tool.currentStep == 'selectObject') {\r\n      if (object instanceof Segment) {\r\n        if (object.shape instanceof ArrowLineShape) {\r\n          window.dispatchEvent(\r\n            new CustomEvent('show-notif', {\r\n              detail: {\r\n                message:\r\n                  'Les vecteurs ne peuvent pas ├¬tre divis├®s, mais peuvent ├¬tre multipli├®s.',\r\n              },\r\n            }),\r\n          );\r\n          return;\r\n        } else {\r\n          this.segmentId = object.id;\r\n\r\n          new LineShape({\r\n            layer: 'upper',\r\n            strokeColor: this.drawColors[0],\r\n            strokeWidth: 3,\r\n            path: object.getSVGPath('no scale', true),\r\n            id: undefined,\r\n          });\r\n\r\n          this.mode = 'segment';\r\n          setState({ tool: { ...app.tool, currentStep: 'divide' } });\r\n        }\r\n      } else {\r\n        this.firstPointIds = object.map((pt) => pt.id);\r\n\r\n        this.setSelectionConstraints();\r\n        setState({\r\n          tool: {\r\n            ...app.tool,\r\n            currentStep: 'selectSecondPoint',\r\n            firstPointIds: this.firstPointIds,\r\n          },\r\n        });\r\n      }\r\n    } else if (app.tool.currentStep == 'selectSecondPoint') {\r\n      const pt1 = findObjectById(this.firstPointIds[0]);\r\n      const object1 = object[0];\r\n\r\n      if (pt1.coordinates.dist(object1.coordinates) < 0.01) {\r\n        // pt1 == object => d├®s├®lectionner le point.\r\n        removeObjectById(app.upperCanvasLayer.points[0].id);\r\n\r\n        setState({ tool: { ...app.tool, currentStep: 'selectObject' } });\r\n      } else {\r\n        const pointsToDivide = [];\r\n        const firstPoints = this.firstPointIds.map((ptId) =>\r\n          findObjectById(ptId),\r\n        );\r\n        const newObjects = [...object];\r\n        for (let i = 0; i < firstPoints.length; i++) {\r\n          for (let j = 0; j < newObjects.length; j++) {\r\n            let firstSegmentIds;\r\n            if (firstPoints[i].shape.name == 'PointOnLine')\r\n              firstSegmentIds = [\r\n                firstPoints[i].shape.geometryObject.geometryParentObjectId1,\r\n              ];\r\n            else if (\r\n              firstPoints[i].shape.name.startsWith('PointOnIntersection')\r\n            )\r\n              firstSegmentIds = [\r\n                firstPoints[i].shape.geometryObject.geometryParentObjectId1,\r\n                firstPoints[i].shape.geometryObject.geometryParentObjectId2,\r\n              ];\r\n            else firstSegmentIds = firstPoints[i].segmentIds;\r\n            let secondSegmentIds;\r\n            if (newObjects[j].shape.name == 'PointOnLine')\r\n              secondSegmentIds = [\r\n                newObjects[j].shape.geometryObject.geometryParentObjectId1,\r\n              ];\r\n            else if (newObjects[j].shape.name.startsWith('PointOnIntersection'))\r\n              secondSegmentIds = [\r\n                newObjects[j].shape.geometryObject.geometryParentObjectId1,\r\n                newObjects[j].shape.geometryObject.geometryParentObjectId2,\r\n              ];\r\n            else secondSegmentIds = newObjects[j].segmentIds;\r\n            for (let m = 0; m < firstSegmentIds.length; m++) {\r\n              for (let n = 0; n < secondSegmentIds.length; n++) {\r\n                if (firstSegmentIds[m] == secondSegmentIds[n]) {\r\n                  pointsToDivide.push([\r\n                    firstPoints[i],\r\n                    newObjects[j],\r\n                    firstSegmentIds[m],\r\n                  ]);\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n        if (pointsToDivide.length == 0) {\r\n          window.dispatchEvent(\r\n            new CustomEvent('show-notif', {\r\n              detail: {\r\n                message:\r\n                  'Les points de la division doivent appartenir au m├¬me segment',\r\n              },\r\n            }),\r\n          );\r\n          return;\r\n        }\r\n\r\n        new Point({\r\n          coordinates: pointsToDivide[0][1].coordinates,\r\n          layer: 'upper',\r\n          color: this.drawColors[0],\r\n          size: 2,\r\n        });\r\n\r\n        let mustChooseArc = false;\r\n\r\n        pointsToDivide.forEach((pts, idx) => {\r\n          let firstCoordinates = pointsToDivide[0][0].coordinates;\r\n          let secondCoordinates = pointsToDivide[0][1].coordinates;\r\n          const commonSegment = findObjectById(pts[2]);\r\n          const shape = commonSegment.shape;\r\n          let path1 = [\r\n              'M',\r\n              firstCoordinates.x,\r\n              firstCoordinates.y,\r\n              'L',\r\n              secondCoordinates.x,\r\n              secondCoordinates.y,\r\n            ].join(' '),\r\n            path2;\r\n          if (commonSegment.isArc()) {\r\n            if (!shape.isCircle()) {\r\n              commonSegment.vertexes[0].ratio = 0;\r\n              commonSegment.vertexes[1].ratio = 1;\r\n              if (\r\n                (pts[0].ratio > pts[1].ratio) ^\r\n                commonSegment.counterclockwise\r\n              ) {\r\n                [pointsToDivide[idx][0], pointsToDivide[idx][1]] = [\r\n                  pointsToDivide[idx][1],\r\n                  pointsToDivide[idx][0],\r\n                ];\r\n                [firstCoordinates, secondCoordinates] = [\r\n                  secondCoordinates,\r\n                  firstCoordinates,\r\n                ];\r\n              }\r\n            } else {\r\n              if (pointsToDivide.length == 1) {\r\n                mustChooseArc = true;\r\n              }\r\n            }\r\n            let centerCoordinates = commonSegment.arcCenter.coordinates,\r\n              firstAngle = centerCoordinates.angleWith(firstCoordinates),\r\n              secondAngle = centerCoordinates.angleWith(secondCoordinates);\r\n            if (secondAngle < firstAngle) secondAngle += 2 * Math.PI;\r\n            const largeArcFlag = secondAngle - firstAngle > Math.PI ? 1 : 0,\r\n              sweepFlag = 1;\r\n            path1 = [\r\n              'M',\r\n              firstCoordinates.x,\r\n              firstCoordinates.y,\r\n              'A',\r\n              commonSegment.radius,\r\n              commonSegment.radius,\r\n              0,\r\n              largeArcFlag,\r\n              sweepFlag,\r\n              secondCoordinates.x,\r\n              secondCoordinates.y,\r\n            ].join(' ');\r\n            path2 = [\r\n              'M',\r\n              firstCoordinates.x,\r\n              firstCoordinates.y,\r\n              'A',\r\n              commonSegment.radius,\r\n              commonSegment.radius,\r\n              0,\r\n              1 - largeArcFlag,\r\n              1 - sweepFlag,\r\n              secondCoordinates.x,\r\n              secondCoordinates.y,\r\n            ].join(' ');\r\n          }\r\n          if (mustChooseArc) {\r\n            this.lines = [\r\n              new LineShape({\r\n                layer: 'upper',\r\n                strokeColor: this.drawColors[idx + 1],\r\n                strokeWidth: 3,\r\n                path: path1,\r\n                id: undefined,\r\n              }),\r\n              new LineShape({\r\n                layer: 'upper',\r\n                strokeColor: this.drawColors[idx + 2],\r\n                strokeWidth: 3,\r\n                path: path2,\r\n                id: undefined,\r\n              }),\r\n            ];\r\n          } else {\r\n            new LineShape({\r\n              layer: 'upper',\r\n              strokeColor: this.drawColors[idx],\r\n              strokeWidth: 3,\r\n              path: path1,\r\n              id: undefined,\r\n            });\r\n          }\r\n        });\r\n\r\n        this.mode = 'twoPoints';\r\n        this.pointsToDivide = pointsToDivide;\r\n        if (mustChooseArc) {\r\n          setState({\r\n            tool: { ...app.tool, currentStep: 'chooseArcDirection' },\r\n          });\r\n        } else {\r\n          setState({ tool: { ...app.tool, currentStep: 'divide' } });\r\n        }\r\n      }\r\n    } else if (app.tool.currentStep == 'chooseArcDirection') {\r\n      this.arcDirectionCounterclockwise = object.counterclockwise;\r\n      setState({ tool: { ...app.tool, currentStep: 'divide' } });\r\n      this.executeAction();\r\n      setState({\r\n        tool: { ...app.tool, name: this.name, currentStep: 'selectObject' },\r\n      });\r\n      return;\r\n    }\r\n\r\n    if (app.tool.currentStep == 'divide') {\r\n      this.executeAnimation();\r\n    }\r\n    // window.dispatchEvent(new CustomEvent('refresh'));\r\n  }\r\n\r\n  executeAnimation() {\r\n    window.clearTimeout(this.timeoutRef);\r\n    this.timeoutRef = window.setTimeout(() => {\r\n      this.executeAction();\r\n      setState({\r\n        tool: { ...app.tool, name: this.name, currentStep: 'selectObject' },\r\n      });\r\n    }, 200);\r\n  }\r\n\r\n  _executeAction() {\r\n    this.numberOfParts = app.settings.numberOfDivisionParts;\r\n    if (this.mode == 'twoPoints') {\r\n      this.pointsToDivide.forEach((pts) => {\r\n        this.firstPoint = pts[0];\r\n        this.secondPoint = pts[1];\r\n        this.segment = findObjectById(pts[2]);\r\n        if (this.segment.arcCenter) this.pointsModeAddArcPoints();\r\n        else this.pointsModeAddSegPoints();\r\n      });\r\n    } else if (this.mode == 'segment') {\r\n      this.segment = findObjectById(this.segmentId);\r\n      if (this.segment.arcCenter) this.segmentModeAddArcPoints();\r\n      else this.segmentModeAddSegPoints();\r\n    } else {\r\n      const vector = findObjectById(this.vectorId);\r\n      const secondPointCoordinates = vector.vertexes[0].coordinates.add(\r\n        vector.vertexes[1].coordinates\r\n          .substract(vector.vertexes[0].coordinates)\r\n          .multiply(1 / this.numberOfParts),\r\n      );\r\n      let path = [\r\n        'M',\r\n        vector.segments[0].vertexes[0].x,\r\n        vector.segments[0].vertexes[0].y,\r\n        'L',\r\n        secondPointCoordinates.x,\r\n        secondPointCoordinates.y,\r\n      ];\r\n      path = path.join(' ');\r\n\r\n      const newShape = new ArrowLineShape({\r\n        layer: 'main',\r\n        path: path,\r\n        name: vector.name,\r\n        familyName: 'duplicate',\r\n        fillColor: vector.fillColor,\r\n        fillOpacity: vector.fillOpacity,\r\n        strokeColor: vector.strokeColor,\r\n        geometryObject: new GeometryObject({\r\n          geometryDuplicateParentShapeId: vector.id,\r\n          geometryConstructionSpec: {\r\n            numberOfParts: this.numberOfParts,\r\n          },\r\n        }),\r\n      });\r\n      vector.geometryObject.geometryDuplicateChildShapeIds.push(newShape.id);\r\n    }\r\n  }\r\n\r\n  segmentModeAddArcPoints() {\r\n    this.firstPoint = this.segment.vertexes[0];\r\n    this.secondPoint = this.segment.vertexes[1];\r\n    this.segment.vertexes[1].ratio = 1;\r\n    this.segment.vertexes[0].ratio = 0;\r\n\r\n    let shape = this.segment.shape,\r\n      center = this.segment.arcCenter,\r\n      firstAngle = center.coordinates.angleWith(this.firstPoint.coordinates),\r\n      secondAngle = center.coordinates.angleWith(this.secondPoint.coordinates);\r\n    if (this.firstPoint.coordinates.equal(this.secondPoint.coordinates))\r\n      secondAngle += 2 * Math.PI;\r\n    else if (firstAngle > secondAngle) secondAngle += 2 * Math.PI;\r\n\r\n    // Pour un cercle entier, on ajoute un point de division suppl├®mentaire\r\n    if (shape.isCircle()) {\r\n      this.segment.addPoint(\r\n        this.firstPoint.coordinates,\r\n        this.firstPoint.ratio,\r\n        this.firstPoint.id,\r\n        this.secondPoint.id,\r\n      );\r\n    }\r\n\r\n    let ratioCap =\r\n      (this.secondPoint.ratio - this.firstPoint.ratio) / this.numberOfParts;\r\n    if (this.firstPoint.ratio == this.secondPoint.ratio)\r\n      ratioCap = 1 / this.numberOfParts;\r\n\r\n    let partAngle = (secondAngle - firstAngle) / this.numberOfParts,\r\n      radius = this.segment.radius;\r\n\r\n    if (\r\n      this.segment.counterclockwise &&\r\n      !this.firstPoint.coordinates.equal(this.secondPoint.coordinates)\r\n    ) {\r\n      partAngle = (secondAngle - firstAngle - 2 * Math.PI) / this.numberOfParts;\r\n    }\r\n\r\n    for (\r\n      let i = 1, coord = this.firstPoint.coordinates;\r\n      i < this.numberOfParts;\r\n      i++\r\n    ) {\r\n      const newX = radius * Math.cos(firstAngle + partAngle * i) + center.x,\r\n        newY = radius * Math.sin(firstAngle + partAngle * i) + center.y;\r\n      coord = new Coordinates({ x: newX, y: newY });\r\n      const ratio = this.firstPoint.ratio + i * ratioCap;\r\n      this.segment.addPoint(\r\n        coord,\r\n        ratio,\r\n        this.firstPoint.id,\r\n        this.secondPoint.id,\r\n      );\r\n    }\r\n  }\r\n\r\n  segmentModeAddSegPoints() {\r\n    this.firstPoint = this.segment.vertexes[0];\r\n    this.secondPoint = this.segment.vertexes[1];\r\n    this.pointsModeAddSegPoints();\r\n  }\r\n\r\n  pointsModeAddArcPoints() {\r\n    // if (this.firstPoint.coordinates.equal(this.segment.vertexes[0].coordinates))\r\n    //   this.firstPoint.ratio = 0;\r\n    // else if (\r\n    //   this.secondPoint.coordinates.equal(this.segment.vertexes[1].coordinates)\r\n    // )\r\n    //   this.secondPoint.ratio = 1;\r\n    let shape = this.segment.shape,\r\n      centerCoordinates = this.segment.arcCenter.coordinates,\r\n      firstAngle = centerCoordinates.angleWith(this.firstPoint.coordinates),\r\n      secondAngle = centerCoordinates.angleWith(this.secondPoint.coordinates);\r\n    if (this.arcDirectionCounterclockwise) {\r\n      [firstAngle, secondAngle] = [secondAngle, firstAngle];\r\n    }\r\n    if (secondAngle < firstAngle) {\r\n      secondAngle += Math.PI * 2;\r\n    }\r\n    const ratioCap =\r\n      // (this.secondPoint.ratio - this.firstPoint.ratio)\r\n      1 / this.numberOfParts;\r\n    // if (shape.isCircle()) {\r\n    //   if (ratioCap < 0) ratioCap += 1 / this.numberOfParts;\r\n    // }\r\n\r\n    const partAngle = (secondAngle - firstAngle) / this.numberOfParts,\r\n      radius = this.segment.radius;\r\n\r\n    for (\r\n      let i = 1; //, coord = this.firstPoint.coordinates;\r\n      i < this.numberOfParts;\r\n      i++\r\n    ) {\r\n      const newX =\r\n          radius * Math.cos(firstAngle + partAngle * i) + centerCoordinates.x,\r\n        newY =\r\n          radius * Math.sin(firstAngle + partAngle * i) + centerCoordinates.y;\r\n      const coord = new Coordinates({ x: newX, y: newY });\r\n      let ratio = i * ratioCap; //this.firstPoint.ratio +\r\n      if (ratio > 1) ratio--;\r\n      this.segment.addPoint(\r\n        coord,\r\n        ratio,\r\n        this.firstPoint.id,\r\n        this.secondPoint.id,\r\n      );\r\n    }\r\n  }\r\n\r\n  pointsModeAddSegPoints() {\r\n    if (this.firstPoint.ratio > this.secondPoint.ratio)\r\n      [this.firstPoint, this.secondPoint] = [this.secondPoint, this.firstPoint];\r\n\r\n    const ratioCap =\r\n      //(this.secondPoint.ratio - this.firstPoint.ratio)\r\n      1 / this.numberOfParts;\r\n\r\n    const segLength = this.secondPoint.coordinates.substract(\r\n      this.firstPoint.coordinates,\r\n    );\r\n    const part = segLength.multiply(1 / this.numberOfParts);\r\n\r\n    for (\r\n      let i = 1, coord = this.firstPoint.coordinates;\r\n      i < this.numberOfParts;\r\n      i++\r\n    ) {\r\n      coord = coord.add(part);\r\n      const ratio = i * ratioCap; //this.firstPoint.ratio +\r\n      this.segment.addPoint(\r\n        coord,\r\n        ratio,\r\n        this.firstPoint.id,\r\n        this.secondPoint.id,\r\n      );\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Divide\\divide-popup.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":32,"column":70,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":32,"endColumn":72,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[908,910],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import '@components/color-button';\r\nimport { TemplatePopup } from '@components/popups/template-popup';\r\nimport { css, html, LitElement } from 'lit';\r\nimport { app, setState } from '../Core/App';\r\nimport { range } from '../Core/Tools/general';\r\n\r\nclass DividePopup extends LitElement {\r\n  static properties = {\r\n    parts: Number,\r\n  };\r\n\r\n  static styles = [\r\n    TemplatePopup.template_popup_styles(),\r\n    css`\r\n      select {\r\n        text-align: center;\r\n        width: 2.5rem;\r\n      }\r\n    `,\r\n  ];\r\n\r\n  render() {\r\n    return html`\r\n      <template-popup>\r\n        <h2 slot=\"title\">Diviser</h2>\r\n        <div slot=\"body\" id=\"body\">\r\n          <label for=\"settings_divide_number_of_parts\">\r\n            Diviser en\r\n            <select @change=\"${this.changeNumberOfParts}\">\r\n              ${range(2, 9).map(\r\n                (x) =>\r\n                  html` <option value=\"${x}\" ?selected=\"${this.parts == x}\">\r\n                    ${x}\r\n                  </option>`,\r\n              )}\r\n            </select>\r\n            parts</label\r\n          >\r\n        </div>\r\n\r\n        <div slot=\"footer\">\r\n          <color-button\r\n            @click=\"${() => window.dispatchEvent(new Event('close-popup'))}\"\r\n            innerText=\"Ok\"\r\n          ></color-button>\r\n        </div>\r\n      </template-popup>\r\n    `;\r\n  }\r\n\r\n  firstUpdated() {\r\n    window.addEventListener(\r\n      'state-changed',\r\n      () => (this.parts = app.settings.numberOfDivisionParts),\r\n    );\r\n    window.addEventListener('close-popup', this.submitAndClose.bind(this));\r\n  }\r\n\r\n  changeNumberOfParts(event) {\r\n    setState({\r\n      settings: { ...app.settings, numberOfDivisionParts: event.target.value },\r\n    });\r\n  }\r\n\r\n  submit() {\r\n    setState({\r\n      tool: { ...app.tool, name: 'divide', currentStep: 'selectObject' },\r\n    });\r\n  }\r\n\r\n  submitAndClose() {\r\n    this.submit();\r\n    this.remove();\r\n  }\r\n}\r\ncustomElements.define('divide-popup', DividePopup);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Divide\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Duplicate\\DuplicateTool.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":81,"column":54,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":81,"endColumn":56,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[3015,3017],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":118,"column":28,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":118,"endColumn":30,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[4120,4122],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":119,"column":28,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":119,"endColumn":30,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[4163,4165],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":123,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":123,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4236,4238],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":145,"column":35,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":145,"endColumn":37,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[5054,5056],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":156,"column":28,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":156,"endColumn":30,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5365,5367],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":170,"column":31,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":170,"endColumn":33,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5928,5930],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":203,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":203,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[7174,7176],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":221,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":221,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[7639,7641],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":232,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":232,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7978,7980],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":244,"column":19,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":244,"endColumn":21,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8334,8336],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":248,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":248,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8490,8492],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":310,"column":26,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":310,"endColumn":28,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[10741,10743],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":318,"column":35,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":318,"endColumn":37,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[11084,11086],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":357,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":357,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[12494,12496],"text":"!=="},"desc":"Use '!==' instead of '!='."}]}],"suppressedMessages":[],"errorCount":15,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { html } from 'lit';\r\nimport { app, setState } from '../Core/App';\r\nimport { GroupManager } from '../Core/Managers/GroupManager';\r\nimport { SelectManager } from '../Core/Managers/SelectManager';\r\nimport { ShapeManager } from '../Core/Managers/ShapeManager';\r\nimport { Coordinates } from '../Core/Objects/Coordinates';\r\nimport { Point } from '../Core/Objects/Point';\r\nimport { Segment } from '../Core/Objects/Segment';\r\nimport { ShapeGroup } from '../Core/Objects/ShapeGroup';\r\nimport { GeometryObject } from '../Core/Objects/Shapes/GeometryObject';\r\nimport { LineShape } from '../Core/Objects/Shapes/LineShape';\r\nimport { SinglePointShape } from '../Core/Objects/Shapes/SinglePointShape';\r\nimport { Tool } from '../Core/States/Tool';\r\nimport { getShapeAdjustment } from '../Core/Tools/automatic_adjustment';\r\nimport { computeConstructionSpec } from '../GeometryTools/recomputeShape';\r\n\r\n/**\r\n * Dupliquer une figure\r\n */\r\nexport class DuplicateTool extends Tool {\r\n  constructor() {\r\n    super('duplicate', 'Dupliquer', 'operation');\r\n\r\n    this.currentStep = null; // listen-canvas-click -> moving-shape\r\n\r\n    //coordonn├®es de la souris lorsque la duplication a commenc├®\r\n    this.startClickCoordinates = null;\r\n\r\n    /*\r\n        L'ensemble des figures li├®es ├á la figure s├®lectionn├®e, y compris la figure\r\n        elle-m├¬me\r\n         */\r\n    this.involvedShapes = [];\r\n\r\n    this.translateOffset = new Coordinates({ x: -20, y: -20 });\r\n  }\r\n\r\n  /**\r\n   * Renvoie l'aide ├á afficher ├á l'utilisateur\r\n   * @return {String} L'aide, en HTML\r\n   */\r\n  getHelpText() {\r\n    const toolName = this.title;\r\n    return html`\r\n      <h3>${toolName}</h3>\r\n      <p>\r\n        Vous avez s├®lectionn├® l'outil <b>\"${toolName}\"</b>.<br />\r\n        Pour copier une figure, appuyez sur la figure et faites glissez votre\r\n        doigt dans une direction sans le relacher. Relachez ensuite votre doigt\r\n        une fois que la nouvelle figure est ├á la bonne place.<br /><br />\r\n        <b>Attention:</b> si vous appuyez sur une figure puis relachez\r\n        directement, une copie de la figure aura bien ├®t├® cr├®├®e, mais ├á la m├¬me\r\n        position que la figure d'origine. Il y a donc deux figures l'une sur\r\n        l'autre.<br /><br />\r\n        <b>Note:</b> la nouvelle figure cr├®├®e n'est pas li├®e d'une mani├¿re ou\r\n        d'une autre avec la figure d'origine: il s'agit bien d'une copie\r\n        compl├¿tement ind├®pendante.\r\n      </p>\r\n    `;\r\n  }\r\n\r\n  start() {\r\n    setTimeout(\r\n      () =>\r\n        setState({\r\n          tool: { ...app.tool, name: this.name, currentStep: 'listen' },\r\n        }),\r\n      50,\r\n    );\r\n  }\r\n\r\n  listen() {\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.stopAnimation();\r\n    this.removeListeners();\r\n\r\n    const constraints = SelectManager.getEmptySelectionConstraints();\r\n    constraints.eventType = 'mousedown';\r\n    constraints.shapes.canSelect = true;\r\n    constraints.shapes.blacklist = app.mainCanvasLayer.shapes.filter(\r\n      (s) => s instanceof SinglePointShape && s.name != 'PointOnLine',\r\n    );\r\n    constraints.segments.canSelect = true;\r\n    constraints.segments.blacklist = app.mainCanvasLayer.shapes\r\n      .filter((s) => s instanceof LineShape)\r\n      .map((s) => {\r\n        return { shapeId: s.id };\r\n      });\r\n    constraints.priority = ['points', 'shapes', 'segments'];\r\n    app.workspace.selectionConstraints = constraints;\r\n    this.objectSelectedId = app.addListener('objectSelected', this.handler);\r\n  }\r\n\r\n  selectSegment() {\r\n    this.removeListeners();\r\n\r\n    const constraints = SelectManager.getEmptySelectionConstraints();\r\n    constraints.segments.canSelect = true;\r\n    constraints.eventType = 'mousedown';\r\n    app.workspace.selectionConstraints = constraints;\r\n    this.objectSelectedId = app.addListener('objectSelected', this.handler);\r\n  }\r\n\r\n  move() {\r\n    this.removeListeners();\r\n\r\n    this.mouseUpId = app.addListener('canvasMouseUp', this.handler);\r\n  }\r\n\r\n  end() {\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.stopAnimation();\r\n    this.removeListeners();\r\n  }\r\n\r\n  objectSelected(object) {\r\n    if (\r\n      app.tool.currentStep != 'listen' &&\r\n      app.tool.currentStep != 'selectSegment'\r\n    )\r\n      return;\r\n\r\n    if (app.tool.currentStep == 'selectSegment' && object instanceof Segment) {\r\n      if (object.isInfinite || object.isSemiInfinite) return;\r\n      this.mode = 'point';\r\n      this.segment = object;\r\n      this.executeAction();\r\n      setState({\r\n        tool: { ...app.tool, name: this.name, currentStep: 'listen' },\r\n      });\r\n    } else if (object instanceof Segment) {\r\n      this.mode = 'segment';\r\n\r\n      this.startClickCoordinates = app.workspace.lastKnownMouseCoordinates;\r\n      this.lastKnownMouseCoordinates = this.startClickCoordinates;\r\n\r\n      this.involvedSegment = object;\r\n\r\n      const newShape = new LineShape({\r\n        layer: 'upper',\r\n        path: object.getSVGPath('no scale', true),\r\n        id: undefined,\r\n        segmentsColor: [object.color],\r\n        pointsColor: object.points\r\n          .filter((pt) => pt.type != 'divisionPoint')\r\n          .map((pt) => {\r\n            return pt.color;\r\n          }),\r\n      });\r\n      newShape.translate(this.translateOffset);\r\n\r\n      this.drawingShapes = [newShape];\r\n\r\n      setState({ tool: { ...app.tool, currentStep: 'move' } });\r\n      this.animate();\r\n    } else if (object.name == 'PointOnLine') {\r\n      this.involvedPoint = object;\r\n      new Point({\r\n        coordinates: object.points[0].coordinates,\r\n        layer: 'upper',\r\n        color: app.settings.referenceDrawColor,\r\n        size: 2,\r\n      });\r\n      setState({ tool: { ...app.tool, currentStep: 'selectSegment' } });\r\n    } else {\r\n      this.mode = 'shape';\r\n      this.involvedShapes = ShapeManager.getAllBindedShapes(object);\r\n      for (let i = 0; i < this.involvedShapes.length; i++) {\r\n        const currentShape = this.involvedShapes[i];\r\n        if (currentShape.name == 'Vector') {\r\n          window.dispatchEvent(\r\n            new CustomEvent('show-notif', {\r\n              detail: {\r\n                message:\r\n                  'Les vecteurs ne peuvent pas ├¬tre dupliqu├®s, mais peuvent ├¬tre multipli├®s.',\r\n              },\r\n            }),\r\n          );\r\n          return;\r\n        }\r\n      }\r\n      this.startClickCoordinates = app.workspace.lastKnownMouseCoordinates;\r\n      this.lastKnownMouseCoordinates = this.startClickCoordinates;\r\n\r\n      // sort shape by height\r\n      this.involvedShapes.sort(\r\n        (s1, s2) =>\r\n          ShapeManager.getShapeIndex(s1) - ShapeManager.getShapeIndex(s2),\r\n      );\r\n      this.drawingShapes = this.involvedShapes.map((s) => {\r\n        const newShape = new s.constructor({\r\n          ...s,\r\n          layer: 'upper',\r\n          path: s.getSVGPath('no scale', false),\r\n          id: undefined,\r\n          // divisionPointInfos: s.divisionPoints.map((dp) => {\r\n          //   return { coordinates: dp.coordinates, ratio: dp.ratio, segmentIdx: dp.segments[0].idx, color: dp.color };\r\n          // }),\r\n          segmentsColor: s.segments.map((seg) => {\r\n            return seg.color;\r\n          }),\r\n          pointsColor: s.points\r\n            .filter((pt) => pt.type != 'divisionPoint')\r\n            .map((pt) => {\r\n              return pt.color;\r\n            }),\r\n        });\r\n        newShape.vertexes.forEach(\r\n          (vx, idx) => (vx.visible = s.vertexes[idx].visible),\r\n        );\r\n        newShape.translate(this.translateOffset);\r\n        return newShape;\r\n      });\r\n\r\n      setState({ tool: { ...app.tool, currentStep: 'move' } });\r\n      this.animate();\r\n    }\r\n  }\r\n\r\n  canvasMouseUp() {\r\n    if (app.tool.currentStep != 'move') return;\r\n\r\n    this.translation = app.workspace.lastKnownMouseCoordinates\r\n      .substract(this.startClickCoordinates)\r\n      .add(this.translateOffset);\r\n\r\n    this.executeAction();\r\n    setState({ tool: { ...app.tool, name: this.name, currentStep: 'listen' } });\r\n  }\r\n\r\n  refreshStateUpper() {\r\n    if (app.tool.currentStep == 'move') {\r\n      const transformation = app.workspace.lastKnownMouseCoordinates.substract(\r\n        this.lastKnownMouseCoordinates,\r\n      );\r\n\r\n      this.drawingShapes.forEach((s) => s.translate(transformation));\r\n\r\n      this.lastKnownMouseCoordinates = app.workspace.lastKnownMouseCoordinates;\r\n    }\r\n  }\r\n\r\n  _executeAction() {\r\n    if (this.mode == 'point') {\r\n      const segment = this.segment;\r\n      let coord;\r\n      const ratio = this.involvedPoint.points[0].ratio;\r\n      if (segment.shape.name == 'Circle') {\r\n        const refShape = segment.shape;\r\n        const angle =\r\n          refShape.segments[0].arcCenter.coordinates.angleWith(\r\n            refShape.vertexes[0].coordinates,\r\n          ) +\r\n          ratio * Math.PI * 2;\r\n        coord = refShape.segments[0].arcCenter.coordinates.add({\r\n          x: refShape.segments[0].radius * Math.cos(angle),\r\n          y: refShape.segments[0].radius * Math.sin(angle),\r\n        });\r\n      } else if (segment.isArc()) {\r\n        const firstAngle = segment.arcCenter.coordinates.angleWith(\r\n          segment.vertexes[0].coordinates,\r\n        );\r\n        let secondAngle = segment.arcCenter.coordinates.angleWith(\r\n          segment.vertexes[1].coordinates,\r\n        );\r\n        if (secondAngle <= firstAngle) {\r\n          secondAngle += Math.PI * 2;\r\n        }\r\n        let newAngle = firstAngle + ratio * (secondAngle - firstAngle);\r\n        if (segment.counterclockwise) {\r\n          newAngle =\r\n            firstAngle - ratio * (2 * Math.PI - secondAngle + firstAngle);\r\n        }\r\n        coord = new Coordinates({\r\n          x:\r\n            segment.arcCenter.coordinates.x +\r\n            segment.radius * Math.cos(newAngle),\r\n          y:\r\n            segment.arcCenter.coordinates.y +\r\n            segment.radius * Math.sin(newAngle),\r\n        });\r\n      } else {\r\n        const firstPoint = segment.vertexes[0];\r\n        const secondPoint = segment.vertexes[1];\r\n        const segLength = secondPoint.coordinates.substract(\r\n          firstPoint.coordinates,\r\n        );\r\n        const part = segLength.multiply(ratio);\r\n\r\n        coord = firstPoint.coordinates.add(part);\r\n      }\r\n\r\n      const shape = new SinglePointShape({\r\n        layer: 'main',\r\n        path: `M ${coord.x} ${coord.y}`,\r\n        name: 'PointOnLine',\r\n        familyName: 'Point',\r\n        geometryObject: new GeometryObject({\r\n          geometryDuplicateParentShapeId: this.involvedPoint.id,\r\n          geometryParentObjectId1: segment.id,\r\n        }),\r\n      });\r\n\r\n      computeConstructionSpec(shape);\r\n\r\n      segment.shape.geometryObject.geometryChildShapeIds.push(shape.id);\r\n      this.involvedPoint.geometryObject.geometryDuplicateChildShapeIds.push(\r\n        shape.id,\r\n      );\r\n    } else if (this.mode == 'segment') {\r\n      const newShape = new LineShape({\r\n        layer: 'main',\r\n        familyName: 'duplicate',\r\n        path: this.involvedSegment.getSVGPath('no scale', true),\r\n        id: undefined,\r\n        segmentsColor: [this.involvedSegment.color],\r\n        pointsColor: this.involvedSegment.points\r\n          .filter((pt) => pt.type != 'divisionPoint')\r\n          .map((pt) => {\r\n            return pt.color;\r\n          }),\r\n        geometryObject: new GeometryObject({}),\r\n      });\r\n      newShape.translate(this.translation);\r\n\r\n      if (newShape.geometryObject)\r\n        newShape.geometryObject = new GeometryObject({\r\n          geometryDuplicateParentShapeId: this.involvedSegment.id,\r\n        });\r\n      this.involvedSegment.shape.geometryObject.geometryDuplicateChildShapeIds.push(\r\n        newShape.id,\r\n      );\r\n\r\n      const transformation = getShapeAdjustment([newShape], newShape);\r\n\r\n      newShape.rotate(transformation.rotationAngle, newShape.centerCoordinates);\r\n      newShape.translate(transformation.translation);\r\n\r\n      computeConstructionSpec(newShape);\r\n    } else {\r\n      const shapesList = [];\r\n\r\n      this.involvedShapes.forEach((s) => {\r\n        const newShape = new s.constructor({\r\n          ...s,\r\n          layer: 'main',\r\n          familyName: 'duplicate',\r\n          path: s.getSVGPath('no scale', false),\r\n          id: undefined,\r\n          // divisionPointInfos: s.divisionPoints.map((dp) => {\r\n          //   return { coordinates: dp.coordinates, ratio: dp.ratio, segmentIdx: dp.segments[0].idx, color: dp.color };\r\n          // }),\r\n          segmentsColor: s.segments.map((seg) => {\r\n            return seg.color;\r\n          }),\r\n          pointsColor: s.points\r\n            .filter((pt) => pt.type != 'divisionPoint')\r\n            .map((pt) => {\r\n              return pt.color;\r\n            }),\r\n        });\r\n        newShape.vertexes.forEach(\r\n          (vx, idx) => (vx.visible = s.vertexes[idx].visible),\r\n        );\r\n        if (newShape.name.startsWith('Parallele'))\r\n          newShape.name = newShape.name.slice('Parallele'.length);\r\n        if (newShape.name.startsWith('Perpendicular'))\r\n          newShape.name = newShape.name.slice('Perpendicular'.length);\r\n        if (newShape.geometryObject)\r\n          newShape.geometryObject = new GeometryObject({\r\n            geometryDuplicateParentShapeId: s.id,\r\n          });\r\n        s.geometryObject.geometryDuplicateChildShapeIds.push(newShape.id);\r\n        shapesList.push(newShape);\r\n        newShape.translate(this.translation);\r\n      });\r\n\r\n      const transformation = getShapeAdjustment(shapesList, shapesList[0]);\r\n\r\n      shapesList.forEach((newShape) => {\r\n        newShape.rotate(\r\n          transformation.rotationAngle,\r\n          shapesList[0].centerCoordinates,\r\n        );\r\n        newShape.translate(transformation.translation);\r\n      });\r\n\r\n      //Si n├®cessaire, cr├®er le userGroup\r\n      if (shapesList.length > 1) {\r\n        const userGroup = new ShapeGroup(0, 1);\r\n        userGroup.shapesIds = shapesList.map((s) => s.id);\r\n        GroupManager.addGroup(userGroup);\r\n      }\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Duplicate\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\GeometryTools\\deleteShape.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":8,"column":51,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":8,"endColumn":53,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[307,309],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":11,"column":32,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":11,"endColumn":34,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[409,411],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":20,"column":16,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":20,"endColumn":18,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[591,593],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":44,"column":64,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":44,"endColumn":66,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[1386,1388],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":49,"column":20,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":49,"endColumn":22,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[1602,1604],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":55,"column":20,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":55,"endColumn":22,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[1817,1819],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":86,"column":50,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":86,"endColumn":52,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2726,2728],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":87,"column":32,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":87,"endColumn":34,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2774,2776],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":96,"column":29,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":96,"endColumn":31,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3102,3104],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":101,"column":38,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":101,"endColumn":40,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3324,3326],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app } from '../Core/App';\r\nimport { findObjectById, removeObjectById } from '../Core/Tools/general';\r\n\r\nexport function deleteSubDivisionPoints(segment, point) {\r\n  segment.divisionPoints.forEach((divPt) => {\r\n    if (\r\n      divPt.endpointIds &&\r\n      divPt.endpointIds.some((endPtId) => endPtId == point.id)\r\n    ) {\r\n      deleteSubDivisionPoints(segment, divPt);\r\n      if (app.environment.name == 'Geometrie')\r\n        deleteChildrenOfDivisionPoint(divPt);\r\n      segment.deletePoint(divPt);\r\n    }\r\n  });\r\n}\r\n\r\nexport function deleteChildren(shape) {\r\n  if (\r\n    shape.name == 'PointOnLine' ||\r\n    shape.name.startsWith('PointOnIntersection')\r\n  ) {\r\n    const segment = findObjectById(\r\n      shape.geometryObject.geometryParentObjectId1,\r\n    );\r\n    if (segment) {\r\n      // if segment not deleted yet\r\n      const point = shape.points[0];\r\n      deleteSubDivisionPoints(segment, point);\r\n    }\r\n  }\r\n  if (shape.name.startsWith('PointOnIntersection')) {\r\n    const segment = findObjectById(\r\n      shape.geometryObject.geometryParentObjectId2,\r\n    );\r\n    if (segment) {\r\n      // if segment not deleted yet\r\n      const point = shape.points[0];\r\n      deleteSubDivisionPoints(segment, point);\r\n    }\r\n  }\r\n  app.mainCanvasLayer.shapes.forEach((s) => {\r\n    s.geometryObject.geometryChildShapeIds =\r\n      s.geometryObject.geometryChildShapeIds.filter((id) => id != shape.id);\r\n  });\r\n  app.mainCanvasLayer.shapes.forEach((s) => {\r\n    s.geometryObject.geometryTransformationChildShapeIds =\r\n      s.geometryObject.geometryTransformationChildShapeIds.filter(\r\n        (id) => id != shape.id,\r\n      );\r\n  });\r\n  app.mainCanvasLayer.shapes.forEach((s) => {\r\n    s.geometryObject.geometryDuplicateChildShapeIds =\r\n      s.geometryObject.geometryDuplicateChildShapeIds.filter(\r\n        (id) => id != shape.id,\r\n      );\r\n  });\r\n  shape.geometryObject.geometryTransformationChildShapeIds.forEach(\r\n    (childId) => {\r\n      const child = findObjectById(childId);\r\n      if (child) {\r\n        deleteChildren(child);\r\n      }\r\n    },\r\n  );\r\n  shape.geometryObject.geometryChildShapeIds.forEach((childId) => {\r\n    const child = findObjectById(childId);\r\n    if (child) {\r\n      deleteChildren(child);\r\n    }\r\n  });\r\n  shape.geometryObject.geometryDuplicateChildShapeIds.forEach((childId) => {\r\n    const child = findObjectById(childId);\r\n    if (child) {\r\n      deleteChildren(child);\r\n    }\r\n  });\r\n  removeObjectById(shape.id);\r\n}\r\n\r\nexport function deleteChildrenOfDivisionPoint(point) {\r\n  const shape = point.shape;\r\n  shape.geometryObject.geometryChildShapeIds.forEach((childId) => {\r\n    const child = findObjectById(childId);\r\n    if (!child) return;\r\n    if (child.vertexes.some((vx) => vx.reference == point.id)) {\r\n      if (app.environment.name == 'Geometrie') deleteChildren(child);\r\n      removeObjectById(child.id);\r\n    }\r\n  });\r\n  shape.geometryObject.geometryTransformationChildShapeIds.forEach(\r\n    (childId) => {\r\n      const child = findObjectById(childId);\r\n      if (!child) return;\r\n      child.divisionPoints.forEach((divPt) => {\r\n        if (divPt.reference == point.id) {\r\n          const segment = divPt.segments[0];\r\n          if (segment) {\r\n            // if segment not deleted yet\r\n            deleteSubDivisionPoints(segment, divPt);\r\n            if (app.environment.name == 'Geometrie')\r\n              deleteChildrenOfDivisionPoint(divPt);\r\n            segment.deletePoint(divPt);\r\n          }\r\n        }\r\n      });\r\n    },\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\GeometryTools\\general.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":16,"column":28,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":16,"endColumn":30,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[665,667],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":19,"column":66,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":19,"endColumn":68,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[856,858],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":26,"column":66,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":26,"endColumn":68,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1168,1170],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":33,"column":66,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":33,"endColumn":68,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1475,1477],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":42,"column":66,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":42,"endColumn":68,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1843,1845],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":49,"column":66,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":49,"endColumn":68,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2149,2151],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":59,"column":68,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":59,"endColumn":70,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2579,2581],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":90,"column":66,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":90,"endColumn":68,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3878,3880],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":96,"column":66,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":96,"endColumn":68,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4150,4152],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":104,"column":66,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":104,"endColumn":68,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4449,4451],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":111,"column":66,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":111,"endColumn":68,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4725,4727],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":119,"column":17,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":119,"endColumn":19,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4902,4904],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":120,"column":69,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":120,"endColumn":71,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[4992,4994],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":127,"column":17,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":127,"endColumn":19,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5183,5185],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":131,"column":16,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":131,"endColumn":18,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5324,5326],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":132,"column":19,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":132,"endColumn":21,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5351,5353],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":135,"column":16,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":135,"endColumn":18,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5485,5487],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":136,"column":19,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":136,"endColumn":21,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5512,5514],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":137,"column":20,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":137,"endColumn":22,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5550,5552],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":138,"column":20,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":138,"endColumn":22,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5586,5588],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":139,"column":20,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":139,"endColumn":22,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5633,5635],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":140,"column":20,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":140,"endColumn":22,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5679,5681],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":141,"column":20,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":141,"endColumn":22,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5725,5727],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":142,"column":16,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":142,"endColumn":18,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5762,5764],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":143,"column":19,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":143,"endColumn":21,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5789,5791],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":143,"column":46,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":143,"endColumn":48,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5816,5818],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":147,"column":18,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":147,"endColumn":20,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5902,5904],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":148,"column":18,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":148,"endColumn":20,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5938,5940],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":149,"column":19,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":149,"endColumn":21,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5984,5986],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":149,"column":55,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":149,"endColumn":57,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6020,6022],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":192,"column":27,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":192,"endColumn":29,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7433,7435],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":245,"column":27,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":245,"endColumn":29,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[9081,9083],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":299,"column":27,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":299,"endColumn":29,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[10746,10748],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":352,"column":27,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":352,"endColumn":29,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[12393,12395],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":352,"column":54,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":352,"endColumn":56,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[12420,12422],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":394,"column":27,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":394,"endColumn":29,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[13826,13828],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":558,"column":18,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":558,"endColumn":20,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[19431,19433],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":563,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":563,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[19648,19650],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":38,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app } from '../Core/App';\r\nimport { Coordinates } from '../Core/Objects/Coordinates';\r\nimport { Point } from '../Core/Objects/Point';\r\nimport { Segment } from '../Core/Objects/Segment';\r\nimport { GeometryObject } from '../Core/Objects/Shapes/GeometryObject';\r\nimport { LineShape } from '../Core/Objects/Shapes/LineShape';\r\nimport { SinglePointShape } from '../Core/Objects/Shapes/SinglePointShape';\r\nimport { findObjectById } from '../Core/Tools/general';\r\nimport { computeConstructionSpec } from './recomputeShape';\r\n\r\nexport function getAllLinkedShapesInGeometry(\r\n  shape,\r\n  involvedShapes,\r\n  includeDuplicate = true,\r\n) {\r\n  if (app.environment.name != 'Geometrie') return;\r\n  shape.geometryObject.geometryChildShapeIds.forEach((ref) => {\r\n    const s = findObjectById(ref);\r\n    if (!involvedShapes.find((involvedShape) => involvedShape.id == s.id)) {\r\n      involvedShapes.push(s);\r\n      getAllLinkedShapesInGeometry(s, involvedShapes, includeDuplicate);\r\n    }\r\n  });\r\n  shape.geometryObject.geometryTransformationChildShapeIds.forEach((sId) => {\r\n    const s = findObjectById(sId);\r\n    if (!involvedShapes.find((involvedShape) => involvedShape.id == s.id)) {\r\n      involvedShapes.push(s);\r\n      getAllLinkedShapesInGeometry(s, involvedShapes, includeDuplicate);\r\n    }\r\n  });\r\n  shape.geometryObject.geometryDuplicateChildShapeIds.forEach((sId) => {\r\n    const s = findObjectById(sId);\r\n    if (!involvedShapes.find((involvedShape) => involvedShape.id == s.id)) {\r\n      involvedShapes.push(s);\r\n      getAllLinkedShapesInGeometry(s, involvedShapes, includeDuplicate);\r\n    }\r\n  });\r\n  if (shape.geometryObject.geometryTransformationParentShapeId) {\r\n    const s = findObjectById(\r\n      shape.geometryObject.geometryTransformationParentShapeId,\r\n    );\r\n    if (!involvedShapes.find((involvedShape) => involvedShape.id == s.id)) {\r\n      involvedShapes.push(s);\r\n      getAllLinkedShapesInGeometry(s, involvedShapes, includeDuplicate);\r\n    }\r\n  }\r\n  shape.geometryObject.geometryMultipliedChildShapeIds.forEach((sId) => {\r\n    const s = findObjectById(sId);\r\n    if (!involvedShapes.find((involvedShape) => involvedShape.id == s.id)) {\r\n      involvedShapes.push(s);\r\n      getAllLinkedShapesInGeometry(s, involvedShapes, includeDuplicate);\r\n    }\r\n  });\r\n  const characteristicElements =\r\n    shape.geometryObject.geometryTransformationCharacteristicElements;\r\n  if (characteristicElements) {\r\n    characteristicElements.elements.forEach((element) => {\r\n      const s = element.shape;\r\n      if (!involvedShapes.find((involvedShape) => involvedShape.id == s.id)) {\r\n        involvedShapes.push(s);\r\n        getAllLinkedShapesInGeometry(s, involvedShapes, includeDuplicate);\r\n      }\r\n    });\r\n  }\r\n\r\n  // shape.geometryObject.geometryTransformationCharacteristicElementIds.forEach((sId, idx) => {\r\n  //   let s;\r\n  //   if ((shape.geometryObject.geometryTransformationName == 'translation' &&\r\n  //     shape.geometryObject.geometryTransformationCharacteristicElementIds.length == 1) ||\r\n  //     (shape.geometryObject.geometryTransformationName == 'rotation' &&\r\n  //     idx == 1 &&\r\n  //     shape.geometryObject.geometryTransformationCharacteristicElementIds.length == 2) ) {\r\n  //       s = findObjectById(sId);\r\n  //   } else {\r\n  //     s = findObjectById(sId).shape;\r\n  //   }\r\n  //   if (!involvedShapes.find(involvedShape => involvedShape.id == s.id)) {\r\n  //     involvedShapes.push(s);\r\n  //     getAllLinkedShapesInGeometry(s, involvedShapes, includeDuplicate);\r\n  //   }\r\n  // });\r\n\r\n  if (shape.geometryObject.geometryParentObjectId1) {\r\n    const seg = findObjectById(shape.geometryObject.geometryParentObjectId1);\r\n    const s = seg.shape;\r\n    // if (seg)\r\n    // s = seg.shape;\r\n    // else\r\n    //   s = findObjectById(shape.geometryObject.geometryParentObjectId1);\r\n    if (!involvedShapes.find((involvedShape) => involvedShape.id == s.id))\r\n      involvedShapes.push(s);\r\n  }\r\n  if (shape.geometryObject.geometryParentObjectId2) {\r\n    const seg = findObjectById(shape.geometryObject.geometryParentObjectId2);\r\n    const s = seg.shape;\r\n    if (!involvedShapes.find((involvedShape) => involvedShape.id == s.id))\r\n      involvedShapes.push(s);\r\n  }\r\n}\r\n\r\nexport function getAllChildrenInGeometry(shape, involvedShapes) {\r\n  shape.geometryObject.geometryTransformationChildShapeIds.forEach((sId) => {\r\n    const s = findObjectById(sId);\r\n    if (!involvedShapes.find((involvedShape) => involvedShape.id == s.id)) {\r\n      involvedShapes.push(s);\r\n      getAllChildrenInGeometry(s, involvedShapes);\r\n    }\r\n  });\r\n  shape.geometryObject.geometryChildShapeIds.forEach((sId) => {\r\n    const s = findObjectById(sId);\r\n    if (!involvedShapes.find((involvedShape) => involvedShape.id == s.id)) {\r\n      involvedShapes.push(s);\r\n      getAllChildrenInGeometry(s, involvedShapes);\r\n    }\r\n  });\r\n}\r\n\r\nfunction addShapeToChildren(parent, child) {\r\n  if (parent.id == child.id) return;\r\n  if (parent.geometryObject.geometryChildShapeIds.indexOf(child.id) != -1)\r\n    return;\r\n  parent.geometryObject.geometryChildShapeIds.push(child.id);\r\n}\r\n\r\nexport function linkNewlyCreatedPoint(shape, point) {\r\n  let ref = point.adjustedOn;\r\n  if (ref?.type == 'grid') return;\r\n  while (ref && ref instanceof Point && ref.reference)\r\n    ref = findObjectById(ref.reference);\r\n  if (\r\n    (point.idx == 1 &&\r\n      (shape.name == 'CircleArc' ||\r\n        shape.name.startsWith('Parallele') ||\r\n        shape.name.startsWith('Perpendicular'))) ||\r\n    (point.idx == 2 &&\r\n      (shape.name == 'Rectangle' ||\r\n        shape.name == 'Losange' ||\r\n        shape.name == 'RightAngleTriangle' ||\r\n        shape.name == 'RightAngleTrapeze' ||\r\n        shape.name == 'IsoscelesTriangle' ||\r\n        shape.name == 'CirclePart')) ||\r\n    (point.idx == 3 &&\r\n      (shape.name == 'Trapeze' || shape.name == 'RightAngleTrapeze'))\r\n  ) {\r\n    let constraintShape;\r\n    if (\r\n      shape.name == 'Rectangle' ||\r\n      shape.name == 'RightAngleTriangle' ||\r\n      (shape.name == 'RightAngleTrapeze' && point.idx == 2)\r\n    ) {\r\n      const referenceSegment = shape.segments[0];\r\n      const angle = referenceSegment.getAngleWithHorizontal() + Math.PI / 2;\r\n      const newCoordinates = shape.vertexes[1].coordinates.add(\r\n        new Coordinates({\r\n          x: 100 * Math.cos(angle),\r\n          y: 100 * Math.sin(angle),\r\n        }),\r\n      );\r\n\r\n      const path = [\r\n        'M',\r\n        shape.vertexes[1].coordinates.x,\r\n        shape.vertexes[1].coordinates.y,\r\n        'L',\r\n        newCoordinates.x,\r\n        newCoordinates.y,\r\n      ].join(' ');\r\n\r\n      constraintShape = new LineShape({\r\n        layer: 'main',\r\n        path: path,\r\n        name: 'PerpendicularStraightLine',\r\n        familyName: 'Line',\r\n        strokeColor: app.settings.constraintsDrawColor,\r\n        strokeWidth: 2,\r\n        geometryObject: new GeometryObject({\r\n          geometryIsConstaintDraw: true,\r\n        }),\r\n      });\r\n      constraintShape.geometryObject.geometryParentObjectId1 =\r\n        referenceSegment.id;\r\n      referenceSegment.shape.geometryObject.geometryChildShapeIds.push(\r\n        constraintShape.id,\r\n      );\r\n\r\n      addShapeToChildren(shape, constraintShape);\r\n      constraintShape.vertexes[0].reference = shape.vertexes[1].id;\r\n\r\n      constraintShape.segments[0].isInfinite = true;\r\n      constraintShape.vertexes[0].visible = false;\r\n      constraintShape.vertexes[1].visible = false;\r\n    } else if (shape.name == 'Losange') {\r\n      const referenceSegment = shape.segments[0];\r\n      const oppositeCoordinates = referenceSegment.vertexes[1].coordinates\r\n          .multiply(2)\r\n          .substract(referenceSegment.vertexes[0].coordinates),\r\n        radius = referenceSegment.vertexes[0].coordinates.dist(\r\n          referenceSegment.vertexes[1].coordinates,\r\n        );\r\n      const path = [\r\n        'M',\r\n        referenceSegment.vertexes[0].coordinates.x,\r\n        referenceSegment.vertexes[0].coordinates.y,\r\n      ]\r\n        .concat([\r\n          'A',\r\n          radius,\r\n          radius,\r\n          0,\r\n          1,\r\n          0,\r\n          oppositeCoordinates.x,\r\n          oppositeCoordinates.y,\r\n        ])\r\n        .concat([\r\n          'A',\r\n          radius,\r\n          radius,\r\n          0,\r\n          1,\r\n          0,\r\n          referenceSegment.vertexes[0].coordinates.x,\r\n          referenceSegment.vertexes[0].coordinates.y,\r\n        ])\r\n        .join(' ');\r\n\r\n      constraintShape = new LineShape({\r\n        layer: 'main',\r\n        path: path,\r\n        name: 'Circle',\r\n        familyName: 'Circle',\r\n        strokeColor: app.settings.constraintsDrawColor,\r\n        strokeWidth: 2,\r\n        geometryObject: new GeometryObject({\r\n          geometryIsConstaintDraw: true,\r\n        }),\r\n      });\r\n\r\n      addShapeToChildren(shape, constraintShape);\r\n      constraintShape.vertexes[0].reference = shape.vertexes[0].id;\r\n      constraintShape.segments[0].arcCenter.reference = shape.vertexes[1].id;\r\n\r\n      constraintShape.vertexes[0].visible = false;\r\n      constraintShape.segments[0].arcCenter.visible = false;\r\n    } else if (shape.name == 'CircleArc') {\r\n      const referenceSegment = shape.segments[0];\r\n      const oppositeCoordinates = referenceSegment.arcCenter.coordinates\r\n          .multiply(2)\r\n          .substract(referenceSegment.vertexes[0].coordinates),\r\n        radius = referenceSegment.vertexes[0].coordinates.dist(\r\n          referenceSegment.arcCenter.coordinates,\r\n        );\r\n      const path = [\r\n        'M',\r\n        referenceSegment.vertexes[0].coordinates.x,\r\n        referenceSegment.vertexes[0].coordinates.y,\r\n      ]\r\n        .concat([\r\n          'A',\r\n          radius,\r\n          radius,\r\n          0,\r\n          1,\r\n          0,\r\n          oppositeCoordinates.x,\r\n          oppositeCoordinates.y,\r\n        ])\r\n        .concat([\r\n          'A',\r\n          radius,\r\n          radius,\r\n          0,\r\n          1,\r\n          0,\r\n          referenceSegment.vertexes[0].coordinates.x,\r\n          referenceSegment.vertexes[0].coordinates.y,\r\n        ])\r\n        .join(' ');\r\n\r\n      constraintShape = new LineShape({\r\n        layer: 'main',\r\n        path: path,\r\n        name: 'Circle',\r\n        familyName: 'Circle',\r\n        strokeColor: app.settings.constraintsDrawColor,\r\n        strokeWidth: 2,\r\n        geometryObject: new GeometryObject({\r\n          geometryIsConstaintDraw: true,\r\n        }),\r\n      });\r\n\r\n      addShapeToChildren(shape, constraintShape);\r\n      constraintShape.vertexes[0].reference = shape.vertexes[0].id;\r\n      constraintShape.segments[0].arcCenter.reference =\r\n        shape.segments[0].arcCenter.id;\r\n\r\n      constraintShape.vertexes[0].visible = false;\r\n      constraintShape.segments[0].arcCenter.visible = false;\r\n    } else if (shape.name == 'CirclePart') {\r\n      const referenceSegment = shape.segments[1];\r\n      const oppositeCoordinates = referenceSegment.arcCenter.coordinates\r\n          .multiply(2)\r\n          .substract(referenceSegment.vertexes[0].coordinates),\r\n        radius = referenceSegment.vertexes[0].coordinates.dist(\r\n          referenceSegment.arcCenter.coordinates,\r\n        );\r\n      const path = [\r\n        'M',\r\n        referenceSegment.vertexes[0].coordinates.x,\r\n        referenceSegment.vertexes[0].coordinates.y,\r\n      ]\r\n        .concat([\r\n          'A',\r\n          radius,\r\n          radius,\r\n          0,\r\n          1,\r\n          0,\r\n          oppositeCoordinates.x,\r\n          oppositeCoordinates.y,\r\n        ])\r\n        .concat([\r\n          'A',\r\n          radius,\r\n          radius,\r\n          0,\r\n          1,\r\n          0,\r\n          referenceSegment.vertexes[0].coordinates.x,\r\n          referenceSegment.vertexes[0].coordinates.y,\r\n        ])\r\n        .join(' ');\r\n\r\n      constraintShape = new LineShape({\r\n        layer: 'main',\r\n        path: path,\r\n        name: 'Circle',\r\n        familyName: 'Circle',\r\n        strokeColor: app.settings.constraintsDrawColor,\r\n        strokeWidth: 2,\r\n        geometryObject: new GeometryObject({\r\n          geometryIsConstaintDraw: true,\r\n        }),\r\n      });\r\n\r\n      addShapeToChildren(shape, constraintShape);\r\n      constraintShape.vertexes[0].reference = shape.vertexes[1].id;\r\n      constraintShape.segments[0].arcCenter.reference = shape.vertexes[0].id;\r\n\r\n      constraintShape.vertexes[0].visible = false;\r\n      constraintShape.segments[0].arcCenter.visible = false;\r\n    } else if (shape.name == 'Trapeze' || shape.name == 'RightAngleTrapeze') {\r\n      const referenceSegment = shape.segments[0];\r\n      const angle = referenceSegment.getAngleWithHorizontal();\r\n      const newCoordinates = shape.vertexes[2].coordinates.add(\r\n        new Coordinates({\r\n          x: 100 * Math.cos(angle),\r\n          y: 100 * Math.sin(angle),\r\n        }),\r\n      );\r\n\r\n      const path = [\r\n        'M',\r\n        shape.vertexes[2].coordinates.x,\r\n        shape.vertexes[2].coordinates.y,\r\n        'L',\r\n        newCoordinates.x,\r\n        newCoordinates.y,\r\n      ].join(' ');\r\n\r\n      constraintShape = new LineShape({\r\n        layer: 'main',\r\n        path: path,\r\n        name: 'ParalleleStraightLine',\r\n        familyName: 'Line',\r\n        strokeColor: app.settings.constraintsDrawColor,\r\n        strokeWidth: 2,\r\n        geometryObject: new GeometryObject({\r\n          geometryIsConstaintDraw: true,\r\n        }),\r\n      });\r\n      constraintShape.geometryObject.geometryParentObjectId1 =\r\n        referenceSegment.id;\r\n      referenceSegment.shape.geometryObject.geometryChildShapeIds.push(\r\n        constraintShape.id,\r\n      );\r\n\r\n      addShapeToChildren(shape, constraintShape);\r\n      constraintShape.vertexes[0].reference = shape.vertexes[2].id;\r\n\r\n      constraintShape.segments[0].isInfinite = true;\r\n      constraintShape.vertexes[0].visible = false;\r\n      constraintShape.vertexes[1].visible = false;\r\n    } else if (shape.name == 'IsoscelesTriangle') {\r\n      const referenceSegment = shape.segments[0];\r\n      const referenceSegmentMiddle = referenceSegment.addPoint(\r\n        referenceSegment.middle,\r\n        0.5,\r\n        referenceSegment.vertexIds[0],\r\n        referenceSegment.vertexIds[1],\r\n        false,\r\n      );\r\n      const angle = referenceSegment.getAngleWithHorizontal() + Math.PI / 2;\r\n      const newCoordinates = referenceSegmentMiddle.coordinates.add(\r\n        new Coordinates({\r\n          x: 100 * Math.cos(angle),\r\n          y: 100 * Math.sin(angle),\r\n        }),\r\n      );\r\n\r\n      const path = [\r\n        'M',\r\n        referenceSegmentMiddle.coordinates.x,\r\n        referenceSegmentMiddle.coordinates.y,\r\n        'L',\r\n        newCoordinates.x,\r\n        newCoordinates.y,\r\n      ].join(' ');\r\n\r\n      constraintShape = new LineShape({\r\n        layer: 'main',\r\n        path: path,\r\n        name: 'PerpendicularStraightLine',\r\n        familyName: 'Line',\r\n        strokeColor: app.settings.constraintsDrawColor,\r\n        strokeWidth: 2,\r\n        geometryObject: new GeometryObject({\r\n          geometryIsConstaintDraw: true,\r\n        }),\r\n      });\r\n      constraintShape.geometryObject.geometryParentObjectId1 =\r\n        referenceSegment.id;\r\n      referenceSegment.shape.geometryObject.geometryChildShapeIds.push(\r\n        constraintShape.id,\r\n      );\r\n\r\n      addShapeToChildren(shape, constraintShape);\r\n      constraintShape.vertexes[0].reference = referenceSegmentMiddle.id;\r\n\r\n      constraintShape.segments[0].isInfinite = true;\r\n      constraintShape.vertexes[0].visible = false;\r\n      constraintShape.vertexes[1].visible = false;\r\n      referenceSegmentMiddle.visible = false;\r\n    } else if (shape.name.startsWith('Parallele')) {\r\n      const referenceSegment = findObjectById(\r\n        shape.geometryObject.geometryParentObjectId1,\r\n      );\r\n      const angle = referenceSegment.getAngleWithHorizontal();\r\n      const newCoordinates = shape.vertexes[0].coordinates.add(\r\n        new Coordinates({\r\n          x: 100 * Math.cos(angle),\r\n          y: 100 * Math.sin(angle),\r\n        }),\r\n      );\r\n\r\n      const path = [\r\n        'M',\r\n        shape.vertexes[0].coordinates.x,\r\n        shape.vertexes[0].coordinates.y,\r\n        'L',\r\n        newCoordinates.x,\r\n        newCoordinates.y,\r\n      ].join(' ');\r\n\r\n      constraintShape = new LineShape({\r\n        layer: 'main',\r\n        path: path,\r\n        name: 'ParalleleStraightLine',\r\n        familyName: 'Line',\r\n        strokeColor: app.settings.constraintsDrawColor,\r\n        strokeWidth: 2,\r\n        geometryObject: new GeometryObject({\r\n          geometryIsConstaintDraw: true,\r\n        }),\r\n      });\r\n      constraintShape.geometryObject.geometryParentObjectId1 =\r\n        referenceSegment.id;\r\n      referenceSegment.shape.geometryObject.geometryChildShapeIds.push(\r\n        constraintShape.id,\r\n      );\r\n\r\n      addShapeToChildren(shape, constraintShape);\r\n      constraintShape.vertexes[0].reference = shape.vertexes[0].id;\r\n\r\n      constraintShape.segments[0].isInfinite = true;\r\n      constraintShape.vertexes[0].visible = false;\r\n      constraintShape.vertexes[1].visible = false;\r\n    } else if (shape.name.startsWith('Perpendicular')) {\r\n      const referenceSegment = findObjectById(\r\n        shape.geometryObject.geometryParentObjectId1,\r\n      );\r\n      const angle = referenceSegment.getAngleWithHorizontal() + Math.PI / 2;\r\n      const newCoordinates = shape.vertexes[0].coordinates.add(\r\n        new Coordinates({\r\n          x: 100 * Math.cos(angle),\r\n          y: 100 * Math.sin(angle),\r\n        }),\r\n      );\r\n\r\n      const path = [\r\n        'M',\r\n        shape.vertexes[0].coordinates.x,\r\n        shape.vertexes[0].coordinates.y,\r\n        'L',\r\n        newCoordinates.x,\r\n        newCoordinates.y,\r\n      ].join(' ');\r\n\r\n      constraintShape = new LineShape({\r\n        layer: 'main',\r\n        path: path,\r\n        name: 'PerpendicularStraightLine',\r\n        familyName: 'Line',\r\n        strokeColor: app.settings.constraintsDrawColor,\r\n        strokeWidth: 2,\r\n        geometryObject: new GeometryObject({\r\n          geometryIsConstaintDraw: true,\r\n        }),\r\n      });\r\n      constraintShape.geometryObject.geometryParentObjectId1 =\r\n        referenceSegment.id;\r\n      referenceSegment.shape.geometryObject.geometryChildShapeIds.push(\r\n        constraintShape.id,\r\n      );\r\n\r\n      addShapeToChildren(shape, constraintShape);\r\n      constraintShape.vertexes[0].reference = shape.vertexes[0].id;\r\n\r\n      constraintShape.segments[0].isInfinite = true;\r\n      constraintShape.vertexes[0].visible = false;\r\n      constraintShape.vertexes[1].visible = false;\r\n    }\r\n\r\n    const newSinglePointShape = new SinglePointShape({\r\n      layer: 'main',\r\n      path: `M ${point.coordinates.x} ${point.coordinates.y}`,\r\n      name: 'PointOnLine',\r\n      familyName: 'Point',\r\n      geometryObject: new GeometryObject({\r\n        geometryPointOnTheFlyChildId: shape.id,\r\n      }),\r\n    });\r\n    newSinglePointShape.geometryObject.geometryParentObjectId1 =\r\n      constraintShape.segments[0].id;\r\n    addShapeToChildren(constraintShape, newSinglePointShape);\r\n\r\n    if (ref && ref instanceof Segment) {\r\n      newSinglePointShape.name = 'PointOnIntersection2';\r\n      newSinglePointShape.geometryObject.geometryParentObjectId2 = ref.id;\r\n\r\n      addShapeToChildren(ref.shape, newSinglePointShape);\r\n    }\r\n    computeConstructionSpec(newSinglePointShape);\r\n\r\n    addShapeToChildren(newSinglePointShape, shape);\r\n    point.reference = newSinglePointShape.vertexes[0].id;\r\n  } else if (ref && ref instanceof Point) {\r\n    if (ref.type == 'divisionPoint') {\r\n      ref.endpointIds?.forEach((endPointId) => {\r\n        const endPoint = findObjectById(endPointId);\r\n        const endPointShape = endPoint.shape;\r\n        if (\r\n          endPointShape.name == 'PointOnLine' ||\r\n          endPointShape.name.startsWith('PointOnIntersection')\r\n        )\r\n          addShapeToChildren(endPointShape, shape);\r\n      });\r\n    }\r\n    addShapeToChildren(ref.shape, shape);\r\n    point.reference = ref.id;\r\n  } else {\r\n    const newSinglePointShape = new SinglePointShape({\r\n      layer: 'main',\r\n      path: `M ${point.coordinates.x} ${point.coordinates.y}`,\r\n      name: 'Point',\r\n      familyName: 'Point',\r\n      geometryObject: new GeometryObject({\r\n        geometryPointOnTheFlyChildId: shape.id,\r\n      }),\r\n    });\r\n    if (ref && ref instanceof Segment) {\r\n      newSinglePointShape.name = 'PointOnLine';\r\n      newSinglePointShape.geometryObject.geometryParentObjectId1 = ref.id;\r\n\r\n      computeConstructionSpec(newSinglePointShape);\r\n      addShapeToChildren(ref.shape, newSinglePointShape);\r\n      // ref.shape.geometryObject.geometryChildShapeIds.push(newSinglePointShape.id);\r\n    }\r\n    addShapeToChildren(newSinglePointShape, shape);\r\n    point.reference = newSinglePointShape.vertexes[0].id;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\GeometryTools\\recomputeShape.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":15,"column":28,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":15,"endColumn":30,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[560,562],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":33,"column":21,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":33,"endColumn":23,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1165,1167],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":77,"column":28,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":77,"endColumn":30,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[2563,2565],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":92,"column":24,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":92,"endColumn":26,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3002,3004],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":113,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":113,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3793,3795],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":117,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":117,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3996,3998],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":121,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":121,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4197,4199],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":125,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":125,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4404,4406],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":126,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":126,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4455,4457],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":134,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":134,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4820,4822],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":135,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":135,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4861,4863],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":148,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":148,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5360,5362],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":149,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":149,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5412,5414],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":150,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":150,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5463,5465],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":151,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":151,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5513,5515],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":152,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":152,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5567,5569],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":157,"column":18,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":157,"endColumn":20,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[5728,5730],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":161,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":161,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5919,5921],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":162,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":162,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5978,5980],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":163,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":163,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6041,6043],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":168,"column":18,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":168,"endColumn":20,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[6198,6200],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":172,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":172,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6389,6391],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":182,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":182,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6816,6818],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":193,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":193,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7304,7306],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":203,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":203,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7672,7674],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":208,"column":24,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":208,"endColumn":26,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7849,7851],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":250,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":250,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[9505,9507],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":275,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":275,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[10425,10427],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":284,"column":18,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":284,"endColumn":20,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[10760,10762],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":288,"column":48,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":288,"endColumn":50,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[10974,10976],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":290,"column":23,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":290,"endColumn":25,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[11017,11019],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":302,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":302,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[11655,11657],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":311,"column":18,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":311,"endColumn":20,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[11998,12000],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":315,"column":48,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":315,"endColumn":50,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[12212,12214],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":317,"column":23,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":317,"endColumn":25,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[12255,12257],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":328,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":328,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[12822,12824],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":329,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":329,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[12866,12868],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":330,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":330,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[12909,12911],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":352,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":352,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[13712,13714],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":384,"column":35,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":384,"endColumn":37,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[14768,14770],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":431,"column":35,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":431,"endColumn":37,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[16517,16519],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":478,"column":35,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":478,"endColumn":37,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[18332,18334],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":487,"column":35,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":487,"endColumn":37,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[18580,18582],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'idx' is defined but never used. Allowed unused args must match /^_/u.","line":495,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":495,"endColumn":32,"suggestions":[{"messageId":"removeVar","data":{"varName":"idx"},"fix":{"range":[18706,18711],"text":""},"desc":"Remove unused variable 'idx'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'points' is defined but never used. Allowed unused args must match /^_/u.","line":495,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":495,"endColumn":40,"suggestions":[{"messageId":"removeVar","data":{"varName":"points"},"fix":{"range":[18711,18719],"text":""},"desc":"Remove unused variable 'points'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'idx' is defined but never used. Allowed unused args must match /^_/u.","line":527,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":527,"endColumn":40,"suggestions":[{"messageId":"removeVar","data":{"varName":"idx"},"fix":{"range":[19704,19709],"text":""},"desc":"Remove unused variable 'idx'."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":533,"column":24,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":533,"endColumn":26,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[19878,19880],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":537,"column":31,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":537,"endColumn":33,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[20060,20062],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":542,"column":55,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":542,"endColumn":57,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[20270,20272],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":545,"column":78,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":545,"endColumn":80,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[20399,20401],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":565,"column":53,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":565,"endColumn":55,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[21092,21094],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":571,"column":62,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":571,"endColumn":64,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[21346,21348],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":574,"column":78,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":574,"endColumn":80,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[21468,21470],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":586,"column":62,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":586,"endColumn":64,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[21882,21884],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":594,"column":78,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":594,"endColumn":80,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[22147,22149],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":622,"column":18,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":622,"endColumn":20,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[23204,23206],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":666,"column":18,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":666,"endColumn":20,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[24539,24541],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":673,"column":24,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":673,"endColumn":26,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[24776,24778],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":728,"column":31,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":728,"endColumn":33,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[26866,26868],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":731,"column":27,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":731,"endColumn":29,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[26998,27000],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":753,"column":15,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":753,"endColumn":17,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[27735,27737],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":793,"column":58,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":793,"endColumn":60,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[29230,29232],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":798,"column":58,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":798,"endColumn":60,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[29497,29499],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":824,"column":18,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":824,"endColumn":20,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[30469,30471],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":831,"column":28,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":831,"endColumn":30,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[30664,30666],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":838,"column":35,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":838,"endColumn":37,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[30967,30969],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":880,"column":35,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":880,"endColumn":37,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[32739,32741],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'maxIndex' is assigned a value but never used. Allowed unused args must match /^_/u.","line":892,"column":48,"nodeType":"Identifier","messageId":"unusedVar","endLine":892,"endColumn":56,"suggestions":[{"messageId":"removeVar","data":{"varName":"maxIndex"},"fix":{"range":[33146,33162],"text":""},"desc":"Remove unused variable 'maxIndex'."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":893,"column":24,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":893,"endColumn":26,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[33190,33192],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":894,"column":20,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":894,"endColumn":22,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[33228,33230],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":931,"column":31,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":931,"endColumn":33,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[34798,34800],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":940,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":940,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[35261,35263],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":945,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":945,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[35614,35616],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":948,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":948,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[35757,35759],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":949,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":949,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[35804,35806],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":962,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":962,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[36584,36586],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":966,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":966,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[36866,36868],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":982,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":982,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[37562,37564],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":985,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":985,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[37725,37727],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":990,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":990,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[37985,37987],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":995,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":995,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[38287,38289],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":1004,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":1004,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[38685,38687],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":1014,"column":16,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":1014,"endColumn":18,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[39088,39090],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":1015,"column":16,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":1015,"endColumn":18,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[39138,39140],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":1030,"column":16,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":1030,"endColumn":18,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[39622,39624],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":1031,"column":16,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":1031,"endColumn":18,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[39676,39678],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":1052,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":1052,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[40369,40371],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":83,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { snapCoordinatesToGrid } from '../../utils/gridSnapping';\r\nimport { app } from '../Core/App';\r\nimport { Coordinates } from '../Core/Objects/Coordinates';\r\nimport { Point } from '../Core/Objects/Point';\r\nimport { Segment } from '../Core/Objects/Segment';\r\nimport { LineShape } from '../Core/Objects/Shapes/LineShape';\r\nimport { findObjectById, mod } from '../Core/Tools/general';\r\n\r\nexport function computeAllShapeTransform(\r\n  shape,\r\n  layer = 'upper',\r\n  includeChildren = true,\r\n  includePointOnIntersection = true,\r\n) {\r\n  if (app.environment.name != 'Geometrie') return;\r\n  if (includeChildren) {\r\n    shape.geometryObject.geometryChildShapeIds.forEach((ref) => {\r\n      const sRef = findObjectById(ref);\r\n      if (!sRef) {\r\n        console.info('child not found');\r\n        return;\r\n      }\r\n      computeShapeTransform(sRef, layer);\r\n      computeAllShapeTransform(sRef, layer);\r\n    });\r\n  } else if (includePointOnIntersection) {\r\n    shape.geometryObject.geometryChildShapeIds.forEach((ref) => {\r\n      const sRef = findObjectById(ref);\r\n      if (!sRef) {\r\n        console.info('child not found');\r\n        return;\r\n      }\r\n      if (sRef.name == 'PointOnIntersection') {\r\n        computeShapeTransform(sRef, layer);\r\n        computeAllShapeTransform(sRef, layer);\r\n      }\r\n    });\r\n  }\r\n\r\n  shape.geometryObject.geometryTransformationChildShapeIds.forEach(\r\n    (childId) => {\r\n      const child = findObjectById(childId);\r\n      computeShapeTransform(child);\r\n      computeAllShapeTransform(child, layer);\r\n    },\r\n  );\r\n  if (includeChildren) {\r\n    shape.geometryObject.geometryDuplicateChildShapeIds.forEach((childId) => {\r\n      const child = findObjectById(childId);\r\n      computeShapeTransform(child);\r\n      computeAllShapeTransform(child, layer);\r\n    });\r\n    shape.geometryObject.geometryMultipliedChildShapeIds.forEach((childId) => {\r\n      const child = findObjectById(childId);\r\n      computeShapeTransform(child);\r\n      computeAllShapeTransform(child, layer);\r\n    });\r\n  }\r\n}\r\n\r\nfunction reverseShape(shape, selectedAxis) {\r\n  shape.points.forEach((pt) => {\r\n    computePointPosition(pt, selectedAxis);\r\n  });\r\n}\r\n\r\nfunction computePointPosition(point, selectedAxis) {\r\n  const center = selectedAxis.projectionOnSegment(point);\r\n\r\n  //Calculer la nouvelle position du point ├á partir de l'ancienne et de la projection.\r\n  point.coordinates = point.coordinates.add(\r\n    center.substract(point.coordinates).multiply(2),\r\n  );\r\n}\r\n\r\nexport function computeShapeTransform(shape, layer = 'upper') {\r\n  if (app.environment.name != 'Geometrie') return;\r\n\r\n  if (shape.geometryObject.geometryTransformationParentShapeId) {\r\n    computeTransformShape(shape);\r\n    return;\r\n  } else if (shape.geometryObject.geometryDuplicateParentShapeId) {\r\n    computeDuplicateShape(shape);\r\n    return;\r\n  } else if (shape.geometryObject.geometryMultipliedParentShapeId) {\r\n    computeDuplicateShape(shape);\r\n    return;\r\n  }\r\n\r\n  computeLinkedShape(shape);\r\n\r\n  if (shape.familyName == 'Regular') {\r\n    let externalAngle = (Math.PI * 2) / shape.segments.length;\r\n    if (shape.isReversed) {\r\n      externalAngle *= -1;\r\n    }\r\n    const v1 = shape.segments[0].vertexes[0].coordinates;\r\n    const v2 = shape.segments[0].vertexes[1].coordinates;\r\n\r\n    const length = v1.dist(v2);\r\n    const startAngle = Math.atan2(-(v1.y - v2.y), -(v1.x - v2.x));\r\n\r\n    for (let i = 2; i < shape.vertexes.length; i++) {\r\n      const dx = length * Math.cos(startAngle - (i - 1) * externalAngle);\r\n      const dy = length * Math.sin(startAngle - (i - 1) * externalAngle);\r\n\r\n      const coord = shape.vertexes[i - 1].coordinates.add(\r\n        new Coordinates({ x: dx, y: dy }),\r\n      );\r\n\r\n      shape.vertexes[i].coordinates = snapCoordinatesToGrid(coord);\r\n    }\r\n  } else if (shape.name == 'Rectangle') {\r\n    shape.vertexes[3].coordinates = shape.vertexes[2].coordinates\r\n      .substract(shape.vertexes[1].coordinates)\r\n      .add(shape.vertexes[0].coordinates);\r\n  } else if (shape.name == 'Losange') {\r\n    shape.vertexes[3].coordinates = shape.vertexes[2].coordinates\r\n      .substract(shape.vertexes[1].coordinates)\r\n      .add(shape.vertexes[0].coordinates);\r\n  } else if (shape.name == 'Parallelogram') {\r\n    shape.vertexes[3].coordinates = shape.vertexes[2].coordinates\r\n      .substract(shape.vertexes[1].coordinates)\r\n      .add(shape.vertexes[0].coordinates);\r\n  } else if (shape.name == 'RightAngleTrapeze') {\r\n  } else if (shape.name == 'IsoscelesTrapeze') {\r\n    const projection = shape.segments[0].projectionOnSegment(\r\n      shape.vertexes[2].coordinates,\r\n    );\r\n    const middleOfSegment = shape.segments[0].middle;\r\n    shape.vertexes[3].coordinates = shape.vertexes[2].coordinates\r\n      .substract(projection.multiply(2))\r\n      .add(middleOfSegment.multiply(2));\r\n  } else if (shape.name == 'Trapeze') {\r\n  } else if (shape.name == 'RightAngleIsoscelesTriangle') {\r\n    const firstSegment = shape.segments[0];\r\n    const angle =\r\n      firstSegment.getAngleWithHorizontal() -\r\n      shape.geometryObject.geometryConstructionSpec.angle;\r\n    const length = firstSegment.length;\r\n\r\n    shape.vertexes[2].coordinates = snapCoordinatesToGrid(\r\n      new Coordinates({\r\n        x: shape.vertexes[1].x + length * Math.cos(angle),\r\n        y: shape.vertexes[1].y + length * Math.sin(angle),\r\n      }),\r\n    );\r\n  } else if (shape.name == 'RightAngleTriangle') {\r\n  } else if (shape.name == 'IsoscelesTriangle') {\r\n  } else if (shape.name == 'ParalleleSegment') {\r\n  } else if (shape.name == 'PerpendicularSegment') {\r\n  } else if (shape.name == 'SemiStraightLine') {\r\n    const newValue = !shape.vertexes[0].coordinates.equal(\r\n      shape.vertexes[1].coordinates,\r\n      0.1,\r\n    );\r\n    if (newValue != shape.geometryObject.geometryIsVisibleByChoice) {\r\n      shape.geometryObject.geometryIsVisibleByChoice = newValue;\r\n      recomputeAllVisibilities(layer);\r\n    }\r\n  } else if (shape.name == 'ParalleleSemiStraightLine') {\r\n  } else if (shape.name == 'PerpendicularSemiStraightLine') {\r\n  } else if (shape.name == 'StraightLine') {\r\n    const newValue = !shape.vertexes[0].coordinates.equal(\r\n      shape.vertexes[1].coordinates,\r\n      0.1,\r\n    );\r\n    if (newValue != shape.geometryObject.geometryIsVisibleByChoice) {\r\n      shape.geometryObject.geometryIsVisibleByChoice = newValue;\r\n      recomputeAllVisibilities(layer);\r\n    }\r\n  } else if (shape.name == 'ParalleleStraightLine') {\r\n    const seg = findObjectById(shape.geometryObject.geometryParentObjectId1);\r\n    const angle = seg.getAngleWithHorizontal();\r\n\r\n    shape.vertexes[1].coordinates = snapCoordinatesToGrid(\r\n      new Coordinates({\r\n        x: shape.vertexes[0].coordinates.x + 100 * Math.cos(angle),\r\n        y: shape.vertexes[0].coordinates.y + 100 * Math.sin(angle),\r\n      }),\r\n    );\r\n  } else if (shape.name == 'PerpendicularStraightLine') {\r\n    const seg = findObjectById(shape.geometryObject.geometryParentObjectId1);\r\n    let angle = seg.getAngleWithHorizontal() + Math.PI / 2;\r\n    if (shape.isReversed) angle += Math.PI;\r\n\r\n    shape.vertexes[1].coordinates = snapCoordinatesToGrid(\r\n      new Coordinates({\r\n        x: shape.vertexes[0].coordinates.x + 100 * Math.cos(angle),\r\n        y: shape.vertexes[0].coordinates.y + 100 * Math.sin(angle),\r\n      }),\r\n    );\r\n  } else if (shape.name == 'Strip') {\r\n    const seg = shape.segments[0];\r\n    const angle = seg.getAngleWithHorizontal();\r\n\r\n    shape.vertexes[3].coordinates = snapCoordinatesToGrid(\r\n      new Coordinates({\r\n        x: shape.vertexes[2].coordinates.x + 100 * Math.cos(angle),\r\n        y: shape.vertexes[2].coordinates.y + 100 * Math.sin(angle),\r\n      }),\r\n    );\r\n  } else if (shape.name == 'PointOnLine') {\r\n    const ref = findObjectById(shape.geometryObject.geometryParentObjectId1);\r\n    const point = shape.points[0];\r\n\r\n    let coord;\r\n    if (ref.shape.name == 'Circle') {\r\n      const refShape = ref.shape;\r\n      const angle =\r\n        refShape.segments[0].arcCenter.coordinates.angleWith(\r\n          refShape.vertexes[0].coordinates,\r\n        ) +\r\n        shape.points[0].ratio * Math.PI * 2;\r\n      coord = refShape.segments[0].arcCenter.coordinates.add({\r\n        x: refShape.segments[0].radius * Math.cos(angle),\r\n        y: refShape.segments[0].radius * Math.sin(angle),\r\n      });\r\n    } else if (ref.isArc()) {\r\n      const firstAngle = ref.arcCenter.coordinates.angleWith(\r\n        ref.vertexes[0].coordinates,\r\n      );\r\n      let secondAngle = ref.arcCenter.coordinates.angleWith(\r\n        ref.vertexes[1].coordinates,\r\n      );\r\n      if (secondAngle <= firstAngle) {\r\n        secondAngle += Math.PI * 2;\r\n      }\r\n      let newAngle = firstAngle + point.ratio * (secondAngle - firstAngle);\r\n      if (ref.counterclockwise) {\r\n        newAngle =\r\n          firstAngle - point.ratio * (2 * Math.PI - secondAngle + firstAngle);\r\n      }\r\n      coord = new Coordinates({\r\n        x: ref.arcCenter.coordinates.x + ref.radius * Math.cos(newAngle),\r\n        y: ref.arcCenter.coordinates.y + ref.radius * Math.sin(newAngle),\r\n      });\r\n    } else {\r\n      const firstPoint = ref.vertexes[0];\r\n      const secondPoint = ref.vertexes[1];\r\n      const segLength = secondPoint.coordinates.substract(\r\n        firstPoint.coordinates,\r\n      );\r\n      const part = segLength.multiply(point.ratio);\r\n\r\n      coord = firstPoint.coordinates.add(part);\r\n    }\r\n    shape.points[0].coordinates = snapCoordinatesToGrid(coord);\r\n    ref.divisionPoints.forEach((pt) => computeDivisionPoint(pt));\r\n  } else if (shape.name == 'PointOnShape') {\r\n    const coord = shape.points[0].coordinates;\r\n    const ref = findObjectById(shape.geometryObject.geometryParentObjectId1);\r\n    if (ref.isCoordinatesInPath(coord) || ref.isCoordinatesOnBorder(coord)) {\r\n      return;\r\n    }\r\n    const projections = ref.segments.map((seg) => {\r\n      let proj = seg.projectionOnSegment(coord);\r\n      if (!seg.isCoordinatesOnSegment(proj)) {\r\n        if (\r\n          proj.dist(seg.vertexes[0].coordinates) <\r\n          proj.dist(seg.vertexes[1].coordinates)\r\n        ) {\r\n          proj = seg.vertexes[0].coordinates;\r\n        } else {\r\n          proj = seg.vertexes[1].coordinates;\r\n        }\r\n      }\r\n      const dist = proj.dist(coord);\r\n      return { proj, dist };\r\n    });\r\n    projections.sort((p1, p2) => {\r\n      return p1.dist - p2.dist;\r\n    });\r\n    shape.points[0].coordinates = snapCoordinatesToGrid(projections[0].proj);\r\n  } else if (shape.name == 'PointOnIntersection') {\r\n    const firstSeg = findObjectById(\r\n      shape.geometryObject.geometryParentObjectId1,\r\n    );\r\n    const secondSeg = findObjectById(\r\n      shape.geometryObject.geometryParentObjectId2,\r\n    );\r\n    const coords = firstSeg.intersectionWith(secondSeg);\r\n    const newValue = !!coords;\r\n    if (newValue != shape.geometryObject.geometryIsVisibleByChoice) {\r\n      shape.geometryObject.geometryIsVisibleByChoice = newValue;\r\n      recomputeAllVisibilities(layer);\r\n    }\r\n    if (shape.geometryObject.geometryIsVisible == false) return;\r\n\r\n    if (coords.length == 1)\r\n      coords[1] = new Coordinates({ x: coords[0].x, y: coords[0].y });\r\n    const lastCoords = shape.points.map((pt) => pt.coordinates);\r\n    const mustInvertCoord =\r\n      lastCoords[0].dist(coords[0]) + lastCoords[1].dist(coords[1]) >\r\n      lastCoords[0].dist(coords[1]) + lastCoords[1].dist(coords[0]);\r\n    if (mustInvertCoord) coords.reverse();\r\n    shape.points.forEach(\r\n      (pt, idx) => (pt.coordinates = snapCoordinatesToGrid(coords[idx])),\r\n    );\r\n    firstSeg.divisionPoints.forEach((pt) => computeDivisionPoint(pt));\r\n    secondSeg.divisionPoints.forEach((pt) => computeDivisionPoint(pt));\r\n  } else if (shape.name == 'PointOnIntersection2') {\r\n    const firstSeg = findObjectById(\r\n      shape.geometryObject.geometryParentObjectId1,\r\n    );\r\n    const secondSeg = findObjectById(\r\n      shape.geometryObject.geometryParentObjectId2,\r\n    );\r\n    const coords = firstSeg.intersectionWith(secondSeg, 0.001);\r\n    const newValue = !!coords;\r\n    if (newValue != shape.geometryObject.geometryIsVisibleByChoice) {\r\n      shape.geometryObject.geometryIsVisibleByChoice = newValue;\r\n      recomputeAllVisibilities(layer);\r\n    }\r\n    if (shape.geometryObject.geometryIsVisible == false) return;\r\n\r\n    if (coords.length == 1)\r\n      coords[1] = new Coordinates({ x: coords[0].x, y: coords[0].y });\r\n    const lastCoords = shape.points.map((pt) => pt.coordinates);\r\n    const mustInvertCoord =\r\n      lastCoords[0].dist(coords[0]) > lastCoords[0].dist(coords[1]);\r\n    if (mustInvertCoord) coords.reverse();\r\n    shape.points.forEach(\r\n      (pt, idx) => (pt.coordinates = snapCoordinatesToGrid(coords[idx])),\r\n    );\r\n    firstSeg.divisionPoints.forEach((pt) => computeDivisionPoint(pt));\r\n    secondSeg.divisionPoints.forEach((pt) => computeDivisionPoint(pt));\r\n  } else if (shape.name == 'CirclePart') {\r\n  } else if (shape.name == 'CircleArc') {\r\n  } else if (shape.name == '30degreesArc') {\r\n    let angle =\r\n      shape.segments[0].arcCenter.coordinates.angleWith(\r\n        shape.vertexes[0].coordinates,\r\n      ) +\r\n      Math.PI / 6;\r\n    if (shape.isReversed)\r\n      angle =\r\n        shape.segments[0].arcCenter.coordinates.angleWith(\r\n          shape.vertexes[0].coordinates,\r\n        ) -\r\n        Math.PI / 6;\r\n    const radius = shape.segments[0].arcCenter.coordinates.dist(\r\n      shape.vertexes[0].coordinates,\r\n    );\r\n    const thirdPointCoordinates = new Coordinates({\r\n      x: shape.segments[0].arcCenter.coordinates.x + Math.cos(angle) * radius,\r\n      y: shape.segments[0].arcCenter.coordinates.y + Math.sin(angle) * radius,\r\n    });\r\n    shape.vertexes[1].coordinates = snapCoordinatesToGrid(\r\n      thirdPointCoordinates,\r\n    );\r\n  } else if (shape.name == '45degreesArc') {\r\n    let angle =\r\n      shape.segments[0].arcCenter.coordinates.angleWith(\r\n        shape.vertexes[0].coordinates,\r\n      ) +\r\n      Math.PI / 4;\r\n    if (shape.isReversed)\r\n      angle =\r\n        shape.segments[0].arcCenter.coordinates.angleWith(\r\n          shape.vertexes[0].coordinates,\r\n        ) -\r\n        Math.PI / 4;\r\n    const radius = shape.segments[0].arcCenter.coordinates.dist(\r\n      shape.vertexes[0].coordinates,\r\n    );\r\n    const thirdPointCoordinates = new Coordinates({\r\n      x: shape.segments[0].arcCenter.coordinates.x + Math.cos(angle) * radius,\r\n      y: shape.segments[0].arcCenter.coordinates.y + Math.sin(angle) * radius,\r\n    });\r\n    shape.vertexes[1].coordinates = snapCoordinatesToGrid(\r\n      thirdPointCoordinates,\r\n    );\r\n  }\r\n\r\n  shape.divisionPoints.forEach((pt) => computeDivisionPoint(pt));\r\n  if (shape.isCenterShown) {\r\n    shape.center.coordinates = shape.centerCoordinates;\r\n  }\r\n}\r\n\r\nfunction getPositionWithRatio(point, referenceSegment) {\r\n  let coord;\r\n  if (referenceSegment.shape.name == 'Circle') {\r\n    const refShape = referenceSegment.shape;\r\n    const angle =\r\n      refShape.segments[0].arcCenter.coordinates.angleWith(\r\n        refShape.vertexes[0].coordinates,\r\n      ) +\r\n      shape.points[0].ratio * Math.PI * 2;\r\n    coord = refShape.segments[0].arcCenter.coordinates.add({\r\n      x: refShape.segments[0].radius * Math.cos(angle),\r\n      y: refShape.segments[0].radius * Math.sin(angle),\r\n    });\r\n  } else if (referenceSegment.isArc()) {\r\n    const firstAngle = referenceSegment.arcCenter.coordinates.angleWith(\r\n      referenceSegment.vertexes[0].coordinates,\r\n    );\r\n    let secondAngle = referenceSegment.arcCenter.coordinates.angleWith(\r\n      referenceSegment.vertexes[1].coordinates,\r\n    );\r\n    if (secondAngle <= firstAngle) {\r\n      secondAngle += Math.PI * 2;\r\n    }\r\n    let newAngle = firstAngle + point.ratio * (secondAngle - firstAngle);\r\n    if (referenceSegment.counterclockwise) {\r\n      newAngle =\r\n        firstAngle - point.ratio * (2 * Math.PI - secondAngle + firstAngle);\r\n    }\r\n    coord = new Coordinates({\r\n      x:\r\n        referenceSegment.arcCenter.coordinates.x +\r\n        referenceSegment.radius * Math.cos(newAngle),\r\n      y:\r\n        referenceSegment.arcCenter.coordinates.y +\r\n        referenceSegment.radius * Math.sin(newAngle),\r\n    });\r\n  } else {\r\n    const firstPoint = referenceSegment.vertexes[0];\r\n    const secondPoint = referenceSegment.vertexes[1];\r\n    const segLength = secondPoint.coordinates.substract(firstPoint.coordinates);\r\n    const part = segLength.multiply(point.ratio);\r\n\r\n    coord = firstPoint.coordinates.add(part);\r\n  }\r\n  return coord;\r\n}\r\n\r\nexport function getRatioWithPosition(point, referenceSegment) {\r\n  let ratio;\r\n  if (referenceSegment.shape.name == 'Circle') {\r\n    const angle = referenceSegment.arcCenter.coordinates.angleWith(\r\n      point.coordinates,\r\n    );\r\n    const refAngle = referenceSegment.arcCenter.coordinates.angleWith(\r\n      referenceSegment.vertexes[0].coordinates,\r\n    );\r\n    ratio = (angle - refAngle) / Math.PI / 2;\r\n    if (ratio < 0) ratio += 1;\r\n  } else if (referenceSegment.isArc()) {\r\n    let angle = referenceSegment.arcCenter.coordinates.angleWith(\r\n      point.coordinates,\r\n    );\r\n    let firstAngle = referenceSegment.arcCenter.coordinates.angleWith(\r\n      referenceSegment.vertexes[0].coordinates,\r\n    );\r\n    let secondAngle = referenceSegment.arcCenter.coordinates.angleWith(\r\n      referenceSegment.vertexes[1].coordinates,\r\n    );\r\n    if (referenceSegment.counterclockwise)\r\n      [firstAngle, secondAngle] = [secondAngle, firstAngle];\r\n    if (firstAngle > secondAngle) secondAngle += 2 * Math.PI;\r\n    if (firstAngle > angle) angle += 2 * Math.PI;\r\n    ratio = (angle - firstAngle) / (secondAngle - firstAngle);\r\n    if (referenceSegment.counterclockwise) ratio = 1 - ratio;\r\n  } else {\r\n    if (\r\n      Math.abs(\r\n        referenceSegment.vertexes[0].coordinates.x -\r\n          referenceSegment.vertexes[1].coordinates.x,\r\n      ) < 0.001\r\n    ) {\r\n      ratio =\r\n        (point.coordinates.y - referenceSegment.vertexes[0].coordinates.y) /\r\n        (referenceSegment.vertexes[1].coordinates.y -\r\n          referenceSegment.vertexes[0].coordinates.y);\r\n    } else {\r\n      ratio =\r\n        (point.coordinates.x - referenceSegment.vertexes[0].coordinates.x) /\r\n        (referenceSegment.vertexes[1].coordinates.x -\r\n          referenceSegment.vertexes[0].coordinates.x);\r\n    }\r\n  }\r\n  if (\r\n    ratio > 1 &&\r\n    !(\r\n      referenceSegment.shape.name.endsWith('StraightLine') ||\r\n      referenceSegment.shape.name == 'Strip'\r\n    )\r\n  )\r\n    ratio = 1;\r\n  else if (\r\n    ratio < 0 &&\r\n    !(\r\n      (referenceSegment.shape.name.endsWith('StraightLine') &&\r\n        !referenceSegment.shape.name.endsWith('SemiStraightLine')) ||\r\n      referenceSegment.shape.name == 'Strip'\r\n    )\r\n  )\r\n    ratio = 0;\r\n  return ratio;\r\n}\r\n\r\nfunction computeLinkedShape(shape) {\r\n  shape.points.forEach((pt, idx, points) => {\r\n    if (pt.reference) {\r\n      const reference = findObjectById(pt.reference);\r\n      if (reference) {\r\n        if (reference instanceof Point) {\r\n          pt.coordinates = new Coordinates(reference.coordinates);\r\n        } else {\r\n          const coord = getPositionWithRatio(pt, reference);\r\n          pt.coordinates = snapCoordinatesToGrid(coord);\r\n        }\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\nfunction computeTransformShape(shape) {\r\n  const parentShape = findObjectById(\r\n    shape.geometryObject.geometryTransformationParentShapeId,\r\n  );\r\n  shape.vertexes.forEach((pt, idx) => {\r\n    pt.coordinates = snapCoordinatesToGrid(\r\n      parentShape.vertexes[idx].coordinates,\r\n    );\r\n  });\r\n  shape.points\r\n    .filter((pt) => pt.type === 'arcCenter')\r\n    .forEach((pt, idx) => {\r\n      pt.coordinates = snapCoordinatesToGrid(\r\n        parentShape.points.filter((pt) => pt.type === 'arcCenter')[idx]\r\n          .coordinates,\r\n      );\r\n    });\r\n  shape.divisionPoints.forEach((pt, idx) => {\r\n    if (pt.reference)\r\n      pt.coordinates = snapCoordinatesToGrid(\r\n        findObjectById(pt.reference).coordinates,\r\n      );\r\n  });\r\n  if (parentShape.name == 'CirclePart') {\r\n    shape.segments[1].arcCenter.coordinates = snapCoordinatesToGrid(\r\n      parentShape.segments[1].arcCenter.coordinates,\r\n    );\r\n  } else if (parentShape.name == 'CircleArc') {\r\n    shape.segments[0].arcCenter.coordinates = snapCoordinatesToGrid(\r\n      parentShape.segments[0].arcCenter.coordinates,\r\n    );\r\n  }\r\n  if (shape.geometryObject.geometryTransformationName == 'orthogonalSymetry') {\r\n    let axis;\r\n    if (\r\n      shape.geometryObject.geometryTransformationCharacteristicElements.type ==\r\n      'axis'\r\n    ) {\r\n      axis =\r\n        shape.geometryObject.geometryTransformationCharacteristicElements\r\n          .firstElement;\r\n    } else {\r\n      const pts =\r\n        shape.geometryObject.geometryTransformationCharacteristicElements\r\n          .elements;\r\n      const axisShape = new LineShape({\r\n        layer: 'invisible',\r\n        path: `M ${pts[0].coordinates.x} ${pts[0].coordinates.y} L ${pts[1].coordinates.x} ${pts[1].coordinates.y}`,\r\n        borderColor: app.settings.referenceDrawColor,\r\n        borderSize: 2,\r\n      });\r\n      axis = axisShape.segments[0];\r\n    }\r\n    reverseShape(shape, axis);\r\n  } else if (\r\n    shape.geometryObject.geometryTransformationName == 'centralSymetry'\r\n  ) {\r\n    const center =\r\n      shape.geometryObject.geometryTransformationCharacteristicElements\r\n        .firstElement.coordinates;\r\n    shape.rotate(Math.PI, center);\r\n  } else if (shape.geometryObject.geometryTransformationName == 'translation') {\r\n    let pts;\r\n    if (\r\n      shape.geometryObject.geometryTransformationCharacteristicElements.type ==\r\n      'vector'\r\n    ) {\r\n      pts =\r\n        shape.geometryObject.geometryTransformationCharacteristicElements\r\n          .firstElement.points;\r\n    } else {\r\n      pts =\r\n        shape.geometryObject.geometryTransformationCharacteristicElements\r\n          .elements;\r\n    }\r\n    shape.translate(pts[1].coordinates.substract(pts[0].coordinates));\r\n  } else if (shape.geometryObject.geometryTransformationName == 'rotation') {\r\n    // let angle;\r\n    let pts;\r\n\r\n    const rotationCenter =\r\n      shape.geometryObject.geometryTransformationCharacteristicElements\r\n        .firstElement;\r\n    if (\r\n      shape.geometryObject.geometryTransformationCharacteristicElements.type ==\r\n      'arc'\r\n    ) {\r\n      const arc =\r\n        shape.geometryObject.geometryTransformationCharacteristicElements\r\n          .secondElement;\r\n      pts = [...arc.vertexes, arc.arcCenter];\r\n    } else {\r\n      pts =\r\n        shape.geometryObject.geometryTransformationCharacteristicElements.elements.slice(\r\n          1,\r\n        );\r\n    }\r\n    const angle =\r\n      pts[2].coordinates.angleWith(pts[1].coordinates) -\r\n      pts[2].coordinates.angleWith(pts[0].coordinates);\r\n\r\n    // if (shape.geometryObject.geometryTransformationCharacteristicElementIds.length == 2) {\r\n    //   let arc = findObjectById(shape.geometryObject.geometryTransformationCharacteristicElementIds[1])\r\n    //   pts = [findObjectById(shape.geometryObject.geometryTransformationCharacteristicElementIds[0])];\r\n    // } else {\r\n    //   pts = shape.geometryObject.geometryTransformationCharacteristicElementIds.map(refId =>\r\n    //     findObjectById(refId)\r\n    //   );\r\n    // }\r\n    // angle *= -1;\r\n    shape.rotate(angle, rotationCenter.coordinates);\r\n  }\r\n  if (shape.name == 'PointOnLine') {\r\n    const firstSeg = findObjectById(\r\n      shape.geometryObject.geometryParentObjectId1,\r\n    );\r\n    firstSeg.divisionPoints.forEach((pt) => {\r\n      computeDivisionPoint(pt);\r\n    });\r\n    // recomputeAllVisibilities('upper');\r\n  } else if (shape.name.startsWith('PointOnIntersection')) {\r\n    const firstSeg = findObjectById(\r\n      shape.geometryObject.geometryParentObjectId1,\r\n    );\r\n    firstSeg.divisionPoints.forEach((pt) => {\r\n      computeDivisionPoint(pt);\r\n    });\r\n    const secondSeg = findObjectById(\r\n      shape.geometryObject.geometryParentObjectId2,\r\n    );\r\n    secondSeg.divisionPoints.forEach((pt) => {\r\n      computeDivisionPoint(pt);\r\n    });\r\n    recomputeAllVisibilities('upper');\r\n  }\r\n  shape.divisionPoints.forEach((pt) => {\r\n    if (!pt.reference) computeDivisionPoint(pt);\r\n  });\r\n\r\n  if (shape.isCenterShown) {\r\n    shape.center.coordinates = shape.centerCoordinates;\r\n  }\r\n}\r\n\r\nfunction computeDuplicateShape(shape) {\r\n  let parentObject = findObjectById(\r\n    shape.geometryObject.geometryDuplicateParentShapeId,\r\n  );\r\n  if (!parentObject)\r\n    parentObject = findObjectById(\r\n      shape.geometryObject.geometryMultipliedParentShapeId,\r\n    );\r\n\r\n  let parentShape = parentObject;\r\n  if (parentObject instanceof Segment) parentShape = parentObject.shape;\r\n\r\n  if (shape.name == 'PointOnLine') {\r\n    shape.points[0].ratio = parentShape.points[0].ratio;\r\n\r\n    const ref = findObjectById(shape.geometryObject.geometryParentObjectId1);\r\n    const point = shape.points[0];\r\n\r\n    let coord;\r\n    if (ref.shape.name == 'Circle') {\r\n      const refShape = ref.shape;\r\n      const angle =\r\n        refShape.segments[0].arcCenter.coordinates.angleWith(\r\n          refShape.vertexes[0].coordinates,\r\n        ) +\r\n        shape.points[0].ratio * Math.PI * 2;\r\n      coord = refShape.segments[0].arcCenter.coordinates.add({\r\n        x: refShape.segments[0].radius * Math.cos(angle),\r\n        y: refShape.segments[0].radius * Math.sin(angle),\r\n      });\r\n    } else if (ref.isArc()) {\r\n      const firstAngle = ref.arcCenter.coordinates.angleWith(\r\n        ref.vertexes[0].coordinates,\r\n      );\r\n      let secondAngle = ref.arcCenter.coordinates.angleWith(\r\n        ref.vertexes[1].coordinates,\r\n      );\r\n      if (secondAngle <= firstAngle) {\r\n        secondAngle += Math.PI * 2;\r\n      }\r\n      let newAngle = firstAngle + point.ratio * (secondAngle - firstAngle);\r\n      if (ref.counterclockwise) {\r\n        newAngle =\r\n          firstAngle - point.ratio * (2 * Math.PI - secondAngle + firstAngle);\r\n      }\r\n      coord = new Coordinates({\r\n        x: ref.arcCenter.coordinates.x + ref.radius * Math.cos(newAngle),\r\n        y: ref.arcCenter.coordinates.y + ref.radius * Math.sin(newAngle),\r\n      });\r\n    } else {\r\n      const firstPoint = ref.vertexes[0];\r\n      const secondPoint = ref.vertexes[1];\r\n      const segLength = secondPoint.coordinates.substract(\r\n        firstPoint.coordinates,\r\n      );\r\n      const part = segLength.multiply(point.ratio);\r\n\r\n      coord = firstPoint.coordinates.add(part);\r\n    }\r\n    shape.points[0].coordinates = snapCoordinatesToGrid(coord);\r\n    ref.divisionPoints.forEach((pt) => computeDivisionPoint(pt));\r\n  } else {\r\n    const vector =\r\n      shape.geometryObject.geometryConstructionSpec.childFirstPointCoordinates.substract(\r\n        shape.geometryObject.geometryConstructionSpec\r\n          .parentFirstPointCoordinates,\r\n      );\r\n    let mustReverse = false,\r\n      rotationMultiplier = -1;\r\n    if (shape.isReversed ^ parentShape.isReversed) {\r\n      mustReverse = true;\r\n      rotationMultiplier = 1;\r\n    }\r\n    shape.points\r\n      .filter((pt) => pt.type != 'divisionPoint')\r\n      .forEach((pt, idx) => {\r\n        let startCoord = parentObject.points.filter(\r\n          (pt) => pt.type != 'divisionPoint',\r\n        )[idx].coordinates;\r\n        if (mustReverse) {\r\n          startCoord = new Coordinates({\r\n            x:\r\n              startCoord.x +\r\n              2 *\r\n                (shape.geometryObject.geometryConstructionSpec\r\n                  .parentFirstPointCoordinates.x -\r\n                  startCoord.x),\r\n            y: startCoord.y,\r\n          });\r\n        }\r\n        let newPointCoordinates = startCoord\r\n          .rotate(\r\n            rotationMultiplier *\r\n              shape.geometryObject.geometryConstructionSpec.rotationAngle,\r\n            shape.geometryObject.geometryConstructionSpec\r\n              .parentFirstPointCoordinates,\r\n          )\r\n          .add(vector);\r\n        if (\r\n          idx == 1 &&\r\n          shape.geometryObject.geometryConstructionSpec.numerator\r\n        ) {\r\n          newPointCoordinates = shape.points[0].coordinates.add(\r\n            newPointCoordinates\r\n              .substract(shape.points[0].coordinates)\r\n              .multiply(\r\n                shape.geometryObject.geometryConstructionSpec.numerator /\r\n                  shape.geometryObject.geometryConstructionSpec.denominator,\r\n              ),\r\n          );\r\n        }\r\n        pt.coordinates = snapCoordinatesToGrid(newPointCoordinates);\r\n      });\r\n    shape.divisionPoints.forEach((pt) => computeDivisionPoint(pt));\r\n    if (shape.isCenterShown) {\r\n      shape.center.coordinates = shape.centerCoordinates;\r\n    }\r\n  }\r\n}\r\n\r\nexport function recomputeAllVisibilities(layer) {\r\n  app[layer + 'CanvasLayer'].shapes.forEach((s) => {\r\n    if (s.geometryObject) s.geometryObject.geometryIsVisible = true;\r\n  });\r\n  app[layer + 'CanvasLayer'].points.forEach(\r\n    (pt) => (pt.geometryIsVisible = true),\r\n  );\r\n\r\n  const changeVisibilityRecursively = (shapeId) => {\r\n    const shape = findObjectById(shapeId);\r\n    if (!shape.geometryObject.geometryIsVisible) {\r\n      return;\r\n    }\r\n    shape.geometryObject.geometryIsVisible = false;\r\n    if (shape.name.startsWith('PointOnIntersection')) {\r\n      let segment = findObjectById(\r\n        shape.geometryObject.geometryParentObjectId1,\r\n      );\r\n      segment.divisionPoints.forEach((divPt) => {\r\n        if (divPt.endpointIds?.some((endPtId) => endPtId == shape.points[0].id))\r\n          divPt.geometryIsVisible = false;\r\n      });\r\n      segment = findObjectById(shape.geometryObject.geometryParentObjectId2);\r\n      segment.divisionPoints.forEach((divPt) => {\r\n        if (divPt.endpointIds?.some((endPtId) => endPtId == shape.points[0].id))\r\n          divPt.geometryIsVisible = false;\r\n      });\r\n    }\r\n    // if (shape.name == 'PointOnLine') {\r\n    //   let segment = findObjectById(shape.geometryObject.geometryParentObjectId1);\r\n    //   segment.divisionPoints.forEach(divPt => {\r\n    //     if (divPt.endpointIds?.some(endPtId => endPtId == shape.points[0].id))\r\n    //       divPt.geometryIsVisible = false;\r\n    //   });\r\n    // }\r\n    shape.geometryObject.geometryChildShapeIds.forEach((objId) => {\r\n      changeVisibilityRecursively(objId);\r\n    });\r\n    shape.geometryObject.geometryTransformationChildShapeIds.forEach(\r\n      (objId) => {\r\n        changeVisibilityRecursively(objId);\r\n      },\r\n    );\r\n    shape.geometryObject.geometryDuplicateChildShapeIds.forEach((objId) => {\r\n      changeVisibilityRecursively(objId);\r\n    });\r\n  };\r\n\r\n  app[layer + 'CanvasLayer'].shapes.forEach((s) => {\r\n    if (s.geometryObject?.geometryIsVisibleByChoice === false) {\r\n      if (s.name != 'cut') changeVisibilityRecursively(s.id);\r\n      else s.geometryObject.geometryIsVisible = false;\r\n    }\r\n  });\r\n}\r\n\r\nexport function computeDivisionPoint(point) {\r\n  if (app.environment.name != 'Geometrie') return;\r\n  const segment = point.segments[0];\r\n  if (point.shape.isCircle()) {\r\n    const startAngle = segment.arcCenter.coordinates.angleWith(\r\n      segment.vertexes[0].coordinates,\r\n    );\r\n    let newAngle = startAngle + point.ratio * 2 * Math.PI;\r\n    if (point.endpointIds?.length == 2) {\r\n      const firstPoint = findObjectById(point.endpointIds[0]);\r\n      const secondPoint = findObjectById(point.endpointIds[1]);\r\n      const firstAngle = segment.arcCenter.coordinates.angleWith(\r\n        firstPoint.coordinates,\r\n      );\r\n      let secondAngle = segment.arcCenter.coordinates.angleWith(\r\n        secondPoint.coordinates,\r\n      );\r\n      if (secondAngle <= firstAngle) {\r\n        secondAngle += Math.PI * 2;\r\n      }\r\n      newAngle = firstAngle + point.ratio * (secondAngle - firstAngle);\r\n    }\r\n    const newCoordinates = new Coordinates({\r\n      x: segment.arcCenter.coordinates.x + segment.radius * Math.cos(newAngle),\r\n      y: segment.arcCenter.coordinates.y + segment.radius * Math.sin(newAngle),\r\n    });\r\n    point.coordinates = snapCoordinatesToGrid(newCoordinates);\r\n  } else if (segment.isArc()) {\r\n    const firstAngle = segment.arcCenter.coordinates.angleWith(\r\n      segment.vertexes[0].coordinates,\r\n    );\r\n    let secondAngle = segment.arcCenter.coordinates.angleWith(\r\n      segment.vertexes[1].coordinates,\r\n    );\r\n    if (secondAngle <= firstAngle) {\r\n      secondAngle += Math.PI * 2;\r\n    }\r\n    let newAngle = firstAngle + point.ratio * (secondAngle - firstAngle);\r\n    if (segment.counterclockwise) {\r\n      newAngle =\r\n        firstAngle - point.ratio * (2 * Math.PI - secondAngle + firstAngle);\r\n    }\r\n    const newCoordinates = new Coordinates({\r\n      x: segment.arcCenter.coordinates.x + segment.radius * Math.cos(newAngle),\r\n      y: segment.arcCenter.coordinates.y + segment.radius * Math.sin(newAngle),\r\n    });\r\n    point.coordinates = snapCoordinatesToGrid(newCoordinates);\r\n  } else {\r\n    let firstPoint = segment.vertexes[0];\r\n    let secondPoint = segment.vertexes[1];\r\n    if (point.endpointIds?.length == 2) {\r\n      firstPoint = findObjectById(point.endpointIds[0]);\r\n      secondPoint = findObjectById(point.endpointIds[1]);\r\n    }\r\n\r\n    const segLength = secondPoint.coordinates.substract(firstPoint.coordinates);\r\n    const part = segLength.multiply(point.ratio);\r\n\r\n    point.coordinates = snapCoordinatesToGrid(firstPoint.coordinates.add(part));\r\n  }\r\n}\r\n\r\nexport function computeConstructionSpec(shape, maxIndex = 100) {\r\n  if (shape.familyName == 'duplicate') {\r\n    if (shape.name == 'PointOnLine') {\r\n      return;\r\n    }\r\n    const refObject = findObjectById(\r\n      shape.geometryObject.geometryDuplicateParentShapeId,\r\n    );\r\n    let refShape = refObject;\r\n    if (refShape instanceof Segment) refShape = refShape.shape;\r\n    shape.geometryObject.geometryConstructionSpec.parentFirstPointCoordinates =\r\n      refObject.vertexes[0].coordinates;\r\n    shape.geometryObject.geometryConstructionSpec.childFirstPointCoordinates =\r\n      shape.vertexes[0].coordinates;\r\n    const refShapeAngle = refObject.vertexes[0].coordinates.angleWith(\r\n      refObject.centerCoordinates\r\n        ? refObject.centerCoordinates\r\n        : refObject.vertexes[1].coordinates,\r\n    );\r\n    let centerCoordinates = shape.centerCoordinates;\r\n    // let firstPointCoordinates = shape.points[0].coordinates;\r\n    if (refShape.isReversed ^ shape.isReversed) {\r\n      centerCoordinates = new Coordinates({\r\n        x:\r\n          centerCoordinates.x +\r\n          2 * (shape.points[0].coordinates.x - centerCoordinates.x),\r\n        y: centerCoordinates.y,\r\n      });\r\n      // firstPointCoordinates = new Coordinates({\r\n      //   x: shape.points[0].coordinates.x + 2 * (shape.centerCoordinates.x - shape.points[0].coordinates.x),\r\n      //   y: shape.points[0].coordinates.y,\r\n      // });\r\n    }\r\n    const shapeAngle =\r\n      shape.vertexes[0].coordinates.angleWith(centerCoordinates);\r\n    if (shape.segments[0].length > 0.01) {\r\n      shape.geometryObject.geometryConstructionSpec.rotationAngle =\r\n        refShapeAngle - shapeAngle;\r\n    }\r\n  } else if (shape.familyName == 'multipliedVector') {\r\n    const refShape = findObjectById(\r\n      shape.geometryObject.geometryMultipliedParentShapeId,\r\n    );\r\n    shape.geometryObject.geometryConstructionSpec.parentFirstPointCoordinates =\r\n      refShape.points[0].coordinates;\r\n    shape.geometryObject.geometryConstructionSpec.childFirstPointCoordinates =\r\n      shape.points[0].coordinates;\r\n    shape.geometryObject.geometryConstructionSpec.rotationAngle = 0;\r\n  } else if (shape.name == 'Rectangle') {\r\n    // let angle = shape.vertexes[1].getVertexAngle();\r\n    // shape.geometryObject.geometryConstructionSpec.height = shape.vertexes[2].coordinates.dist(shape.vertexes[1]);\r\n    // if (angle < Math.PI / 2 + .1 && angle > Math.PI / 2 - .1)\r\n    //   shape.geometryObject.geometryConstructionSpec.height *= -1;\r\n  } else if (shape.name == 'Losange') {\r\n    shape.geometryObject.geometryConstructionSpec.angle =\r\n      shape.vertexes[1].getVertexAngle();\r\n  } else if (shape.name == 'Parallelogram') {\r\n  } else if (shape.name == 'RightAngleTrapeze') {\r\n    // let angle = shape.vertexes[1].getVertexAngle();\r\n    // shape.geometryObject.geometryConstructionSpec.height = shape.vertexes[2].coordinates.dist(shape.vertexes[1]);\r\n    // if (Math.abs(angle - Math.PI / 2) < .1) {\r\n    //   shape.geometryObject.geometryConstructionSpec.height *= -1;\r\n    // }\r\n    // if (maxIndex > 2) {\r\n    //   angle = shape.vertexes[2].getVertexAngle();\r\n    //   shape.geometryObject.geometryConstructionSpec.smallBaseLength = shape.vertexes[3].coordinates.dist(shape.vertexes[2]);\r\n    //   if (shape.geometryObject.geometryConstructionSpec.height > 0 ^ Math.abs(angle - Math.PI / 2) < .1) {\r\n    //     shape.geometryObject.geometryConstructionSpec.smallBaseLength *= -1;\r\n    //   }\r\n    // }\r\n  } else if (shape.name == 'IsoscelesTrapeze') {\r\n    // shape.constructionSpec.angle = shape.vertexes[1].getVertexAngle();\r\n    // shape.constructionSpec.firstSegmentLength = shape.segments[0].length;\r\n    // shape.constructionSpec.secondSegmentLength = shape.segments[1].length;\r\n  } else if (shape.name == 'Trapeze') {\r\n    shape.geometryObject.geometryConstructionSpec.angle =\r\n      shape.vertexes[1].getVertexAngle();\r\n    shape.geometryObject.geometryConstructionSpec.firstSegmentLength =\r\n      shape.segments[0].length;\r\n    shape.geometryObject.geometryConstructionSpec.secondSegmentLength =\r\n      shape.segments[1].length;\r\n    shape.geometryObject.geometryConstructionSpec.thirdSegmentLength =\r\n      shape.segments[2].length;\r\n    if (\r\n      Math.abs(\r\n        shape.segments[0].getAngleWithHorizontal() -\r\n          shape.segments[2].getAngleWithHorizontal(),\r\n      ) > 0.1\r\n    )\r\n      shape.geometryObject.geometryConstructionSpec.thirdSegmentLength *= -1;\r\n  } else if (shape.name == 'RightAngleIsoscelesTriangle') {\r\n    shape.geometryObject.geometryConstructionSpec.angle =\r\n      shape.vertexes[1].getVertexAngle();\r\n  } else if (shape.name == 'RightAngleTriangle') {\r\n    shape.geometryObject.geometryConstructionSpec.angle =\r\n      shape.vertexes[1].getVertexAngle();\r\n    shape.geometryObject.geometryConstructionSpec.secondSegmentLength =\r\n      shape.segments[1].length;\r\n  } else if (shape.name == 'IsoscelesTriangle') {\r\n    shape.geometryObject.geometryConstructionSpec.height =\r\n      shape.segments[0].middle.dist(shape.vertexes[2].coordinates);\r\n    if (shape.vertexes[1].getVertexAngle() > Math.PI)\r\n      shape.geometryObject.geometryConstructionSpec.height *= -1;\r\n  } else if (shape.name == 'CirclePart') {\r\n    const angle2 = shape.segments[1].arcCenter.coordinates.angleWith(\r\n      shape.vertexes[1].coordinates,\r\n    );\r\n    const angle1 = shape.segments[1].arcCenter.coordinates.angleWith(\r\n      shape.vertexes[2].coordinates,\r\n    );\r\n    const angle = mod(angle1 - angle2, 2 * Math.PI);\r\n    shape.geometryObject.geometryConstructionSpec.angle = angle;\r\n  } else if (shape.name == 'CircleArc') {\r\n    const angle2 = shape.segments[0].arcCenter.coordinates.angleWith(\r\n      shape.vertexes[0].coordinates,\r\n    );\r\n    const angle1 = shape.segments[0].arcCenter.coordinates.angleWith(\r\n      shape.vertexes[1].coordinates,\r\n    );\r\n    const angle = mod(angle1 - angle2, 2 * Math.PI);\r\n    shape.geometryObject.geometryConstructionSpec.angle = angle;\r\n  } else if (\r\n    shape.name == 'ParalleleSemiStraightLine' ||\r\n    shape.name == 'ParalleleSegment'\r\n  ) {\r\n    shape.geometryObject.geometryConstructionSpec.segmentLength =\r\n      shape.segments[0].length;\r\n    const reference = findObjectById(\r\n      shape.geometryObject.geometryParentObjectId1,\r\n    );\r\n    if (\r\n      Math.abs(\r\n        reference.getAngleWithHorizontal() -\r\n          shape.segments[0].getAngleWithHorizontal(),\r\n      ) > 0.1\r\n    )\r\n      shape.geometryObject.geometryConstructionSpec.segmentLength *= -1;\r\n  } else if (\r\n    shape.name == 'PerpendicularSemiStraightLine' ||\r\n    shape.name == 'PerpendicularSegment'\r\n  ) {\r\n    shape.geometryObject.geometryConstructionSpec.segmentLength =\r\n      shape.segments[0].length;\r\n    const reference = findObjectById(\r\n      shape.geometryObject.geometryParentObjectId1,\r\n    );\r\n    if (\r\n      Math.abs(\r\n        reference.getAngleWithHorizontal() -\r\n          shape.segments[0].getAngleWithHorizontal() +\r\n          Math.PI / 2,\r\n      ) > 0.1 &&\r\n      Math.abs(\r\n        reference.getAngleWithHorizontal() -\r\n          shape.segments[0].getAngleWithHorizontal() +\r\n          Math.PI / 2 -\r\n          2 * Math.PI,\r\n      ) > 0.1\r\n    )\r\n      shape.geometryObject.geometryConstructionSpec.segmentLength *= -1;\r\n  } else if (shape.name == 'PointOnLine') {\r\n    const reference = findObjectById(\r\n      shape.geometryObject.geometryParentObjectId1,\r\n    );\r\n    const ratio = getRatioWithPosition(shape.points[0], reference);\r\n    shape.points[0].ratio = ratio;\r\n  }\r\n}\r\n\r\nexport function projectionOnConstraints(coordinates, constraints) {\r\n  if (constraints.isFree) return coordinates;\r\n  const projectionsOnContraints = constraints.lines\r\n    .map((line) => {\r\n      const projection = line.segment.projectionOnSegment(coordinates);\r\n      const dist = projection.dist(coordinates);\r\n      return { projection: projection, dist: dist };\r\n    })\r\n    .concat(\r\n      constraints.points.map((pt) => {\r\n        const dist = pt.dist(coordinates);\r\n        return { projection: pt, dist: dist };\r\n      }),\r\n    );\r\n  projectionsOnContraints.sort((p1, p2) => (p1.dist > p2.dist ? 1 : -1));\r\n  return snapCoordinatesToGrid(projectionsOnContraints[0].projection);\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Grid\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Group\\GroupTool.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":126,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":126,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3579,3581],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":155,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":155,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4638,4640],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":157,"column":20,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":157,"endColumn":22,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4744,4746],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":183,"column":20,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":183,"endColumn":22,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5681,5683],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":211,"column":19,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":211,"endColumn":21,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6485,6487],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":214,"column":26,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":214,"endColumn":28,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6640,6642],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { html } from 'lit';\r\nimport { app, setState } from '../Core/App';\r\nimport { GroupManager } from '../Core/Managers/GroupManager';\r\nimport { ShapeGroup } from '../Core/Objects/ShapeGroup';\r\nimport { Tool } from '../Core/States/Tool';\r\n\r\n/**\r\n * Grouper des figures.\r\n */\r\nexport class GroupTool extends Tool {\r\n  constructor() {\r\n    super('group', 'Grouper', 'tool');\r\n\r\n    this.group = null;\r\n\r\n    this.firstShape = null;\r\n\r\n    this.groupsColor = [\r\n      '#77b5fe',\r\n      '#096a09',\r\n      '#f00020',\r\n      '#03224c',\r\n      '#34c924',\r\n      '#d473d4',\r\n      '#fd3f92',\r\n      '#ff8400',\r\n    ];\r\n  }\r\n\r\n  /**\r\n   * Renvoie l'aide ├á afficher ├á l'utilisateur\r\n   * @return {String} L'aide, en HTML\r\n   */\r\n  getHelpText() {\r\n    const toolName = this.title;\r\n    return html`\r\n      <h3>${toolName}</h3>\r\n      <p>\r\n        Vous avez s├®lectionn├® l'outil <b>\"${toolName}\"</b>. Cet outil permet de\r\n        figurer des groupes de figures, qui sont alors solidaires. Une figure ne\r\n        peut appartenir qu'├á un seul groupe.\r\n        <br />\r\n        Une fois cet outil s├®lectionn├®, le num├®ro du groupe appara├«t sur chaque\r\n        figure appartenant ├á un groupe.<br /><br />\r\n\r\n        Pour cr├®er un nouveau groupe, touchez deux figures n'appartenant pas ├á\r\n        un groupe. Toutes les figures touch├®es par la suite seront ajout├®es ├á ce\r\n        groupe.<br /><br />\r\n\r\n        Pour ajouter une figure ├á un groupe, touchez une des figures appartenant\r\n        ├á ce groupe, puis touchez la figure que vous souhaitez ajouter.<br /><br />\r\n\r\n        Pour fusionner deux groupes, touchez une des figures appartenant au\r\n        premier groupe, puis touchez une des figures de l'autre groupe.\r\n      </p>\r\n    `;\r\n  }\r\n\r\n  start() {\r\n    setTimeout(\r\n      () =>\r\n        setState({\r\n          tool: { ...app.tool, name: this.name, currentStep: 'listen' },\r\n        }),\r\n      50,\r\n    );\r\n  }\r\n\r\n  listen() {\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.removeListeners();\r\n\r\n    app.mainCanvasLayer.shapes.map((s) => {\r\n      const currentGroup = GroupManager.getShapeGroup(s);\r\n      if (currentGroup != null) {\r\n        new s.constructor({\r\n          ...s,\r\n          layer: 'upper',\r\n          path: s.getSVGPath('no scale', false, false),\r\n          fillOpacity: 0,\r\n          strokeColor: currentGroup.color,\r\n          strokeWidth: 3,\r\n          divisionPointInfos: s.divisionPoints.map((dp) => {\r\n            return {\r\n              coordinates: dp.coordinates,\r\n              ratio: dp.ratio,\r\n              segmentIdx: dp.segments[0].idx,\r\n              id: dp.id,\r\n              color: dp.color,\r\n            };\r\n          }),\r\n          pointsColor: s.points.map((pt) => {\r\n            return pt.color;\r\n          }),\r\n        });\r\n      }\r\n    });\r\n\r\n    app.workspace.selectionConstraints =\r\n      app.fastSelectionConstraints.click_all_shape;\r\n    this.objectSelectedId = app.addListener('objectSelected', this.handler);\r\n  }\r\n\r\n  selectSecondShape() {\r\n    this.removeListeners();\r\n\r\n    app.workspace.selectionConstraints =\r\n      app.fastSelectionConstraints.click_all_shape;\r\n    this.objectSelectedId = app.addListener('objectSelected', this.handler);\r\n  }\r\n\r\n  fillGroup() {\r\n    this.removeListeners();\r\n\r\n    app.workspace.selectionConstraints =\r\n      app.fastSelectionConstraints.click_all_shape;\r\n    this.objectSelectedId = app.addListener('objectSelected', this.handler);\r\n  }\r\n\r\n  end() {\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.removeListeners();\r\n  }\r\n\r\n  objectSelected(shape) {\r\n    if (app.tool.currentStep == 'listen') {\r\n      const userGroup = GroupManager.getShapeGroup(shape);\r\n      if (userGroup) {\r\n        this.group = userGroup;\r\n        setState({ tool: { ...app.tool, currentStep: 'fillGroup' } });\r\n      } else {\r\n        this.firstShapeId = shape.id;\r\n        new shape.constructor({\r\n          ...shape,\r\n          layer: 'upper',\r\n          path: shape.getSVGPath('no scale', false, false),\r\n          fillOpacity: 0,\r\n          strokeColor: this.groupsColor[app.nextGroupColorIdx % 8],\r\n          strokeWidth: 3,\r\n          divisionPointInfos: shape.divisionPoints.map((dp) => {\r\n            return {\r\n              coordinates: dp.coordinates,\r\n              ratio: dp.ratio,\r\n              segmentIdx: dp.segments[0].idx,\r\n              id: dp.id,\r\n              color: dp.color,\r\n            };\r\n          }),\r\n          pointsColor: shape.points.map((pt) => {\r\n            return pt.color;\r\n          }),\r\n        });\r\n        setState({ tool: { ...app.tool, currentStep: 'selectSecondShape' } });\r\n      }\r\n    } else if (app.tool.currentStep == 'selectSecondShape') {\r\n      const userGroup = GroupManager.getShapeGroup(shape);\r\n      if (shape.id == this.firstShapeId) {\r\n        window.dispatchEvent(\r\n          new CustomEvent('show-notif', {\r\n            detail: { message: 'La figure choisie fait d├®j├á partie du groupe' },\r\n          }),\r\n        );\r\n        return;\r\n      } else if (userGroup) {\r\n        this.group = userGroup;\r\n        this.mode = 'add';\r\n      } else {\r\n        this.mode = 'new';\r\n        this.secondShapeId = shape.id;\r\n        this.group = GroupManager.getShapeGroup(shape);\r\n      }\r\n      this.executeAction();\r\n      setState({\r\n        tool: { ...app.tool, name: this.name, currentStep: 'fillGroup' },\r\n      });\r\n    } else {\r\n      // fillGroup\r\n      this.secondGroup = GroupManager.getShapeGroup(shape);\r\n      if (this.secondGroup) {\r\n        //La figure fait partie d'un autre groupe, on fusionne\r\n        let index1 = GroupManager.getGroupIndex(this.group),\r\n          index2 = GroupManager.getGroupIndex(this.secondGroup);\r\n        if (index1 == index2) {\r\n          window.dispatchEvent(\r\n            new CustomEvent('show-notif', {\r\n              detail: {\r\n                message: 'La figure choisie fait d├®j├á partie du groupe',\r\n              },\r\n            }),\r\n          );\r\n          return;\r\n        }\r\n        //On garde le groupe ayant l'index le plus petit\r\n        if (index1 > index2) {\r\n          [index1, index2] = [index2, index1];\r\n          [this.group, this.secondGroup] = [this.secondGroup, this.group];\r\n        }\r\n        this.mode = 'merge';\r\n      } else {\r\n        this.mode = 'add';\r\n        this.firstShapeId = shape.id;\r\n      }\r\n      this.executeAction();\r\n      setState({\r\n        tool: { ...app.tool, name: this.name, currentStep: 'fillGroup' },\r\n      });\r\n    }\r\n  }\r\n\r\n  _executeAction() {\r\n    if (this.mode == 'new') {\r\n      this.group = new ShapeGroup(this.firstShapeId, this.secondShapeId);\r\n      GroupManager.addGroup(this.group);\r\n    } else if (this.mode == 'add') {\r\n      this.group.addShape(this.firstShapeId);\r\n    } else {\r\n      // merge\r\n      const group1 = this.group,\r\n        group2 = this.secondGroup;\r\n\r\n      group1.shapesIds = [...group1.shapesIds, ...group2.shapesIds];\r\n      GroupManager.deleteGroup(group2);\r\n    }\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    app.mainCanvasLayer.shapes.map((s) => {\r\n      const currentGroup = GroupManager.getShapeGroup(s);\r\n      if (currentGroup != null) {\r\n        new s.constructor({\r\n          ...s,\r\n          layer: 'upper',\r\n          path: s.getSVGPath('no scale', false, false),\r\n          fillOpacity: 0,\r\n          strokeColor: currentGroup.color,\r\n          strokeWidth: 3,\r\n          divisionPointInfos: s.divisionPoints.map((dp) => {\r\n            return {\r\n              coordinates: dp.coordinates,\r\n              ratio: dp.ratio,\r\n              segmentIdx: dp.segments[0].idx,\r\n              id: dp.id,\r\n              color: dp.color,\r\n            };\r\n          }),\r\n          pointsColor: s.points.map((pt) => {\r\n            return pt.color;\r\n          }),\r\n        });\r\n        console.info(s.getSVGPath('no scale', false, false));\r\n      }\r\n    });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Group\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Hide\\HideTool.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":72,"column":19,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":72,"endColumn":21,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1977,1979],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":99,"column":26,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":99,"endColumn":28,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2964,2966],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { html } from 'lit';\r\nimport { app, setState } from '../Core/App';\r\nimport { ShapeManager } from '../Core/Managers/ShapeManager';\r\nimport { Shape } from '../Core/Objects/Shapes/Shape';\r\nimport { SinglePointShape } from '../Core/Objects/Shapes/SinglePointShape';\r\nimport { Tool } from '../Core/States/Tool';\r\nimport { addInfoToId, findObjectById } from '../Core/Tools/general';\r\n\r\n/**\r\n * Cacher des objets.\r\n */\r\nexport class HideTool extends Tool {\r\n  constructor() {\r\n    super('hide', 'Cacher', 'tool');\r\n  }\r\n\r\n  getHelpText() {\r\n    const toolName = this.title;\r\n    return html`\r\n      <h3>${toolName}</h3>\r\n      <p>Vous avez s├®lectionn├® l'outil <b>\"${toolName}\"</b>.</p>\r\n    `;\r\n  }\r\n\r\n  start() {\r\n    setTimeout(\r\n      () =>\r\n        setState({\r\n          tool: { ...app.tool, name: this.name, currentStep: 'listen' },\r\n        }),\r\n      50,\r\n    );\r\n  }\r\n\r\n  listen() {\r\n    // this.showHidden();\r\n    this.removeListeners();\r\n\r\n    window.dispatchEvent(new CustomEvent('reset-selection-constraints'));\r\n    app.workspace.selectionConstraints.eventType = 'click';\r\n    app.workspace.selectionConstraints.shapes.canSelect = true;\r\n    app.workspace.selectionConstraints.points.canSelect = true;\r\n    app.workspace.selectionConstraints.points.types = ['divisionPoint'];\r\n    this.objectSelectedId = app.addListener('objectSelected', this.handler);\r\n  }\r\n\r\n  end() {\r\n    app.mainCanvasLayer.editingShapeIds = [];\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.removeListeners();\r\n  }\r\n\r\n  objectSelected(object) {\r\n    if (!object) return;\r\n\r\n    if (object instanceof Shape) {\r\n      this.mode = 'shape';\r\n      this.involvedShapes = ShapeManager.getAllBindedShapes(object);\r\n    } else {\r\n      // point\r\n      this.point = object;\r\n      this.mode = 'divisionPoint';\r\n    }\r\n\r\n    this.executeAction();\r\n    setState({\r\n      tool: { ...app.tool, name: this.name, currentStep: 'listen' },\r\n    });\r\n  }\r\n\r\n  _executeAction() {\r\n    if (this.mode == 'shape') {\r\n      const workingShapes = this.involvedShapes.map((s) =>\r\n        findObjectById(addInfoToId(s.id, 'main')),\r\n      );\r\n      workingShapes.forEach((s) => {\r\n        s.geometryObject.geometryIsHidden = true;\r\n      });\r\n      app.mainCanvasLayer.shapes.forEach((s) => {\r\n        if (s instanceof SinglePointShape) {\r\n          const child = findObjectById(\r\n            s.geometryObject.geometryPointOnTheFlyChildId,\r\n          );\r\n          if (child)\r\n            s.geometryObject.geometryIsHidden =\r\n              child.geometryObject.geometryIsHidden;\r\n        }\r\n      });\r\n      app.mainCanvasLayer.shapes.forEach((s) => {\r\n        if (s.geometryObject.geometryIsConstaintDraw) {\r\n          const child = findObjectById(\r\n            s.geometryObject.geometryChildShapeIds[0],\r\n          );\r\n          if (child)\r\n            s.geometryObject.geometryIsHidden =\r\n              child.geometryObject.geometryIsHidden;\r\n        }\r\n      });\r\n    } else if (this.mode == 'divisionPoint') {\r\n      this.point.geometryIsHidden = true;\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Hide\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Merge\\MergeTool.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":97,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":97,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2794,2796],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":127,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":127,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3838,3840],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":128,"column":29,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":128,"endColumn":31,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3893,3895],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":192,"column":19,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":192,"endColumn":21,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5874,5876],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":230,"column":20,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":230,"endColumn":22,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6894,6896],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":260,"column":33,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":260,"endColumn":35,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[7789,7791],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":289,"column":23,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":289,"endColumn":25,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8706,8708],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":485,"column":38,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":485,"endColumn":40,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[15513,15515],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":486,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":486,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[15561,15563],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":507,"column":21,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":507,"endColumn":23,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[16227,16229],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"prefer-const","severity":1,"message":"'radius' is never reassigned. Use 'const' instead.","line":526,"column":11,"nodeType":"Identifier","messageId":"useConst","endLine":526,"endColumn":17},{"ruleId":"prefer-const","severity":1,"message":"'firstAngle' is never reassigned. Use 'const' instead.","line":527,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":527,"endColumn":19}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { html } from 'lit';\r\nimport { app, setState } from '../Core/App';\r\nimport { ShapeManager } from '../Core/Managers/ShapeManager';\r\nimport { Segment } from '../Core/Objects/Segment';\r\nimport { Tool } from '../Core/States/Tool';\r\nimport { findObjectById, getAverageColor } from '../Core/Tools/general';\r\n\r\n/**\r\n * Fusionner 2 figures en une nouvelle figure\r\n */\r\nexport class MergeTool extends Tool {\r\n  constructor() {\r\n    super('merge', 'Fusionner', 'operation');\r\n\r\n    // listen-canvas-click -> selecting-second-shape\r\n    this.currentStep = null;\r\n\r\n    this.firstShape = null;\r\n\r\n    this.secondShape = null;\r\n  }\r\n\r\n  /**\r\n   * Renvoie l'aide ├á afficher ├á l'utilisateur\r\n   * @return {String} L'aide, en HTML\r\n   */\r\n  getHelpText() {\r\n    const toolName = this.title;\r\n    return html`\r\n      <h3>${toolName}</h3>\r\n      <p>\r\n        Vous avez s├®lectionn├® l'outil <b>\"${toolName}\"</b>. Cet outil permet de\r\n        fusionner deux figures ayant au moins un c├┤t├® commun en une seule\r\n        figure. Une nouvelle figure (le fruit de la fusion) est cr├®├®e, et les\r\n        deux figures d'origine restent intactes.<br />\r\n\r\n        Pour fusionner les deux figures, touchez la premi├¿re figure puis la\r\n        seconde.<br /><br />\r\n\r\n        <b>Note:</b> pour qu'une fusion entre deux figures soit possible, il\r\n        faut que les deux figures aient au moins un segment en commun (un c├┤t├®\r\n        entier, ou une partie d'un c├┤t├®). Il ne faut pas que les deux figures se\r\n        chevauchent pour que la fusion puisse ├¬tre r├®alis├®e.\r\n      </p>\r\n    `;\r\n  }\r\n\r\n  /**\r\n   * initialiser l'├®tat\r\n   */\r\n  start() {\r\n    setTimeout(\r\n      () =>\r\n        setState({\r\n          tool: { ...app.tool, name: this.name, currentStep: 'listen' },\r\n        }),\r\n      50,\r\n    );\r\n  }\r\n\r\n  listen() {\r\n    app.mainCanvasLayer.editingShapeIds = [];\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.stopAnimation();\r\n    this.removeListeners();\r\n\r\n    app.workspace.selectionConstraints =\r\n      app.fastSelectionConstraints.click_all_shape;\r\n    this.objectSelectedId = app.addListener('objectSelected', this.handler);\r\n  }\r\n\r\n  selectSecondShape() {\r\n    this.removeListeners();\r\n\r\n    app.workspace.selectionConstraints =\r\n      app.fastSelectionConstraints.click_all_shape;\r\n    this.objectSelectedId = app.addListener('objectSelected', this.handler);\r\n  }\r\n\r\n  /**\r\n   * stopper l'├®tat\r\n   */\r\n  end() {\r\n    app.mainCanvasLayer.editingShapeIds = [];\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.stopAnimation();\r\n    this.removeListeners();\r\n  }\r\n\r\n  /**\r\n   * Appel├®e par ├®v├®nement du SelectManager lorsqu'une figure a ├®t├® s├®lectionn├®e (onClick)\r\n   */\r\n  objectSelected(shape) {\r\n    if (!shape) return;\r\n\r\n    let mustExecuteAction = false;\r\n    if (app.tool.currentStep == 'listen') {\r\n      this.involvedShapes = ShapeManager.getAllBindedShapes(shape);\r\n      if (this.involvedShapes.length > 1) {\r\n        this.path = this.getPathFromGroup();\r\n        if (this.path) {\r\n          this.mode = 'multipleShapes';\r\n          mustExecuteAction = true;\r\n        } else {\r\n          window.dispatchEvent(\r\n            new CustomEvent('show-notif', {\r\n              detail: {\r\n                message: 'Le groupe ne peut pas ├¬tre fusionn├®.',\r\n              },\r\n            }),\r\n          );\r\n          return;\r\n        }\r\n      } else {\r\n        this.firstShapeId = shape.id;\r\n        app.mainCanvasLayer.editingShapeIds = [this.firstShapeId];\r\n        this.drawingShapes = new shape.constructor({\r\n          ...shape,\r\n          layer: 'upper',\r\n          path: shape.getSVGPath('no scale'),\r\n          id: undefined,\r\n          strokeColor: '#E90CC8',\r\n          strokeWidth: 3,\r\n        });\r\n        setState({ tool: { ...app.tool, currentStep: 'selectSecondShape' } });\r\n      }\r\n    } else if (app.tool.currentStep == 'selectSecondShape') {\r\n      if (this.firstShapeId == shape.id) {\r\n        // deselect firstShape\r\n        this.firstShapeId = null;\r\n        setState({ tool: { ...app.tool, currentStep: 'listen' } });\r\n      } else {\r\n        const group = ShapeManager.getAllBindedShapes(shape);\r\n        if (group.length > 1) {\r\n          const firstShape = findObjectById(this.firstShapeId);\r\n          this.involvedShapes = [...group, firstShape];\r\n          const path = this.getPathFromGroup();\r\n          if (path) {\r\n            this.mode = 'multipleShapes';\r\n            mustExecuteAction = true;\r\n          } else {\r\n            window.dispatchEvent(\r\n              new CustomEvent('show-notif', {\r\n                detail: {\r\n                  message: 'La figure ne peut pas ├¬tre fusionn├®e au groupe',\r\n                },\r\n              }),\r\n            );\r\n            return;\r\n          }\r\n        } else {\r\n          this.secondShapeId = shape.id;\r\n\r\n          const firstShape = findObjectById(this.firstShapeId);\r\n          const secondShape = findObjectById(this.secondShapeId);\r\n\r\n          if (firstShape.getCommonsCoordinates(secondShape).length < 2) {\r\n            window.dispatchEvent(\r\n              new CustomEvent('show-notif', {\r\n                detail: {\r\n                  message: \"Il n'y a pas de segment commun entre les figures.\",\r\n                },\r\n              }),\r\n            );\r\n            return;\r\n          }\r\n\r\n          if (firstShape.overlapsWith(secondShape)) {\r\n            window.dispatchEvent(\r\n              new CustomEvent('show-notif', {\r\n                detail: { message: 'Les figures se superposent.' },\r\n              }),\r\n            );\r\n            return;\r\n          }\r\n\r\n          this.mode = 'twoShapes';\r\n          mustExecuteAction = true;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (mustExecuteAction) {\r\n      this.executeAction();\r\n      setState({\r\n        tool: { ...app.tool, name: this.name, currentStep: 'listen' },\r\n      });\r\n    }\r\n  }\r\n\r\n  _executeAction() {\r\n    if (this.mode == 'twoShapes') {\r\n      const shape1 = ShapeManager.getShapeById(this.firstShapeId),\r\n        shape2 = ShapeManager.getShapeById(this.secondShapeId);\r\n\r\n      const newSegments = this.createNewSegments(shape1, shape2);\r\n\r\n      const path = this.linkNewSegments(newSegments);\r\n      if (!path) return this.alertDigShape();\r\n\r\n      this.createNewShape(path, shape1, shape2);\r\n    } else {\r\n      this.createNewShape(this.path, ...this.involvedShapes);\r\n    }\r\n  }\r\n\r\n  alertDigShape() {\r\n    window.dispatchEvent(\r\n      new CustomEvent('show-notif', {\r\n        detail: { message: 'La figure cr├®├®e est creuse' },\r\n      }),\r\n    );\r\n  }\r\n\r\n  getPathFromGroup() {\r\n    const segmentsList = this.checkGroupMerge(this.involvedShapes);\r\n\r\n    if (!segmentsList) return null;\r\n\r\n    const path = this.linkNewSegments(segmentsList);\r\n\r\n    return path;\r\n  }\r\n\r\n  checkGroupMerge(shapes) {\r\n    // check if a shape overlaps another one\r\n    if (\r\n      shapes.some((shape) =>\r\n        shapes.some((s) => {\r\n          if (s.id == shape.id) return false;\r\n          else return s.overlapsWith(shape);\r\n        }),\r\n      )\r\n    )\r\n      return null;\r\n\r\n    const oldSegments = shapes\r\n      .map((s) =>\r\n        s.segments.map((seg) => {\r\n          return new Segment({\r\n            layer: 'invisible',\r\n            createFromNothing: true,\r\n            vertexCoordinates: seg.vertexes.map((vx) => vx.coordinates),\r\n            divisionPointInfos: seg.divisionPoints.map((dp) => {\r\n              return {\r\n                coordinates: dp.coordinates,\r\n                ratio: dp.ratio,\r\n                color: dp.color,\r\n              };\r\n            }),\r\n            arcCenterCoordinates: seg.arcCenter?.coordinates,\r\n          });\r\n        }),\r\n      )\r\n      .flat();\r\n\r\n    const cutSegments = oldSegments\r\n      .map((segment, idx, segments) => {\r\n        const pointsInside = segments\r\n          .filter((seg, i) => i != idx)\r\n          .map((seg) =>\r\n            seg.points.filter((pt1) =>\r\n              segment.divisionPoints.some((pt2) =>\r\n                pt1.coordinates.equal(pt2.coordinates),\r\n              ),\r\n            ),\r\n          )\r\n          .flat()\r\n          .filter((pt, idx, pts) => {\r\n            for (let i = idx + 1; i < pts.length; i++) {\r\n              if (pts[i].coordinates.equal(pt.coordinates)) return false;\r\n            }\r\n            return true;\r\n          });\r\n        if (pointsInside.length) return segment.divideWith(pointsInside);\r\n        else return segment;\r\n      })\r\n      .flat();\r\n\r\n    // delete common segments\r\n    const newSegments = [];\r\n    cutSegments.forEach((seg, i, segments) => {\r\n      if (seg.used) {\r\n        return;\r\n      }\r\n      const segs = segments\r\n        .map((segment) => (segment.equal(seg) ? segment : undefined))\r\n        .filter(Boolean);\r\n      if (segs.length == 1) newSegments.push(seg);\r\n      else segs.forEach((seg) => (seg.used = true));\r\n    });\r\n\r\n    return newSegments;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @returns {Segment[]}  les segments temporaires (ni fusionn├®s ni ordonn├®s)\r\n   */\r\n  createNewSegments(shape1, shape2) {\r\n    const segments1 = shape1.segments.map((seg) => {\r\n      const segmentCopy = new Segment({\r\n        layer: 'invisible',\r\n        createFromNothing: true,\r\n        vertexCoordinates: seg.vertexes.map((v) => v.coordinates),\r\n        divisionPointInfos: seg.divisionPoints.map((dp) => {\r\n          return {\r\n            coordinates: dp.coordinates,\r\n            ratio: dp.ratio,\r\n            color: dp.color,\r\n          };\r\n        }),\r\n        arcCenterCoordinates: seg.arcCenter?.coordinates,\r\n        counterclockwise: seg.counterclockwise,\r\n      });\r\n      return segmentCopy;\r\n    });\r\n    const segments2 = shape2.segments.map((seg) => {\r\n      const segmentCopy = new Segment({\r\n        layer: 'invisible',\r\n        createFromNothing: true,\r\n        vertexCoordinates: seg.vertexes.map((v) => v.coordinates),\r\n        divisionPointInfos: seg.divisionPoints.map((dp) => {\r\n          return {\r\n            coordinates: dp.coordinates,\r\n            ratio: dp.ratio,\r\n            color: dp.color,\r\n          };\r\n        }),\r\n        arcCenterCoordinates: seg.arcCenter?.coordinates,\r\n        counterclockwise: seg.counterclockwise,\r\n      });\r\n      return segmentCopy;\r\n    });\r\n    segments1.forEach((seg) => seg.sortDivisionPoints());\r\n    segments2.forEach((seg) => seg.sortDivisionPoints());\r\n\r\n    for (let i = 0; i < segments1.length; i++) {\r\n      for (let j = 0; j < segments2.length; j++) {\r\n        const firstSegment = segments1[i];\r\n        const secondSegment = segments2[j];\r\n        if (firstSegment.isArc() || secondSegment.isArc()) {\r\n          continue;\r\n        }\r\n        if (\r\n          Math.abs(\r\n            firstSegment.getAngleWithHorizontal() -\r\n              secondSegment.getAngleWithHorizontal(),\r\n          ) > 0.01\r\n        ) {\r\n          secondSegment.reverse();\r\n        }\r\n        const commonCoordinates = this.getCommonCoordinates(\r\n          firstSegment,\r\n          secondSegment,\r\n        );\r\n        if (commonCoordinates) {\r\n          // si on veut faire la fusion d'un groupe\r\n          if (\r\n            !firstSegment.vertexes[0].coordinates.equal(commonCoordinates[0])\r\n          ) {\r\n            segments1.push(\r\n              new Segment({\r\n                layer: 'invisible',\r\n                createFromNothing: true,\r\n                vertexCoordinates: [\r\n                  firstSegment.vertexes[0].coordinates,\r\n                  commonCoordinates[0],\r\n                ],\r\n                arcCenterCoordinates: firstSegment.arcCenter?.coordinates,\r\n                counterclockwise: firstSegment.counterclockwise,\r\n              }),\r\n            );\r\n          }\r\n          if (\r\n            !firstSegment.vertexes[1].coordinates.equal(commonCoordinates[1])\r\n          ) {\r\n            segments1.push(\r\n              new Segment({\r\n                layer: 'invisible',\r\n                createFromNothing: true,\r\n                vertexCoordinates: [\r\n                  commonCoordinates[1],\r\n                  firstSegment.vertexes[1].coordinates,\r\n                ],\r\n                arcCenterCoordinates: firstSegment.arcCenter?.coordinates,\r\n                counterclockwise: firstSegment.counterclockwise,\r\n              }),\r\n            );\r\n          }\r\n          if (\r\n            !secondSegment.vertexes[0].coordinates.equal(commonCoordinates[0])\r\n          ) {\r\n            segments2.push(\r\n              new Segment({\r\n                layer: 'invisible',\r\n                createFromNothing: true,\r\n                vertexCoordinates: [\r\n                  secondSegment.vertexes[0].coordinates,\r\n                  commonCoordinates[0],\r\n                ],\r\n                arcCenterCoordinates: firstSegment.arcCenter?.coordinates,\r\n                counterclockwise: firstSegment.counterclockwise,\r\n              }),\r\n            );\r\n          }\r\n          if (\r\n            !secondSegment.vertexes[1].coordinates.equal(commonCoordinates[1])\r\n          ) {\r\n            segments2.push(\r\n              new Segment({\r\n                layer: 'invisible',\r\n                createFromNothing: true,\r\n                vertexCoordinates: [\r\n                  commonCoordinates[1],\r\n                  secondSegment.vertexes[1].coordinates,\r\n                ],\r\n                arcCenterCoordinates: firstSegment.arcCenter?.coordinates,\r\n                counterclockwise: firstSegment.counterclockwise,\r\n              }),\r\n            );\r\n          }\r\n          segments1.splice(i, 1);\r\n          segments2.splice(j, 1);\r\n          i = -1;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    const segments = [...segments1, ...segments2];\r\n    return segments;\r\n  }\r\n\r\n  getCommonCoordinates(firstSegment, secondSegment) {\r\n    if (firstSegment.isArc() || secondSegment.isArc()) return null;\r\n    let firstCommonCoordinates = null;\r\n    let secondCommonCoordinates = null;\r\n    [\r\n      firstSegment.vertexes[0],\r\n      ...firstSegment.divisionPoints,\r\n      firstSegment.vertexes[1],\r\n    ].forEach((pt1) => {\r\n      [\r\n        secondSegment.vertexes[0],\r\n        ...secondSegment.divisionPoints,\r\n        secondSegment.vertexes[1],\r\n      ].forEach((pt2) => {\r\n        if (pt1.coordinates.equal(pt2.coordinates)) {\r\n          if (firstCommonCoordinates == null) {\r\n            firstCommonCoordinates = pt1.coordinates;\r\n          } else {\r\n            secondCommonCoordinates = pt1.coordinates;\r\n          }\r\n        }\r\n      });\r\n    });\r\n    if (firstCommonCoordinates != null && secondCommonCoordinates != null)\r\n      return [firstCommonCoordinates, secondCommonCoordinates];\r\n    else return null;\r\n  }\r\n\r\n  /**\r\n   * Cr├®e les segments d├®finitifs de la figure fusionn├®e\r\n   * @param {Segment[]} segmentsList   les segments ├á modifier\r\n   * @returns {Segment[]}              les segments d├®finitifs\r\n   */\r\n  linkNewSegments(segmentsList) {\r\n    const startCoordinates = segmentsList[0].vertexes[0].coordinates;\r\n    let path = ['M', startCoordinates.x, startCoordinates.y];\r\n    let segmentUsed = 0;\r\n    const numberOfSegments = segmentsList.length;\r\n\r\n    let nextSegmentIndex = 0;\r\n    this.addPathElem(path, segmentsList[0]);\r\n    this.lastUsedCoordinates = segmentsList[0].vertexes[1].coordinates;\r\n    segmentsList.splice(nextSegmentIndex, 1);\r\n    segmentUsed++;\r\n\r\n    while (!this.lastUsedCoordinates.equal(startCoordinates)) {\r\n      const potentialSegmentIdx = segmentsList\r\n        .map((seg, idx) =>\r\n          seg.contains(this.lastUsedCoordinates, false) ? idx : undefined,\r\n        )\r\n        .filter((seg) => Number.isInteger(seg));\r\n      if (potentialSegmentIdx.length != 1) {\r\n        if (potentialSegmentIdx.length == 0)\r\n          console.info('shape cannot be closed (dead end)');\r\n        else\r\n          console.info(\r\n            'shape is dig (a segment has more than one segment for next)',\r\n          );\r\n        return null;\r\n      }\r\n      nextSegmentIndex = potentialSegmentIdx[0];\r\n      const nextSegment = segmentsList[nextSegmentIndex];\r\n      let mustReverse = false;\r\n      if (\r\n        !nextSegment.vertexes[0].coordinates.equal(this.lastUsedCoordinates)\r\n      ) {\r\n        mustReverse = true;\r\n      }\r\n      this.addPathElem(path, nextSegment, mustReverse);\r\n      segmentsList.splice(nextSegmentIndex, 1);\r\n      segmentUsed++;\r\n    }\r\n\r\n    if (segmentUsed != numberOfSegments) {\r\n      // si tous les segments n'ont pas ├®t├® utilis├®s, la figure cr├®├®e est creuse\r\n      console.info('shape is dig (not all segments have been used)');\r\n      return null;\r\n    }\r\n\r\n    path = path.join(' ');\r\n\r\n    return path;\r\n  }\r\n\r\n  addPathElem(path, segment, mustReverse) {\r\n    let firstCoord = segment.vertexes[0].coordinates;\r\n    let secondCoord = segment.vertexes[1].coordinates;\r\n    if (!segment.isArc()) {\r\n      if (mustReverse) [firstCoord, secondCoord] = [secondCoord, firstCoord];\r\n      path.push('L', secondCoord.x, secondCoord.y);\r\n    } else {\r\n      const centerCoordinates = segment.arcCenter.coordinates;\r\n      let radius = centerCoordinates.dist(secondCoord),\r\n        firstAngle = centerCoordinates.angleWith(firstCoord),\r\n        secondAngle = centerCoordinates.angleWith(secondCoord);\r\n\r\n      if (secondAngle < firstAngle) secondAngle += 2 * Math.PI;\r\n      let largeArcFlag = secondAngle - firstAngle > Math.PI ? 1 : 0,\r\n        sweepFlag = 1;\r\n      if (segment.counterclockwise) {\r\n        sweepFlag = Math.abs(sweepFlag - 1);\r\n        largeArcFlag = Math.abs(largeArcFlag - 1);\r\n      }\r\n\r\n      if (mustReverse) {\r\n        [firstCoord, secondCoord] = [secondCoord, firstCoord];\r\n        sweepFlag = Math.abs(sweepFlag - 1);\r\n      }\r\n\r\n      path.push(\r\n        'A',\r\n        radius,\r\n        radius,\r\n        0,\r\n        largeArcFlag,\r\n        sweepFlag,\r\n        secondCoord.x,\r\n        secondCoord.y,\r\n      );\r\n    }\r\n    this.lastUsedCoordinates = secondCoord;\r\n  }\r\n\r\n  /**\r\n   * cr├®e la figure fusionn├®e et l'ajoute au workspace\r\n   * @param {String} path\r\n   */\r\n  createNewShape(path, ...shapes) {\r\n    const newShape = new shapes[0].constructor({\r\n      layer: 'main',\r\n      path: path,\r\n      name: 'Custom',\r\n      familyName: 'Custom',\r\n      fillColor: getAverageColor(...shapes.map((s) => s.fillColor)),\r\n      strokeColor: getAverageColor(...shapes.map((s) => s.strokeColor)),\r\n      fillOpacity:\r\n        shapes.map((s) => s.fillOpacity).reduce((acc, value) => acc + value) /\r\n        shapes.length,\r\n      isBiface: shapes.some((s) => s.isBiface),\r\n      // isReversed: shapes.some((s) => s.isReversed),\r\n    });\r\n    newShape.cleanSameDirectionSegment();\r\n    newShape.translate({ x: -20, y: -20 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Merge\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Move\\MoveTool.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":97,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":97,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[2995,2997],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":101,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":101,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3171,3173],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":154,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":154,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[4991,4993],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":163,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":163,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5278,5280],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":165,"column":34,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":165,"endColumn":36,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5337,5339],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":166,"column":35,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":166,"endColumn":37,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5380,5382],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":266,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":266,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8767,8769],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'idxS' is defined but never used. Allowed unused args must match /^_/u.","line":275,"column":57,"nodeType":"Identifier","messageId":"unusedVar","endLine":275,"endColumn":61,"suggestions":[{"messageId":"removeVar","data":{"varName":"idxS"},"fix":{"range":[9154,9160],"text":""},"desc":"Remove unused variable 'idxS'."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { html } from 'lit';\r\nimport { app, setState } from '../Core/App';\r\nimport { ShapeManager } from '../Core/Managers/ShapeManager';\r\nimport { Coordinates } from '../Core/Objects/Coordinates';\r\nimport { SinglePointShape } from '../Core/Objects/Shapes/SinglePointShape';\r\nimport { Tool } from '../Core/States/Tool';\r\nimport { getShapeAdjustment } from '../Core/Tools/automatic_adjustment';\r\nimport { addInfoToId, findObjectById } from '../Core/Tools/general';\r\nimport {\r\n  compareIdBetweenLayers,\r\n  duplicateShape,\r\n} from '../Core/Tools/shapesTools';\r\nimport { getAllLinkedShapesInGeometry } from '../GeometryTools/general';\r\nimport {\r\n  computeAllShapeTransform,\r\n  computeConstructionSpec,\r\n} from '../GeometryTools/recomputeShape';\r\n\r\n/**\r\n * D├®placer une figure (ou un ensemble de figures li├®es) sur l'espace de travail\r\n */\r\nexport class MoveTool extends Tool {\r\n  constructor() {\r\n    super('move', 'Glisser', 'move');\r\n\r\n    // listen-canvas-click -> move\r\n    this.currentStep = null;\r\n\r\n    // La figure que l'on d├®place\r\n    this.selectedShape = null;\r\n\r\n    // Coordonn├®es de la souris lorsque le d├®placement a commenc├®\r\n    this.startClickCoordinates = null;\r\n\r\n    // L'ensemble des figures li├®es ├á la figure s├®lectionn├®e, y compris la figure elle-m├¬me\r\n    this.involvedShapes = [];\r\n  }\r\n\r\n  /**\r\n   * Renvoie l'aide ├á afficher ├á l'utilisateur\r\n   * @return {String} L'aide, en HTML\r\n   */\r\n  getHelpText() {\r\n    const toolName = this.title;\r\n    return html`\r\n      <h3>${toolName}</h3>\r\n      <p>\r\n        Vous avez s├®lectionn├® l'outil <b>\"${toolName}\"</b>.<br />\r\n        Pour d├®placer une figure, touchez la figure et glissez votre doigt sans\r\n        le relacher. Relachez ensuite votre doigt une fois que la figure est\r\n        correctement positionn├®e.\r\n      </p>\r\n    `;\r\n  }\r\n\r\n  start() {\r\n    setTimeout(\r\n      () =>\r\n        setState({\r\n          tool: { ...app.tool, name: this.name, currentStep: 'listen' },\r\n        }),\r\n      50,\r\n    );\r\n  }\r\n\r\n  listen() {\r\n    this.pointOnLineRatio = null;\r\n    this.lastAdjusment = null;\r\n    app.mainCanvasLayer.editingShapeIds = [];\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.stopAnimation();\r\n    this.removeListeners();\r\n\r\n    app.workspace.selectionConstraints =\r\n      app.fastSelectionConstraints.mousedown_all_shape;\r\n    app.workspace.selectionConstraints.shapes.blacklist =\r\n      app.mainCanvasLayer.shapes.filter((s) => s instanceof SinglePointShape);\r\n    this.objectSelectedId = app.addListener('objectSelected', this.handler);\r\n  }\r\n\r\n  move() {\r\n    this.removeListeners();\r\n    this.mouseUpId = app.addListener('canvasMouseUp', this.handler);\r\n  }\r\n\r\n  end() {\r\n    app.mainCanvasLayer.editingShapeIds = [];\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.stopAnimation();\r\n    this.removeListeners();\r\n  }\r\n\r\n  /**\r\n   * Appel├®e par ├®v├®nement du SelectManager lorsqu'une figure a ├®t├® s├®lectionn├®e (canvasMouseDown)\r\n   */\r\n  objectSelected(shape) {\r\n    if (app.tool.currentStep != 'listen') return;\r\n    if (!shape) return;\r\n    this.selectedShape = shape;\r\n    this.involvedShapes = ShapeManager.getAllBindedShapes(shape);\r\n    if (app.environment.name == 'Geometrie') {\r\n      this.involvedShapes = ShapeManager.getAllBindedShapesInGeometry(shape);\r\n      for (let i = 0; i < this.involvedShapes.length; i++) {\r\n        const currentShape = this.involvedShapes[i];\r\n        if (currentShape.geometryObject.geometryTransformationName != null) {\r\n          window.dispatchEvent(\r\n            new CustomEvent('show-notif', {\r\n              detail: {\r\n                message:\r\n                  'Les images issues de transfomation ne peuvent pas ├¬tre d├®plac├®es.',\r\n              },\r\n            }),\r\n          );\r\n          return;\r\n        }\r\n      }\r\n    }\r\n    this.shapesToCopy = [...this.involvedShapes];\r\n    this.shapesToCopy.forEach((s) => {\r\n      getAllLinkedShapesInGeometry(s, this.shapesToCopy, false);\r\n    });\r\n\r\n    this.startClickCoordinates = app.workspace.lastKnownMouseCoordinates;\r\n    this.lastKnownMouseCoordinates = this.startClickCoordinates;\r\n\r\n    this.shapesToCopy.sort(\r\n      (s1, s2) =>\r\n        ShapeManager.getShapeIndex(s1) - ShapeManager.getShapeIndex(s2),\r\n    );\r\n\r\n    this.drawingShapes = this.shapesToCopy.map((s) => duplicateShape(s));\r\n    this.shapesToMove = this.drawingShapes.filter((s) =>\r\n      this.involvedShapes.find((inShape) =>\r\n        compareIdBetweenLayers(inShape.id, s.id),\r\n      ),\r\n    );\r\n\r\n    app.mainCanvasLayer.editingShapeIds = this.shapesToCopy.map((s) => s.id);\r\n\r\n    app.upperCanvasLayer.shapes.forEach((s) => {\r\n      s.geometryObject?.geometryDuplicateChildShapeIds.forEach(\r\n        (duplicateChildId) => {\r\n          const duplicateChild = findObjectById(duplicateChildId);\r\n          computeConstructionSpec(duplicateChild);\r\n        },\r\n      );\r\n    });\r\n\r\n    setState({ tool: { ...app.tool, currentStep: 'move' } });\r\n    this.animate();\r\n  }\r\n\r\n  canvasMouseUp() {\r\n    if (app.tool.currentStep != 'move') return;\r\n    this.executeAction();\r\n    setState({ tool: { ...app.tool, name: this.name, currentStep: 'listen' } });\r\n  }\r\n\r\n  /**\r\n   * Appel├®e par la fonction de dessin, lorsqu'il faut dessiner l'action en cours\r\n   */\r\n  refreshStateUpper() {\r\n    if (app.tool.currentStep == 'move') {\r\n      if (\r\n        this.shapesToMove.length == 1 &&\r\n        this.shapesToMove[0].name == 'PointOnLine'\r\n      ) {\r\n        const s = this.shapesToMove[0];\r\n        const point = s.points[0];\r\n        const reference = findObjectById(\r\n          s.geometryObject.geometryParentObjectId1,\r\n        );\r\n        point.coordinates = reference.projectionOnSegment(\r\n          app.workspace.lastKnownMouseCoordinates,\r\n        );\r\n        const ratioX =\r\n          (point.coordinates.x - reference.vertexes[0].coordinates.x) /\r\n          (reference.vertexes[1].coordinates.x -\r\n            reference.vertexes[0].coordinates.x);\r\n        const ratioY =\r\n          (point.coordinates.x - reference.vertexes[0].coordinates.x) /\r\n          (reference.vertexes[1].coordinates.x -\r\n            reference.vertexes[0].coordinates.x);\r\n        let ratio = ratioX;\r\n        if (isNaN(ratio)) ratio = ratioY;\r\n\r\n        if (\r\n          ratio < 0 &&\r\n          !(\r\n            reference.shape.name.endsWith('StraightLine') &&\r\n            !reference.shape.name.endsWith('SeminStraightLine')\r\n          )\r\n        )\r\n          ratio = 0;\r\n        if (ratio > 1 && !reference.shape.name.endsWith('StraightLine'))\r\n          ratio = 1;\r\n        point.ratio = ratio;\r\n        this.pointOnLineRatio = ratio;\r\n\r\n        const firstPoint = reference.vertexes[0];\r\n        const secondPoint = reference.vertexes[1];\r\n\r\n        const segLength = secondPoint.coordinates.substract(\r\n          firstPoint.coordinates,\r\n        );\r\n        const part = segLength.multiply(point.ratio);\r\n\r\n        const coord = firstPoint.coordinates.add(part);\r\n        point.coordinates = coord;\r\n      } else {\r\n        const mainShape = findObjectById(\r\n          addInfoToId(this.selectedShape.id, 'upper'),\r\n        );\r\n        const translation = app.workspace.lastKnownMouseCoordinates.substract(\r\n          this.lastKnownMouseCoordinates,\r\n        );\r\n\r\n        this.shapesToMove.forEach((s) => {\r\n          if (this.lastAdjusment) {\r\n            s.translate(\r\n              Coordinates.nullCoordinates.substract(\r\n                this.lastAdjusment.translation,\r\n              ),\r\n            );\r\n            s.rotate(\r\n              this.lastAdjusment.rotationAngle * -1,\r\n              this.lastAdjusment.centerCoord,\r\n            );\r\n          }\r\n          s.translate(translation);\r\n        });\r\n\r\n        const adjustment = getShapeAdjustment(\r\n          this.shapesToMove,\r\n          mainShape,\r\n          app.mainCanvasLayer.editingShapeIds,\r\n        );\r\n        this.lastAdjusment = {\r\n          ...adjustment,\r\n          centerCoord: new Coordinates(mainShape.centerCoordinates),\r\n        };\r\n        this.shapesToMove.forEach((s) => {\r\n          s.rotate(adjustment.rotationAngle, this.lastAdjusment.centerCoord);\r\n          s.translate(adjustment.translation);\r\n        });\r\n        this.shapesToMove.forEach((s) => {\r\n          computeAllShapeTransform(s, 'upper', false);\r\n        });\r\n      }\r\n\r\n      this.lastKnownMouseCoordinates = app.workspace.lastKnownMouseCoordinates;\r\n    }\r\n  }\r\n\r\n  _executeAction() {\r\n    app.mainCanvasLayer.editingShapeIds.forEach((sId, idxS) => {\r\n      const s = findObjectById(sId);\r\n      s.points.forEach((pt, idxPt) => {\r\n        pt.coordinates = new Coordinates(\r\n          this.drawingShapes[idxS].points[idxPt].coordinates,\r\n        );\r\n        if (this.pointOnLineRatio) pt.ratio = this.pointOnLineRatio;\r\n      });\r\n    });\r\n\r\n    if (app.environment.name == 'Geometrie') {\r\n      app.mainCanvasLayer.shapes.forEach((s) => {\r\n        s.geometryObject?.geometryDuplicateChildShapeIds.forEach(\r\n          (duplicateChildId) => {\r\n            const duplicateChild = findObjectById(duplicateChildId);\r\n            computeConstructionSpec(duplicateChild);\r\n          },\r\n        );\r\n      });\r\n      app.mainCanvasLayer.editingShapeIds.forEach((sId, idxS) => {\r\n        const s = findObjectById(sId);\r\n        computeAllShapeTransform(s, 'main', false);\r\n      });\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Move\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Opacity\\OpacityTool.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":67,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":67,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[1747,1749],"text":"!=="},"desc":"Use '!==' instead of '!='."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { html } from 'lit';\r\nimport { app, setState } from '../Core/App';\r\nimport { ShapeManager } from '../Core/Managers/ShapeManager';\r\nimport { Tool } from '../Core/States/Tool';\r\nimport { createElem } from '../Core/Tools/general';\r\nimport './opacity-popup';\r\n\r\n/**\r\n * Modifier l'opacit├® d'une figure\r\n */\r\nexport class OpacityTool extends Tool {\r\n  constructor() {\r\n    super('opacity', 'Opacit├®', 'tool');\r\n\r\n    this.currentStep = null; // choose-opacity -> listen-canvas-click\r\n\r\n    this.opacity = 0.7;\r\n  }\r\n\r\n  /**\r\n   * Renvoie l'aide ├á afficher ├á l'utilisateur\r\n   * @return {String} L'aide, en HTML\r\n   */\r\n  getHelpText() {\r\n    const toolName = this.title;\r\n    return html`\r\n      <h3>${toolName}</h3>\r\n      <p>\r\n        Vous avez s├®lectionn├® l'outil <b>\"${toolName}\"</b>. Cet outil permet de\r\n        d├®finir pour chaque figure si elle est transparente, semi-transparente\r\n        ou compl├¿tement opaque.<br />\r\n        Apr├¿s avoir choisit l'une de ces 3 options dans le menu, touchez une\r\n        figure pour lui appliquer la modification.\r\n      </p>\r\n    `;\r\n  }\r\n\r\n  /**\r\n   * initialiser l'├®tat\r\n   */\r\n  start() {\r\n    this.removeListeners();\r\n\r\n    createElem('opacity-popup');\r\n  }\r\n\r\n  selectObject() {\r\n    this.removeListeners();\r\n\r\n    app.workspace.selectionConstraints =\r\n      app.fastSelectionConstraints.click_all_shape;\r\n    this.objectSelectedId = app.addListener('objectSelected', this.handler);\r\n  }\r\n\r\n  /**\r\n   * stopper l'├®tat\r\n   */\r\n  end() {\r\n    this.removeListeners();\r\n  }\r\n\r\n  /**\r\n   * Appel├®e par ├®v├®nement du SelectManager lorsqu'une figure a ├®t├® s├®lectionn├®e (click)\r\n   * @param  {Shape} shape            La figure s├®lectionn├®e\r\n   */\r\n  objectSelected(shape) {\r\n    if (app.tool.currentStep != 'selectObject') return;\r\n\r\n    this.involvedShapes = ShapeManager.getAllBindedShapes(shape);\r\n\r\n    this.executeAction();\r\n    setState({\r\n      tool: { ...app.tool, name: this.name, currentStep: 'selectObject' },\r\n    });\r\n  }\r\n\r\n  _executeAction() {\r\n    this.involvedShapes.forEach((s) => {\r\n      s.fillOpacity = app.settings.shapeOpacity;\r\n    });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Opacity\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Opacity\\opacity-popup.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":53,"column":59,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":53,"endColumn":61,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1343,1345],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":56,"column":61,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":56,"endColumn":63,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1467,1469],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":59,"column":59,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":59,"endColumn":61,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1596,1598],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import '@components/color-button';\r\nimport { TemplatePopup } from '@components/popups/template-popup';\r\nimport { css, html, LitElement } from 'lit';\r\nimport { app, setState } from '../Core/App';\r\n\r\nclass OpacityPopup extends LitElement {\r\n  constructor() {\r\n    super();\r\n\r\n    window.addEventListener(\r\n      'close-popup',\r\n      () => {\r\n        this.submitAndClose();\r\n      },\r\n      {\r\n        once: true,\r\n      },\r\n    );\r\n\r\n    this.updateProperties = () => {\r\n      this.opacity = app.settings.shapeOpacity;\r\n    };\r\n    this.updateProperties();\r\n\r\n    this.eventHandler = () => {\r\n      this.updateProperties();\r\n    };\r\n    window.addEventListener('settings-changed', this.eventHandler);\r\n  }\r\n\r\n  static get properties() {\r\n    return {\r\n      opacity: Number,\r\n    };\r\n  }\r\n\r\n  static get styles() {\r\n    return [TemplatePopup.template_popup_styles(), css``];\r\n  }\r\n\r\n  render() {\r\n    return html`\r\n      <template-popup>\r\n        <h2 slot=\"title\">Opacit├®</h2>\r\n        <div slot=\"body\" id=\"body\">\r\n          <div class=\"field\">\r\n            <label for=\"opacity_popup_select\">Rendre une figure</label>\r\n            <select\r\n              name=\"opacity_popup_select\"\r\n              id=\"opacity_popup_select\"\r\n              @change=\"${this.changeOpacity}\"\r\n            >\r\n              <option value=\"0\" ?selected=\"${this.opacity == 0}\">\r\n                transparente\r\n              </option>\r\n              <option value=\"0.7\" ?selected=\"${this.opacity == 0.7}\">\r\n                semi-transparente\r\n              </option>\r\n              <option value=\"1\" ?selected=\"${this.opacity == 1}\">opaque</option>\r\n            </select>\r\n          </div>\r\n        </div>\r\n\r\n        <div slot=\"footer\">\r\n          <color-button\r\n            @click=\"${() =>\r\n              window.dispatchEvent(new CustomEvent('close-popup'))}\"\r\n            innerText=\"Ok\"\r\n          ></color-button>\r\n        </div>\r\n      </template-popup>\r\n    `;\r\n  }\r\n\r\n  changeOpacity(event) {\r\n    const shapeOpacity = parseFloat(event.target.value);\r\n    setState({\r\n      settings: { ...app.settings, shapeOpacity },\r\n    });\r\n  }\r\n\r\n  submit() {\r\n    setState({\r\n      tool: { ...app.tool, name: 'opacity', currentStep: 'selectObject' },\r\n    });\r\n  }\r\n\r\n  close() {\r\n    this.remove();\r\n    window.removeEventListener('settings-changed', this.eventHandler);\r\n  }\r\n\r\n  submitAndClose() {\r\n    this.submit();\r\n    this.close();\r\n  }\r\n}\r\ncustomElements.define('opacity-popup', OpacityPopup);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\OrthogonalSymetry\\OrthogonalSymetryTool.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":66,"column":33,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":66,"endColumn":35,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1998,2000],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":137,"column":33,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":137,"endColumn":35,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4082,4084],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":145,"column":26,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":145,"endColumn":28,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4586,4588],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":149,"column":48,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":149,"endColumn":50,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4807,4809],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":251,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":251,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7996,7998],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":312,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":312,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[9925,9927],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":318,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":318,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[10171,10173],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":326,"column":27,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":326,"endColumn":29,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[10460,10462],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":341,"column":44,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":341,"endColumn":46,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[11067,11069],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":355,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":355,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[11477,11479],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":367,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":367,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[11950,11952],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":375,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":375,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[12294,12296],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":387,"column":42,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":387,"endColumn":44,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[12680,12682],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":390,"column":27,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":390,"endColumn":29,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[12848,12850],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":506,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":506,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[17002,17004],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":15,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app, setState } from '../Core/App';\r\nimport { GroupManager } from '../Core/Managers/GroupManager';\r\nimport { SelectManager } from '../Core/Managers/SelectManager';\r\nimport { ShapeManager } from '../Core/Managers/ShapeManager';\r\nimport { CharacteristicElements } from '../Core/Objects/CharacteristicElements';\r\nimport { Coordinates } from '../Core/Objects/Coordinates';\r\nimport { Point } from '../Core/Objects/Point';\r\nimport { Segment } from '../Core/Objects/Segment';\r\nimport { ShapeGroup } from '../Core/Objects/ShapeGroup';\r\nimport { GeometryObject } from '../Core/Objects/Shapes/GeometryObject';\r\nimport { LineShape } from '../Core/Objects/Shapes/LineShape';\r\nimport { SinglePointShape } from '../Core/Objects/Shapes/SinglePointShape';\r\nimport { Tool } from '../Core/States/Tool';\r\nimport { findObjectById, removeObjectById } from '../Core/Tools/general';\r\n\r\nexport class OrthogonalSymetryTool extends Tool {\r\n  constructor() {\r\n    super('orthogonalSymetry', 'Sym├®trie orthogonale', 'transformation');\r\n  }\r\n\r\n  start() {\r\n    this.removeListeners();\r\n    this.duration = app.settings.geometryTransformationAnimation\r\n      ? app.settings.geometryTransformationAnimationDuration\r\n      : 0.001;\r\n\r\n    setTimeout(\r\n      () =>\r\n        setState({\r\n          tool: {\r\n            ...app.tool,\r\n            name: this.name,\r\n            currentStep: 'selectFirstReference',\r\n          },\r\n        }),\r\n      50,\r\n    );\r\n  }\r\n\r\n  selectFirstReference() {\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.stopAnimation();\r\n    this.removeListeners();\r\n\r\n    this.showLastCharacteristicElements();\r\n\r\n    this.pointsDrawn = [];\r\n    this.characteristicElements = null;\r\n\r\n    setTimeout(\r\n      () =>\r\n        setState({\r\n          tool: {\r\n            ...app.tool,\r\n            name: this.name,\r\n            currentStep: 'selectReference',\r\n          },\r\n        }),\r\n      50,\r\n    );\r\n  }\r\n\r\n  selectReference() {\r\n    this.removeListeners();\r\n\r\n    if (this.pointsDrawn.length == 1) {\r\n      const shapesToDelete = [];\r\n      app.upperCanvasLayer.shapes.forEach((s) => {\r\n        if (s.geometryObject?.geometryIsCharacteristicElements)\r\n          shapesToDelete.push(s);\r\n      });\r\n      shapesToDelete.forEach((s) => removeObjectById(s.id));\r\n    }\r\n\r\n    // this.setSelectionConstraints();\r\n    this.mouseDownId = app.addListener('canvasMouseDown', this.handler);\r\n  }\r\n\r\n  animateFirstRefPoint() {\r\n    this.removeListeners();\r\n\r\n    window.dispatchEvent(new CustomEvent('reset-selection-constraints'));\r\n    app.workspace.selectionConstraints.eventType = 'click';\r\n    app.workspace.selectionConstraints.points.canSelect = true;\r\n    this.animate();\r\n    this.mouseUpId = app.addListener('canvasMouseUp', this.handler);\r\n  }\r\n\r\n  animateSecondRefPoint() {\r\n    this.removeListeners();\r\n\r\n    window.dispatchEvent(new CustomEvent('reset-selection-constraints'));\r\n    app.workspace.selectionConstraints.eventType = 'click';\r\n    app.workspace.selectionConstraints.points.canSelect = true;\r\n    this.animate();\r\n    this.mouseUpId = app.addListener('canvasMouseUp', this.handler);\r\n  }\r\n\r\n  selectObject() {\r\n    this.removeListeners();\r\n\r\n    if (this.drawingShapes)\r\n      this.drawingShapes.forEach((s) => {\r\n        removeObjectById(s.id);\r\n      });\r\n\r\n    const shapesToDelete = [];\r\n    app.upperCanvasLayer.shapes.forEach((s) => {\r\n      if (s.geometryObject?.geometryIsCharacteristicElements)\r\n        shapesToDelete.push(s);\r\n    });\r\n    shapesToDelete.forEach((s) => removeObjectById(s.id));\r\n\r\n    this.setSelectionConstraints();\r\n    this.objectSelectedId = app.addListener('objectSelected', this.handler);\r\n  }\r\n\r\n  ortho() {\r\n    this.removeListeners();\r\n\r\n    this.startTime = Date.now();\r\n    this.animate();\r\n  }\r\n\r\n  end() {\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.stopAnimation();\r\n    this.removeListeners();\r\n  }\r\n\r\n  get referenceShape() {\r\n    return findObjectById(app.tool.referenceShapeId);\r\n  }\r\n\r\n  canvasMouseDown() {\r\n    const coord = app.workspace.lastKnownMouseCoordinates;\r\n    if (this.pointsDrawn.length == 0) {\r\n      window.dispatchEvent(new CustomEvent('reset-selection-constraints'));\r\n      app.workspace.selectionConstraints.eventType = 'click';\r\n      app.workspace.selectionConstraints.segments.canSelect = true;\r\n      app.workspace.selectionConstraints.segments.canSelectFromUpper = true;\r\n      app.workspace.selectionConstraints.points.canSelect = true;\r\n      const object = SelectManager.selectObject(coord);\r\n      if (object instanceof Segment && !object.isArc()) {\r\n        if (object.layer == 'upper') {\r\n          this.characteristicElements =\r\n            object.shape.geometryObject.geometryTransformationCharacteristicElements;\r\n          let referenceShape;\r\n          if (this.characteristicElements.type == 'axis') {\r\n            referenceShape = new LineShape({\r\n              path: this.characteristicElements.firstElement.getSVGPath(\r\n                'no scale',\r\n                true,\r\n              ),\r\n              layer: 'upper',\r\n              strokeColor: app.settings.referenceDrawColor,\r\n              strokeWidth: 2,\r\n            });\r\n          } else {\r\n            const firstPoint = this.characteristicElements.firstElement;\r\n            const secondPoint = this.characteristicElements.secondElement;\r\n            referenceShape = new LineShape({\r\n              path: `M ${firstPoint.coordinates.x} ${firstPoint.coordinates.y} L ${secondPoint.coordinates.x} ${secondPoint.coordinates.y}`,\r\n              layer: 'upper',\r\n              strokeColor: app.settings.referenceDrawColor,\r\n              strokeWidth: 2,\r\n            });\r\n          }\r\n          referenceShape.segments[0].isInfinite = true;\r\n          setState({\r\n            tool: {\r\n              ...app.tool,\r\n              name: this.name,\r\n              currentStep: 'selectObject',\r\n              referenceShapeId: referenceShape.id,\r\n            },\r\n          });\r\n        } else {\r\n          this.characteristicElements = new CharacteristicElements({\r\n            type: 'axis',\r\n            elementIds: [object.id],\r\n          });\r\n          const referenceShape = new LineShape({\r\n            path: object.getSVGPath('no scale', true),\r\n            layer: 'upper',\r\n            strokeColor: app.settings.referenceDrawColor,\r\n            strokeWidth: 2,\r\n          });\r\n          referenceShape.segments[0].isInfinite = true;\r\n          setState({\r\n            tool: {\r\n              ...app.tool,\r\n              name: this.name,\r\n              currentStep: 'selectObject',\r\n              referenceShapeId: referenceShape.id,\r\n            },\r\n          });\r\n        }\r\n      } else {\r\n        this.pointsDrawn.push(\r\n          new Point({\r\n            coordinates: coord,\r\n            layer: 'upper',\r\n            color: app.settings.referenceDrawColor,\r\n            size: 2,\r\n          }),\r\n        );\r\n        setState({\r\n          tool: {\r\n            ...app.tool,\r\n            name: this.name,\r\n            currentStep: 'animateFirstRefPoint',\r\n          },\r\n        });\r\n      }\r\n    } else {\r\n      this.pointsDrawn.push(\r\n        new Point({\r\n          coordinates: coord,\r\n          layer: 'upper',\r\n          color: app.settings.referenceDrawColor,\r\n          size: 2,\r\n        }),\r\n      );\r\n      const segment = new Segment({\r\n        layer: 'upper',\r\n        vertexIds: this.pointsDrawn.map((pt) => pt.id),\r\n        isInfinite: true,\r\n      });\r\n      const referenceShape = new LineShape({\r\n        layer: 'upper',\r\n        segmentIds: [segment.id],\r\n        pointIds: this.pointsDrawn.map((pt) => pt.id),\r\n        strokeColor: app.settings.referenceDrawColor,\r\n        strokeWidth: 2,\r\n      });\r\n      setState({\r\n        tool: {\r\n          ...app.tool,\r\n          name: this.name,\r\n          currentStep: 'animateSecondRefPoint',\r\n          referenceShapeId: referenceShape.id,\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  canvasMouseUp() {\r\n    this.stopAnimation();\r\n\r\n    if (app.tool.currentStep == 'animateFirstRefPoint') {\r\n      const coord = app.workspace.lastKnownMouseCoordinates;\r\n      const object = SelectManager.selectObject(coord);\r\n      if (object) {\r\n        this.firstReference = object;\r\n      } else {\r\n        this.firstReference = this.pointsDrawn[0];\r\n      }\r\n      this.characteristicElements = new CharacteristicElements({\r\n        type: 'two-points',\r\n        elementIds: [this.firstReference.id],\r\n      });\r\n      setState({\r\n        tool: { ...app.tool, name: this.name, currentStep: 'selectReference' },\r\n      });\r\n    } else {\r\n      const coord = app.workspace.lastKnownMouseCoordinates;\r\n      const object = SelectManager.selectObject(coord);\r\n      if (object) {\r\n        this.secondReference = object;\r\n      } else {\r\n        this.secondReference = this.pointsDrawn[1];\r\n      }\r\n      this.characteristicElements.elementIds.push(this.secondReference.id);\r\n      setState({\r\n        tool: { ...app.tool, name: this.name, currentStep: 'selectObject' },\r\n      });\r\n    }\r\n  }\r\n\r\n  objectSelected(object) {\r\n    if (!object) return;\r\n\r\n    this.involvedShapes = ShapeManager.getAllBindedShapes(object);\r\n    this.drawingShapes = this.involvedShapes.map(\r\n      (s) =>\r\n        new s.constructor({\r\n          ...s,\r\n          layer: 'upper',\r\n          path: s.getSVGPath('no scale', false),\r\n          id: undefined,\r\n          // divisionPointInfos: s.divisionPoints.map((dp) => {\r\n          //   return { coordinates: dp.coordinates, ratio: dp.ratio, segmentIdx: dp.segments[0].idx, color: dp.color };\r\n          // }),\r\n          segmentsColor: s.segments.map((seg) => {\r\n            return seg.color;\r\n          }),\r\n          pointsColor: s.vertexes.map((pt) => {\r\n            return pt.color;\r\n          }),\r\n        }),\r\n    );\r\n    setState({\r\n      tool: {\r\n        ...app.tool,\r\n        currentStep: 'ortho',\r\n      },\r\n    });\r\n  }\r\n\r\n  animate() {\r\n    if (app.tool.currentStep == 'animateFirstRefPoint') {\r\n      window.dispatchEvent(new CustomEvent('refreshUpper'));\r\n      this.requestAnimFrameId = window.requestAnimationFrame(() =>\r\n        this.animate(),\r\n      );\r\n      return;\r\n    } else if (app.tool.currentStep == 'animateSecondRefPoint') {\r\n      window.dispatchEvent(new CustomEvent('refreshUpper'));\r\n      this.requestAnimFrameId = window.requestAnimationFrame(() =>\r\n        this.animate(),\r\n      );\r\n      return;\r\n    }\r\n    this.lastProgress = this.progress || 0;\r\n    if (this.lastProgress == 0) {\r\n      this.drawingShapes.forEach((s) =>\r\n        s.points.forEach((point) => {\r\n          const center = this.referenceShape.segments[0].projectionOnSegment(\r\n            point.coordinates,\r\n          );\r\n          point.startCoordinates = new Coordinates(point.coordinates);\r\n          point.endCoordinates = new Coordinates({\r\n            x: point.x + 2 * (center.x - point.x),\r\n            y: point.y + 2 * (center.y - point.y),\r\n          });\r\n        }),\r\n      );\r\n    }\r\n    this.progress = (Date.now() - this.startTime) / (this.duration * 1000);\r\n    if (this.progress > 1 && app.tool.name == 'orthogonalSymetry') {\r\n      this.executeAction();\r\n      setState({\r\n        tool: { ...app.tool, name: this.name, currentStep: 'selectObject' },\r\n      });\r\n    } else {\r\n      window.dispatchEvent(new CustomEvent('refreshUpper'));\r\n      this.requestAnimFrameId = window.requestAnimationFrame(() =>\r\n        this.animate(),\r\n      );\r\n    }\r\n  }\r\n\r\n  refreshStateUpper() {\r\n    if (app.tool.currentStep == 'ortho') {\r\n      const progressInAnimation =\r\n        Math.cos(Math.PI * (1 - this.progress)) / 2 + 0.5;\r\n      app.upperCanvasLayer.points.forEach((point) => {\r\n        if (point.startCoordinates) {\r\n          point.coordinates = point.startCoordinates.substract(\r\n            point.startCoordinates\r\n              .substract(point.endCoordinates)\r\n              .multiply(progressInAnimation),\r\n          );\r\n        }\r\n      });\r\n    } else if (app.tool.currentStep == 'animateFirstRefPoint') {\r\n      const coord = app.workspace.lastKnownMouseCoordinates;\r\n      const object = SelectManager.selectObject(coord);\r\n      if (object) {\r\n        this.pointsDrawn[0].coordinates = object.coordinates;\r\n      } else {\r\n        this.pointsDrawn[0].coordinates = coord;\r\n      }\r\n    } else if (app.tool.currentStep == 'animateSecondRefPoint') {\r\n      const coord = app.workspace.lastKnownMouseCoordinates;\r\n      const object = SelectManager.selectObject(coord);\r\n      if (object) {\r\n        this.pointsDrawn[1].coordinates = object.coordinates;\r\n      } else {\r\n        this.pointsDrawn[1].coordinates = coord;\r\n      }\r\n    }\r\n  }\r\n\r\n  _executeAction() {\r\n    if (this.characteristicElements.type == 'two-points') {\r\n      this.characteristicElements.elementIds.forEach((elemId, idx) => {\r\n        const element = findObjectById(elemId);\r\n        if (element.layer == 'upper') {\r\n          this.characteristicElements.elementIds[idx] = new SinglePointShape({\r\n            layer: 'main',\r\n            path: `M ${element.coordinates.x} ${element.coordinates.y}`,\r\n            name: 'Point',\r\n            familyName: 'Point',\r\n            geometryObject: new GeometryObject({}),\r\n          }).points[0].id;\r\n        }\r\n      });\r\n    }\r\n\r\n    if (\r\n      !app.workspace.orthogonalSymetryLastCharacteristicElements.find(\r\n        (elements) => this.characteristicElements.equal(elements),\r\n      )\r\n    ) {\r\n      app.workspace.orthogonalSymetryLastCharacteristicElements.push(\r\n        this.characteristicElements,\r\n      );\r\n    }\r\n\r\n    const selectedAxis = this.referenceShape.segments[0];\r\n\r\n    const newShapes = this.involvedShapes.map((s) => {\r\n      const newShape = new s.constructor({\r\n        ...s,\r\n        layer: 'main',\r\n        id: undefined,\r\n        familyName: 'transformation',\r\n        path: s.getSVGPath('no scale', false),\r\n        // divisionPointInfos: s.divisionPoints.map((dp) => {\r\n        //   return { coordinates: dp.coordinates, ratio: dp.ratio, segmentIdx: dp.segments[0].idx, color: dp.color };\r\n        // }),\r\n        segmentsColor: s.segments.map((seg) => {\r\n          return seg.color;\r\n        }),\r\n        pointsColor: s.vertexes.map((pt) => {\r\n          return pt.color;\r\n        }),\r\n        geometryObject: new GeometryObject({\r\n          geometryTransformationChildShapeIds: [],\r\n          geometryTransformationParentShapeId: s.id,\r\n          geometryTransformationCharacteristicElements:\r\n            this.characteristicElements,\r\n          geometryTransformationName: 'orthogonalSymetry',\r\n          geometryIsVisible: s.geometryObject.geometryIsVisible,\r\n          geometryIsHidden: s.geometryObject.geometryIsHidden,\r\n          geometryIsConstaintDraw: s.geometryObject.geometryIsConstaintDraw,\r\n        }),\r\n      });\r\n\r\n      s.geometryObject.geometryTransformationChildShapeIds.push(newShape.id);\r\n      newShape.geometryObject.geometryTransformationCharacteristicElements.elementIds.forEach(\r\n        (refId) => {\r\n          const ref = findObjectById(refId);\r\n          if (\r\n            !ref.shape.geometryObject.geometryTransformationChildShapeIds.includes(\r\n              newShape.id,\r\n            )\r\n          ) {\r\n            ref.shape.geometryObject.geometryTransformationChildShapeIds.push(\r\n              newShape.id,\r\n            );\r\n          }\r\n        },\r\n      );\r\n      this.reverseShape(newShape, selectedAxis);\r\n      newShape.points.forEach((pt, idx) => {\r\n        pt.geometryIsVisible = s.points[idx].geometryIsVisible;\r\n        pt.geometryIsHidden = s.points[idx].geometryIsHidden;\r\n      });\r\n      return newShape;\r\n    });\r\n\r\n    if (newShapes.length > 1) {\r\n      const userGroup = new ShapeGroup(0, 1);\r\n      userGroup.shapesIds = newShapes.map((s) => s.id);\r\n      GroupManager.addGroup(userGroup);\r\n    }\r\n  }\r\n\r\n  reverseShape(shape, selectedAxis) {\r\n    shape.reverse();\r\n\r\n    shape.points.forEach((pt) => {\r\n      this.computePointPosition(pt, selectedAxis);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Calcule les nouvelles coordonn├®es d'un point lors de l'animation d'une sym├®trie axiale\r\n   * @param  {Point} point    le point\r\n   * @param  {Object} axe      L'axe de sym├®trie\r\n   * @return {Point}          Nouvelles coordonn├®es\r\n   */\r\n  computePointPosition(point, selectedAxis) {\r\n    const center = selectedAxis.projectionOnSegment(point);\r\n\r\n    //Calculer la nouvelle position du point ├á partir de l'ancienne et de la projection.\r\n    point.coordinates = point.coordinates.add(\r\n      center.substract(point.coordinates).multiply(2),\r\n    );\r\n  }\r\n\r\n  setSelectionConstraints() {\r\n    const constraints = app.fastSelectionConstraints.mousedown_all_shape;\r\n    constraints.shapes.blacklist = app.mainCanvasLayer.shapes.filter(\r\n      (s) => s.geometryObject.geometryPointOnTheFlyChildId,\r\n    );\r\n    app.workspace.selectionConstraints = constraints;\r\n  }\r\n\r\n  showLastCharacteristicElements() {\r\n    app.workspace.orthogonalSymetryLastCharacteristicElements.forEach(\r\n      (characteristicElement) => {\r\n        if (characteristicElement.type == 'axis') {\r\n          const axis = findObjectById(characteristicElement.elementIds[0]);\r\n          const coordinates = [\r\n            axis.points[0].coordinates,\r\n            axis.points[1].coordinates,\r\n          ];\r\n          const shape = new LineShape({\r\n            layer: 'upper',\r\n            path: `M ${coordinates[0].x} ${coordinates[0].y} L ${coordinates[1].x} ${coordinates[1].y}`,\r\n            name: 'StraightLine',\r\n            familyName: 'Line',\r\n            strokeColor: app.settings.referenceDrawColor2,\r\n            strokeWidth: 2,\r\n            geometryObject: new GeometryObject({\r\n              geometryIsCharacteristicElements: true,\r\n              geometryTransformationCharacteristicElements:\r\n                characteristicElement,\r\n            }),\r\n          });\r\n          shape.segments[0].isInfinite = true;\r\n        } else {\r\n          const firstPoint = findObjectById(\r\n            characteristicElement.elementIds[0],\r\n          );\r\n          const secondPoint = findObjectById(\r\n            characteristicElement.elementIds[1],\r\n          );\r\n\r\n          const shape = new LineShape({\r\n            layer: 'upper',\r\n            path: `M ${firstPoint.coordinates.x} ${firstPoint.coordinates.y} L ${secondPoint.coordinates.x} ${secondPoint.coordinates.y}`,\r\n            name: 'StraightLine',\r\n            familyName: 'Line',\r\n            strokeColor: app.settings.referenceDrawColor2,\r\n            strokeWidth: 2,\r\n            geometryObject: new GeometryObject({\r\n              geometryIsCharacteristicElements: true,\r\n              geometryTransformationCharacteristicElements:\r\n                characteristicElement,\r\n            }),\r\n          });\r\n          shape.points[0].color = app.settings.referenceDrawColor2;\r\n          shape.points[0].size = 2;\r\n          shape.points[1].color = app.settings.referenceDrawColor2;\r\n          shape.points[1].size = 2;\r\n        }\r\n      },\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\OrthogonalSymetry\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\OrthogonalSymetry\\select-menu.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'SelectMenu' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":17,"suggestions":[{"messageId":"removeVar","data":{"varName":"SelectMenu"},"fix":{"range":[204,1430],"text":""},"desc":"Remove unused variable 'SelectMenu'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SelectMenu' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import '@components/color-button';\nimport { css, html, LitElement } from 'lit';\nimport { customElement } from 'lit/decorators.js';\nimport { TemplatePopup } from '../../components/popups/template-popup';\n\n@customElement('select-menu')\nclass SelectMenu extends LitElement {\n  constructor() {\n    super();\n\n    window.addEventListener('close-popup', () => this.close());\n  }\n\n  static get properties() {\n    return {\n      potentialShapes: { type: Array },\n    };\n  }\n\n  static get styles() {\n    return [\n      TemplatePopup.template_popup_styles(),\n      css`\n        p {\n          text-align: center;\n        }\n\n        [slot='body'] {\n          padding: 0;\n        }\n\n        [slot='footer'] {\n          padding-top: 16px;\n        }\n      `,\n    ];\n  }\n\n  render() {\n    return html`\n      <template-popup>\n        <h2 slot=\"title\">${'Figure'}</h2>\n        <div slot=\"body\" id=\"body\">\n          ${this.potentialShapes.map(\n            (s) => html`\n              <color-button @click=\"${this.clickHandler}\" innerText=\"${s.id}\">\n              </color-button>\n            `,\n          )}\n        </div>\n      </template-popup>\n    `;\n  }\n\n  clickHandler(e) {\n    const shapeId = e.target.innerText;\n    window.dispatchEvent(\n      new CustomEvent('shapeSelected', { detail: { shapeId } }),\n    );\n    this.close();\n  }\n\n  close() {\n    window.dispatchEvent(new CustomEvent('shapeSelected', { detail: {} }));\n    this.remove();\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\ResetPosition\\ResetPositionTool.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\ResetPosition\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Reverse\\ReverseTool.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":180,"column":29,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":180,"endColumn":31,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5504,5506],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":181,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":181,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5549,5551],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":187,"column":32,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":187,"endColumn":34,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5757,5759],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":203,"column":39,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":203,"endColumn":41,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6433,6435],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":232,"column":28,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":232,"endColumn":30,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7323,7325],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":382,"column":44,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":382,"endColumn":46,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[12654,12656],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":400,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":400,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[13213,13215],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'idxS' is defined but never used. Allowed unused args must match /^_/u.","line":460,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":460,"endColumn":26,"suggestions":[{"messageId":"removeVar","data":{"varName":"idxS"},"fix":{"range":[15269,15275],"text":""},"desc":"Remove unused variable 'idxS'."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":464,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":464,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[15408,15410],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'idxS' is defined but never used. Allowed unused args must match /^_/u.","line":473,"column":57,"nodeType":"Identifier","messageId":"unusedVar","endLine":473,"endColumn":61,"suggestions":[{"messageId":"removeVar","data":{"varName":"idxS"},"fix":{"range":[15795,15801],"text":""},"desc":"Remove unused variable 'idxS'."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { html } from 'lit';\r\nimport { app, setState } from '../Core/App';\r\nimport { ShapeManager } from '../Core/Managers/ShapeManager';\r\nimport { Coordinates } from '../Core/Objects/Coordinates';\r\nimport { Point } from '../Core/Objects/Point';\r\nimport { Segment } from '../Core/Objects/Segment';\r\nimport { LineShape } from '../Core/Objects/Shapes/LineShape';\r\nimport { Shape } from '../Core/Objects/Shapes/Shape';\r\nimport { SinglePointShape } from '../Core/Objects/Shapes/SinglePointShape';\r\nimport { Tool } from '../Core/States/Tool';\r\nimport { findObjectById, removeObjectById } from '../Core/Tools/general';\r\nimport {\r\n  compareIdBetweenLayers,\r\n  duplicateShape,\r\n} from '../Core/Tools/shapesTools';\r\nimport { getAllLinkedShapesInGeometry } from '../GeometryTools/general';\r\nimport {\r\n  computeAllShapeTransform,\r\n  computeConstructionSpec,\r\n} from '../GeometryTools/recomputeShape';\r\n\r\n/**\r\n * Retourner une figure (ou un ensemble de figures li├®es) sur l'espace de travail\r\n */\r\nexport class ReverseTool extends Tool {\r\n  constructor() {\r\n    super('reverse', 'Retourner', 'move');\r\n\r\n    // start -> select-axis -> reverse\r\n    this.currentStep = null;\r\n\r\n    // La figure que l'on retourne\r\n    this.selectedShape = null;\r\n\r\n    // Timestamp au d├®marrage de l'animation\r\n    this.startTime = null;\r\n\r\n    // Objet repr├®sentant l'axe de sym├®trie utilis├®e pour le retournement\r\n    this.axis = null;\r\n\r\n    // Dur├®e en secondes de l'animation\r\n    this.duration = 2;\r\n\r\n    // Couleur des axes de sym├®trie\r\n    this.symmetricalAxeColor = '#080';\r\n\r\n    this.axes = [];\r\n\r\n    this.axisAngle = null;\r\n\r\n    // Longueur en pixels des 4 arcs de sym├®trie\r\n    this.axisLength = 200;\r\n\r\n    // L'ensemble des figures li├®es ├á la figure s├®lectionn├®e, y compris la figure elle-m├¬me\r\n    this.involvedShapes = [];\r\n\r\n    this.requestAnimFrameId = null;\r\n  }\r\n\r\n  /**\r\n   * Renvoie l'aide ├á afficher ├á l'utilisateur\r\n   * @return {String} L'aide, en HTML\r\n   */\r\n  getHelpText() {\r\n    const toolName = this.title;\r\n    return html`\r\n      <h3>${toolName}</h3>\r\n      <p>\r\n        Vous avez s├®lectionn├® l'outil <b>\"${toolName}\"</b>.<br />\r\n        Pour retourner une figure, touchez-l├á, puis touchez un des axes de\r\n        sym├®trie apparus sur la figure pour la retourner selon cet axe de\r\n        sym├®trie.\r\n      </p>\r\n    `;\r\n  }\r\n\r\n  /**\r\n   * initialiser l'├®tat\r\n   */\r\n  start() {\r\n    setTimeout(\r\n      () =>\r\n        setState({\r\n          tool: { ...app.tool, name: this.name, currentStep: 'listen' },\r\n        }),\r\n      50,\r\n    );\r\n  }\r\n\r\n  listen() {\r\n    app.mainCanvasLayer.editingShapeIds = [];\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.stopAnimation();\r\n    this.removeListeners();\r\n\r\n    app.workspace.selectionConstraints =\r\n      app.fastSelectionConstraints.click_all_shape;\r\n    app.workspace.selectionConstraints.shapes.blacklist =\r\n      app.mainCanvasLayer.shapes.filter((s) => s instanceof SinglePointShape);\r\n    this.objectSelectedId = app.addListener('objectSelected', this.handler);\r\n  }\r\n\r\n  selectAxis() {\r\n    this.removeListeners();\r\n    app.upperCanvasLayer.removeAllObjects();\r\n\r\n    const selectedShape = ShapeManager.getShapeById(app.tool.selectedShapeId);\r\n\r\n    this.shapesToCopy = [...this.involvedShapes];\r\n    this.shapesToCopy.forEach((s) => {\r\n      getAllLinkedShapesInGeometry(s, this.shapesToCopy, false);\r\n    });\r\n\r\n    this.center = selectedShape.centerCoordinates;\r\n    this.initialAngle = this.center.angleWith(\r\n      app.workspace.lastKnownMouseCoordinates,\r\n    );\r\n    this.lastAngle = this.initialAngle;\r\n\r\n    this.shapesToCopy.sort(\r\n      (s1, s2) =>\r\n        ShapeManager.getShapeIndex(s1) - ShapeManager.getShapeIndex(s2),\r\n    );\r\n\r\n    this.drawingShapes = this.shapesToCopy.map((s) => duplicateShape(s));\r\n    this.shapesToMove = this.drawingShapes.filter((s) =>\r\n      this.involvedShapes.find((inShape) =>\r\n        compareIdBetweenLayers(inShape.id, s.id),\r\n      ),\r\n    );\r\n\r\n    app.mainCanvasLayer.editingShapeIds = this.shapesToCopy.map((s) => s.id);\r\n    this.createAllAxes();\r\n\r\n    window.dispatchEvent(new CustomEvent('reset-selection-constraints'));\r\n    app.workspace.selectionConstraints.eventType = 'click';\r\n    app.workspace.selectionConstraints.segments.canSelect = true;\r\n    app.workspace.selectionConstraints.segments.whitelist = this.axes.map(\r\n      (s) => {\r\n        return { shapeId: s.id };\r\n      },\r\n    );\r\n    app.workspace.selectionConstraints.segments.canSelectFromUpper = true;\r\n    app.workspace.selectionConstraints.shapes.canSelect = true;\r\n    app.workspace.selectionConstraints.shapes.blacklist = [\r\n      // { shapeId: selectedShape.id },\r\n      (app.workspace.selectionConstraints.shapes.blacklist =\r\n        app.mainCanvasLayer.shapes.filter(\r\n          (s) => s instanceof SinglePointShape,\r\n        )),\r\n    ];\r\n\r\n    this.objectSelectedId = app.addListener('objectSelected', this.handler);\r\n  }\r\n\r\n  reverse() {\r\n    this.removeListeners();\r\n\r\n    this.createAxis(app.tool.axisAngle);\r\n    this.startTime = Date.now();\r\n    this.animate();\r\n  }\r\n\r\n  /**\r\n   * stopper l'├®tat\r\n   */\r\n  end() {\r\n    app.mainCanvasLayer.editingShapeIds = [];\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.stopAnimation();\r\n    this.removeListeners();\r\n  }\r\n\r\n  /**\r\n   * Appel├®e par ├®v├®nement du SelectManager quand une figure est s├®lectionn├®e (onClick)\r\n   * @param  {Object} object            La figure s├®lectionn├®e\r\n   */\r\n  objectSelected(object) {\r\n    if (\r\n      (app.tool.currentStep == 'listen' ||\r\n        app.tool.currentStep == 'selectAxis') &&\r\n      object instanceof Shape\r\n    ) {\r\n      const selectedShape = object;\r\n\r\n      this.involvedShapes = ShapeManager.getAllBindedShapes(selectedShape);\r\n      if (app.environment.name == 'Geometrie') {\r\n        this.involvedShapes =\r\n          ShapeManager.getAllBindedShapesInGeometry(selectedShape);\r\n        for (let i = 0; i < this.involvedShapes.length; i++) {\r\n          const currentShape = this.involvedShapes[i];\r\n          if (currentShape.geometryObject?.geometryTransformationName != null) {\r\n            window.dispatchEvent(\r\n              new CustomEvent('show-notif', {\r\n                detail: {\r\n                  message:\r\n                    'Les images issues de transfomation ne peuvent pas ├¬tre retourn├®es.',\r\n                },\r\n              }),\r\n            );\r\n            return;\r\n          }\r\n          if (currentShape.familyName == 'multipliedVector') {\r\n            window.dispatchEvent(\r\n              new CustomEvent('show-notif', {\r\n                detail: {\r\n                  message:\r\n                    \"Les vecteurs multipli├®s ne peuvent pas ├¬tre retourn├®s, mais peuvent l'├¬tre via leur parent.\",\r\n                },\r\n              }),\r\n            );\r\n            return;\r\n          }\r\n        }\r\n        const shapesToAdd = [];\r\n        this.involvedShapes.forEach((s) => {\r\n          s.geometryObject?.geometryMultipliedChildShapeIds.forEach((sId) => {\r\n            shapesToAdd.push(findObjectById(sId));\r\n          });\r\n        });\r\n        this.involvedShapes.push(...shapesToAdd);\r\n      }\r\n\r\n      setState({\r\n        tool: {\r\n          ...app.tool,\r\n          currentStep: 'selectAxis',\r\n          selectedShapeId: selectedShape.id,\r\n        },\r\n      });\r\n    } else if (\r\n      app.tool.currentStep == 'selectAxis' &&\r\n      object instanceof Segment\r\n    ) {\r\n      const selectedAxis = object;\r\n      this.axisAngle = selectedAxis.getAngleWithHorizontal();\r\n\r\n      this.shapesToMove.forEach((shape) => {\r\n        shape.segments.forEach((seg) => {\r\n          if (seg.arcCenter) {\r\n            const tangentCoord1 = seg.centerProjectionOnSegment(this.axisAngle);\r\n            const tangentPoint1 = new Point({\r\n              layer: 'upper',\r\n              coordinates: tangentCoord1,\r\n              visible: false,\r\n            });\r\n            let center = selectedAxis.projectionOnSegment(tangentPoint1);\r\n            tangentPoint1.startCoordinates = new Coordinates(tangentCoord1);\r\n            tangentPoint1.endCoordinates = new Coordinates({\r\n              x: tangentCoord1.x + 2 * (center.x - tangentCoord1.x),\r\n              y: tangentCoord1.y + 2 * (center.y - tangentCoord1.y),\r\n            });\r\n            seg.tangentPoint1 = tangentPoint1;\r\n\r\n            const tangentCoord2 = seg.centerProjectionOnSegment(\r\n              this.axisAngle + Math.PI / 2,\r\n            );\r\n            const tangentPoint2 = new Point({\r\n              layer: 'upper',\r\n              coordinates: tangentCoord2,\r\n              visible: false,\r\n            });\r\n            center = selectedAxis.projectionOnSegment(tangentPoint2);\r\n            tangentPoint2.startCoordinates = new Coordinates(tangentCoord2);\r\n            tangentPoint2.endCoordinates = new Coordinates({\r\n              x: tangentCoord2.x + 2 * (center.x - tangentCoord2.x),\r\n              y: tangentCoord2.y + 2 * (center.y - tangentCoord2.y),\r\n            });\r\n            seg.tangentPoint2 = tangentPoint2;\r\n\r\n            seg.axisAngle = this.axisAngle;\r\n          }\r\n        });\r\n        shape.points.forEach((pt) => {\r\n          const center = selectedAxis.projectionOnSegment(pt);\r\n\r\n          pt.startCoordinates = new Coordinates(pt.coordinates);\r\n          pt.endCoordinates = new Coordinates({\r\n            x: pt.x + 2 * (center.x - pt.x),\r\n            y: pt.y + 2 * (center.y - pt.y),\r\n          });\r\n        });\r\n      });\r\n\r\n      // app.upperCanvasLayer.points.forEach((point) => {\r\n      //   let center = selectedAxis.projectionOnSegment(point);\r\n\r\n      //   point.startCoordinates = new Coordinates(point.coordinates);\r\n      //   point.endCoordinates = new Coordinates({\r\n      //     x: point.x + 2 * (center.x - point.x),\r\n      //     y: point.y + 2 * (center.y - point.y),\r\n      //   });\r\n      // });\r\n\r\n      app.upperCanvasLayer.shapes.forEach((s) => {\r\n        s.geometryObject?.geometryDuplicateChildShapeIds.forEach(\r\n          (duplicateChildId) => {\r\n            const duplicateChild = findObjectById(duplicateChildId);\r\n            computeConstructionSpec(duplicateChild);\r\n          },\r\n        );\r\n      });\r\n\r\n      this.axes.forEach((axis) => removeObjectById(axis.id));\r\n\r\n      setState({\r\n        tool: {\r\n          ...app.tool,\r\n          currentStep: 'reverse',\r\n          axisAngle: this.axisAngle,\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  createAllAxes() {\r\n    this.axes[0] = this.createAxis(Math.PI / 2);\r\n    this.axes[1] = this.createAxis((3 * Math.PI) / 4);\r\n    this.axes[2] = this.createAxis(0);\r\n    this.axes[3] = this.createAxis(Math.PI / 4);\r\n  }\r\n\r\n  createAxis(orientation) {\r\n    // Ajuster la longueur de l'axe selon le zoom pour maintenir une taille visuelle constante\r\n    const axisLengthInLogicalCoords = this.axisLength / app.workspace.zoomLevel;\r\n\r\n    let path = '';\r\n    if (Math.abs(orientation - Math.PI / 2) < 0.01) {\r\n      path = [\r\n        'M',\r\n        this.center.x,\r\n        this.center.y - axisLengthInLogicalCoords / 2,\r\n        'L',\r\n        this.center.x,\r\n        this.center.y + axisLengthInLogicalCoords / 2,\r\n      ].join(' ');\r\n    } else if (Math.abs(orientation - Math.PI / 4) < 0.01) {\r\n      path = [\r\n        'M',\r\n        this.center.x - (0.683 * axisLengthInLogicalCoords) / 2,\r\n        this.center.y - (0.683 * axisLengthInLogicalCoords) / 2,\r\n        'L',\r\n        this.center.x + (0.683 * axisLengthInLogicalCoords) / 2,\r\n        this.center.y + (0.683 * axisLengthInLogicalCoords) / 2,\r\n      ].join(' ');\r\n    } else if (Math.abs(orientation) < 0.01) {\r\n      path = [\r\n        'M',\r\n        this.center.x - axisLengthInLogicalCoords / 2,\r\n        this.center.y,\r\n        'L',\r\n        this.center.x + axisLengthInLogicalCoords / 2,\r\n        this.center.y,\r\n      ].join(' ');\r\n    } else if (Math.abs(orientation - (3 * Math.PI) / 4) < 0.01) {\r\n      path = [\r\n        'M',\r\n        this.center.x + (0.683 * axisLengthInLogicalCoords) / 2,\r\n        this.center.y - (0.683 * axisLengthInLogicalCoords) / 2,\r\n        'L',\r\n        this.center.x - (0.683 * axisLengthInLogicalCoords) / 2,\r\n        this.center.y + (0.683 * axisLengthInLogicalCoords) / 2,\r\n      ].join(' ');\r\n    } else {\r\n      console.error('orientation not supported : ', orientation);\r\n    }\r\n    const axis = new LineShape({\r\n      layer: 'upper',\r\n      path: path,\r\n      strokeColor: this.symmetricalAxeColor,\r\n      isPointed: false,\r\n    });\r\n    return axis;\r\n  }\r\n\r\n  /**\r\n   * G├¿re l'animation du retournement.\r\n   */\r\n  animate() {\r\n    this.lastProgress = this.progress || 0;\r\n    this.progress = (Date.now() - this.startTime) / (this.duration * 1000);\r\n    if (this.progress > 1 && app.tool.name == 'reverse') {\r\n      this.executeAction();\r\n      setState({\r\n        tool: { ...app.tool, name: this.name, currentStep: 'listen' },\r\n      });\r\n    } else {\r\n      window.dispatchEvent(new CustomEvent('refreshUpper'));\r\n      this.requestAnimFrameId = window.requestAnimationFrame(() =>\r\n        this.animate(),\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Appel├®e par la fonction de dessin, lorsqu'il faut dessiner l'action en cours\r\n   * @param  {Point} mouseCoordinates Les coordonn├®es de la souris\r\n   */\r\n  refreshStateUpper() {\r\n    if (app.tool.currentStep == 'reverse') {\r\n      const progressInAnimation =\r\n        Math.cos(Math.PI * (1 - this.progress)) / 2 + 0.5;\r\n      this.shapesToMove.forEach((s) => {\r\n        s.points.forEach((point) => {\r\n          if (point.startCoordinates)\r\n            point.coordinates = point.startCoordinates.substract(\r\n              point.startCoordinates\r\n                .substract(point.endCoordinates)\r\n                .multiply(progressInAnimation),\r\n            );\r\n        });\r\n        s.segments.forEach((seg) => {\r\n          if (seg.arcCenter) {\r\n            const point = seg.tangentPoint1;\r\n            if (point.startCoordinates)\r\n              point.coordinates = point.startCoordinates.substract(\r\n                point.startCoordinates\r\n                  .substract(point.endCoordinates)\r\n                  .multiply(progressInAnimation),\r\n              );\r\n            const point2 = seg.tangentPoint2;\r\n\r\n            if (point2.startCoordinates)\r\n              point2.coordinates = point2.startCoordinates.substract(\r\n                point2.startCoordinates\r\n                  .substract(point2.endCoordinates)\r\n                  .multiply(progressInAnimation),\r\n              );\r\n          }\r\n        });\r\n        if (this.progress >= 0.5 && this.lastProgress < 0.5) {\r\n          s.reverse();\r\n        }\r\n        computeAllShapeTransform(s, 'upper', false);\r\n      });\r\n\r\n      // this.shapesToMove.forEach(s => {\r\n      // });\r\n      // app.upperCanvasLayer.points.forEach((point) => {\r\n\r\n      // });\r\n\r\n      // if (this.progress >= 0.5 && this.lastProgress < 0.5) {\r\n      //   // milieu animation\r\n      //   app.upperCanvasLayer.shapes.forEach((s) => {\r\n      //     s.reverse();\r\n      //   });\r\n      // }\r\n    }\r\n  }\r\n\r\n  _executeAction() {\r\n    const selectedAxis = this.createAxis(app.tool.axisAngle).segments[0];\r\n    app.mainCanvasLayer.editingShapeIds\r\n      .filter((editingShapeId) =>\r\n        this.shapesToMove.some((shapeToMove) =>\r\n          compareIdBetweenLayers(shapeToMove.id, editingShapeId),\r\n        ),\r\n      )\r\n      .forEach((sId, idxS) => {\r\n        const s = findObjectById(sId);\r\n        this.reverseShape(s, selectedAxis);\r\n      });\r\n    if (app.environment.name == 'Geometrie') {\r\n      app.mainCanvasLayer.shapes.forEach((s) => {\r\n        s.geometryObject?.geometryDuplicateChildShapeIds.forEach(\r\n          (duplicateChildId) => {\r\n            const duplicateChild = findObjectById(duplicateChildId);\r\n            computeConstructionSpec(duplicateChild);\r\n          },\r\n        );\r\n      });\r\n      app.mainCanvasLayer.editingShapeIds.forEach((sId, idxS) => {\r\n        const s = findObjectById(sId);\r\n        computeAllShapeTransform(s, 'main', false);\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Retourne une figure\r\n   * @param  {Shape} shape       la figure ├á retourner\r\n   */\r\n  reverseShape(shape, selectedAxis) {\r\n    shape.reverse();\r\n\r\n    shape.points.forEach((pt) => {\r\n      this.computePointPosition(pt, selectedAxis);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Calcule les nouvelles coordonn├®es d'un point lors de l'animation d'une sym├®trie axiale\r\n   * @param  {Point} point    le point\r\n   * @param  {Object} axe      L'axe de sym├®trie\r\n   * @return {Point}          Nouvelles coordonn├®es\r\n   */\r\n  computePointPosition(point, selectedAxis) {\r\n    const center = selectedAxis.projectionOnSegment(point);\r\n\r\n    //Calculer la nouvelle position du point ├á partir de l'ancienne et de la projection.\r\n    point.coordinates = point.coordinates.add(\r\n      center.substract(point.coordinates).multiply(2),\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Reverse\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Rotate45\\Rotate45Tool.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Rotate45\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Rotate\\RotateTool.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":102,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":102,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[3136,3138],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":107,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":107,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3314,3316],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":122,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":122,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3939,3941],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":168,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":168,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[5489,5491],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":191,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":191,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[6157,6159],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":201,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":201,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[6448,6450],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":226,"column":28,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":226,"endColumn":30,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7262,7264],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":241,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":241,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7801,7803],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'idxS' is defined but never used. Allowed unused args must match /^_/u.","line":250,"column":57,"nodeType":"Identifier","messageId":"unusedVar","endLine":250,"endColumn":61,"suggestions":[{"messageId":"removeVar","data":{"varName":"idxS"},"fix":{"range":[8188,8194],"text":""},"desc":"Remove unused variable 'idxS'."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { html } from 'lit';\r\nimport { app, setState } from '../Core/App';\r\nimport { ShapeManager } from '../Core/Managers/ShapeManager';\r\nimport { Coordinates } from '../Core/Objects/Coordinates';\r\nimport { Point } from '../Core/Objects/Point';\r\nimport { SinglePointShape } from '../Core/Objects/Shapes/SinglePointShape';\r\nimport { Tool } from '../Core/States/Tool';\r\nimport { getShapeAdjustment } from '../Core/Tools/automatic_adjustment';\r\nimport { addInfoToId, findObjectById } from '../Core/Tools/general';\r\nimport {\r\n  compareIdBetweenLayers,\r\n  duplicateShape,\r\n} from '../Core/Tools/shapesTools';\r\nimport { getAllLinkedShapesInGeometry } from '../GeometryTools/general';\r\nimport {\r\n  computeAllShapeTransform,\r\n  computeConstructionSpec,\r\n} from '../GeometryTools/recomputeShape';\r\n\r\n/**\r\n * Tourner une figure (ou un ensemble de figures li├®es) sur l'espace de travail\r\n */\r\nexport class RotateTool extends Tool {\r\n  constructor() {\r\n    super('rotate', 'Tourner', 'move');\r\n\r\n    this.centerDrawColor = '#080';\r\n\r\n    this.currentStep = null; // listen-canvas-click -> rotate\r\n\r\n    //La figure que l'on d├®place\r\n    this.selectedShape = null;\r\n\r\n    //L'angle initial entre le centre de la figure et la position de la souris\r\n    this.initialAngle = null;\r\n\r\n    /*\r\n        L'ensemble des figures li├®es ├á la figure s├®lectionn├®e, y compris la figure\r\n        elle-m├¬me\r\n         */\r\n    this.involvedShapes = [];\r\n  }\r\n\r\n  /**\r\n   * Renvoie l'aide ├á afficher ├á l'utilisateur\r\n   * @return {String} L'aide, en HTML\r\n   */\r\n  getHelpText() {\r\n    const toolName = this.title;\r\n    return html`\r\n      <h3>${toolName}</h3>\r\n      <p>\r\n        Vous avez s├®lectionn├® l'outil <b>\"${toolName}\"</b>.<br />\r\n        Touchez une figure, puis glissez votre doigt sans relacher la figure\r\n        pour la faire tourner. La figure tourne autour de son centre, qui est\r\n        affich├® lors de la rotation. Faites tournez votre doigt autour de ce\r\n        centre pour faire tourner la figure.\r\n      </p>\r\n    `;\r\n  }\r\n\r\n  start() {\r\n    setTimeout(\r\n      () =>\r\n        setState({\r\n          tool: { ...app.tool, name: this.name, currentStep: 'listen' },\r\n        }),\r\n      50,\r\n    );\r\n  }\r\n\r\n  listen() {\r\n    app.mainCanvasLayer.editingShapeIds = [];\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.stopAnimation();\r\n    this.removeListeners();\r\n\r\n    app.workspace.selectionConstraints =\r\n      app.fastSelectionConstraints.mousedown_all_shape;\r\n    app.workspace.selectionConstraints.shapes.blacklist =\r\n      app.mainCanvasLayer.shapes.filter((s) => s instanceof SinglePointShape);\r\n    this.objectSelectedId = app.addListener('objectSelected', this.handler);\r\n  }\r\n\r\n  rotate() {\r\n    this.removeListeners();\r\n\r\n    this.mouseUpId = app.addListener('canvasMouseUp', this.handler);\r\n  }\r\n\r\n  end() {\r\n    app.mainCanvasLayer.editingShapeIds = [];\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.removeListeners();\r\n    this.stopAnimation();\r\n  }\r\n\r\n  /**\r\n   * Appel├®e par ├®v├®nement du SelectManager quand une figure est s├®lectionn├®e (canvasMouseDown)\r\n   */\r\n  objectSelected(shape) {\r\n    if (app.tool.currentStep != 'listen') return;\r\n    if (!shape) return;\r\n\r\n    this.selectedShape = shape;\r\n    this.involvedShapes = ShapeManager.getAllBindedShapes(shape);\r\n    if (app.environment.name == 'Geometrie') {\r\n      this.involvedShapes = ShapeManager.getAllBindedShapesInGeometry(shape);\r\n      for (let i = 0; i < this.involvedShapes.length; i++) {\r\n        const currentShape = this.involvedShapes[i];\r\n        if (currentShape.geometryObject?.geometryTransformationName != null) {\r\n          window.dispatchEvent(\r\n            new CustomEvent('show-notif', {\r\n              detail: {\r\n                message:\r\n                  'Les images issues de transfomation ne peuvent pas ├¬tre tourn├®es.',\r\n              },\r\n            }),\r\n          );\r\n          return;\r\n        }\r\n        if (currentShape.familyName == 'multipliedVector') {\r\n          window.dispatchEvent(\r\n            new CustomEvent('show-notif', {\r\n              detail: {\r\n                message:\r\n                  \"Les vecteurs multipli├®s ne peuvent pas ├¬tre tourn├®s, mais peuvent l'├¬tre via leur parent.\",\r\n              },\r\n            }),\r\n          );\r\n          return;\r\n        }\r\n      }\r\n      const shapesToAdd = [];\r\n      this.involvedShapes.forEach((s) => {\r\n        s.geometryObject?.geometryMultipliedChildShapeIds.forEach((sId) => {\r\n          shapesToAdd.push(findObjectById(sId));\r\n        });\r\n      });\r\n      this.involvedShapes.push(...shapesToAdd);\r\n    }\r\n\r\n    this.shapesToCopy = [...this.involvedShapes];\r\n    this.shapesToCopy.forEach((s) => {\r\n      getAllLinkedShapesInGeometry(s, this.shapesToCopy, false);\r\n    });\r\n\r\n    this.startClickCoordinates = app.workspace.lastKnownMouseCoordinates;\r\n    this.lastKnownMouseCoordinates = this.startClickCoordinates;\r\n\r\n    this.center = shape.centerCoordinates;\r\n    this.initialAngle = this.center.angleWith(\r\n      app.workspace.lastKnownMouseCoordinates,\r\n    );\r\n    this.lastAngle = this.initialAngle;\r\n\r\n    this.shapesToCopy.sort(\r\n      (s1, s2) =>\r\n        ShapeManager.getShapeIndex(s1) - ShapeManager.getShapeIndex(s2),\r\n    );\r\n    this.drawingShapes = this.shapesToCopy.map((s) => duplicateShape(s));\r\n    this.shapesToMove = this.drawingShapes.filter((s) =>\r\n      this.involvedShapes.find((inShape) =>\r\n        compareIdBetweenLayers(inShape.id, s.id),\r\n      ),\r\n    );\r\n\r\n    if (app.environment.name != 'Cubes')\r\n      new Point({\r\n        coordinates: this.center,\r\n        layer: 'upper',\r\n        color: this.centerDrawColor,\r\n      });\r\n\r\n    app.mainCanvasLayer.editingShapeIds = this.shapesToCopy.map((s) => s.id);\r\n\r\n    app.upperCanvasLayer.shapes.forEach((s) => {\r\n      s.geometryObject?.geometryDuplicateChildShapeIds.forEach(\r\n        (duplicateChildId) => {\r\n          const duplicateChild = findObjectById(duplicateChildId);\r\n          computeConstructionSpec(duplicateChild);\r\n        },\r\n      );\r\n    });\r\n\r\n    setState({ tool: { ...app.tool, currentStep: 'rotate' } });\r\n    this.animate();\r\n  }\r\n\r\n  canvasMouseUp() {\r\n    if (app.tool.currentStep != 'rotate') return;\r\n\r\n    this.executeAction();\r\n    setState({ tool: { ...app.tool, name: this.name, currentStep: 'listen' } });\r\n  }\r\n\r\n  /**\r\n   * Appel├®e par la fonction de dessin, lorsqu'il faut dessiner l'action en cours\r\n   */\r\n  refreshStateUpper() {\r\n    if (app.tool.currentStep == 'rotate') {\r\n      const newAngle = this.center.angleWith(\r\n          app.workspace.lastKnownMouseCoordinates,\r\n        ),\r\n        diffAngle = newAngle - this.lastAngle;\r\n\r\n      this.lastAngle = newAngle;\r\n      this.shapesToMove.forEach((s) => {\r\n        s.rotate(diffAngle, this.center);\r\n        computeAllShapeTransform(s, 'upper', false);\r\n      });\r\n    }\r\n    this.lastKnownMouseCoordinates = app.workspace.lastKnownMouseCoordinates;\r\n  }\r\n\r\n  _executeAction() {\r\n    const centerCoordinates = this.selectedShape.centerCoordinates;\r\n    const adjustment = getShapeAdjustment(\r\n      this.shapesToMove,\r\n      this.selectedShape,\r\n    );\r\n    app.mainCanvasLayer.editingShapeIds\r\n      .filter((editingShapeId) =>\r\n        this.shapesToMove.some(\r\n          (shapeToMove) =>\r\n            shapeToMove.id == addInfoToId(editingShapeId, 'upper'),\r\n        ),\r\n      )\r\n      .forEach((sId, idxS) => {\r\n        const s = findObjectById(sId);\r\n        s.points.forEach((pt, idxPt) => {\r\n          pt.coordinates = new Coordinates(\r\n            this.shapesToMove[idxS].points[idxPt].coordinates,\r\n          );\r\n          if (this.pointOnLineRatio) pt.ratio = this.pointOnLineRatio;\r\n        });\r\n\r\n        s.rotate(adjustment.rotationAngle, centerCoordinates);\r\n        s.translate(adjustment.translation);\r\n      });\r\n    if (app.environment.name == 'Geometrie') {\r\n      app.mainCanvasLayer.shapes.forEach((s) => {\r\n        s.geometryObject?.geometryDuplicateChildShapeIds.forEach(\r\n          (duplicateChildId) => {\r\n            const duplicateChild = findObjectById(duplicateChildId);\r\n            computeConstructionSpec(duplicateChild);\r\n          },\r\n        );\r\n      });\r\n      app.mainCanvasLayer.editingShapeIds.forEach((sId, idxS) => {\r\n        const s = findObjectById(sId);\r\n        computeAllShapeTransform(s, 'main', false);\r\n      });\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Rotate\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Rotation\\RotationTool.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":71,"column":33,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":71,"endColumn":35,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2209,2211],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":151,"column":26,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":151,"endColumn":28,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4558,4560],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":155,"column":48,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":155,"endColumn":50,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4790,4792],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":394,"column":53,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":394,"endColumn":55,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[12578,12580],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":457,"column":27,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":457,"endColumn":29,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[14424,14426],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":474,"column":44,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":474,"endColumn":46,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[15224,15226],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":508,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":508,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[16431,16433],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":524,"column":27,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":524,"endColumn":29,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[17039,17041],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":536,"column":32,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":536,"endColumn":34,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[17518,17520],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app, setState } from '../Core/App';\r\nimport { GroupManager } from '../Core/Managers/GroupManager';\r\nimport { SelectManager } from '../Core/Managers/SelectManager';\r\nimport { ShapeManager } from '../Core/Managers/ShapeManager';\r\nimport { CharacteristicElements } from '../Core/Objects/CharacteristicElements';\r\nimport { Coordinates } from '../Core/Objects/Coordinates';\r\nimport { Point } from '../Core/Objects/Point';\r\nimport { Segment } from '../Core/Objects/Segment';\r\nimport { ShapeGroup } from '../Core/Objects/ShapeGroup';\r\nimport { ArrowLineShape } from '../Core/Objects/Shapes/ArrowLineShape';\r\nimport { GeometryObject } from '../Core/Objects/Shapes/GeometryObject';\r\nimport { SinglePointShape } from '../Core/Objects/Shapes/SinglePointShape';\r\nimport { Tool } from '../Core/States/Tool';\r\nimport { findObjectById, removeObjectById } from '../Core/Tools/general';\r\nimport { isAngleBetweenTwoAngles } from '../Core/Tools/geometry';\r\n\r\n/**\r\n * Outil de rotation g├®om├®trique\r\n * Permet la rotation d'objets autour d'un centre avec d├®finition d'angle par 3 points ou arc existant\r\n */\r\nexport class RotationTool extends Tool {\r\n  constructor() {\r\n    super('rotation', 'Rotation', 'transformation');\r\n  }\r\n\r\n  start() {\r\n    this.removeListeners();\r\n    this.duration = app.settings.geometryTransformationAnimation\r\n      ? app.settings.geometryTransformationAnimationDuration\r\n      : 0.001;\r\n\r\n    setTimeout(\r\n      () =>\r\n        setState({\r\n          tool: {\r\n            ...app.tool,\r\n            name: this.name,\r\n            currentStep: 'selectFirstReference',\r\n          },\r\n        }),\r\n      50,\r\n    );\r\n  }\r\n\r\n  selectFirstReference() {\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.stopAnimation();\r\n    this.removeListeners();\r\n\r\n    this.showLastCharacteristicElements('rotationCenter');\r\n\r\n    this.pointsDrawn = [];\r\n    this.characteristicElements = null;\r\n\r\n    setTimeout(\r\n      () =>\r\n        setState({\r\n          tool: {\r\n            ...app.tool,\r\n            name: this.name,\r\n            currentStep: 'selectReference',\r\n          },\r\n        }),\r\n      50,\r\n    );\r\n  }\r\n\r\n  selectReference() {\r\n    this.removeListeners();\r\n\r\n    if (this.pointsDrawn.length == 1) {\r\n      const shapesToDelete = [];\r\n      app.upperCanvasLayer.shapes.forEach((s) => {\r\n        if (s.geometryObject?.geometryIsCharacteristicElements)\r\n          shapesToDelete.push(s);\r\n      });\r\n      shapesToDelete.forEach((s) => removeObjectById(s.id));\r\n      this.showLastCharacteristicElements('arcs');\r\n\r\n      // Configurer les contraintes de s├®lection pour permettre la s├®lection d'arcs\r\n      this.configureArcSelectionConstraints();\r\n    }\r\n\r\n    this.mouseDownId = app.addListener('canvasMouseDown', this.handler);\r\n  }\r\n\r\n  animateRefPoint() {\r\n    this.removeListeners();\r\n\r\n    window.dispatchEvent(new CustomEvent('reset-selection-constraints'));\r\n    app.workspace.selectionConstraints.eventType = 'click';\r\n    app.workspace.selectionConstraints.points.canSelect = true;\r\n    this.animate();\r\n    this.mouseUpId = app.addListener('canvasMouseUp', this.handler);\r\n  }\r\n\r\n  selectDirection() {\r\n    this.removeListeners();\r\n\r\n    window.setTimeout(\r\n      () => (this.mouseClickId = app.addListener('canvasClick', this.handler)),\r\n    );\r\n  }\r\n\r\n  selectObject() {\r\n    if (this.drawingShapes) {\r\n      this.drawingShapes.forEach((s) => {\r\n        removeObjectById(s.id);\r\n      });\r\n    }\r\n\r\n    this.removeListeners();\r\n\r\n    const shapesToDelete = [];\r\n    app.upperCanvasLayer.shapes.forEach((s) => {\r\n      if (s.geometryObject?.geometryIsCharacteristicElements)\r\n        shapesToDelete.push(s);\r\n    });\r\n    shapesToDelete.forEach((s) => removeObjectById(s.id));\r\n\r\n    this.setSelectionConstraints();\r\n    this.objectSelectedId = app.addListener('objectSelected', this.handler);\r\n  }\r\n\r\n  rot() {\r\n    this.removeListeners();\r\n\r\n    this.startTime = Date.now();\r\n    this.animate();\r\n  }\r\n\r\n  end() {\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.stopAnimation();\r\n    this.removeListeners();\r\n  }\r\n\r\n  get referenceShape() {\r\n    return findObjectById(app.tool.referenceShapeId);\r\n  }\r\n\r\n  canvasMouseDown() {\r\n    const coord = app.workspace.lastKnownMouseCoordinates;\r\n\r\n    if (this.pointsDrawn.length === 1) {\r\n      this.configureArcSelectionConstraints();\r\n      const object = this.trySelectArcObject(coord);\r\n      if (object instanceof Segment && object.isArc()) {\r\n        const firstElementId = this.characteristicElements.elementIds[0];\r\n        let referenceShape;\r\n        if (object.layer == 'upper') {\r\n          this.characteristicElements = new CharacteristicElements(\r\n            object.shape.geometryObject.geometryTransformationCharacteristicElements,\r\n          );\r\n          if (this.characteristicElements.type == 'arc') {\r\n            referenceShape = new ArrowLineShape({\r\n              path: this.characteristicElements.secondElement.getSVGPath(\r\n                'no scale',\r\n                true,\r\n              ),\r\n              layer: 'upper',\r\n              strokeColor: app.settings.referenceDrawColor,\r\n              strokeWidth: 2,\r\n            });\r\n          } else {\r\n            const points = this.characteristicElements.elements\r\n              .slice(1)\r\n              .map(\r\n                (pt) =>\r\n                  new Point({\r\n                    ...pt,\r\n                    id: null,\r\n                    shapeId: undefined,\r\n                    layer: 'upper',\r\n                  }),\r\n              );\r\n            const radius = points[0].coordinates.dist(points[2].coordinates);\r\n            const angle = points[2].coordinates.angleWith(\r\n              points[1].coordinates,\r\n            );\r\n            const projectionCoord = points[2].coordinates.add({\r\n              x: radius * Math.cos(angle),\r\n              y: radius * Math.sin(angle),\r\n            });\r\n            points[1].coordinates = projectionCoord;\r\n\r\n            const counterclockwise =\r\n              this.characteristicElements.counterclockwise;\r\n            const seg = new Segment({\r\n              layer: 'upper',\r\n              idx: 0,\r\n              vertexIds: [points[0].id, points[1].id],\r\n              arcCenterId: points[2].id,\r\n              counterclockwise: counterclockwise,\r\n            });\r\n            referenceShape = new ArrowLineShape({\r\n              layer: 'upper',\r\n              segmentIds: [seg.id],\r\n              pointIds: points.map((pt) => pt.id),\r\n              name: 'arc',\r\n              familyName: 'circle-shape',\r\n              fillOpacity: 0,\r\n              geometryObject: new GeometryObject({}),\r\n              strokeWidth: 2,\r\n              strokeColor: app.settings.referenceDrawColor,\r\n            });\r\n          }\r\n        } else {\r\n          this.characteristicElements = new CharacteristicElements({\r\n            type: 'arc',\r\n            elementIds: [null, object.id],\r\n          });\r\n          referenceShape = new ArrowLineShape({\r\n            path: object.getSVGPath('no scale', true),\r\n            layer: 'upper',\r\n            strokeColor: app.settings.referenceDrawColor,\r\n            strokeWidth: 2,\r\n          });\r\n        }\r\n        this.angle =\r\n          referenceShape.segments[0].arcCenter.coordinates.angleWith(\r\n            referenceShape.vertexes[0].coordinates,\r\n          ) -\r\n          referenceShape.segments[0].arcCenter.coordinates.angleWith(\r\n            referenceShape.vertexes[1].coordinates,\r\n          );\r\n        this.angle *= -1;\r\n        setState({\r\n          tool: {\r\n            ...app.tool,\r\n            name: this.name,\r\n            currentStep: 'selectObject',\r\n            referenceShapeId: referenceShape.id,\r\n          },\r\n        });\r\n        this.characteristicElements.elementIds[0] = firstElementId;\r\n        return;\r\n      }\r\n    }\r\n    this.pointsDrawn.push(\r\n      new Point({\r\n        coordinates: coord,\r\n        layer: 'upper',\r\n        color: app.settings.referenceDrawColor,\r\n        size: 2,\r\n      }),\r\n    );\r\n    setState({\r\n      tool: { ...app.tool, name: this.name, currentStep: 'animateRefPoint' },\r\n    });\r\n  }\r\n\r\n  canvasMouseUp() {\r\n    this.stopAnimation();\r\n\r\n    const coord = app.workspace.lastKnownMouseCoordinates;\r\n    const object = SelectManager.selectObject(coord);\r\n    const reference = object\r\n      ? object\r\n      : this.pointsDrawn[this.pointsDrawn.length - 1];\r\n    if (this.characteristicElements) {\r\n      this.characteristicElements.elementIds.push(reference.id);\r\n    } else {\r\n      this.characteristicElements = new CharacteristicElements({\r\n        type: 'points',\r\n        elementIds: [reference.id],\r\n      });\r\n    }\r\n    if (this.pointsDrawn.length < 4) {\r\n      setState({\r\n        tool: { ...app.tool, name: this.name, currentStep: 'selectReference' },\r\n      });\r\n    } else {\r\n      this.angle =\r\n        this.pointsDrawn[2].coordinates.angleWith(\r\n          this.pointsDrawn[1].coordinates,\r\n        ) -\r\n        this.pointsDrawn[2].coordinates.angleWith(\r\n          this.pointsDrawn[3].coordinates,\r\n        );\r\n      this.angle *= -1;\r\n\r\n      const radius = this.pointsDrawn[1].coordinates.dist(\r\n        this.pointsDrawn[2].coordinates,\r\n      );\r\n      const angle = this.pointsDrawn[2].coordinates.angleWith(\r\n        this.pointsDrawn[3].coordinates,\r\n      );\r\n      const projectionCoord = this.pointsDrawn[2].coordinates.add({\r\n        x: radius * Math.cos(angle),\r\n        y: radius * Math.sin(angle),\r\n      });\r\n      const arcPoints0 = [\r\n        new Point({\r\n          coordinates: this.pointsDrawn[1].coordinates,\r\n          layer: 'upper',\r\n          color: app.settings.referenceDrawColor,\r\n          size: 0.1,\r\n        }),\r\n        new Point({\r\n          coordinates: projectionCoord,\r\n          layer: 'upper',\r\n          color: app.settings.referenceDrawColor,\r\n          size: 0.1,\r\n        }),\r\n        new Point({\r\n          coordinates: this.pointsDrawn[2].coordinates,\r\n          layer: 'upper',\r\n          color: app.settings.referenceDrawColor,\r\n          size: 0.1,\r\n        }),\r\n      ];\r\n      const arcPoints1 = [\r\n        new Point({\r\n          coordinates: this.pointsDrawn[1].coordinates,\r\n          layer: 'upper',\r\n          color: app.settings.referenceDrawColor,\r\n          size: 0.1,\r\n        }),\r\n        new Point({\r\n          coordinates: projectionCoord,\r\n          layer: 'upper',\r\n          color: app.settings.referenceDrawColor,\r\n          size: 0.1,\r\n        }),\r\n        new Point({\r\n          coordinates: this.pointsDrawn[2].coordinates,\r\n          layer: 'upper',\r\n          color: app.settings.referenceDrawColor,\r\n          size: 0.1,\r\n        }),\r\n      ];\r\n      const arcSeg0 = new Segment({\r\n        layer: 'upper',\r\n        idx: 0,\r\n        vertexIds: [arcPoints0[0].id, arcPoints0[1].id],\r\n        arcCenterId: arcPoints0[2].id,\r\n        counterclockwise: this.angle < 0,\r\n      });\r\n      const arcSeg1 = new Segment({\r\n        layer: 'upper',\r\n        idx: 0,\r\n        vertexIds: [arcPoints1[0].id, arcPoints1[1].id],\r\n        arcCenterId: arcPoints1[2].id,\r\n        counterclockwise: this.angle >= 0,\r\n      });\r\n      this.arcShape0 = new ArrowLineShape({\r\n        layer: 'upper',\r\n        segmentIds: [arcSeg0.id],\r\n        pointIds: arcPoints0.map((pt) => pt.id),\r\n        name: 'arrow',\r\n        familyName: 'circle-shape',\r\n        strokeColor: app.settings.referenceDrawColor,\r\n        fillOpacity: 0,\r\n        geometryObject: {},\r\n        strokeWidth: 2,\r\n      });\r\n      this.arcShape1 = new ArrowLineShape({\r\n        layer: 'upper',\r\n        segmentIds: [arcSeg1.id],\r\n        pointIds: arcPoints1.map((pt) => pt.id),\r\n        name: 'arrow',\r\n        familyName: 'circle-shape',\r\n        strokeColor: app.settings.referenceDrawColor2,\r\n        fillOpacity: 0,\r\n        geometryObject: {},\r\n        strokeWidth: 2,\r\n      });\r\n\r\n      setState({\r\n        tool: { ...app.tool, name: this.name, currentStep: 'selectDirection' },\r\n      });\r\n    }\r\n  }\r\n\r\n  canvasClick() {\r\n    const angle = this.pointsDrawn[2].coordinates.angleWith(\r\n      app.workspace.lastKnownMouseCoordinates,\r\n    );\r\n    const startAngle = this.pointsDrawn[2].coordinates.angleWith(\r\n      this.pointsDrawn[1].coordinates,\r\n    );\r\n    const endAngle = this.pointsDrawn[2].coordinates.angleWith(\r\n      this.pointsDrawn[3].coordinates,\r\n    );\r\n    const isAngleInside = isAngleBetweenTwoAngles(\r\n      startAngle,\r\n      endAngle,\r\n      false,\r\n      angle,\r\n    );\r\n    this.clockwise = isAngleInside;\r\n    this.characteristicElements.clockwise = this.clockwise;\r\n    if (this.arcShape0.segments[0].counterclockwise == this.clockwise) {\r\n      removeObjectById(this.arcShape0.id);\r\n    } else {\r\n      removeObjectById(this.arcShape1.id);\r\n    }\r\n\r\n    if (!((this.angle < 0) ^ this.clockwise)) {\r\n      if (this.angle > 0) this.angle -= 2 * Math.PI;\r\n      else if (this.angle < 0) this.angle += 2 * Math.PI;\r\n    }\r\n\r\n    this.characteristicElements.elementIds.splice(\r\n      2,\r\n      2,\r\n      this.characteristicElements.elementIds[3],\r\n      this.characteristicElements.elementIds[2],\r\n    );\r\n\r\n    setState({\r\n      tool: { ...app.tool, name: this.name, currentStep: 'selectObject' },\r\n    });\r\n  }\r\n\r\n  objectSelected(object) {\r\n    if (!object) return;\r\n\r\n    this.involvedShapes = ShapeManager.getAllBindedShapes(object);\r\n    this.drawingShapes = this.involvedShapes.map(\r\n      (s) =>\r\n        new s.constructor({\r\n          ...s,\r\n          layer: 'upper',\r\n          path: s.getSVGPath('no scale', false),\r\n          id: undefined,\r\n          // divisionPointInfos: s.divisionPoints.map((dp) => {\r\n          //   return { coordinates: dp.coordinates, ratio: dp.ratio, segmentIdx: dp.segments[0].idx, color: dp.color };\r\n          // }),\r\n          segmentsColor: s.segments.map((seg) => {\r\n            return seg.color;\r\n          }),\r\n          pointsColor: s.vertexes.map((pt) => {\r\n            return pt.color;\r\n          }),\r\n        }),\r\n    );\r\n    setState({\r\n      tool: {\r\n        ...app.tool,\r\n        currentStep: 'rot',\r\n      },\r\n    });\r\n    window.dispatchEvent(new CustomEvent('refreshUpper'));\r\n  }\r\n\r\n  animate() {\r\n    if (app.tool.currentStep === 'animateRefPoint') {\r\n      window.dispatchEvent(new CustomEvent('refreshUpper'));\r\n      this.requestAnimFrameId = window.requestAnimationFrame(() =>\r\n        this.animate(),\r\n      );\r\n      return;\r\n    }\r\n    this.lastProgress = this.progress || 0;\r\n    if (this.lastProgress == 0) {\r\n      const rotationCenter = this.characteristicElements.firstElement;\r\n      this.drawingShapes.forEach((s) =>\r\n        s.points.forEach((point) => {\r\n          point.startCoordinates = new Coordinates(point.coordinates);\r\n          const startAngle = rotationCenter.coordinates.angleWith(\r\n            point.coordinates,\r\n          );\r\n          const length = rotationCenter.coordinates.dist(point.coordinates);\r\n          point.endCoordinates = new Coordinates({\r\n            x: rotationCenter.x + Math.cos(startAngle + this.angle) * length,\r\n            y: rotationCenter.y + Math.sin(startAngle + this.angle) * length,\r\n          });\r\n        }),\r\n      );\r\n    }\r\n    this.progress = (Date.now() - this.startTime) / (this.duration * 1000);\r\n    if (this.progress > 1 && app.tool.name == 'rotation') {\r\n      this.executeAction();\r\n      setState({\r\n        tool: { ...app.tool, name: this.name, currentStep: 'selectObject' },\r\n      });\r\n    } else {\r\n      window.dispatchEvent(new CustomEvent('refreshUpper'));\r\n      this.requestAnimFrameId = window.requestAnimationFrame(() =>\r\n        this.animate(),\r\n      );\r\n    }\r\n  }\r\n\r\n  refreshStateUpper() {\r\n    if (app.tool.currentStep === 'rot') {\r\n      const rotationCenter = this.characteristicElements.firstElement;\r\n      app.upperCanvasLayer.points.forEach((point) => {\r\n        if (point.startCoordinates) {\r\n          const startAngle = rotationCenter.coordinates.angleWith(\r\n            point.startCoordinates,\r\n          );\r\n          const length = rotationCenter.coordinates.dist(\r\n            point.startCoordinates,\r\n          );\r\n          point.coordinates = new Coordinates({\r\n            x:\r\n              rotationCenter.coordinates.x +\r\n              Math.cos(startAngle + this.angle * this.progress) * length,\r\n            y:\r\n              rotationCenter.coordinates.y +\r\n              Math.sin(startAngle + this.angle * this.progress) * length,\r\n          });\r\n        }\r\n      });\r\n    } else if (app.tool.currentStep == 'animateRefPoint') {\r\n      const coord = app.workspace.lastKnownMouseCoordinates;\r\n      const object = SelectManager.selectObject(coord);\r\n      if (object) {\r\n        this.pointsDrawn[this.pointsDrawn.length - 1].coordinates =\r\n          object.coordinates;\r\n      } else {\r\n        this.pointsDrawn[this.pointsDrawn.length - 1].coordinates = coord;\r\n      }\r\n    }\r\n  }\r\n\r\n  _executeAction() {\r\n    if (this.characteristicElements.type === 'points') {\r\n      this.characteristicElements.elementIds.forEach((elemId, idx) => {\r\n        const element = findObjectById(elemId);\r\n        if (element.layer == 'upper') {\r\n          this.characteristicElements.elementIds[idx] = new SinglePointShape({\r\n            layer: 'main',\r\n            path: `M ${element.coordinates.x} ${element.coordinates.y}`,\r\n            name: 'Point',\r\n            familyName: 'Point',\r\n            geometryObject: new GeometryObject({}),\r\n          }).points[0].id;\r\n        }\r\n      });\r\n    } else {\r\n      const rotationCenter = this.characteristicElements.firstElement;\r\n      if (rotationCenter.layer == 'upper') {\r\n        this.characteristicElements.elementIds[0] = new SinglePointShape({\r\n          layer: 'main',\r\n          path: `M ${rotationCenter.coordinates.x} ${rotationCenter.coordinates.y}`,\r\n          name: 'Point',\r\n          familyName: 'Point',\r\n          geometryObject: new GeometryObject({}),\r\n        }).points[0].id;\r\n      }\r\n    }\r\n\r\n    if (\r\n      !app.workspace.rotationLastCharacteristicElements.find((elements) =>\r\n        this.characteristicElements.equal(elements),\r\n      )\r\n    ) {\r\n      app.workspace.rotationLastCharacteristicElements.push(\r\n        this.characteristicElements,\r\n      );\r\n    }\r\n\r\n    // let vector = this.referenceShape.segments[0];\r\n\r\n    const newShapes = this.involvedShapes.map((s) => {\r\n      const newShape = new s.constructor({\r\n        ...s,\r\n        layer: 'main',\r\n        familyName: 'transformation',\r\n        id: undefined,\r\n        path: s.getSVGPath('no scale', false),\r\n        // divisionPointInfos: s.divisionPoints.map((dp) => {\r\n        //   return { coordinates: dp.coordinates, ratio: dp.ratio, segmentIdx: dp.segments[0].idx, color: dp.color };\r\n        // }),\r\n        segmentsColor: s.segments.map((seg) => {\r\n          return seg.color;\r\n        }),\r\n        pointsColor: s.vertexes.map((pt) => {\r\n          return pt.color;\r\n        }),\r\n        geometryObject: new GeometryObject({\r\n          geometryTransformationChildShapeIds: [],\r\n          geometryTransformationParentShapeId: s.id,\r\n          geometryTransformationCharacteristicElements:\r\n            this.characteristicElements,\r\n          geometryTransformationName: 'rotation',\r\n          geometryIsVisible: s.geometryObject.geometryIsVisible,\r\n          geometryIsHidden: s.geometryObject.geometryIsHidden,\r\n          geometryIsConstaintDraw: s.geometryObject.geometryIsConstaintDraw,\r\n        }),\r\n      });\r\n\r\n      s.geometryObject.geometryTransformationChildShapeIds.push(newShape.id);\r\n      newShape.geometryObject.geometryTransformationCharacteristicElements.elementIds.forEach(\r\n        (refId) => {\r\n          const ref = findObjectById(refId);\r\n          if (\r\n            !ref.shape.geometryObject.geometryTransformationChildShapeIds.includes(\r\n              newShape.id,\r\n            )\r\n          ) {\r\n            ref.shape.geometryObject.geometryTransformationChildShapeIds.push(\r\n              newShape.id,\r\n            );\r\n          }\r\n        },\r\n      );\r\n\r\n      // newShape.geometryObject.geometryTransformationCharacteristicElementIds.map((refId) => {\r\n      //   let ref = findObjectById(refId);\r\n      //   if (!ref.shape.geometryObject.geometryTransformationChildShapeIds.includes(newShape.id)) {\r\n      //     ref.shape.geometryObject.geometryTransformationChildShapeIds.push(newShape.id);\r\n      //   }\r\n      // });\r\n\r\n      newShape.rotate(\r\n        this.angle,\r\n        this.characteristicElements.firstElement.coordinates,\r\n      );\r\n      newShape.points.forEach((pt, idx) => {\r\n        pt.geometryIsVisible = s.points[idx].geometryIsVisible;\r\n        pt.geometryIsHidden = s.points[idx].geometryIsHidden;\r\n      });\r\n      return newShape;\r\n    });\r\n\r\n    if (newShapes.length > 1) {\r\n      const userGroup = new ShapeGroup(0, 1);\r\n      userGroup.shapesIds = newShapes.map((s) => s.id);\r\n      GroupManager.addGroup(userGroup);\r\n    }\r\n  }\r\n\r\n  setSelectionConstraints() {\r\n    const constraints = app.fastSelectionConstraints.mousedown_all_shape;\r\n    constraints.shapes.blacklist = app.mainCanvasLayer.shapes.filter(\r\n      (s) => s.geometryObject.geometryPointOnTheFlyChildId,\r\n    );\r\n    app.workspace.selectionConstraints = constraints;\r\n  }\r\n\r\n  showLastCharacteristicElements(typeOfObjectToShow) {\r\n    if (typeOfObjectToShow === 'rotationCenter') {\r\n      const allRotationCenters =\r\n        app.workspace.rotationLastCharacteristicElements\r\n          .map((lastElements) => lastElements.firstElement)\r\n          .filter(\r\n            (element, index, elements) => elements.indexOf(element) === index,\r\n          );\r\n      allRotationCenters.forEach((point) => {\r\n        const shape = new SinglePointShape({\r\n          layer: 'upper',\r\n          path: `M ${point.coordinates.x} ${point.coordinates.y}`,\r\n          name: 'Point',\r\n          familyName: 'Point',\r\n          geometryObject: new GeometryObject({\r\n            geometryIsCharacteristicElements: true,\r\n            geometryTransformationCharacteristicElements: null,\r\n          }),\r\n        });\r\n        shape.points[0].color = app.settings.referenceDrawColor2;\r\n        shape.points[0].size = 2;\r\n      });\r\n    } else {\r\n      app.workspace.rotationLastCharacteristicElements.forEach(\r\n        (characteristicElement) => {\r\n          let points;\r\n          if (characteristicElement.type === 'arc') {\r\n            const arc = findObjectById(characteristicElement.elementIds[1]);\r\n            points = [...arc.vertexes, arc.arcCenter];\r\n          } else {\r\n            points = characteristicElement.elements.slice(1);\r\n            // shape.points[0].color = app.settings.referenceDrawColor;\r\n            // shape.points[0].size = 2;\r\n            // shape.points[1].color = app.settings.referenceDrawColor;\r\n            // shape.points[1].size = 2;\r\n            const radius = points[0].coordinates.dist(points[2].coordinates);\r\n            const angle = points[2].coordinates.angleWith(\r\n              points[1].coordinates,\r\n            );\r\n            const projectionCoord = points[2].coordinates.add({\r\n              x: radius * Math.cos(angle),\r\n              y: radius * Math.sin(angle),\r\n            });\r\n            points[1] = new Point({\r\n              layer: 'upper',\r\n              coordinates: projectionCoord,\r\n              isVisible: false,\r\n            });\r\n          }\r\n          const firstVertex = new Point({\r\n            coordinates: points[0].coordinates,\r\n            layer: 'upper',\r\n            color: app.settings.referenceDrawColor,\r\n            size: 0.1,\r\n          });\r\n          const secondVertex = new Point({\r\n            coordinates: points[1].coordinates,\r\n            layer: 'upper',\r\n            color: app.settings.referenceDrawColor,\r\n            size: 0.1,\r\n          });\r\n          const arcCenter = new Point({\r\n            coordinates: points[2].coordinates,\r\n            layer: 'upper',\r\n            color: app.settings.referenceDrawColor,\r\n            size: 0.1,\r\n          });\r\n          const seg = new Segment({\r\n            layer: 'upper',\r\n            idx: 0,\r\n            vertexIds: [firstVertex.id, secondVertex.id],\r\n            arcCenterId: arcCenter.id,\r\n            counterclockwise: !characteristicElement.clockwise,\r\n          });\r\n          const shapeCenter = new Point({\r\n            coordinates: points[2].coordinates,\r\n            layer: 'upper',\r\n            type: 'shapeCenter',\r\n            color: app.settings.referenceDrawColor,\r\n            size: 0.1,\r\n          });\r\n          const shape = new ArrowLineShape({\r\n            layer: 'upper',\r\n            segmentIds: [seg.id],\r\n            pointIds: [firstVertex, secondVertex, arcCenter, shapeCenter].map(\r\n              (pt) => pt.id,\r\n            ),\r\n            name: 'arc',\r\n            familyName: 'circle-shape',\r\n            strokeColor: app.settings.referenceDrawColor2,\r\n            strokeWidth: 2,\r\n            fillOpacity: 0,\r\n            geometryObject: new GeometryObject({\r\n              geometryIsCharacteristicElements: true,\r\n              geometryTransformationCharacteristicElements:\r\n                characteristicElement,\r\n            }),\r\n          });\r\n          seg.shapeId = shape.id;\r\n        },\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Configure les contraintes de s├®lection pour permettre la s├®lection d'arcs\r\n   * @private\r\n   */\r\n  configureArcSelectionConstraints() {\r\n    window.dispatchEvent(new CustomEvent('reset-selection-constraints'));\r\n    app.workspace.selectionConstraints.eventType = 'click';\r\n    app.workspace.selectionConstraints.segments.canSelect = true;\r\n    app.workspace.selectionConstraints.segments.canSelectFromUpper = true;\r\n    app.workspace.selectionConstraints.points.canSelect = true;\r\n    app.workspace.selectionConstraints.shapes.canSelect = true;\r\n    app.workspace.selectionConstraints.shapes.canSelectFromUpper = true;\r\n  }\r\n\r\n  /**\r\n   * Tente de s├®lectionner un objet arc aux coordonn├®es donn├®es\r\n   * @param {Coordinates} coord - Coordonn├®es de s├®lection\r\n   * @returns {Segment|null} Le segment arc trouv├® ou null\r\n   * @private\r\n   */\r\n  trySelectArcObject(coord) {\r\n    let object = SelectManager.selectObject(coord);\r\n\r\n    // Si aucun segment n'est trouv├® directement, chercher dans les formes\r\n    if (!object) {\r\n      const shapesWithArcs = app.mainCanvasLayer.shapes.filter((shape) =>\r\n        shape.segments?.some((seg) => seg.isArc?.()),\r\n      );\r\n\r\n      for (const shape of shapesWithArcs) {\r\n        if (shape.isCoordinatesOnBorder?.(coord)) {\r\n          object = shape.segments.find((seg) => seg.isArc?.());\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    return object;\r\n  }\r\n\r\n  /**\r\n   * Valide les param├¿tres avant ex├®cution\r\n   * @returns {boolean} True si valide\r\n   * @private\r\n   */\r\n  validateExecutionParameters() {\r\n    return (\r\n      this.characteristicElements &&\r\n      this.involvedShapes &&\r\n      this.involvedShapes.length > 0 &&\r\n      typeof this.angle === 'number'\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Rotation\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\ScalarMultiplication\\ScalarMultiplication.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":42,"column":21,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":42,"endColumn":23,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[1177,1179],"text":"!=="},"desc":"Use '!==' instead of '!='."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app, setState } from '../Core/App';\r\nimport { ArrowLineShape } from '../Core/Objects/Shapes/ArrowLineShape';\r\nimport { GeometryObject } from '../Core/Objects/Shapes/GeometryObject';\r\nimport { Tool } from '../Core/States/Tool';\r\nimport { createElem, findObjectById } from '../Core/Tools/general';\r\nimport { computeConstructionSpec } from '../GeometryTools/recomputeShape';\r\n\r\n/**\r\n * Monter des objets.\r\n */\r\nexport class ScalarMultiplicationTool extends Tool {\r\n  constructor() {\r\n    super(\r\n      'scalarMultiplication',\r\n      'Multiplier un vecteur par un scalaire',\r\n      'operation',\r\n    );\r\n\r\n    this.timeoutRef = null;\r\n\r\n    this.drawColor = '#E90CC8';\r\n  }\r\n\r\n  start() {\r\n    window.clearTimeout(this.timeoutRef);\r\n    this.removeListeners();\r\n\r\n    createElem('scalar-popup');\r\n  }\r\n\r\n  selectObject() {\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    window.clearTimeout(this.timeoutRef);\r\n    this.removeListeners();\r\n\r\n    app.workspace.selectionConstraints =\r\n      app.fastSelectionConstraints.click_all_shape;\r\n    this.objectSelectedId = app.addListener('objectSelected', this.handler);\r\n  }\r\n\r\n  objectSelected(object) {\r\n    if (object.name != 'Vector') {\r\n      window.dispatchEvent(\r\n        new CustomEvent('show-notif', {\r\n          detail: { message: 'La figure s├®lectionn├®e doit ├¬tre un vecteur' },\r\n        }),\r\n      );\r\n      return;\r\n    }\r\n\r\n    this.vectorId = object.id;\r\n    new ArrowLineShape({\r\n      layer: 'upper',\r\n      strokeColor: this.drawColor,\r\n      strokeWidth: 3,\r\n      path: object.getSVGPath('no scale', true),\r\n      id: undefined,\r\n    });\r\n    window.dispatchEvent(new CustomEvent('refreshUpper'));\r\n\r\n    this.executeAnimation();\r\n  }\r\n\r\n  end() {\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    window.clearTimeout(this.timeoutRef);\r\n    this.removeListeners();\r\n  }\r\n\r\n  executeAnimation() {\r\n    window.clearTimeout(this.timeoutRef);\r\n    this.timeoutRef = window.setTimeout(() => {\r\n      this.executeAction();\r\n      setState({\r\n        tool: { ...app.tool, name: this.name, currentStep: 'selectObject' },\r\n      });\r\n    }, 200);\r\n  }\r\n\r\n  _executeAction() {\r\n    this.numerator = app.settings.scalarNumerator;\r\n    this.denominator = app.settings.scalarDenominator;\r\n\r\n    const vector = findObjectById(this.vectorId);\r\n    const secondPointCoordinates = vector.vertexes[0].coordinates.add(\r\n      vector.vertexes[1].coordinates\r\n        .substract(vector.vertexes[0].coordinates)\r\n        .multiply(this.numerator / this.denominator),\r\n    );\r\n    let path = [\r\n      'M',\r\n      vector.segments[0].vertexes[0].x,\r\n      vector.segments[0].vertexes[0].y,\r\n      'L',\r\n      secondPointCoordinates.x,\r\n      secondPointCoordinates.y,\r\n    ];\r\n    path = path.join(' ');\r\n\r\n    const newShape = new ArrowLineShape({\r\n      layer: 'main',\r\n      path: path,\r\n      name: vector.name,\r\n      familyName: 'multipliedVector',\r\n      fillColor: vector.fillColor,\r\n      fillOpacity: vector.fillOpacity,\r\n      strokeColor: vector.strokeColor,\r\n      geometryObject: new GeometryObject({\r\n        geometryMultipliedParentShapeId: vector.id,\r\n        geometryConstructionSpec: {\r\n          numerator: this.numerator,\r\n          denominator: this.denominator,\r\n        },\r\n      }),\r\n    });\r\n\r\n    computeConstructionSpec(newShape);\r\n\r\n    vector.geometryObject.geometryMultipliedChildShapeIds.push(newShape.id);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\ScalarMultiplication\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\ScalarMultiplication\\scalar-popup.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":75,"column":71,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":75,"endColumn":73,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1843,1845],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":84,"column":73,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":84,"endColumn":75,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2142,2144],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import '@components/color-button';\r\nimport { TemplatePopup } from '@components/popups/template-popup';\r\nimport { css, html, LitElement } from 'lit';\r\nimport { app, setState } from '../Core/App';\r\nimport { range } from '../Core/Tools/general';\r\n\r\nclass ScalarPopup extends LitElement {\r\n  constructor() {\r\n    super();\r\n\r\n    window.addEventListener(\r\n      'close-popup',\r\n      () => {\r\n        this.submitAndClose();\r\n      },\r\n      {\r\n        once: true,\r\n      },\r\n    );\r\n\r\n    this.updateProperties = () => {\r\n      this.numerator = app.settings.scalarNumerator;\r\n      this.denominator = app.settings.scalarDenominator;\r\n    };\r\n    this.updateProperties();\r\n\r\n    this.eventHandler = () => {\r\n      this.updateProperties();\r\n    };\r\n    window.addEventListener('settings-changed', this.eventHandler);\r\n  }\r\n\r\n  static get properties() {\r\n    return {\r\n      numerator: Number,\r\n      denominator: Number,\r\n    };\r\n  }\r\n\r\n  static get styles() {\r\n    return [\r\n      TemplatePopup.template_popup_styles(),\r\n      css`\r\n        span {\r\n          font-weight: normal;\r\n        }\r\n\r\n        select {\r\n          text-align: center;\r\n          width: 2.5rem;\r\n        }\r\n\r\n        hr {\r\n          height: 4px;\r\n          width: 20%;\r\n          border-width: 0;\r\n          text-align: left;\r\n          margin: 3px auto 3px;\r\n          color: black;\r\n          background-color: black;\r\n        }\r\n      `,\r\n    ];\r\n  }\r\n\r\n  render() {\r\n    return html`\r\n      <template-popup>\r\n        <h2 slot=\"title\">Multiplier un vecteur par un scalaire</h2>\r\n        <div slot=\"body\" id=\"body\">\r\n          <label for=\"settings_divide_number_of_parts\">Multiplier par</label>\r\n          <select @change=\"${this.changeNumerator}\">\r\n            ${range(1, 9).map(\r\n              (x) =>\r\n                html`<option value=\"${x}\" ?selected=\"${this.numerator == x}\">\r\n                  ${x}\r\n                </option>`,\r\n            )}\r\n          </select>\r\n          <hr />\r\n          <select @change=\"${this.changeDenominator}\">\r\n            ${range(1, 9).map(\r\n              (x) =>\r\n                html`<option value=\"${x}\" ?selected=\"${this.denominator == x}\">\r\n                  ${x}\r\n                </option>`,\r\n            )}\r\n          </select>\r\n        </div>\r\n\r\n        <div slot=\"footer\">\r\n          <color-button\r\n            @click=\"${() =>\r\n              window.dispatchEvent(new CustomEvent('close-popup'))}\"\r\n            innerText=\"Ok\"\r\n          ></color-button>\r\n        </div>\r\n      </template-popup>\r\n    `;\r\n  }\r\n\r\n  changeNumerator(event) {\r\n    setState({\r\n      settings: {\r\n        ...app.settings,\r\n        scalarNumerator: parseInt(event.target.value),\r\n      },\r\n    });\r\n  }\r\n\r\n  changeDenominator(event) {\r\n    setState({\r\n      settings: {\r\n        ...app.settings,\r\n        scalarDenominator: parseInt(event.target.value),\r\n      },\r\n    });\r\n  }\r\n\r\n  submit() {\r\n    setState({\r\n      tool: {\r\n        ...app.tool,\r\n        name: 'scalarMultiplication',\r\n        currentStep: 'selectObject',\r\n      },\r\n    });\r\n  }\r\n\r\n  close() {\r\n    this.remove();\r\n    window.removeEventListener('settings-changed', this.eventHandler);\r\n  }\r\n\r\n  submitAndClose() {\r\n    this.submit();\r\n    this.close();\r\n  }\r\n}\r\ncustomElements.define('scalar-popup', ScalarPopup);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Show\\ShowTool.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":148,"column":19,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":148,"endColumn":21,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4977,4979],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":175,"column":26,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":175,"endColumn":28,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5982,5984],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { html } from 'lit';\r\nimport { app, setState } from '../Core/App';\r\nimport { ShapeManager } from '../Core/Managers/ShapeManager';\r\nimport { GeometryObject } from '../Core/Objects/Shapes/GeometryObject';\r\nimport { Shape } from '../Core/Objects/Shapes/Shape';\r\nimport { SinglePointShape } from '../Core/Objects/Shapes/SinglePointShape';\r\nimport { Tool } from '../Core/States/Tool';\r\nimport { addInfoToId, findObjectById } from '../Core/Tools/general';\r\n\r\n/**\r\n * Monter des objets.\r\n */\r\nexport class ShowTool extends Tool {\r\n  constructor() {\r\n    super('show', 'Montrer', 'tool');\r\n  }\r\n\r\n  getHelpText() {\r\n    const toolName = this.title;\r\n    return html`\r\n      <h3>${toolName}</h3>\r\n      <p>Vous avez s├®lectionn├® l'outil <b>\"${toolName}\"</b>.</p>\r\n    `;\r\n  }\r\n\r\n  start() {\r\n    setTimeout(\r\n      () =>\r\n        setState({\r\n          tool: { ...app.tool, name: this.name, currentStep: 'listen' },\r\n        }),\r\n      50,\r\n    );\r\n  }\r\n\r\n  listen() {\r\n    this.showHidden();\r\n    this.removeListeners();\r\n\r\n    window.dispatchEvent(new CustomEvent('reset-selection-constraints'));\r\n    app.workspace.selectionConstraints.eventType = 'click';\r\n    app.workspace.selectionConstraints.shapes.canSelect = true;\r\n    app.workspace.selectionConstraints.shapes.blacklist =\r\n      app.mainCanvasLayer.shapes.map((s) => {\r\n        return { shapeId: s.id };\r\n      });\r\n    app.workspace.selectionConstraints.points.canSelect = true;\r\n    app.workspace.selectionConstraints.points.types = ['divisionPoint'];\r\n    app.workspace.selectionConstraints.shapes.canSelectFromUpper = true;\r\n    app.workspace.selectionConstraints.points.canSelectFromUpper = true;\r\n\r\n    // il faudrait ne pouvoir s├®lectionner que les points cach├®s\r\n\r\n    this.objectSelectedId = app.addListener('objectSelected', this.handler);\r\n  }\r\n\r\n  end() {\r\n    app.mainCanvasLayer.editingShapeIds = [];\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.removeListeners();\r\n  }\r\n\r\n  objectSelected(object) {\r\n    if (object instanceof Shape) {\r\n      this.mode = 'shape';\r\n      this.shapeToShow = object;\r\n    } else {\r\n      this.point = object;\r\n      this.mode = 'divisionPoint';\r\n    }\r\n\r\n    this.executeAction();\r\n    setState({\r\n      tool: { ...app.tool, name: this.name, currentStep: 'listen' },\r\n    });\r\n  }\r\n\r\n  showHidden() {\r\n    app.upperCanvasLayer.removeAllObjects();\r\n\r\n    app.mainCanvasLayer.shapes\r\n      // .filter(s => s.geometryObject.geometryIsHidden === true)\r\n      .forEach((s) => {\r\n        if (s.geometryObject.geometryIsPermanentHidden) return;\r\n        const newShape = new s.constructor({\r\n          ...s,\r\n          layer: 'upper',\r\n          path: s.getSVGPath('no scale', false, false),\r\n          strokeColor: s.strokeColor,\r\n          divisionPointInfos: s.divisionPoints.map((dp) => {\r\n            return {\r\n              coordinates: dp.coordinates,\r\n              ratio: dp.ratio,\r\n              segmentIdx: dp.segments[0].idx,\r\n              id: dp.id,\r\n              color: dp.color,\r\n            };\r\n          }),\r\n          segmentsColor: s.segments.map((seg) => {\r\n            return seg.color;\r\n          }),\r\n          pointsColor: s.points.map((pt) => {\r\n            return s.geometryObject.geometryIsHidden === true\r\n              ? '#f00'\r\n              : pt.color;\r\n          }),\r\n          geometryObject: new GeometryObject({\r\n            ...s.geometryObject,\r\n            geometryIsHidden: false,\r\n          }),\r\n        });\r\n        if (s.geometryObject.geometryIsHidden === true) {\r\n          newShape.drawHidden = true;\r\n        }\r\n        const segIds = newShape.segments.map(\r\n          (seg, idx) => (seg.id = s.segments[idx].id),\r\n        );\r\n        const ptIds = newShape.points.map(\r\n          (pt, idx) => (pt.id = s.points[idx].id),\r\n        );\r\n        newShape.segmentIds = [...segIds];\r\n        newShape.pointIds = [...ptIds];\r\n        newShape.points.forEach((pt, idx) => {\r\n          pt.segmentIds = [...s.points[idx].segmentIds];\r\n          pt.reference = s.points[idx].reference;\r\n          pt.type = s.points[idx].type;\r\n          pt.ratio = s.points[idx].ratio;\r\n          pt.visible = s.points[idx].visible;\r\n          if (s.points[idx].geometryIsHidden) pt.color = '#f00';\r\n        });\r\n        newShape.segments.forEach((seg, idx) => {\r\n          seg.isInfinite = s.segments[idx].isInfinite;\r\n          seg.isSemiInfinite = s.segments[idx].isSemiInfinite;\r\n          seg.vertexIds = [...s.segments[idx].vertexIds];\r\n          seg.divisionPointIds = [...s.segments[idx].divisionPointIds];\r\n          seg.arcCenterId = s.segments[idx].arcCenterId;\r\n        });\r\n        return newShape;\r\n      });\r\n    app.mainCanvasLayer.editingShapeIds = app.mainCanvasLayer.shapes\r\n      // .filter(s => s.geometryObject.geometryIsHidden === true)\r\n      .map((s) => s.id);\r\n    window.dispatchEvent(new CustomEvent('refresh'));\r\n    window.dispatchEvent(new CustomEvent('refreshUpper'));\r\n  }\r\n\r\n  _executeAction() {\r\n    if (this.mode == 'shape') {\r\n      const workingShapes = ShapeManager.getAllBindedShapes(\r\n        findObjectById(addInfoToId(this.shapeToShow.id, 'main')),\r\n      );\r\n      workingShapes.forEach((s) => {\r\n        s.geometryObject.geometryIsHidden = false;\r\n      });\r\n      app.mainCanvasLayer.shapes.forEach((s) => {\r\n        if (s instanceof SinglePointShape) {\r\n          const child = findObjectById(\r\n            s.geometryObject.geometryPointOnTheFlyChildId,\r\n          );\r\n          if (child)\r\n            s.geometryObject.geometryIsHidden =\r\n              child.geometryObject.geometryIsHidden;\r\n        }\r\n      });\r\n      app.mainCanvasLayer.shapes.forEach((s) => {\r\n        if (s.geometryObject.geometryIsConstaintDraw) {\r\n          const child = findObjectById(\r\n            s.geometryObject.geometryChildShapeIds[0],\r\n          );\r\n          if (child)\r\n            s.geometryObject.geometryIsHidden =\r\n              child.geometryObject.geometryIsHidden;\r\n        }\r\n      });\r\n    } else if (this.mode == 'divisionPoint') {\r\n      findObjectById(addInfoToId(this.point.id, 'main')).geometryIsHidden =\r\n        false;\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Show\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Tangram\\Silhouette.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Tangram\\SilhouetteCreatorTool.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":10,"column":16,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":10,"endColumn":18,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[333,335],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":23,"column":43,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":23,"endColumn":45,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[660,662],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":24,"column":43,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":24,"endColumn":45,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[738,740],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":65,"column":18,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":65,"endColumn":20,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2015,2017],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":69,"column":17,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":69,"endColumn":19,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[2136,2138],"text":"!=="},"desc":"Use '!==' instead of '!='."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { tools } from '@store/tools';\r\nimport { LitElement } from 'lit';\r\nimport { app, setState } from '../Core/App';\r\nimport { Silhouette } from './Silhouette';\r\nimport { TangramManager } from './TangramManager';\r\n\r\nconst hasOverlapedShape = (shapes) => {\r\n  return shapes.some((shape) =>\r\n    shapes.some((s) => {\r\n      if (s.id == shape.id) return false;\r\n      else return s.overlapsWith(shape);\r\n    }),\r\n  );\r\n};\r\n\r\n/**\r\n * Cr├®er une silhouette\r\n */\r\nexport class SilhouetteCreatorTool extends LitElement {\r\n  async connectedCallback() {\r\n    super.connectedCallback();\r\n    const currentTools = tools.get();\r\n    currentTools.find((tool) => tool.name == 'translate').isDisable = false;\r\n    currentTools.find((tool) => tool.name == 'color').isDisable = true;\r\n    tools.set([...currentTools]);\r\n    app.isUserWarnedAboutOverlap = false;\r\n    app.workspace.selectionConstraints =\r\n      app.fastSelectionConstraints.mousedown_all_shape;\r\n\r\n    await TangramManager.initShapes(true);\r\n\r\n    setState({\r\n      history: {\r\n        ...app.history,\r\n        startSituation: {\r\n          ...app.workspace.data,\r\n        },\r\n      },\r\n    });\r\n    window.addEventListener('actions-executed', this.verifyOverlappingShapes);\r\n    window.addEventListener('create-silhouette', this.createSilhouette);\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    super.disconnectedCallback();\r\n    window.removeEventListener(\r\n      'actions-executed',\r\n      this.verifyOverlappingShapes,\r\n    );\r\n    window.removeEventListener('create-silhouette', this.createSilhouette);\r\n  }\r\n\r\n  createSilhouette() {\r\n    const shapes = app.mainCanvasLayer.shapes;\r\n    if (!hasOverlapedShape(shapes)) return new Silhouette(shapes);\r\n  }\r\n\r\n  verifyOverlappingShapes() {\r\n    let overlap = false;\r\n    app.mainCanvasLayer.shapes.forEach((s) => {\r\n      s.isOverlappingAnotherInTangram = false;\r\n    });\r\n    app.mainCanvasLayer.shapes.forEach((s, idx, shapes) => {\r\n      const index = app.mainCanvasLayer.shapes.findIndex((s2) => {\r\n        if (s.id == s2.id) return false;\r\n        if (s.overlapsWith(s2)) return true;\r\n        return false;\r\n      });\r\n      if (index != -1) {\r\n        overlap = true;\r\n        s.isOverlappingAnotherInTangram = true;\r\n        shapes[index].isOverlappingAnotherInTangram = true;\r\n      }\r\n    });\r\n\r\n    if (overlap && !app.isUserWarnedAboutOverlap) {\r\n      window.dispatchEvent(\r\n        new CustomEvent('show-notif', {\r\n          detail: { message: 'Certaines figures se superposent.' },\r\n        }),\r\n      );\r\n      app.isUserWarnedAboutOverlap = true;\r\n    }\r\n  }\r\n}\r\ncustomElements.define('silhouette-creator-tool', SilhouetteCreatorTool);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Tangram\\SolutionCheckerTool.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":59,"column":28,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":59,"endColumn":30,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1949,1951],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":78,"column":17,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":78,"endColumn":19,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2470,2472],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":78,"column":31,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":78,"endColumn":33,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2484,2486],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":90,"column":43,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":90,"endColumn":45,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2991,2993],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":91,"column":43,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":91,"endColumn":45,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3068,3070],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":159,"column":20,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":159,"endColumn":22,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4735,4737],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":160,"column":26,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":160,"endColumn":28,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4782,4784],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":162,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":162,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4877,4879],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":164,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":164,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[4930,4932],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":165,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":165,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[4970,4972],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":166,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":166,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[5012,5014],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":167,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":167,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[5050,5052],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":168,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":168,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[5096,5098],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":176,"column":18,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":176,"endColumn":20,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5264,5266],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":183,"column":20,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":183,"endColumn":22,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5465,5467],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":189,"column":29,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":189,"endColumn":31,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5662,5664],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":191,"column":61,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":191,"endColumn":63,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5752,5754],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":192,"column":15,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":192,"endColumn":17,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[5777,5779],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":198,"column":29,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":198,"endColumn":31,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[5984,5986],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":263,"column":31,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":263,"endColumn":33,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[7889,7891],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":277,"column":15,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":277,"endColumn":17,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8368,8370],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":290,"column":23,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":290,"endColumn":25,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8792,8794],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":303,"column":24,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":303,"endColumn":26,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[9152,9154],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":323,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":323,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[9974,9976],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"prefer-const","severity":1,"message":"'radius' is never reassigned. Use 'const' instead.","line":356,"column":11,"nodeType":"Identifier","messageId":"useConst","endLine":356,"endColumn":17},{"ruleId":"prefer-const","severity":1,"message":"'firstAngle' is never reassigned. Use 'const' instead.","line":357,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":357,"endColumn":19}],"suppressedMessages":[],"errorCount":24,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { html, LitElement } from 'lit';\r\nimport { tools } from '../../store/tools';\r\nimport { app, setState } from '../Core/App';\r\nimport { GroupManager } from '../Core/Managers/GroupManager';\r\nimport { Bounds } from '../Core/Objects/Bounds';\r\nimport { Coordinates } from '../Core/Objects/Coordinates';\r\nimport { Segment } from '../Core/Objects/Segment';\r\nimport { ShapeGroup } from '../Core/Objects/ShapeGroup';\r\nimport { RegularShape } from '../Core/Objects/Shapes/RegularShape';\r\nimport { createElem } from '../Core/Tools/general.js';\r\nimport { Silhouette } from './Silhouette';\r\nimport { TangramManager } from './TangramManager';\r\n\r\nexport const closeForbiddenCanvas = () => {\r\n  app.workspace.limited = false;\r\n  app.tangramCanvasLayer.style.backgroundColor = 'transparent';\r\n  app.tangramCanvasLayer.style.zIndex = 0;\r\n};\r\n\r\nexport class SolutionCheckerTool extends LitElement {\r\n  static properties = {\r\n    data: { type: Object },\r\n  };\r\n\r\n  render() {\r\n    if (!this.data) return this.renderOpenPopup();\r\n    closeForbiddenCanvas();\r\n    app.tangramCanvasLayer.removeAllObjects();\r\n    this.eraseSolution();\r\n    this.solutionShapes = null;\r\n    this.initData(this.data);\r\n  }\r\n\r\n  renderOpenPopup() {\r\n    import('@components/popups/open-popup');\r\n    return html`<open-popup></open-popup>`;\r\n  }\r\n\r\n  showMenu() {\r\n    this.stateMenu = app.left_menu.querySelector('state-menu');\r\n    if (!this.stateMenu) {\r\n      import('./state-menu');\r\n      this.stateMenu = document.createElement('state-menu');\r\n      app.left_menu.appendChild(this.stateMenu);\r\n    }\r\n  }\r\n\r\n  static async selectLevel() {\r\n    await import('./level-popup.js');\r\n    const popup = createElem('level-popup');\r\n    return new Promise(\r\n      (resolve) => (popup.onselect = (e) => resolve(e.detail)),\r\n    );\r\n  }\r\n\r\n  async initData(data) {\r\n    const level =\r\n      data.tangramLevelSelected || (await SolutionCheckerTool.selectLevel());\r\n    if (data.fileExtension == 'ags') await TangramManager.initShapes();\r\n\r\n    // Chercher les backObjects dans diff├®rents emplacements possibles\r\n    const backObjects =\r\n      data.wsdata?.backObjects ||\r\n      data.workspaceData?.backObjects ||\r\n      app.workspace?.data?.backObjects;\r\n\r\n    if (!backObjects) {\r\n      console.warn(\r\n        'ÔÜá´©Å SolutionCheckerTool: Aucun backObjects trouv├® dans les donn├®es',\r\n      );\r\n    }\r\n\r\n    let isSilhouetteShown = false;\r\n\r\n    if (backObjects) {\r\n      isSilhouetteShown = true;\r\n\r\n      if (level == 3 || level == 4) {\r\n        app.workspace.limited = true;\r\n        app.tangramCanvasLayer.style = `left:50%; background-color: rgba(255, 0, 0, 0.2); z-index: 10;`;\r\n      }\r\n\r\n      // Ensure canvas is clean before creating silhouette\r\n      app.tangramCanvasLayer.removeAllObjects();\r\n\r\n      const silhouette = new Silhouette(backObjects.shapesData, true, level);\r\n      silhouette.positionInTangramCanvas(data.fileExtension);\r\n    }\r\n    const currentTools = tools.get();\r\n    currentTools.find((tool) => tool.name == 'translate').isDisable = true;\r\n    currentTools.find((tool) => tool.name == 'color').isDisable = false;\r\n    tools.set([...currentTools]);\r\n    setState({\r\n      tangram: { ...app.defaultState.tangram, isSilhouetteShown, level },\r\n    });\r\n\r\n    if (app.history.startSituation == null) {\r\n      setState({\r\n        history: {\r\n          ...app.defaultState.history,\r\n          startSituation: {\r\n            ...app.workspace.data,\r\n            tangram: {\r\n              isSilhouetteShown: true,\r\n              currentStep: 'start',\r\n            },\r\n          },\r\n          startSettings: { ...app.settings },\r\n        },\r\n      });\r\n    }\r\n    this.showMenu();\r\n  }\r\n\r\n  connectedCallback() {\r\n    super.connectedCallback();\r\n    this.tangramListener = app.addListener(\r\n      'tangram-changed',\r\n      this.handler.bind(this),\r\n    );\r\n    this.objectSelectedId = app.addListener(\r\n      'objectSelected',\r\n      this.handler.bind(this),\r\n    );\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    super.disconnectedCallback();\r\n    this.stateMenu.close();\r\n    closeForbiddenCanvas();\r\n    app.removeListener('objectSelected', this.objectSelectedId);\r\n    app.removeListener('tangram-changed', this.tangramListener);\r\n  }\r\n\r\n  check() {\r\n    this.checkSolution();\r\n    setState({\r\n      tool: {\r\n        name: 'verifySolution',\r\n        title: 'V├®rifier la solution',\r\n        currentStep: 'start',\r\n      },\r\n    });\r\n    window.dispatchEvent(\r\n      new CustomEvent('actions-executed', {\r\n        detail: { name: 'V├®rifier la solution' },\r\n      }),\r\n    );\r\n  }\r\n\r\n  uncheck() {\r\n    this.eraseSolution();\r\n  }\r\n\r\n  handler(event) {\r\n    if (this.stateMenu)\r\n      this.stateMenu.check = app.tangram.currentStep === 'check';\r\n\r\n    if (event.type == 'tool-updated') {\r\n      if (app.tool?.name == this.name) {\r\n        this[app.tool.currentStep]();\r\n      } else if (app.tool?.currentStep == 'start') {\r\n        if (\r\n          app.tool.name != 'rotate' &&\r\n          app.tool.name != 'rotate45' &&\r\n          app.tool.name != 'move' &&\r\n          app.tool.name != 'solveChecker' &&\r\n          app.tool.name != 'verifySolution'\r\n        ) {\r\n          setState({ tangram: { ...app.tangram, currentStep: 'uncheck' } });\r\n        }\r\n      }\r\n    }\r\n\r\n    if (\r\n      event.type == 'tangram-changed' &&\r\n      ['check', 'uncheck'].includes(app.tangram.currentStep) &&\r\n      !app.fullHistory.isRunning\r\n    ) {\r\n      this[app.tangram.currentStep]();\r\n    }\r\n\r\n    if (event.type == 'objectSelected')\r\n      this.objectSelected(event.detail.object);\r\n  }\r\n\r\n  objectSelected(object) {\r\n    const solutionShapes = app.mainCanvasLayer.shapes.filter(\r\n      (shape) => shape.name == 'tangramChecker',\r\n    );\r\n    const index = solutionShapes.findIndex((s) => object.id == s.id);\r\n    if (index == -1)\r\n      setState({ tangram: { ...app.tangram, currentStep: 'uncheck' } });\r\n  }\r\n\r\n  eraseSolution() {\r\n    app.mainCanvasLayer.shapes = app.mainCanvasLayer.shapes.filter(\r\n      (shape) => shape.name != 'tangramChecker',\r\n    );\r\n    window.dispatchEvent(new CustomEvent('refresh'));\r\n  }\r\n\r\n  checkSolution() {\r\n    if (this.solutionShapes)\r\n      this.solutionShapes.forEach((shape) =>\r\n        app.mainCanvasLayer.shapes.push(shape),\r\n      );\r\n    else this.solutionShapes = this.solution;\r\n  }\r\n\r\n  get solution() {\r\n    const segmentsList = this.checkGroupMerge(app.tangramCanvasLayer.shapes);\r\n    const paths = this.linkNewSegments(segmentsList);\r\n    const shapes = [];\r\n\r\n    paths.forEach((path) => {\r\n      const shape = new RegularShape({\r\n        layer: 'main',\r\n        path: path,\r\n        color: '#000',\r\n        fillOpacity: 0,\r\n        strokeColor: '#00D084',\r\n        strokeWidth: 3,\r\n        isPointed: false,\r\n        name: 'tangramChecker',\r\n      });\r\n      shape.cleanSameDirectionSegment();\r\n      shapes.push(shape);\r\n    });\r\n\r\n    if (app.tangram.level > 4) {\r\n      const silhouetteBounds = Bounds.getOuterBounds(\r\n        ...shapes.map((s) => s.bounds),\r\n      );\r\n      const center = new Coordinates({\r\n        x: (silhouetteBounds.maxX + silhouetteBounds.minX) / 2,\r\n        y: (silhouetteBounds.maxY + silhouetteBounds.minY) / 2,\r\n      });\r\n      shapes.forEach((s) => s.homothety(10 / 6, center));\r\n    }\r\n\r\n    if (shapes.length > 1) {\r\n      const userGroup = new ShapeGroup(0, 1);\r\n      userGroup.shapesIds = shapes.map((s) => s.id);\r\n      GroupManager.addGroup(userGroup);\r\n    }\r\n    return shapes;\r\n  }\r\n\r\n  checkGroupMerge(shapes) {\r\n    const oldSegments = shapes.flatMap((s) =>\r\n      s.segments.map((seg) => {\r\n        return new Segment({\r\n          layer: 'invisible',\r\n          createFromNothing: true,\r\n          vertexCoordinates: seg.points.map((vx) => vx.coordinates),\r\n        });\r\n      }),\r\n    );\r\n\r\n    const cutSegments = oldSegments.flatMap((segment, idx, segments) => {\r\n      const vertexesInside = segments\r\n        .filter((seg, i) => i != idx)\r\n        .flatMap((seg) =>\r\n          seg.vertexes.filter(\r\n            (vertex) =>\r\n              segment.isCoordinatesOnSegment(vertex.coordinates) &&\r\n              !segment.vertexes.some((vert) =>\r\n                vert.coordinates.equal(vertex.coordinates),\r\n              ),\r\n          ),\r\n        )\r\n        .filter(\r\n          (vertex, idx, vertexes) =>\r\n            vertexes.findIndex((v) =>\r\n              v.coordinates.equal(vertex.coordinates),\r\n            ) == idx,\r\n        );\r\n      if (vertexesInside.length) return segment.divideWith(vertexesInside);\r\n      else return segment;\r\n    });\r\n\r\n    // delete common segments\r\n    const newSegments = [];\r\n    cutSegments.forEach((seg, i, segments) => {\r\n      if (seg.used) return;\r\n      const segs = segments\r\n        .map((segment) => (segment.equal(seg) ? segment : undefined))\r\n        .filter(Boolean);\r\n      if (segs.length == 1) newSegments.push(seg);\r\n      else segs.forEach((seg) => (seg.used = true));\r\n    });\r\n    app.invisibleCanvasLayer.shapes = [];\r\n    return newSegments;\r\n  }\r\n\r\n  linkNewSegments(segmentsList) {\r\n    let paths = [];\r\n    let segmentUsed = 0;\r\n    const numberOfSegments = segmentsList.length;\r\n    let numberOfPathCreated = 0;\r\n\r\n    while (segmentUsed != numberOfSegments) {\r\n      const startCoordinates = segmentsList[0].vertexes[0].coordinates;\r\n      paths.push([]);\r\n      paths[numberOfPathCreated].push(\r\n        'M',\r\n        startCoordinates.x,\r\n        startCoordinates.y,\r\n      );\r\n      let nextSegmentIndex = 0;\r\n      this.addPathElem(paths[numberOfPathCreated], segmentsList[0]);\r\n      this.lastUsedCoordinates = segmentsList[0].vertexes[1].coordinates;\r\n      segmentsList.splice(nextSegmentIndex, 1);\r\n      segmentUsed++;\r\n\r\n      while (!this.lastUsedCoordinates.equal(startCoordinates)) {\r\n        const potentialSegmentIdx = segmentsList\r\n          .map((seg, idx) =>\r\n            seg.contains(this.lastUsedCoordinates, false) ? idx : undefined,\r\n          )\r\n          .filter((seg) => Number.isInteger(seg));\r\n        if (potentialSegmentIdx.length == 0) {\r\n          console.info('shape cannot be closed (dead end)');\r\n          return null;\r\n        }\r\n        nextSegmentIndex = potentialSegmentIdx[0];\r\n        const nextSegment = segmentsList[nextSegmentIndex];\r\n        let mustReverse = false;\r\n        if (\r\n          !nextSegment.vertexes[0].coordinates.equal(this.lastUsedCoordinates)\r\n        ) {\r\n          mustReverse = true;\r\n        }\r\n        this.addPathElem(paths[numberOfPathCreated], nextSegment, mustReverse);\r\n        segmentsList.splice(nextSegmentIndex, 1);\r\n        segmentUsed++;\r\n      }\r\n      numberOfPathCreated++;\r\n    }\r\n\r\n    paths = paths.map((path) => path.join(' '));\r\n\r\n    return paths;\r\n  }\r\n\r\n  addPathElem(path, segment, mustReverse) {\r\n    let firstCoord = segment.vertexes[0].coordinates;\r\n    let secondCoord = segment.vertexes[1].coordinates;\r\n    if (mustReverse) [firstCoord, secondCoord] = [secondCoord, firstCoord];\r\n    this.lastUsedCoordinates = secondCoord;\r\n    if (!segment.isArc()) {\r\n      path.push('L', secondCoord.x, secondCoord.y);\r\n    } else {\r\n      const centerCoordinates = segment.arcCenter.coordinates;\r\n      let radius = centerCoordinates.dist(secondCoord),\r\n        firstAngle = centerCoordinates.angleWith(firstCoord),\r\n        secondAngle = centerCoordinates.angleWith(secondCoord);\r\n\r\n      if (secondAngle < firstAngle) secondAngle += 2 * Math.PI;\r\n      let largeArcFlag = secondAngle - firstAngle > Math.PI ? 1 : 0,\r\n        sweepFlag = 1;\r\n      if (segment.counterclockwise) {\r\n        sweepFlag = Math.abs(sweepFlag - 1);\r\n        largeArcFlag = Math.abs(largeArcFlag - 1);\r\n      }\r\n      path.push(\r\n        'A',\r\n        radius,\r\n        radius,\r\n        0,\r\n        largeArcFlag,\r\n        sweepFlag,\r\n        secondCoord.x,\r\n        secondCoord.y,\r\n      );\r\n    }\r\n  }\r\n}\r\ncustomElements.define('solution-checker-tool', SolutionCheckerTool);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Tangram\\TangramManager.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":14,"column":43,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":14,"endColumn":45,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[487,489],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":15,"column":43,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":15,"endColumn":45,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[564,566],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":35,"column":27,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":35,"endColumn":29,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[1316,1318],"text":"!=="},"desc":"Use '!==' instead of '!='."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { html, LitElement } from 'lit';\r\nimport { tools } from '../../store/tools.js';\r\nimport { app, setState } from '../Core/App.js';\r\nimport { setWorkspaceFromObject } from '../Core/Managers/WorkspaceManager.js';\r\nimport kit from './tangramShapeKit.json';\r\n\r\nexport class TangramManager extends LitElement {\r\n  static properties = {\r\n    mode: { type: String },\r\n  };\r\n\r\n  tangramStart = async () => {\r\n    const currentTools = tools.get();\r\n    currentTools.find((tool) => tool.name == 'translate').isDisable = true;\r\n    currentTools.find((tool) => tool.name == 'color').isDisable = true;\r\n    tools.set([...currentTools]);\r\n  };\r\n\r\n  static async initShapes(isForCreation = false) {\r\n    const ws = kit;\r\n    const zoom = app.workspace.zoomLevel;\r\n    if (!app.tangram.defaultColor) app.tangram.defaultColor = '#006CAA';\r\n    ws.objects.shapesData.forEach((s) => {\r\n      s.fillColor = isForCreation ? '#000' : app.tangram.defaultColor;\r\n      s.strokeColor = isForCreation ? '#fff' : '#000';\r\n      s.fillOpacity = isForCreation ? 1 : 0.5;\r\n    });\r\n    await setWorkspaceFromObject(ws, false);\r\n    if (zoom < app.workspace.zoomLevel) app.workspace.zoomLevel = zoom;\r\n    window.dispatchEvent(new CustomEvent('refresh'));\r\n  }\r\n\r\n  readFile(event) {\r\n    this.data = event.detail;\r\n    if (this.data.envName != 'Tangram') return;\r\n    this.mode = 'reproduction';\r\n    this.requestUpdate();\r\n  }\r\n\r\n  reset() {\r\n    setState({ tangram: { ...app.defaultState.tangram } });\r\n    this.tangramStart();\r\n    this.mode = null;\r\n    this.data = null;\r\n  }\r\n\r\n  render() {\r\n    if (this.mode === 'reproduction') {\r\n      import('./SolutionCheckerTool.js');\r\n      return html`<solution-checker-tool\r\n        .data=\"${this.data}\"\r\n      ></solution-checker-tool>`;\r\n    }\r\n    if (this.mode === 'creation') {\r\n      import('./SilhouetteCreatorTool.js');\r\n      return html`<silhouette-creator-tool></silhouette-creator-tool>`;\r\n    }\r\n    if (app.dataLoading) return;\r\n    import('./start-popup.js');\r\n    return html`<start-popup\r\n      @close=\"${(event) => (this.mode = event.target.mode)}\"\r\n    ></start-popup>`;\r\n  }\r\n\r\n  connectedCallback() {\r\n    super.connectedCallback();\r\n    this.tangramStart();\r\n    this.resetListener = app.addListener('new-window', this.reset.bind(this));\r\n    this.fileListener = app.addListener(\r\n      'file-parsed',\r\n      this.readFile.bind(this),\r\n    );\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    super.disconnectedCallback();\r\n    app.tangramCanvasLayer.removeAllObjects();\r\n    app.removeListener('new-window', this.resetListener);\r\n    app.removeListener('file-parsed', this.fileListener);\r\n  }\r\n}\r\ncustomElements.define('tangram-manager', TangramManager);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Tangram\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Tangram\\level-popup.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":40,"column":38,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":40,"endColumn":40,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[939,941],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":50,"column":38,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":50,"endColumn":40,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1268,1270],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":60,"column":38,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":60,"endColumn":40,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1596,1598],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":70,"column":38,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":70,"endColumn":40,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1946,1948],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":80,"column":38,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":80,"endColumn":40,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2295,2297],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":95,"column":38,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":95,"endColumn":40,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2712,2714],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import '@components/color-button';\r\nimport { TemplatePopup } from '@components/popups/template-popup';\r\nimport { css, html, LitElement } from 'lit';\r\n\r\nclass LevelPopup extends LitElement {\r\n  static properties = {\r\n    level: { type: Number },\r\n  };\r\n\r\n  constructor() {\r\n    super();\r\n    this.level = 1;\r\n  }\r\n\r\n  static styles = [\r\n    TemplatePopup.template_popup_styles(),\r\n    css`\r\n      .choice {\r\n        display: flex;\r\n        align-items: center;\r\n        width: 100%;\r\n      }\r\n      input[type='radio'] {\r\n        display: inline;\r\n      }\r\n    `,\r\n  ];\r\n\r\n  render() {\r\n    return html`\r\n      <template-popup>\r\n        <h2 slot=\"title\">Niveau de difficult├®</h2>\r\n        <div slot=\"body\">\r\n          <div class=\"choice\" @click=\"${() => (this.level = 1)}\">\r\n            <input\r\n              type=\"radio\"\r\n              id=\"level1\"\r\n              name=\"level\"\r\n              value=\"1\"\r\n              .checked=\"${this.level == 1}\"\r\n            />\r\n            <label for=\"level1\">1 Avec lignes</label>\r\n          </div>\r\n          <div class=\"choice\" @click=\"${() => (this.level = 2)}\">\r\n            <input\r\n              type=\"radio\"\r\n              id=\"level2\"\r\n              name=\"level\"\r\n              value=\"2\"\r\n              .checked=\"${this.level == 2}\"\r\n            />\r\n            <label for=\"level2\">2 Sans ligne</label>\r\n          </div>\r\n          <div class=\"choice\" @click=\"${() => (this.level = 3)}\">\r\n            <input\r\n              type=\"radio\"\r\n              id=\"level3\"\r\n              name=\"level\"\r\n              value=\"3\"\r\n              .checked=\"${this.level == 3}\"\r\n            />\r\n            <label for=\"level3\">3 Pas de superposition avec lignes</label>\r\n          </div>\r\n          <div class=\"choice\" @click=\"${() => (this.level = 4)}\">\r\n            <input\r\n              type=\"radio\"\r\n              id=\"level4\"\r\n              name=\"level\"\r\n              value=\"4\"\r\n              .checked=\"${this.level == 4}\"\r\n            />\r\n            <label for=\"level4\">4 Pas de superposition sans ligne</label>\r\n          </div>\r\n          <div class=\"choice\" @click=\"${() => (this.level = 5)}\">\r\n            <input\r\n              type=\"radio\"\r\n              id=\"level5\"\r\n              name=\"level\"\r\n              value=\"5\"\r\n              .checked=\"${this.level == 5}\"\r\n            />\r\n            <label for=\"level5\">5 Echelle diff├®rente avec lignes</label>\r\n          </div>\r\n          <div\r\n            class=\"choice\"\r\n            @click=\"${() => {\r\n              this.level = 6;\r\n            }}\"\r\n          >\r\n            <input\r\n              type=\"radio\"\r\n              id=\"level6\"\r\n              name=\"level\"\r\n              value=\"6\"\r\n              .checked=\"${this.level == 6}\"\r\n            />\r\n            <label for=\"level6\">6 Echelle diff├®rente sans ligne</label>\r\n          </div>\r\n        </div>\r\n        <div slot=\"footer\">\r\n          <color-button @click=\"${this.submit}\" innerText=\"OK\"></color-button>\r\n        </div>\r\n      </template-popup>\r\n    `;\r\n  }\r\n\r\n  firstUpdated() {\r\n    window.addEventListener('close-popup', () => this.submit());\r\n  }\r\n\r\n  submit() {\r\n    this.dispatchEvent(new CustomEvent('select', { detail: this.level }));\r\n    this.close();\r\n  }\r\n\r\n  close() {\r\n    this.remove();\r\n  }\r\n}\r\ncustomElements.define('level-popup', LevelPopup);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Tangram\\start-popup.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Tangram\\state-menu.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\ToBackground\\ToBackgroundTool.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\ToBackground\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Transform\\TransformTool.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":126,"column":23,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":126,"endColumn":25,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3925,3927],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":224,"column":26,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":224,"endColumn":28,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7293,7295],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":270,"column":31,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":270,"endColumn":33,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8725,8727],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":307,"column":20,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":307,"endColumn":22,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[9976,9978],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":314,"column":39,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":314,"endColumn":41,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[10191,10193],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":322,"column":27,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":322,"endColumn":29,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[10463,10465],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":323,"column":27,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":323,"endColumn":29,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[10510,10512],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":348,"column":32,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":348,"endColumn":34,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[11571,11573],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":349,"column":32,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":349,"endColumn":34,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[11623,11625],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":364,"column":21,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":364,"endColumn":23,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[12056,12058],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":395,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":395,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[12963,12965],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":398,"column":22,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":398,"endColumn":24,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[13118,13120],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":400,"column":46,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":400,"endColumn":48,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[13238,13240],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":417,"column":21,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":417,"endColumn":23,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[13747,13749],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":417,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":417,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[13766,13768],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":431,"column":22,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":431,"endColumn":24,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[14241,14243],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":464,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":464,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[15341,15343],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":470,"column":35,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":470,"endColumn":37,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[15560,15562],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":485,"column":48,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":485,"endColumn":50,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[16010,16012],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":497,"column":23,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":497,"endColumn":25,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[16502,16504],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":497,"column":42,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":497,"endColumn":44,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[16521,16523],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":513,"column":26,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":513,"endColumn":28,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[16939,16941],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":544,"column":33,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":544,"endColumn":35,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[17969,17971],"text":"!=="},"desc":"Use '!==' instead of '!='."}]}],"suppressedMessages":[],"errorCount":23,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { html } from 'lit';\r\nimport { app, setState } from '../Core/App';\r\nimport { SelectManager } from '../Core/Managers/SelectManager';\r\nimport { ShapeManager } from '../Core/Managers/ShapeManager';\r\nimport { Coordinates } from '../Core/Objects/Coordinates';\r\nimport { Point } from '../Core/Objects/Point';\r\nimport { GeometryObject } from '../Core/Objects/Shapes/GeometryObject';\r\nimport { LineShape } from '../Core/Objects/Shapes/LineShape';\r\nimport { Tool } from '../Core/States/Tool';\r\nimport { addInfoToId, findObjectById } from '../Core/Tools/general';\r\nimport { duplicateShape } from '../Core/Tools/shapesTools';\r\nimport {\r\n  computeConstructionSpec,\r\n  computeShapeTransform,\r\n  getRatioWithPosition,\r\n  projectionOnConstraints,\r\n  recomputeAllVisibilities,\r\n} from '../GeometryTools/recomputeShape';\r\n\r\n/**\r\n * Ajout de figures sur l'espace de travail\r\n */\r\nexport class TransformTool extends Tool {\r\n  constructor() {\r\n    super('transform', 'Modifier une figure', 'operation');\r\n\r\n    // show-points -> move-point\r\n    this.currentStep = null;\r\n\r\n    // id of the shape that contains the point\r\n    this.shapeId = null;\r\n\r\n    // point to modify\r\n    this.pointSelected = null;\r\n\r\n    // destination point\r\n    this.pointDest = null;\r\n\r\n    // the constraints applied to pointSelected\r\n    this.constraints = null;\r\n\r\n    // line de contrainte (segment, droite, demi-droite ou arc de cercle, cercle)\r\n    this.line = null;\r\n  }\r\n\r\n  /**\r\n   * Renvoie l'aide ├á afficher ├á l'utilisateur\r\n   * @return {String} L'aide, en HTML\r\n   */\r\n  getHelpText() {\r\n    const toolName = this.title;\r\n    return html`\r\n      <h3>${toolName}</h3>\r\n      <p>Vous avez s├®lectionn├® l'outil <b>\"${toolName}\"</b>.<br /></p>\r\n    `;\r\n  }\r\n\r\n  start() {\r\n    app.mainCanvasLayer.editingShapeIds = [];\r\n    app.upperCanvasLayer.removeAllObjects();\r\n\r\n    this.shapeId = null;\r\n    this.pointSelected = null;\r\n    this.pointDest = null;\r\n    this.constraints = null;\r\n    this.line = null;\r\n\r\n    setTimeout(\r\n      () =>\r\n        setState({\r\n          tool: { ...app.tool, name: this.name, currentStep: 'selectPoint' },\r\n        }),\r\n      50,\r\n    );\r\n  }\r\n\r\n  selectPoint() {\r\n    this.removeListeners();\r\n    this.constraintsDrawn = false;\r\n    app.mainCanvasLayer.editingShapeIds = [];\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    window.dispatchEvent(new CustomEvent('reset-selection-constraints'));\r\n    app.workspace.selectionConstraints.eventType = 'mousedown';\r\n    app.workspace.selectionConstraints.points.canSelect = true;\r\n    app.workspace.selectionConstraints.points.types = ['vertex', 'arcCenter'];\r\n    app.workspace.selectionConstraints.points.whitelist = null;\r\n    app.workspace.selectionConstraints.points.blacklist = null;\r\n    app.workspace.selectionConstraints.points.numberOfObjects = 'allInDistance';\r\n    this.objectSelectedId = app.addListener('objectSelected', this.handler);\r\n  }\r\n\r\n  transform() {\r\n    this.removeListeners();\r\n    this.mouseUpId = app.addListener('canvasMouseUp', this.handler);\r\n    this.animate();\r\n  }\r\n\r\n  end() {\r\n    this.constraintsDrawn = false;\r\n    app.mainCanvasLayer.editingShapeIds = [];\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.stopAnimation();\r\n    this.removeListeners();\r\n  }\r\n\r\n  objectSelected(points) {\r\n    for (let i = 0; i < points.length; i++) {\r\n      if (points[i].reference) {\r\n        const reference = findObjectById(points[i].reference);\r\n        if (reference instanceof Point) {\r\n          points[i] = findObjectById(points[i].reference);\r\n          i--;\r\n          continue;\r\n        }\r\n      }\r\n      points[i].computeTransformConstraint();\r\n    }\r\n    points = points.filter(\r\n      (point) =>\r\n        (point.transformConstraints.isFree ||\r\n          point.transformConstraints.isConstrained) &&\r\n        !point.transformConstraints.isBlocked &&\r\n        !point.transformConstraints.isConstructed,\r\n    );\r\n\r\n    if (points.length == 0) return;\r\n\r\n    let point = points.find(\r\n      (point) => point.transformConstraints.isConstrained,\r\n    );\r\n    if (!point) point = points[0];\r\n\r\n    this.constraints = point.transformConstraints;\r\n\r\n    app.upperCanvasLayer.removeAllObjects();\r\n\r\n    if (!this.constraintsDrawn) this.drawConstraints(point);\r\n\r\n    this.pointSelectedId = point.id;\r\n\r\n    const startShapeId = point.shape.id;\r\n    this.tree = {\r\n      [startShapeId]: {\r\n        parents: [],\r\n        children: [],\r\n        isDone: 0,\r\n      },\r\n    };\r\n    this.createTree(0, this.tree);\r\n    const involvedShapeIds = Object.keys(this.tree);\r\n    const involvedShapes = involvedShapeIds.map((shapeId) =>\r\n      findObjectById(shapeId),\r\n    );\r\n\r\n    involvedShapeIds.forEach((oldKey) => {\r\n      const newKey = addInfoToId(oldKey, 'upper');\r\n      delete Object.assign(this.tree, { [newKey]: this.tree[oldKey] })[oldKey];\r\n      for (let i = 0; i < this.tree[newKey].parents.length; i++) {\r\n        this.tree[newKey].parents[i] = addInfoToId(\r\n          this.tree[newKey].parents[i],\r\n          'upper',\r\n        );\r\n      }\r\n      for (let i = 0; i < this.tree[newKey].children.length; i++) {\r\n        this.tree[newKey].children[i] = addInfoToId(\r\n          this.tree[newKey].children[i],\r\n          'upper',\r\n        );\r\n      }\r\n    });\r\n\r\n    involvedShapes.sort((s1, s2) => {\r\n      return ShapeManager.getShapeIndex(s1) - ShapeManager.getShapeIndex(s2);\r\n    });\r\n    this.drawingShapes = involvedShapes.map((s) => duplicateShape(s));\r\n    this.drawingShapes.forEach((s) => {\r\n      if (!findObjectById(s.geometryObject.geometryParentObjectId1)) {\r\n        s.geometryObject.geometryParentObjectId1 = addInfoToId(\r\n          s.geometryObject.geometryParentObjectId1,\r\n          'main',\r\n        );\r\n      }\r\n      if (!findObjectById(s.geometryObject.geometryParentObjectId2)) {\r\n        s.geometryObject.geometryParentObjectId2 = addInfoToId(\r\n          s.geometryObject.geometryParentObjectId2,\r\n          'main',\r\n        );\r\n      }\r\n      if (\r\n        !findObjectById(s.geometryObject.geometryTransformationParentShapeId)\r\n      ) {\r\n        s.geometryObject.geometryTransformationParentShapeId = addInfoToId(\r\n          s.geometryObject.geometryTransformationParentShapeId,\r\n          'main',\r\n        );\r\n      }\r\n      const characteristicElements =\r\n        s.geometryObject.geometryTransformationCharacteristicElements;\r\n      if (characteristicElements && characteristicElements.elementIds) {\r\n        characteristicElements.elementIds =\r\n          characteristicElements.elementIds.map((elId) => {\r\n            if (!findObjectById(elId)) {\r\n              return addInfoToId(elId, 'main');\r\n            }\r\n            return elId;\r\n          });\r\n      }\r\n      if (!findObjectById(s.geometryObject.geometryDuplicateParentShapeId)) {\r\n        s.geometryObject.geometryDuplicateParentShapeId = addInfoToId(\r\n          s.geometryObject.geometryDuplicateParentShapeId,\r\n          'main',\r\n        );\r\n      }\r\n      if (!findObjectById(s.geometryObject.geometryMultipliedParentShapeId)) {\r\n        s.geometryObject.geometryMultipliedParentShapeId = addInfoToId(\r\n          s.geometryObject.geometryMultipliedParentShapeId,\r\n          'main',\r\n        );\r\n      }\r\n    });\r\n\r\n    app.mainCanvasLayer.editingShapeIds = involvedShapes.map((s) => s.id);\r\n\r\n    if (point.shape.name == 'PointOnLine') {\r\n      let constraintSegment = findObjectById(\r\n        addInfoToId(\r\n          point.shape.geometryObject.geometryParentObjectId1,\r\n          'upper',\r\n        ),\r\n      );\r\n      if (!constraintSegment) {\r\n        constraintSegment = findObjectById(\r\n          point.shape.geometryObject.geometryParentObjectId1,\r\n        );\r\n      }\r\n\r\n      new LineShape({\r\n        layer: 'upper',\r\n        path: constraintSegment.getSVGPath('no scale', true),\r\n        id: undefined,\r\n        isPointed: false,\r\n        strokeWidth: 2,\r\n        strokeColor: app.settings.constraintsDrawColor,\r\n        geometryObject: new GeometryObject({}),\r\n      });\r\n    }\r\n\r\n    app.upperCanvasLayer.shapes.forEach((s) => {\r\n      s.geometryObject?.geometryDuplicateChildShapeIds.forEach(\r\n        (duplicateChildId) => {\r\n          const duplicateChild = findObjectById(duplicateChildId);\r\n          computeConstructionSpec(duplicateChild);\r\n        },\r\n      );\r\n      s.geometryObject?.geometryMultipliedChildShapeIds.forEach(\r\n        (multipliedChildId) => {\r\n          const multipliedChild = findObjectById(multipliedChildId);\r\n          computeConstructionSpec(multipliedChild);\r\n        },\r\n      );\r\n    });\r\n\r\n    setState({\r\n      tool: { ...app.tool, name: this.name, currentStep: 'transform' },\r\n    });\r\n  }\r\n\r\n  createTree(index, tree) {\r\n    const currentEntries = Object.entries(tree);\r\n    if (currentEntries.length == index) return;\r\n    const currentShapeId = currentEntries[index][0];\r\n    const currentShape = findObjectById(currentShapeId);\r\n    const dependenciesIds = [\r\n      ...currentShape.geometryObject.geometryChildShapeIds,\r\n      ...currentShape.geometryObject.geometryTransformationChildShapeIds,\r\n      ...currentShape.geometryObject.geometryDuplicateChildShapeIds,\r\n      ...currentShape.geometryObject.geometryMultipliedChildShapeIds,\r\n    ];\r\n    dependenciesIds.sort((dp1, dp2) => {\r\n      if (findObjectById(dp1).geometryObject.geometryIsConstaintDraw) {\r\n        return -1;\r\n      } else if (findObjectById(dp2).geometryObject.geometryIsConstaintDraw) {\r\n        return 1;\r\n      }\r\n    });\r\n    dependenciesIds.forEach((dependenciesId) => {\r\n      if (tree[dependenciesId])\r\n        tree[dependenciesId].parents.push(currentShapeId);\r\n      else\r\n        tree[dependenciesId] = {\r\n          isDone: 0,\r\n          parents: [currentShapeId],\r\n          children: [],\r\n        };\r\n    });\r\n    tree[currentShapeId].children = dependenciesIds;\r\n    this.createTree(index + 1, tree);\r\n  }\r\n\r\n  resetTree() {\r\n    for (const elem in this.tree) {\r\n      this.tree[elem].isDone = 0;\r\n    }\r\n  }\r\n\r\n  browseTree(tree, callNumber) {\r\n    if (callNumber == 100) {\r\n      console.error('too much call on browsetree');\r\n      return;\r\n    }\r\n    let elementDone = 0,\r\n      treeLength = 0;\r\n    for (const currentShapeId in tree) {\r\n      if (tree[currentShapeId].isDone == 0) {\r\n        if (\r\n          tree[currentShapeId].parents.every((parentId) => {\r\n            if (tree[parentId].isDone > 0) {\r\n              return true;\r\n            }\r\n            const parent = findObjectById(parentId);\r\n            if (\r\n              parent.name == 'PointOnLine' ||\r\n              parent.name == 'PointOnIntersection2'\r\n            ) {\r\n              const constraint = findObjectById(\r\n                parent.geometryObject.geometryParentObjectId1,\r\n              );\r\n              if (constraint.shape.geometryObject.geometryIsConstaintDraw)\r\n                return true;\r\n              else return false;\r\n            } else {\r\n              return false;\r\n            }\r\n          })\r\n        ) {\r\n          const currentShape = findObjectById(currentShapeId);\r\n          computeShapeTransform(currentShape);\r\n          currentShape.geometryObject.geometryChildShapeIds\r\n            .map((childId) => findObjectById(childId))\r\n            .filter((child) => child.geometryObject.geometryIsConstaintDraw)\r\n            .forEach((constraint) => {\r\n              computeShapeTransform(constraint);\r\n              tree[constraint.id].isDone++;\r\n              constraint.geometryObject.geometryChildShapeIds\r\n                .map((childId) => findObjectById(childId))\r\n                .filter(\r\n                  (child) =>\r\n                    child.name == 'PointOnLine' ||\r\n                    child.name == 'PointOnIntersection2',\r\n                )\r\n                .forEach((pointOnLine) => {\r\n                  computeShapeTransform(pointOnLine);\r\n                  tree[pointOnLine.id].isDone++;\r\n                });\r\n            });\r\n          computeShapeTransform(currentShape);\r\n          tree[currentShapeId].isDone++;\r\n        }\r\n      } else {\r\n        elementDone++;\r\n      }\r\n      treeLength++;\r\n    }\r\n    if (elementDone == treeLength) {\r\n      return;\r\n    }\r\n    this.browseTree(tree, callNumber + 1);\r\n  }\r\n\r\n  canvasMouseUp() {\r\n    this.stopAnimation();\r\n    this.executeAction();\r\n    setState({\r\n      tool: { ...app.tool, name: this.name, currentStep: 'selectPoint' },\r\n    });\r\n  }\r\n\r\n  _executeAction() {\r\n    app.mainCanvasLayer.editingShapeIds.forEach((sId, idxS) => {\r\n      const s = findObjectById(sId);\r\n      s.points.forEach((pt, idxPt) => {\r\n        pt.coordinates = new Coordinates(\r\n          this.drawingShapes[idxS].points[idxPt].coordinates,\r\n        );\r\n        pt.ratio = this.drawingShapes[idxS].points[idxPt].ratio;\r\n      });\r\n      s.geometryObject.geometryIsVisibleByChoice =\r\n        this.drawingShapes[idxS].geometryObject.geometryIsVisibleByChoice;\r\n      computeConstructionSpec(s);\r\n    });\r\n    recomputeAllVisibilities('main');\r\n  }\r\n\r\n  refreshStateUpper() {\r\n    if (app.tool.currentStep == 'transform') {\r\n      const point = findObjectById(addInfoToId(this.pointSelectedId, 'upper'));\r\n      const shape = point.shape;\r\n      if (shape.name == 'Trapeze' && point.idx < 3) {\r\n        computeConstructionSpec(shape);\r\n      } else if (point.idx < 2 || point.type == 'arcCenter') {\r\n        switch (shape.name) {\r\n          case 'Rectangle':\r\n          case 'Losange':\r\n          case 'Parallelogram':\r\n          case 'RightAngleTrapeze':\r\n          case 'IsoscelesTrapeze':\r\n          case 'RightAngleIsoscelesTriangle':\r\n          case 'RightAngleTriangle':\r\n          case 'IsoscelesTriangle':\r\n          case 'CirclePart':\r\n            computeConstructionSpec(shape);\r\n            break;\r\n          default:\r\n            break;\r\n        }\r\n      }\r\n      if (point.idx == 0 || point.type == 'arcCenter') {\r\n        switch (shape.name) {\r\n          case 'CircleArc':\r\n          case 'ParalleleSemiStraightLine':\r\n          case 'PerpendicularSemiStraightLine':\r\n          case 'ParalleleSegment':\r\n          case 'PerpendicularSegment':\r\n            computeConstructionSpec(shape);\r\n          default:\r\n            break;\r\n        }\r\n      }\r\n      point.coordinates = app.workspace.lastKnownMouseCoordinates;\r\n      this.adjustPoint(point);\r\n      if (shape.name == 'PointOnLine') {\r\n        const reference = findObjectById(\r\n          shape.geometryObject.geometryParentObjectId1,\r\n        );\r\n        point.coordinates = reference.projectionOnSegment(point.coordinates);\r\n        computeConstructionSpec(shape);\r\n      } else if (point.transformConstraints.isConstrained) {\r\n        point.coordinates = projectionOnConstraints(\r\n          point.coordinates,\r\n          point.transformConstraints,\r\n        );\r\n        if (point.reference) {\r\n          point.ratio = getRatioWithPosition(\r\n            point,\r\n            findObjectById(point.reference),\r\n          );\r\n        } else {\r\n          computeConstructionSpec(shape, point.idx);\r\n        }\r\n      } else if (point.idx >= 2) {\r\n        switch (shape.name) {\r\n          case 'Parallelogram':\r\n          case 'IsoscelesTrapeze':\r\n          case 'CirclePart':\r\n            computeConstructionSpec(shape, point.idx);\r\n        }\r\n      }\r\n\r\n      this.resetTree();\r\n      this.browseTree(this.tree, 0);\r\n\r\n      this.resetTree();\r\n      this.browseTree(this.tree, 0);\r\n    } else if (app.tool.currentStep == 'selectPoint') {\r\n      app.mainCanvasLayer.shapes.forEach((s) => {\r\n        s.vertexes.forEach((pt) => {\r\n          pt.computeTransformConstraint();\r\n        });\r\n        s.points\r\n          .filter((pt) => pt.type == 'arcCenter')\r\n          .forEach((pt) => {\r\n            pt.computeTransformConstraint();\r\n          });\r\n      });\r\n\r\n      app.mainCanvasLayer.shapes\r\n        .filter(\r\n          (s) =>\r\n            s.geometryObject.geometryIsVisible !== false &&\r\n            s.geometryObject.geometryIsHidden !== true,\r\n        )\r\n        .forEach((s) => {\r\n          const points = [\r\n            ...s.vertexes,\r\n            ...s.points.filter((pt) => pt.type == 'arcCenter'),\r\n          ];\r\n          points.forEach((pt) => {\r\n            const transformConstraints = pt.transformConstraints;\r\n            const colorPicker = {\r\n              [transformConstraints.isFree]: '#0f0',\r\n              [transformConstraints.isBlocked]: '#f00',\r\n              [transformConstraints.isConstructed]: '#f00',\r\n              [transformConstraints.isConstrained]: '#FF8C00',\r\n            };\r\n            const color = colorPicker[true];\r\n\r\n            if (color != '#f00' && color != undefined) {\r\n              new Point({\r\n                layer: 'upper',\r\n                coordinates: pt.coordinates,\r\n                size: 2,\r\n                color: color,\r\n              });\r\n            }\r\n          });\r\n        });\r\n    }\r\n  }\r\n\r\n  adjustPoint(point) {\r\n    const constraints = SelectManager.getEmptySelectionConstraints().points;\r\n    constraints.canSelect = true;\r\n    if (point.shape.name == 'PointOnLine') {\r\n      const segment = findObjectById(\r\n        point.shape.geometryObject.geometryParentObjectId1,\r\n      );\r\n      constraints.whitelist = [\r\n        {\r\n          shapeId: segment.shape.id,\r\n          type: 'divisionPoint',\r\n          index: segment.idx,\r\n        },\r\n        { shapeId: segment.shape.id, type: 'vertex', index: segment.idx },\r\n        {\r\n          shapeId: segment.shape.id,\r\n          type: 'vertex',\r\n          index: (segment.idx + 1) % segment.shape.segmentIds.length,\r\n        },\r\n      ];\r\n    } else if (point.transformConstraints.isConstrained) {\r\n      return;\r\n    } else {\r\n      constraints.blacklist = this.drawingShapes.map((s) => {\r\n        return { shapeId: addInfoToId(s.id, 'main') };\r\n      });\r\n    }\r\n    const adjustedCoordinates = SelectManager.selectPoint(\r\n      point.coordinates,\r\n      constraints,\r\n      false,\r\n    );\r\n    if (adjustedCoordinates) {\r\n      point.coordinates = new Coordinates(adjustedCoordinates.coordinates);\r\n    } else if (point.shape.name != 'PointOnLine') {\r\n      const gridPointInCanvasSpace = app.gridCanvasLayer.getClosestGridPoint(\r\n        point.coordinates.toCanvasCoordinates(),\r\n      );\r\n      if (gridPointInCanvasSpace) {\r\n        const gridPointInWorldSpace =\r\n          gridPointInCanvasSpace.fromCanvasCoordinates();\r\n        point.coordinates = new Coordinates(gridPointInWorldSpace);\r\n      }\r\n    }\r\n  }\r\n\r\n  drawConstraints(point) {\r\n    if (point.transformConstraints.isConstrained) {\r\n      point.transformConstraints.lines.forEach((ln) => {\r\n        const segment = ln.segment;\r\n        const shape = new LineShape({\r\n          layer: 'upper',\r\n          path: segment.getSVGPath('no scale', true),\r\n          strokeColor: app.settings.constraintsDrawColor,\r\n          fillOpacity: 0,\r\n          strokeWidth: 2,\r\n        });\r\n        if (ln.isInfinite) shape.segments[0].isInfinite = true;\r\n        shape.vertexes.forEach((pt) => (pt.visible = false));\r\n      });\r\n      point.transformConstraints.points.forEach((pt) => {\r\n        new Point({\r\n          layer: 'upper',\r\n          coordinates: pt,\r\n          color: app.settings.constraintsDrawColor,\r\n          size: 2,\r\n        });\r\n      });\r\n      this.constraintsDrawn = true;\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Transform\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Translate\\TranslateTool.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":68,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":68,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[1594,1596],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":79,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":79,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[1926,1928],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":92,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":92,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[2332,2334],"text":"!=="},"desc":"Use '!==' instead of '!='."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { html } from 'lit';\r\nimport { app, setState } from '../Core/App';\r\nimport { Coordinates } from '../Core/Objects/Coordinates';\r\nimport { Tool } from '../Core/States/Tool';\r\n\r\n/**\r\n * Faire translater le plan\r\n */\r\nexport class TranslateTool extends Tool {\r\n  constructor() {\r\n    super('translate', 'D├®placer le plan', 'tool');\r\n\r\n    this.currentStep = null; // listen-canvas-click -> translating-plane\r\n\r\n    this.startClickCoordinates = null;\r\n  }\r\n\r\n  /**\r\n   * Renvoie l'aide ├á afficher ├á l'utilisateur\r\n   * @return {String} L'aide, en HTML\r\n   */\r\n  getHelpText() {\r\n    const toolName = this.title;\r\n    return html`\r\n      <h3>${toolName}</h3>\r\n      <p>\r\n        Vous avez s├®lectionn├® l'outil <b>\"${toolName}\"</b>.<br />\r\n        Touchez l'├®cran n'importe o├╣ dans la zone de dessin, et faites glissez\r\n        votre doigt sans le relacher, pour faire glisser le plan entier.\r\n      </p>\r\n    `;\r\n  }\r\n\r\n  /**\r\n   * initialiser l'├®tat\r\n   */\r\n  start() {\r\n    setTimeout(\r\n      () =>\r\n        setState({\r\n          tool: { ...app.tool, name: this.name, currentStep: 'listen' },\r\n        }),\r\n      50,\r\n    );\r\n  }\r\n\r\n  listen() {\r\n    this.removeListeners();\r\n\r\n    this.mouseDownId = app.addListener('canvasMouseDown', this.handler);\r\n  }\r\n\r\n  translate() {\r\n    this.removeListeners();\r\n\r\n    this.mouseMoveId = app.addListener('canvasMouseMove', this.handler);\r\n    this.mouseUpId = app.addListener('canvasMouseUp', this.handler);\r\n  }\r\n\r\n  /**\r\n   * stopper l'├®tat\r\n   */\r\n  end() {\r\n    this.removeListeners();\r\n  }\r\n\r\n  canvasMouseDown() {\r\n    if (app.tool.currentStep != 'listen') return;\r\n\r\n    this.startClickCoordinates = new Coordinates(\r\n      app.workspace.lastKnownMouseCoordinates,\r\n    );\r\n    this.startOffset = new Coordinates(app.workspace.translateOffset);\r\n\r\n    setState({ tool: { ...app.tool, currentStep: 'translate' } });\r\n  }\r\n\r\n  canvasMouseMove() {\r\n    if (app.tool.currentStep != 'translate') return;\r\n\r\n    const newOffset = app.workspace.translateOffset.add(\r\n      app.workspace.lastKnownMouseCoordinates\r\n        .substract(this.startClickCoordinates)\r\n        .multiply(app.workspace.zoomLevel),\r\n    );\r\n\r\n    app.workspace.setTranslateOffset(newOffset);\r\n    app.workspace.setTranslateOffset(this.startOffset, false);\r\n  }\r\n\r\n  canvasMouseUp() {\r\n    if (app.tool.currentStep != 'translate') return;\r\n\r\n    this.executeAction();\r\n    setState({ tool: { ...app.tool, name: this.name, currentStep: 'listen' } });\r\n  }\r\n\r\n  _executeAction() {\r\n    const newOffset = app.workspace.translateOffset.add(\r\n      app.workspace.lastKnownMouseCoordinates\r\n        .substract(this.startClickCoordinates)\r\n        .multiply(app.workspace.zoomLevel),\r\n    );\r\n\r\n    app.workspace.setTranslateOffset(newOffset);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Translate\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Translation\\TranslationTool.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":68,"column":33,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":68,"endColumn":35,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1997,1999],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":139,"column":33,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":139,"endColumn":35,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4081,4083],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":151,"column":26,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":151,"endColumn":28,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4663,4665],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":155,"column":48,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":155,"endColumn":50,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[4884,4886],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":254,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":254,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7956,7958],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":308,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":308,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[9597,9599],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":314,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":314,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[9843,9845],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":322,"column":27,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":322,"endColumn":29,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[10132,10134],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":337,"column":44,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":337,"endColumn":46,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[10719,10721],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":351,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":351,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[11123,11125],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":361,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":361,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[11495,11497],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":369,"column":37,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":369,"endColumn":39,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[11839,11841],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":381,"column":42,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":381,"endColumn":44,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[12225,12227],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":384,"column":27,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":384,"endColumn":29,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[12393,12395],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":479,"column":40,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":479,"endColumn":42,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[15846,15848],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'shape' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":485,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":485,"endColumn":22,"suggestions":[{"messageId":"removeVar","data":{"varName":"shape"},"fix":{"range":[16078,16636],"text":""},"desc":"Remove unused variable 'shape'."}]}],"suppressedMessages":[],"errorCount":15,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app, setState } from '../Core/App';\r\nimport { GroupManager } from '../Core/Managers/GroupManager';\r\nimport { SelectManager } from '../Core/Managers/SelectManager';\r\nimport { ShapeManager } from '../Core/Managers/ShapeManager';\r\nimport { CharacteristicElements } from '../Core/Objects/CharacteristicElements';\r\nimport { Coordinates } from '../Core/Objects/Coordinates';\r\nimport { Point } from '../Core/Objects/Point';\r\nimport { Segment } from '../Core/Objects/Segment';\r\nimport { ShapeGroup } from '../Core/Objects/ShapeGroup';\r\nimport { ArrowLineShape } from '../Core/Objects/Shapes/ArrowLineShape';\r\nimport { GeometryObject } from '../Core/Objects/Shapes/GeometryObject';\r\nimport { SinglePointShape } from '../Core/Objects/Shapes/SinglePointShape';\r\nimport { Tool } from '../Core/States/Tool';\r\nimport { findObjectById, removeObjectById } from '../Core/Tools/general';\r\n\r\n/**\r\n */\r\nexport class TranslationTool extends Tool {\r\n  constructor() {\r\n    super('translation', 'Translation', 'transformation');\r\n  }\r\n\r\n  start() {\r\n    this.removeListeners();\r\n    this.duration = app.settings.geometryTransformationAnimation\r\n      ? app.settings.geometryTransformationAnimationDuration\r\n      : 0.001;\r\n\r\n    setTimeout(\r\n      () =>\r\n        setState({\r\n          tool: {\r\n            ...app.tool,\r\n            name: this.name,\r\n            currentStep: 'selectFirstReference',\r\n          },\r\n        }),\r\n      50,\r\n    );\r\n  }\r\n\r\n  selectFirstReference() {\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.stopAnimation();\r\n    this.removeListeners();\r\n\r\n    this.showLastCharacteristicElements();\r\n\r\n    this.pointsDrawn = [];\r\n    this.characteristicElements = null;\r\n\r\n    setTimeout(\r\n      () =>\r\n        setState({\r\n          tool: {\r\n            ...app.tool,\r\n            name: this.name,\r\n            currentStep: 'selectReference',\r\n          },\r\n        }),\r\n      50,\r\n    );\r\n  }\r\n\r\n  selectReference() {\r\n    this.removeListeners();\r\n\r\n    if (this.pointsDrawn.length == 1) {\r\n      const shapesToDelete = [];\r\n      app.upperCanvasLayer.shapes.forEach((s) => {\r\n        if (s.geometryObject?.geometryIsCharacteristicElements)\r\n          shapesToDelete.push(s);\r\n      });\r\n      shapesToDelete.forEach((s) => removeObjectById(s.id));\r\n    }\r\n\r\n    // this.setSelectionConstraints();\r\n    this.mouseDownId = app.addListener('canvasMouseDown', this.handler);\r\n  }\r\n\r\n  animateFirstRefPoint() {\r\n    this.removeListeners();\r\n\r\n    window.dispatchEvent(new CustomEvent('reset-selection-constraints'));\r\n    app.workspace.selectionConstraints.eventType = 'click';\r\n    app.workspace.selectionConstraints.points.canSelect = true;\r\n    this.animate();\r\n    this.mouseUpId = app.addListener('canvasMouseUp', this.handler);\r\n  }\r\n\r\n  animateSecondRefPoint() {\r\n    this.removeListeners();\r\n\r\n    window.dispatchEvent(new CustomEvent('reset-selection-constraints'));\r\n    app.workspace.selectionConstraints.eventType = 'click';\r\n    app.workspace.selectionConstraints.points.canSelect = true;\r\n    this.animate();\r\n    this.mouseUpId = app.addListener('canvasMouseUp', this.handler);\r\n  }\r\n\r\n  selectObject() {\r\n    this.removeListeners();\r\n\r\n    if (this.drawingShapes)\r\n      this.drawingShapes.forEach((s) => {\r\n        removeObjectById(s.id);\r\n      });\r\n\r\n    const shapesToDelete = [];\r\n    app.upperCanvasLayer.shapes.forEach((s) => {\r\n      if (s.geometryObject?.geometryIsCharacteristicElements)\r\n        shapesToDelete.push(s);\r\n    });\r\n    shapesToDelete.forEach((s) => removeObjectById(s.id));\r\n\r\n    this.setSelectionConstraints();\r\n    this.objectSelectedId = app.addListener('objectSelected', this.handler);\r\n  }\r\n\r\n  trans() {\r\n    this.removeListeners();\r\n\r\n    this.startTime = Date.now();\r\n    this.animate();\r\n  }\r\n\r\n  end() {\r\n    app.upperCanvasLayer.removeAllObjects();\r\n    this.stopAnimation();\r\n    this.removeListeners();\r\n  }\r\n\r\n  get referenceShape() {\r\n    return findObjectById(app.tool.referenceShapeId);\r\n  }\r\n\r\n  canvasMouseDown() {\r\n    const coord = app.workspace.lastKnownMouseCoordinates;\r\n    if (this.pointsDrawn.length == 0) {\r\n      window.dispatchEvent(new CustomEvent('reset-selection-constraints'));\r\n      app.workspace.selectionConstraints.eventType = 'click';\r\n      app.workspace.selectionConstraints.segments.canSelect = true;\r\n      app.workspace.selectionConstraints.segments.canSelectFromUpper = true;\r\n      app.workspace.selectionConstraints.points.canSelect = true;\r\n      const object = SelectManager.selectObject(coord);\r\n      if (\r\n        object instanceof Segment &&\r\n        !object.isArc() &&\r\n        object.shape instanceof ArrowLineShape\r\n      ) {\r\n        if (object.layer == 'upper') {\r\n          this.characteristicElements =\r\n            object.shape.geometryObject.geometryTransformationCharacteristicElements;\r\n          let referenceShape;\r\n          if (this.characteristicElements.type == 'vector') {\r\n            referenceShape = new ArrowLineShape({\r\n              path: this.characteristicElements.firstElement.getSVGPath(\r\n                'no scale',\r\n                true,\r\n              ),\r\n              layer: 'upper',\r\n              strokeColor: app.settings.referenceDrawColor,\r\n              strokeWidth: 2,\r\n            });\r\n          } else {\r\n            const firstPoint = this.characteristicElements.firstElement;\r\n            const secondPoint = this.characteristicElements.secondElement;\r\n            referenceShape = new ArrowLineShape({\r\n              path: `M ${firstPoint.coordinates.x} ${firstPoint.coordinates.y} L ${secondPoint.coordinates.x} ${secondPoint.coordinates.y}`,\r\n              layer: 'upper',\r\n              strokeColor: app.settings.referenceDrawColor,\r\n              strokeWidth: 2,\r\n            });\r\n          }\r\n          setState({\r\n            tool: {\r\n              ...app.tool,\r\n              name: this.name,\r\n              currentStep: 'selectObject',\r\n              referenceShapeId: referenceShape.id,\r\n            },\r\n          });\r\n        } else {\r\n          this.characteristicElements = new CharacteristicElements({\r\n            type: 'vector',\r\n            elementIds: [object.id],\r\n          });\r\n          const referenceShape = new ArrowLineShape({\r\n            path: object.getSVGPath('no scale', true),\r\n            layer: 'upper',\r\n            strokeColor: app.settings.referenceDrawColor,\r\n            strokeWidth: 2,\r\n          });\r\n          setState({\r\n            tool: {\r\n              ...app.tool,\r\n              name: this.name,\r\n              currentStep: 'selectObject',\r\n              referenceShapeId: referenceShape.id,\r\n            },\r\n          });\r\n        }\r\n      } else {\r\n        this.pointsDrawn.push(\r\n          new Point({\r\n            coordinates: coord,\r\n            layer: 'upper',\r\n            color: app.settings.referenceDrawColor,\r\n            size: 2,\r\n          }),\r\n        );\r\n        setState({\r\n          tool: {\r\n            ...app.tool,\r\n            name: this.name,\r\n            currentStep: 'animateFirstRefPoint',\r\n          },\r\n        });\r\n      }\r\n    } else {\r\n      this.pointsDrawn.push(\r\n        new Point({\r\n          coordinates: coord,\r\n          layer: 'upper',\r\n          color: app.settings.referenceDrawColor,\r\n          size: 2,\r\n        }),\r\n      );\r\n      const segment = new Segment({\r\n        layer: 'upper',\r\n        vertexIds: this.pointsDrawn.map((pt) => pt.id),\r\n      });\r\n      const referenceShape = new ArrowLineShape({\r\n        layer: 'upper',\r\n        segmentIds: [segment.id],\r\n        pointIds: this.pointsDrawn.map((pt) => pt.id),\r\n        strokeColor: app.settings.referenceDrawColor,\r\n        strokeWidth: 2,\r\n      });\r\n      setState({\r\n        tool: {\r\n          ...app.tool,\r\n          name: this.name,\r\n          currentStep: 'animateSecondRefPoint',\r\n          referenceShapeId: referenceShape.id,\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  canvasMouseUp() {\r\n    this.stopAnimation();\r\n\r\n    if (app.tool.currentStep == 'animateFirstRefPoint') {\r\n      const coord = app.workspace.lastKnownMouseCoordinates;\r\n      const object = SelectManager.selectObject(coord);\r\n      const reference = object ? object : this.pointsDrawn[0];\r\n      this.characteristicElements = new CharacteristicElements({\r\n        type: 'two-points',\r\n        elementIds: [reference.id],\r\n      });\r\n      setState({\r\n        tool: { ...app.tool, name: this.name, currentStep: 'selectReference' },\r\n      });\r\n    } else {\r\n      const coord = app.workspace.lastKnownMouseCoordinates;\r\n      const object = SelectManager.selectObject(coord);\r\n      if (object) {\r\n        this.secondReference = object;\r\n      } else {\r\n        this.secondReference = this.pointsDrawn[1];\r\n      }\r\n      this.characteristicElements.elementIds.push(this.secondReference.id);\r\n      setState({\r\n        tool: { ...app.tool, name: this.name, currentStep: 'selectObject' },\r\n      });\r\n    }\r\n  }\r\n\r\n  objectSelected(object) {\r\n    if (!object) return;\r\n\r\n    this.involvedShapes = ShapeManager.getAllBindedShapes(object);\r\n    this.drawingShapes = this.involvedShapes.map(\r\n      (s) =>\r\n        new s.constructor({\r\n          ...s,\r\n          layer: 'upper',\r\n          path: s.getSVGPath('no scale', false),\r\n          id: undefined,\r\n          segmentsColor: s.segments.map((seg) => {\r\n            return seg.color;\r\n          }),\r\n          pointsColor: s.vertexes.map((pt) => {\r\n            return pt.color;\r\n          }),\r\n        }),\r\n    );\r\n    setState({\r\n      tool: {\r\n        ...app.tool,\r\n        currentStep: 'trans',\r\n      },\r\n    });\r\n  }\r\n\r\n  animate() {\r\n    if (app.tool.currentStep == 'animateFirstRefPoint') {\r\n      window.dispatchEvent(new CustomEvent('refreshUpper'));\r\n      this.requestAnimFrameId = window.requestAnimationFrame(() =>\r\n        this.animate(),\r\n      );\r\n      return;\r\n    } else if (app.tool.currentStep == 'animateSecondRefPoint') {\r\n      window.dispatchEvent(new CustomEvent('refreshUpper'));\r\n      this.requestAnimFrameId = window.requestAnimationFrame(() =>\r\n        this.animate(),\r\n      );\r\n      return;\r\n    }\r\n    this.lastProgress = this.progress || 0;\r\n    if (this.lastProgress == 0) {\r\n      const vector = this.referenceShape.points[1].coordinates.substract(\r\n        this.referenceShape.points[0].coordinates,\r\n      );\r\n      this.drawingShapes.forEach((s) =>\r\n        s.points.forEach((point) => {\r\n          point.startCoordinates = new Coordinates(point.coordinates);\r\n          point.endCoordinates = new Coordinates({\r\n            x: point.x + vector.x,\r\n            y: point.y + vector.y,\r\n          });\r\n        }),\r\n      );\r\n    }\r\n    this.progress = (Date.now() - this.startTime) / (this.duration * 1000);\r\n    if (this.progress > 1 && app.tool.name == 'translation') {\r\n      this.executeAction();\r\n      setState({\r\n        tool: { ...app.tool, name: this.name, currentStep: 'selectObject' },\r\n      });\r\n    } else {\r\n      window.dispatchEvent(new CustomEvent('refreshUpper'));\r\n      this.requestAnimFrameId = window.requestAnimationFrame(() =>\r\n        this.animate(),\r\n      );\r\n    }\r\n  }\r\n\r\n  refreshStateUpper() {\r\n    if (app.tool.currentStep == 'trans') {\r\n      app.upperCanvasLayer.points.forEach((point) => {\r\n        if (point.startCoordinates) {\r\n          point.coordinates = point.startCoordinates.substract(\r\n            point.startCoordinates\r\n              .substract(point.endCoordinates)\r\n              .multiply(this.progress),\r\n          );\r\n        }\r\n      });\r\n    } else if (app.tool.currentStep == 'animateFirstRefPoint') {\r\n      const coord = app.workspace.lastKnownMouseCoordinates;\r\n      const object = SelectManager.selectObject(coord);\r\n      if (object) {\r\n        this.pointsDrawn[0].coordinates = object.coordinates;\r\n      } else {\r\n        this.pointsDrawn[0].coordinates = coord;\r\n      }\r\n    } else if (app.tool.currentStep == 'animateSecondRefPoint') {\r\n      const coord = app.workspace.lastKnownMouseCoordinates;\r\n      const object = SelectManager.selectObject(coord);\r\n      if (object) {\r\n        this.pointsDrawn[1].coordinates = object.coordinates;\r\n      } else {\r\n        this.pointsDrawn[1].coordinates = coord;\r\n      }\r\n    }\r\n  }\r\n\r\n  _executeAction() {\r\n    if (this.characteristicElements.type == 'two-points') {\r\n      this.characteristicElements.elementIds.forEach((elemId, idx) => {\r\n        const element = findObjectById(elemId);\r\n        if (element.layer == 'upper') {\r\n          this.characteristicElements.elementIds[idx] = new SinglePointShape({\r\n            layer: 'main',\r\n            path: `M ${element.coordinates.x} ${element.coordinates.y}`,\r\n            name: 'Point',\r\n            familyName: 'Point',\r\n            geometryObject: new GeometryObject({}),\r\n          }).points[0].id;\r\n        }\r\n      });\r\n    }\r\n\r\n    if (\r\n      !app.workspace.translationLastCharacteristicElements.find((elements) =>\r\n        this.characteristicElements.equal(elements),\r\n      )\r\n    ) {\r\n      app.workspace.translationLastCharacteristicElements.push(\r\n        this.characteristicElements,\r\n      );\r\n    }\r\n\r\n    const vector = this.referenceShape.segments[0];\r\n\r\n    const newShapes = this.involvedShapes.map((s) => {\r\n      const newShape = new s.constructor({\r\n        ...s,\r\n        layer: 'main',\r\n        id: undefined,\r\n        familyName: 'transformation',\r\n        path: s.getSVGPath('no scale', false),\r\n        // divisionPointInfos: s.divisionPoints.map((dp) => {\r\n        //   return { coordinates: dp.coordinates, ratio: dp.ratio, segmentIdx: dp.segments[0].idx, color: dp.color };\r\n        // }),\r\n        segmentsColor: s.segments.map((seg) => {\r\n          return seg.color;\r\n        }),\r\n        pointsColor: s.vertexes.map((pt) => {\r\n          return pt.color;\r\n        }),\r\n        geometryObject: new GeometryObject({\r\n          geometryTransformationChildShapeIds: [],\r\n          geometryTransformationParentShapeId: s.id,\r\n          geometryTransformationCharacteristicElements:\r\n            this.characteristicElements,\r\n          geometryTransformationName: 'translation',\r\n          geometryIsVisible: s.geometryObject.geometryIsVisible,\r\n          geometryIsHidden: s.geometryObject.geometryIsHidden,\r\n          geometryIsConstaintDraw: s.geometryObject.geometryIsConstaintDraw,\r\n        }),\r\n      });\r\n\r\n      s.geometryObject.geometryTransformationChildShapeIds.push(newShape.id);\r\n      newShape.geometryObject.geometryTransformationCharacteristicElements.elementIds.forEach(\r\n        (refId) => {\r\n          const ref = findObjectById(refId);\r\n          if (\r\n            !ref.shape.geometryObject.geometryTransformationChildShapeIds.includes(\r\n              newShape.id,\r\n            )\r\n          ) {\r\n            ref.shape.geometryObject.geometryTransformationChildShapeIds.push(\r\n              newShape.id,\r\n            );\r\n          }\r\n        },\r\n      );\r\n      newShape.translate(\r\n        vector.points[1].coordinates.substract(vector.points[0].coordinates),\r\n      );\r\n      newShape.points.forEach((pt, idx) => {\r\n        pt.geometryIsVisible = s.points[idx].geometryIsVisible;\r\n        pt.geometryIsHidden = s.points[idx].geometryIsHidden;\r\n      });\r\n      return newShape;\r\n    });\r\n\r\n    if (newShapes.length > 1) {\r\n      const userGroup = new ShapeGroup(0, 1);\r\n      userGroup.shapesIds = newShapes.map((s) => s.id);\r\n      GroupManager.addGroup(userGroup);\r\n    }\r\n  }\r\n\r\n  setSelectionConstraints() {\r\n    const constraints = app.fastSelectionConstraints.mousedown_all_shape;\r\n    constraints.shapes.blacklist = app.mainCanvasLayer.shapes.filter(\r\n      (s) => s.geometryObject.geometryPointOnTheFlyChildId,\r\n    );\r\n    app.workspace.selectionConstraints = constraints;\r\n  }\r\n\r\n  showLastCharacteristicElements() {\r\n    app.workspace.translationLastCharacteristicElements.forEach(\r\n      (characteristicElement) => {\r\n        if (characteristicElement.type == 'vector') {\r\n          const axis = findObjectById(characteristicElement.elementIds[0]);\r\n          const coordinates = [\r\n            axis.points[0].coordinates,\r\n            axis.points[1].coordinates,\r\n          ];\r\n          const shape = new ArrowLineShape({\r\n            layer: 'upper',\r\n            path: `M ${coordinates[0].x} ${coordinates[0].y} L ${coordinates[1].x} ${coordinates[1].y}`,\r\n            name: 'Vector',\r\n            familyName: 'Line',\r\n            strokeColor: app.settings.referenceDrawColor2,\r\n            strokeWidth: 2,\r\n            geometryObject: new GeometryObject({\r\n              geometryIsCharacteristicElements: true,\r\n              geometryTransformationCharacteristicElements:\r\n                characteristicElement,\r\n            }),\r\n          });\r\n        } else {\r\n          const firstPoint = findObjectById(\r\n            characteristicElement.elementIds[0],\r\n          );\r\n          const secondPoint = findObjectById(\r\n            characteristicElement.elementIds[1],\r\n          );\r\n\r\n          const shape = new ArrowLineShape({\r\n            layer: 'upper',\r\n            path: `M ${firstPoint.coordinates.x} ${firstPoint.coordinates.y} L ${secondPoint.coordinates.x} ${secondPoint.coordinates.y}`,\r\n            name: 'Vector',\r\n            familyName: 'Line',\r\n            strokeColor: app.settings.referenceDrawColor2,\r\n            strokeWidth: 2,\r\n            geometryObject: new GeometryObject({\r\n              geometryIsCharacteristicElements: true,\r\n              geometryTransformationCharacteristicElements:\r\n                characteristicElement,\r\n            }),\r\n          });\r\n          shape.points[0].color = app.settings.referenceDrawColor;\r\n          shape.points[0].size = 2;\r\n          shape.points[1].color = app.settings.referenceDrawColor;\r\n          shape.points[1].size = 2;\r\n        }\r\n      },\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Translation\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Ungroup\\UngroupTool.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Ungroup\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Zoom\\ZoomTool.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":63,"column":23,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":63,"endColumn":25,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2080,2082],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":85,"column":24,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":85,"endColumn":26,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2554,2556],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":89,"column":25,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":89,"endColumn":27,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2695,2697],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":105,"column":30,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":105,"endColumn":32,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3112,3114],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":109,"column":19,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":109,"endColumn":21,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[3251,3253],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app, setState } from '../Core/App';\r\nimport { Coordinates } from '../Core/Objects/Coordinates';\r\nimport { Tool } from '../Core/States/Tool';\r\n\r\n/**\r\n * Calcule le niveau de zoom en appliquant les limites min et max.\r\n *\r\n * @param {number} currentZoom - Le niveau de zoom actuel.\r\n * @param {number} zoomOffset - Le facteur de zoom ├á appliquer (ex: 1.1 pour zoomer, 0.9 pour d├®zoomer).\r\n * @param {number} minZoom - Le niveau de zoom minimum autoris├®.\r\n * @param {number} maxZoom - Le niveau de zoom maximum autoris├®.\r\n * @returns {number} Le nouveau niveau de zoom, en respectant les limites.\r\n */\r\nconst calculateZoomWithLimits = (currentZoom, zoomOffset, minZoom, maxZoom) => {\r\n  let newZoom = currentZoom * zoomOffset;\r\n  if (newZoom > maxZoom) newZoom = maxZoom;\r\n  if (newZoom < minZoom) newZoom = minZoom;\r\n  return newZoom;\r\n};\r\n\r\n/**\r\n * Zoomer/D├®zoomer le plan\r\n */\r\nexport class ZoomTool extends Tool {\r\n  constructor() {\r\n    super('zoom', 'Zoomer', 'tool');\r\n    this.currentStep = null;\r\n    this.init();\r\n  }\r\n\r\n  /**\r\n   * Applique un nouveau niveau de zoom\r\n   */\r\n  applyZoom(newZoom) {\r\n    const originalTranslateOffset = app.workspace.translateOffset,\r\n      originalZoom = app.workspace.zoomLevel,\r\n      scaleOffset = newZoom / originalZoom,\r\n      actualWinSize = new Coordinates({\r\n        x: app.canvasWidth,\r\n        y: app.canvasHeight,\r\n      }).multiply(1 / originalZoom),\r\n      newWinSize = actualWinSize.multiply(1 / scaleOffset),\r\n      newTranslateoffset = originalTranslateOffset\r\n        .multiply(1 / originalZoom)\r\n        .add(newWinSize.substract(actualWinSize).multiply(1 / 2))\r\n        .multiply(newZoom);\r\n\r\n    app.workspace.setZoomLevel(newZoom, false);\r\n    app.workspace.setTranslateOffset(newTranslateoffset);\r\n  }\r\n\r\n  /**\r\n   * initialiser l'├®tat\r\n   */\r\n  init() {\r\n    this.removeListeners();\r\n    this.touchStartId = app.addListener('canvasTouchStart', this.handler);\r\n    this.mouseWheelId = app.addListener('canvasMouseWheel', this.handler);\r\n  }\r\n\r\n  start() {\r\n    this.removeListeners();\r\n    if (app.tool.mode == 'touch') {\r\n      this.touchMoveId = app.addListener('canvasTouchMove', this.handler);\r\n      this.touchEndId = app.addListener('canvasTouchEnd', this.handler);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Execute l'action de zoom depuis le bouton de zoom\r\n   */\r\n  execute() {\r\n    this.applyZoom(app.tool.zoomLevel);\r\n  }\r\n\r\n  /**\r\n   * stopper l'├®tat\r\n   */\r\n  end() {\r\n    this.removeListeners();\r\n  }\r\n\r\n  canvasTouchStart(touches) {\r\n    this.running = true;\r\n    if (touches.length == 2) {\r\n      const point1 = touches[0],\r\n        point2 = touches[1];\r\n      this.baseDist = point1.dist(point2);\r\n      if (this.baseDist == 0) this.baseDist = 0.001;\r\n      this.originalZoom = app.workspace.zoomLevel;\r\n      app.upperCanvasLayer.removeAllObjects();\r\n      setState({\r\n        tool: {\r\n          name: this.name,\r\n          currentStep: 'start',\r\n          mode: 'touch',\r\n          title: this.title,\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  canvasTouchMove(touches) {\r\n    if (touches.length !== 2) return;\r\n    if (app.tool.currentStep == 'start') {\r\n      const point1 = touches[0],\r\n        point2 = touches[1];\r\n      let newDist = point1.dist(point2);\r\n      if (newDist == 0) newDist = 0.001;\r\n      const scaleOffset = newDist / this.baseDist;\r\n      const newZoom = calculateZoomWithLimits(\r\n        this.originalZoom,\r\n        scaleOffset,\r\n        app.settings.minZoomLevel,\r\n        app.settings.maxZoomLevel,\r\n      );\r\n      this.applyZoom(newZoom);\r\n    }\r\n  }\r\n\r\n  canvasTouchEnd() {\r\n    if (!this.running) return;\r\n    this.running = false;\r\n    window.dispatchEvent(\r\n      new CustomEvent('actions-executed', { detail: { name: this.title } }),\r\n    );\r\n  }\r\n\r\n  canvasMouseWheel(deltaY) {\r\n    if (!this.isLastActionZoom)\r\n      setState({\r\n        tool: {\r\n          name: this.name,\r\n          currentStep: 'start',\r\n          mode: 'wheel',\r\n          title: this.title,\r\n        },\r\n      });\r\n    clearTimeout(this.timeoutId);\r\n    this.originalZoom = app.workspace.zoomLevel;\r\n    const scaleOffset = (this.originalZoom - deltaY / 100) / this.originalZoom;\r\n    const newZoom = calculateZoomWithLimits(\r\n      this.originalZoom,\r\n      scaleOffset,\r\n      app.settings.minZoomLevel,\r\n      app.settings.maxZoomLevel,\r\n    );\r\n    this.applyZoom(newZoom);\r\n    this.isLastActionZoom = true;\r\n    this.timeoutId = setTimeout(() => {\r\n      window.dispatchEvent(\r\n        new CustomEvent('actions-executed', { detail: { name: this.title } }),\r\n      );\r\n      this.isLastActionZoom = false;\r\n    }, 300);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Zoom\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\Zoom\\zoom-menu.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\auto-launch.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\backbutton-manager.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used. Allowed unused args must match /^_/u.","line":4,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":23,"suggestions":[{"messageId":"removeVar","data":{"varName":"e"},"fix":{"range":[109,110],"text":""},"desc":"Remove unused variable 'e'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app } from './Core/App';\nimport { goToHomePage } from './Core/Tools/general';\n\nwindow.onpopstate = (e) => {\n  if (\n    app.environment?.name?.length > 0 &&\n    confirm(\"retourner ├á la page d'accueil ?\")\n  )\n    goToHomePage();\n  else history.pushState({}, 'main page');\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\fullhistory-tools.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":317,"column":21,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":317,"endColumn":23,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7602,7604],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":318,"column":21,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":318,"endColumn":23,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7644,7646],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":319,"column":21,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":319,"endColumn":23,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7678,7680],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":325,"column":23,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":325,"endColumn":25,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7895,7897],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":326,"column":23,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":326,"endColumn":25,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[7947,7949],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":333,"column":35,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":333,"endColumn":37,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[8174,8176],"text":"==="},"desc":"Use '===' instead of '=='."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'toolIdx' is defined but never used. Allowed unused args must match /^_/u.","line":436,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":436,"endColumn":44,"suggestions":[{"messageId":"removeVar","data":{"varName":"toolIdx"},"fix":{"range":[11443,11452],"text":""},"desc":"Remove unused variable 'toolIdx'."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":514,"column":31,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":514,"endColumn":33,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[14574,14576],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":537,"column":19,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":537,"endColumn":21,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[15331,15333],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import '@components/icon-button';\r\nimport '@components/template-toolbar';\r\nimport { SignalWatcher } from '@lit-labs/signals';\r\nimport { css, html, LitElement } from 'lit';\r\nimport { app, changes } from './Core/App';\r\nimport { FullHistoryManager } from './Core/Managers/FullHistoryManager';\r\n\r\nconst formatTime = (milliseconds) => {\r\n  const minutes = Math.floor(milliseconds / 1000 / 60);\r\n  const seconds = ((milliseconds / 1000) % 60).toFixed(1);\r\n  return (minutes > 0 ? minutes + 'm ' : '') + seconds + 's';\r\n};\r\n\r\nclass FullHistoryTools extends SignalWatcher(LitElement) {\r\n  static properties = {\r\n    tools: Array,\r\n    index: Number,\r\n    playPauseButton: String,\r\n  };\r\n\r\n  static styles = css`\r\n    :host {\r\n      display: none;\r\n      position: absolute;\r\n      top: 0;\r\n      z-index: 10;\r\n      background-color: var(--theme-color);\r\n      width: ${app.settings.mainMenuWidth}px;\r\n      height: 100dvh;\r\n      padding: 12px;\r\n      box-sizing: border-box;\r\n      box-shadow: 2px 0 8px rgba(0, 0, 0, 0.15);\r\n      font-family:\r\n        -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\r\n    }\r\n\r\n    nav#sidebar {\r\n      display: flex;\r\n      flex-direction: column;\r\n      gap: 12px;\r\n      height: 100%;\r\n      box-sizing: border-box;\r\n    }\r\n\r\n    #action-container {\r\n      display: flex;\r\n      flex-direction: column;\r\n      gap: 0;\r\n      padding-right: 4px;\r\n      overflow-y: auto;\r\n      overflow-x: hidden;\r\n      scrollbar-width: thin;\r\n      box-sizing: border-box;\r\n      flex-grow: 1;\r\n    }\r\n\r\n    .timeline {\r\n      position: relative;\r\n      margin-left: 18px;\r\n      border-left: 2px solid rgba(255, 255, 255, 0.5);\r\n      padding-left: 16px;\r\n    }\r\n\r\n    .tool-marker {\r\n      position: relative;\r\n      margin-bottom: 8px;\r\n      padding-bottom: 8px;\r\n    }\r\n\r\n    .tool-marker:before {\r\n      content: '';\r\n      position: absolute;\r\n      left: -25px;\r\n      top: 5px;\r\n      width: 12px;\r\n      height: 12px;\r\n      background-color: white;\r\n      border: 2px solid white;\r\n      border-radius: 50%;\r\n      z-index: 1;\r\n      box-shadow: 0 0 0 2px var(--theme-color);\r\n    }\r\n\r\n    .tool-marker.past:before {\r\n      background-color: #2e8b57; /* SeaGreen - coh├®rent avec les actions pass├®es */\r\n      border-color: #2e8b57;\r\n      box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.7);\r\n    }\r\n\r\n    .tool-marker.active:before {\r\n      background-color: var(--theme-color);\r\n      border-color: white;\r\n      box-shadow:\r\n        0 0 0 2px var(--theme-color),\r\n        0 0 8px rgba(255, 255, 255, 0.5);\r\n    }\r\n\r\n    .tool-marker.future:before {\r\n      background-color: #888;\r\n      border-color: #888;\r\n      opacity: 0.7;\r\n    }\r\n\r\n    .tool-marker:last-child {\r\n      margin-bottom: 24px;\r\n    }\r\n\r\n    .tool-header {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: space-between;\r\n      background-color: var(--theme-color-soft);\r\n      padding: 6px 10px;\r\n      border-radius: 8px 8px 0 0;\r\n      border-bottom: 1px solid rgba(255, 255, 255, 0.3);\r\n    }\r\n\r\n    .tool-name {\r\n      font-weight: 700;\r\n      font-size: 0.9rem;\r\n      margin: 0;\r\n      color: white;\r\n      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);\r\n      letter-spacing: 0.01em;\r\n    }\r\n\r\n    .tool-time {\r\n      font-size: 0.75rem;\r\n      color: white;\r\n      background-color: rgba(0, 0, 0, 0.4);\r\n      padding: 3px 8px;\r\n      border-radius: 12px;\r\n      font-weight: 600;\r\n      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);\r\n    }\r\n\r\n    .tool-actions {\r\n      background-color: white;\r\n      border-radius: 0 0 8px 8px;\r\n      overflow: hidden;\r\n      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\r\n    }\r\n\r\n    .action-item {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: space-between;\r\n      padding: 0;\r\n      border-bottom: 1px solid rgba(0, 0, 0, 0.1);\r\n      transition:\r\n        background-color 0.2s,\r\n        opacity 0.2s;\r\n      position: relative;\r\n    }\r\n\r\n    .action-item:last-child {\r\n      border-bottom: none;\r\n    }\r\n\r\n    .action-item:hover {\r\n      background-color: rgba(0, 0, 0, 0.05);\r\n    }\r\n\r\n    .action-item.active {\r\n      background-color: rgba(var(--theme-color-rgb), 0.15);\r\n    }\r\n\r\n    .action-item.past {\r\n      background-color: rgba(0, 200, 0, 0.05);\r\n    }\r\n\r\n    .action-item.past .action-index {\r\n      background-color: #2e8b57; /* SeaGreen */\r\n    }\r\n\r\n    .action-item.future {\r\n      background-color: rgba(0, 0, 0, 0.03);\r\n      opacity: 0.7;\r\n    }\r\n\r\n    .action-item.future .action-index {\r\n      background-color: #888;\r\n    }\r\n\r\n    .action-button {\r\n      display: flex;\r\n      align-items: center;\r\n      width: 100%;\r\n      text-align: left;\r\n      padding: 8px 10px;\r\n      font-weight: 500;\r\n      background: none;\r\n      border: none;\r\n      cursor: pointer;\r\n      color: #222;\r\n      font-size: 0.85rem;\r\n    }\r\n\r\n    .action-index {\r\n      background-color: var(--theme-color);\r\n      color: white;\r\n      width: 20px;\r\n      height: 20px;\r\n      border-radius: 50%;\r\n      display: inline-flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      margin-right: 8px;\r\n      font-size: 0.7rem;\r\n      font-weight: bold;\r\n      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);\r\n    }\r\n\r\n    .action-time {\r\n      margin-left: auto;\r\n      font-size: 0.75rem;\r\n      color: #555;\r\n      background-color: rgba(0, 0, 0, 0.05);\r\n      padding: 2px 4px;\r\n      border-radius: 4px;\r\n      font-weight: 500;\r\n    }\r\n\r\n    .play-action-button {\r\n      background: center / 60% no-repeat url('/images/replay.svg');\r\n      width: 36px;\r\n      height: 36px;\r\n      flex-shrink: 0;\r\n      border: none;\r\n      background-color: transparent;\r\n      cursor: pointer;\r\n      border-radius: 4px;\r\n      transition: background-color 0.2s;\r\n    }\r\n\r\n    .play-action-button:hover {\r\n      background-color: rgba(0, 0, 0, 0.1);\r\n    }\r\n\r\n    .controls {\r\n      display: flex;\r\n      flex-direction: column;\r\n      background: var(--theme-color-soft);\r\n      padding: 10px;\r\n      border-radius: 8px;\r\n      margin-bottom: 12px;\r\n      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\r\n    }\r\n\r\n    .progress-label {\r\n      font-size: 0.9rem;\r\n      color: white;\r\n      margin: 0 0 8px 0;\r\n      font-weight: 600;\r\n      text-align: center;\r\n      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);\r\n      letter-spacing: 0.01em;\r\n    }\r\n\r\n    .progress-bar {\r\n      position: relative;\r\n      width: 100%;\r\n      height: 8px;\r\n      background-color: rgba(0, 0, 0, 0.2);\r\n      border-radius: 4px;\r\n      overflow: hidden;\r\n      margin-bottom: 2px;\r\n      box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);\r\n    }\r\n\r\n    .progress-filled {\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      height: 100%;\r\n      background-color: white;\r\n      border-radius: 4px;\r\n      transition: width 0.3s ease;\r\n      box-shadow: 0 0 2px rgba(255, 255, 255, 0.5);\r\n    }\r\n\r\n    @keyframes pulse {\r\n      0% {\r\n        opacity: 0.6;\r\n      }\r\n      50% {\r\n        opacity: 1;\r\n      }\r\n      100% {\r\n        opacity: 0.6;\r\n      }\r\n    }\r\n\r\n    .current-marker {\r\n      position: absolute;\r\n      width: 12px;\r\n      height: 12px;\r\n      border-radius: 50%;\r\n      background-color: white;\r\n      left: -22px;\r\n      top: 10px;\r\n      z-index: 2;\r\n      box-shadow:\r\n        0 0 0 2px var(--theme-color),\r\n        0 0 4px rgba(0, 0, 0, 0.5);\r\n      animation: pulse 2s infinite;\r\n    }\r\n  `;\r\n\r\n  constructor() {\r\n    super();\r\n    this.playPauseButton = 'play';\r\n    let previousStepTimestamp = 0;\r\n    this.tools = app.fullHistory.steps\r\n      .filter(\r\n        (step) =>\r\n          step.type == 'tool-changed' ||\r\n          step.type == 'undo' ||\r\n          step.type == 'redo',\r\n      )\r\n      .map((step) => {\r\n        const time = step.timeStamp - previousStepTimestamp;\r\n        previousStepTimestamp = step.timeStamp;\r\n        let name = step.detail.title;\r\n        if (step.type == 'undo') name = 'Annuler';\r\n        if (step.type == 'redo') name = 'Refaire';\r\n\r\n        return { name, time, timeStamp: step.timeStamp, actions: [] };\r\n      });\r\n    let toolIndex = -1;\r\n    let actionIndex = 1;\r\n    app.fullHistory.steps\r\n      .filter((step) => step.type == 'add-fullstep')\r\n      .forEach((step) => {\r\n        const timeStamp = step.timeStamp;\r\n        while (this.tools[toolIndex + 1]?.timeStamp < timeStamp) {\r\n          toolIndex++;\r\n          previousStepTimestamp = this.tools[toolIndex].timeStamp;\r\n        }\r\n        this.tools[toolIndex].actions.push({\r\n          name: step.detail.name,\r\n          time: timeStamp - previousStepTimestamp,\r\n          timeStamp,\r\n          actionIndex,\r\n        });\r\n        actionIndex++;\r\n        previousStepTimestamp =\r\n          this.tools[toolIndex].actions[\r\n            this.tools[toolIndex].actions.length - 1\r\n          ].timeStamp;\r\n      });\r\n    this.tools.forEach((tool) => {\r\n      tool.time = tool.actions.reduce((time, action) => time + action.time, 0);\r\n    });\r\n    this.index = 0;\r\n  }\r\n\r\n  render() {\r\n    changes.get();\r\n    this.updateProperties();\r\n\r\n    // Calcul du nombre total d'actions pour la barre de progression\r\n    const totalActions = app.fullHistory.numberOfActions || 1;\r\n    const currentProgress = (this.index / totalActions) * 100;\r\n\r\n    // R├®cup├®ration de la couleur du th├¿me pour les styles dynamiques\r\n    const themeColor = getComputedStyle(document.documentElement)\r\n      .getPropertyValue('--theme-color')\r\n      .trim();\r\n\r\n    return html`\r\n      <style>\r\n        button#b${this.index} {\r\n          background-color: rgba(0, 0, 0, 0.05);\r\n        }\r\n        .action-item.active {\r\n          background-color: ${themeColor}22; /* Opacit├® ~13% pour assurer un bon contraste */\r\n        }\r\n\r\n        /* Colorisation de la timeline elle-m├¬me pour indiquer la progression */\r\n        .timeline::before {\r\n          content: '';\r\n          position: absolute;\r\n          left: -2px;\r\n          top: 0;\r\n          width: 2px;\r\n          height: ${currentProgress}%;\r\n          background-color: #2e8b57; /* SeaGreen - m├¬me couleur que les actions pass├®es */\r\n          z-index: 2;\r\n        }\r\n      </style>\r\n      <nav id=\"sidebar\">\r\n        <template-toolbar>\r\n          <div slot=\"body\">\r\n            <icon-button\r\n              name=\"undo\"\r\n              title=\"├®tape pr├®c├®dente\"\r\n              @click=\"${this._clickHandler}\"\r\n            >\r\n            </icon-button>\r\n            <icon-button\r\n              name=\"stop\"\r\n              title=\"arr├¬ter\"\r\n              @click=\"${this._clickHandler}\"\r\n            >\r\n            </icon-button>\r\n            <icon-button\r\n              name=\"${this.playPauseButton}\"\r\n              title=\"${this.playPauseButton}\"\r\n              @click=\"${this._clickHandler}\"\r\n            >\r\n            </icon-button>\r\n            <icon-button\r\n              name=\"redo\"\r\n              title=\"├®tape suivante\"\r\n              @click=\"${this._clickHandler}\"\r\n            >\r\n            </icon-button>\r\n          </div>\r\n        </template-toolbar>\r\n\r\n        <div class=\"controls\">\r\n          <span class=\"progress-label\"\r\n            >Progression: ${this.index}/${totalActions}</span\r\n          >\r\n          <div class=\"progress-bar\">\r\n            <div\r\n              class=\"progress-filled\"\r\n              style=\"width: ${currentProgress}%\"\r\n            ></div>\r\n          </div>\r\n        </div>\r\n\r\n        <div id=\"action-container\">\r\n          <div class=\"timeline\">\r\n            ${this.tools.map((tool, toolIdx) => {\r\n              // D├®terminer l'├®tat du marqueur d'outil\r\n              const hasActiveAction = tool.actions.some(\r\n                (action) => action.actionIndex === this.index,\r\n              );\r\n              const isToolPast =\r\n                tool.actions.length > 0 &&\r\n                tool.actions[tool.actions.length - 1].actionIndex < this.index;\r\n              const isToolFuture =\r\n                tool.actions.length > 0 &&\r\n                tool.actions[0].actionIndex > this.index;\r\n              const toolStateClass = hasActiveAction\r\n                ? 'active'\r\n                : isToolPast\r\n                  ? 'past'\r\n                  : isToolFuture\r\n                    ? 'future'\r\n                    : '';\r\n\r\n              return html`\r\n                <div class=\"tool-marker ${toolStateClass}\">\r\n                  <div class=\"tool-header\">\r\n                    <h3 class=\"tool-name\">${tool.name}</h3>\r\n                    <span class=\"tool-time\">${formatTime(tool.time)}</span>\r\n                  </div>\r\n                  <div class=\"tool-actions\">\r\n                    ${tool.actions.map((action, actionIdx) => {\r\n                      const isActive = action.actionIndex === this.index;\r\n                      const isPast = action.actionIndex < this.index;\r\n                      const isFuture = action.actionIndex > this.index;\r\n                      return html`\r\n                        <div\r\n                          class=\"action-item ${isActive\r\n                            ? 'active'\r\n                            : isPast\r\n                              ? 'past'\r\n                              : isFuture\r\n                                ? 'future'\r\n                                : ''}\"\r\n                        >\r\n                          ${isActive\r\n                            ? html`<div class=\"current-marker\"></div>`\r\n                            : ''}\r\n                          <button\r\n                            id=\"b${action.actionIndex}\"\r\n                            @click=\"${this._clickHandler}\"\r\n                            name=\"action-button\"\r\n                            class=\"action-button\"\r\n                          >\r\n                            <span class=\"action-index\">${actionIdx + 1}</span>\r\n                            <span class=\"action-time\"\r\n                              >${formatTime(action.time)}</span\r\n                            >\r\n                          </button>\r\n                          <button\r\n                            id=\"c${action.actionIndex}\"\r\n                            @click=\"${this._clickHandler}\"\r\n                            name=\"play-action-button\"\r\n                            class=\"play-action-button\"\r\n                          ></button>\r\n                        </div>\r\n                      `;\r\n                    })}\r\n                  </div>\r\n                </div>\r\n              `;\r\n            })}\r\n          </div>\r\n        </div>\r\n      </nav>\r\n    `;\r\n  }\r\n\r\n  updateProperties() {\r\n    if (!app.fullHistory.isRunning) {\r\n      this.close();\r\n      return;\r\n    }\r\n    if (app.fullHistory.index != this.index) {\r\n      this.index = app.fullHistory.actionIndex;\r\n      this.shadowRoot\r\n        .getElementById('b' + this.index)\r\n        ?.parentNode.scrollIntoView();\r\n      this.playPauseButton = app.fullHistory.isPlaying ? 'pause' : 'play';\r\n    }\r\n  }\r\n\r\n  _clickHandler(event) {\r\n    const index = parseInt(this.index);\r\n    let idx;\r\n    switch (event.target.name) {\r\n      case 'action-button':\r\n        idx = parseInt(event.target.id.substring(1));\r\n        FullHistoryManager.moveTo(idx);\r\n        break;\r\n      case 'play-action-button':\r\n        idx = parseInt(event.target.id.substring(1));\r\n        FullHistoryManager.moveTo(idx, true);\r\n        FullHistoryManager.playBrowsing(true);\r\n        break;\r\n      case 'undo':\r\n        if (index == 0) {\r\n          break;\r\n        }\r\n        FullHistoryManager.moveTo(index - 1);\r\n        break;\r\n      case 'stop':\r\n        FullHistoryManager.stopBrowsing();\r\n        break;\r\n      case 'pause':\r\n        FullHistoryManager.pauseBrowsing();\r\n        break;\r\n      case 'play':\r\n        FullHistoryManager.playBrowsing();\r\n        break;\r\n      case 'redo':\r\n        if (index >= app.fullHistory.numberOfActions) {\r\n          break;\r\n        }\r\n        FullHistoryManager.moveTo(index + 1);\r\n        break;\r\n    }\r\n  }\r\n\r\n  close() {\r\n    this.remove();\r\n  }\r\n}\r\ncustomElements.define('fullhistory-tools', FullHistoryTools);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\controllers\\version-item.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'VersionItem' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":18,"suggestions":[{"messageId":"removeVar","data":{"varName":"VersionItem"},"fix":{"range":[131,647],"text":""},"desc":"Remove unused variable 'VersionItem'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'VersionItem' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { css, html, LitElement } from 'lit';\nimport { customElement } from 'lit/decorators.js';\nimport { app } from './Core/App';\n\n@customElement('version-item')\nclass VersionItem extends LitElement {\n  static styles = css`\n    :host {\n      display: flex;\n      align-items: center;\n      height: 20px;\n    }\n    img {\n      height: 100%;\n      margin: 4px;\n    }\n    div {\n      margin-left: 4px;\n      text-align: right;\n      font-size: 0.8rem;\n      color: darkslategray;\n    }\n  `;\n\n  render() {\n    return html`\n      <img src=\"/images/manifest/icon-512.png\" />\n      <div class=\"version\">${app.short_name} ${app.version}</div>\n    `;\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\core\\PerformanceSystem.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'event' is defined but never used. Allowed unused args must match /^_/u.","line":86,"column":43,"nodeType":"Identifier","messageId":"unusedVar","endLine":86,"endColumn":48,"suggestions":[{"messageId":"removeVar","data":{"varName":"event"},"fix":{"range":[2239,2244],"text":""},"desc":"Remove unused variable 'event'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Middleware de performance pour les ├®v├®nements natifs\r\n * Surveille et optimise les performances du syst├¿me\r\n */\r\n\r\n/**\r\n * Classe de monitoring des performances\r\n */\r\nclass PerformanceMonitor {\r\n  constructor() {\r\n    this.metrics = new Map();\r\n    this.thresholds = {\r\n      eventProcessing: 10, // ms\r\n      stateChange: 15, // ms\r\n      toolCreation: 50, // ms\r\n      validation: 5, // ms\r\n    };\r\n    this.enabled = false;\r\n    this.reportInterval = 30000; // 30 secondes\r\n    this.reportTimer = null;\r\n  }\r\n\r\n  /**\r\n   * Activer le monitoring\r\n   */\r\n  enable() {\r\n    if (this.enabled) return;\r\n\r\n    this.enabled = true;\r\n    this.setupEventListeners();\r\n    this.startReporting();\r\n\r\n    if (import.meta.env.DEV) console.log('Performance monitoring activ├®');\r\n  }\r\n\r\n  /**\r\n   * D├®sactiver le monitoring\r\n   */\r\n  disable() {\r\n    if (!this.enabled) return;\r\n\r\n    this.enabled = false;\r\n    this.stopReporting();\r\n\r\n    if (import.meta.env.DEV) console.log('Performance monitoring d├®sactiv├®');\r\n  }\r\n\r\n  /**\r\n   * Configurer les ├®couteurs d'├®v├®nements pour le monitoring\r\n   */\r\n  setupEventListeners() {\r\n    // Surveiller les ├®v├®nements personnalis├®s\r\n    const originalDispatchEvent = window.dispatchEvent;\r\n    const self = this;\r\n\r\n    window.dispatchEvent = function (event) {\r\n      if (self.enabled && event instanceof CustomEvent) {\r\n        const startTime = performance.now();\r\n        const result = originalDispatchEvent.call(this, event);\r\n        const duration = performance.now() - startTime;\r\n\r\n        self.recordMetric('events', event.type, startTime, duration);\r\n\r\n        if (duration > self.thresholds.eventProcessing) {\r\n          console.warn(\r\n            `├ëv├®nement lent d├®tect├®: ${event.type} (${duration.toFixed(2)}ms)`,\r\n          );\r\n        }\r\n\r\n        return result;\r\n      }\r\n      return originalDispatchEvent.call(this, event);\r\n    };\r\n\r\n    // Surveiller les signaux via les ├®v├®nements d'├®tat\r\n    const stateEvents = [\r\n      'app:loading-changed',\r\n      'app:error-changed',\r\n      'environment:changed',\r\n      'tool:activated',\r\n      'workspace:updated',\r\n      'settings:updated',\r\n    ];\r\n\r\n    stateEvents.forEach((eventType) => {\r\n      window.addEventListener(eventType, (event) => {\r\n        if (!this.enabled) return;\r\n\r\n        const startTime = performance.now();\r\n        setTimeout(() => {\r\n          const duration = performance.now() - startTime;\r\n          this.recordMetric('signals', eventType, startTime, duration);\r\n\r\n          if (duration > this.thresholds.stateChange) {\r\n            console.warn(\r\n              `Signal lent d├®tect├®: ${eventType} (${duration.toFixed(2)}ms)`,\r\n            );\r\n          }\r\n        }, 0);\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Enregistrer une m├®trique\r\n   * @param {string} category - Cat├®gorie (eventBus, stateManager, etc.)\r\n   * @param {string} operation - Nom de l'op├®ration\r\n   * @param {number} startTime - Temps de d├®but\r\n   * @param {number} duration - Dur├®e en ms (optionnel)\r\n   */\r\n  recordMetric(category, operation, startTime, duration = null) {\r\n    const key = `${category}.${operation}`;\r\n\r\n    if (!this.metrics.has(key)) {\r\n      this.metrics.set(key, {\r\n        count: 0,\r\n        totalTime: 0,\r\n        minTime: Infinity,\r\n        maxTime: 0,\r\n        averageTime: 0,\r\n        lastTime: 0,\r\n      });\r\n    }\r\n\r\n    const metric = this.metrics.get(key);\r\n\r\n    if (duration !== null) {\r\n      metric.count++;\r\n      metric.totalTime += duration;\r\n      metric.minTime = Math.min(metric.minTime, duration);\r\n      metric.maxTime = Math.max(metric.maxTime, duration);\r\n      metric.averageTime = metric.totalTime / metric.count;\r\n      metric.lastTime = startTime;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Obtenir les m├®triques\r\n   * @param {string} category - Cat├®gorie ├á filtrer (optionnel)\r\n   * @returns {object}\r\n   */\r\n  getMetrics(category = null) {\r\n    const result = {};\r\n\r\n    for (const [key, metric] of this.metrics) {\r\n      if (!category || key.startsWith(category)) {\r\n        result[key] = { ...metric };\r\n      }\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * R├®initialiser les m├®triques\r\n   */\r\n  resetMetrics() {\r\n    this.metrics.clear();\r\n    if (import.meta.env.DEV)\r\n      console.log('M├®triques de performance r├®initialis├®es');\r\n  }\r\n\r\n  /**\r\n   * Obtenir un rapport de performance\r\n   * @returns {object}\r\n   */\r\n  getReport() {\r\n    const metrics = this.getMetrics();\r\n    const now = Date.now();\r\n\r\n    // Analyser les m├®triques\r\n    const slowOperations = [];\r\n    const frequentOperations = [];\r\n\r\n    for (const [key, metric] of Object.entries(metrics)) {\r\n      if (metric.averageTime > 10) {\r\n        slowOperations.push({\r\n          operation: key,\r\n          averageTime: metric.averageTime,\r\n          count: metric.count,\r\n        });\r\n      }\r\n\r\n      if (metric.count > 100) {\r\n        frequentOperations.push({\r\n          operation: key,\r\n          count: metric.count,\r\n          averageTime: metric.averageTime,\r\n        });\r\n      }\r\n    }\r\n\r\n    return {\r\n      timestamp: now,\r\n      totalOperations: Object.values(metrics).reduce(\r\n        (sum, m) => sum + m.count,\r\n        0,\r\n      ),\r\n      slowOperations: slowOperations.sort(\r\n        (a, b) => b.averageTime - a.averageTime,\r\n      ),\r\n      frequentOperations: frequentOperations.sort((a, b) => b.count - a.count),\r\n      memoryUsage: this.getMemoryUsage(),\r\n      recommendations: this.generateRecommendations(\r\n        slowOperations,\r\n        frequentOperations,\r\n      ),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Obtenir l'utilisation m├®moire\r\n   * @returns {object}\r\n   */\r\n  getMemoryUsage() {\r\n    if (performance.memory) {\r\n      return {\r\n        used: Math.round(performance.memory.usedJSHeapSize / 1024 / 1024),\r\n        total: Math.round(performance.memory.totalJSHeapSize / 1024 / 1024),\r\n        limit: Math.round(performance.memory.jsHeapSizeLimit / 1024 / 1024),\r\n      };\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * G├®n├®rer des recommandations d'optimisation\r\n   * @param {array} slowOperations - Op├®rations lentes\r\n   * @param {array} frequentOperations - Op├®rations fr├®quentes\r\n   * @returns {array}\r\n   */\r\n  generateRecommendations(slowOperations, frequentOperations) {\r\n    const recommendations = [];\r\n\r\n    if (slowOperations.length > 0) {\r\n      recommendations.push({\r\n        type: 'performance',\r\n        priority: 'high',\r\n        message: `${slowOperations.length} op├®ration(s) lente(s) d├®tect├®e(s)`,\r\n        details: slowOperations\r\n          .slice(0, 3)\r\n          .map(\r\n            (op) =>\r\n              `${op.operation}: ${op.averageTime.toFixed(2)}ms en moyenne`,\r\n          ),\r\n      });\r\n    }\r\n\r\n    if (frequentOperations.length > 0) {\r\n      const highFreqSlow = frequentOperations.filter(\r\n        (op) => op.averageTime > 5,\r\n      );\r\n      if (highFreqSlow.length > 0) {\r\n        recommendations.push({\r\n          type: 'optimization',\r\n          priority: 'medium',\r\n          message: 'Op├®rations fr├®quentes qui pourraient ├¬tre optimis├®es',\r\n          details: highFreqSlow\r\n            .slice(0, 3)\r\n            .map(\r\n              (op) =>\r\n                `${op.operation}: ${op.count} fois, ${op.averageTime.toFixed(2)}ms/op`,\r\n            ),\r\n        });\r\n      }\r\n    }\r\n\r\n    const memoryUsage = this.getMemoryUsage();\r\n    if (memoryUsage && memoryUsage.used > memoryUsage.limit * 0.8) {\r\n      recommendations.push({\r\n        type: 'memory',\r\n        priority: 'high',\r\n        message: 'Utilisation m├®moire ├®lev├®e',\r\n        details: [`${memoryUsage.used}MB utilis├®s sur ${memoryUsage.limit}MB`],\r\n      });\r\n    }\r\n\r\n    return recommendations;\r\n  }\r\n\r\n  /**\r\n   * D├®marrer les rapports automatiques\r\n   */\r\n  startReporting() {\r\n    if (this.reportTimer) return;\r\n\r\n    this.reportTimer = setInterval(() => {\r\n      const report = this.getReport();\r\n\r\n      // Afficher seulement si il y a des probl├¿mes\r\n      if (\r\n        report.slowOperations.length > 0 ||\r\n        report.recommendations.some((r) => r.priority === 'high')\r\n      ) {\r\n        console.group('­ƒôè Rapport de performance AG-Tablette');\r\n        if (import.meta.env.DEV)\r\n          console.log('Op├®rations totales:', report.totalOperations);\r\n\r\n        if (report.slowOperations.length > 0) {\r\n          console.warn('Op├®rations lentes:', report.slowOperations);\r\n        }\r\n\r\n        if (report.recommendations.length > 0) {\r\n          if (import.meta.env.DEV)\r\n            console.log('Recommandations:', report.recommendations);\r\n        }\r\n\r\n        if (report.memoryUsage) {\r\n          if (import.meta.env.DEV)\r\n            console.log(\r\n              'M├®moire:',\r\n              `${report.memoryUsage.used}MB/${report.memoryUsage.limit}MB`,\r\n            );\r\n        }\r\n\r\n        console.groupEnd();\r\n      }\r\n\r\n      // ├ëmettre rapport via ├®v├®nements natifs\r\n      window.dispatchEvent(\r\n        new CustomEvent('performance:report', {\r\n          detail: report,\r\n        }),\r\n      );\r\n    }, this.reportInterval);\r\n  }\r\n\r\n  /**\r\n   * Arr├¬ter les rapports automatiques\r\n   */\r\n  stopReporting() {\r\n    if (this.reportTimer) {\r\n      clearInterval(this.reportTimer);\r\n      this.reportTimer = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Configurer les seuils d'alerte\r\n   * @param {object} newThresholds - Nouveaux seuils\r\n   */\r\n  setThresholds(newThresholds) {\r\n    this.thresholds = { ...this.thresholds, ...newThresholds };\r\n    if (import.meta.env.DEV)\r\n      console.log('Seuils de performance mis ├á jour:', this.thresholds);\r\n  }\r\n}\r\n\r\n/**\r\n * Middleware de cache intelligent pour optimiser les performances\r\n */\r\nexport class SmartCache {\r\n  constructor(maxSize = 100, ttl = 300000) {\r\n    // 5 minutes par d├®faut\r\n    this.cache = new Map();\r\n    this.accessTimes = new Map();\r\n    this.maxSize = maxSize;\r\n    this.ttl = ttl;\r\n  }\r\n\r\n  /**\r\n   * Obtenir une valeur du cache\r\n   * @param {string} key - Cl├®\r\n   * @returns {any} Valeur ou undefined\r\n   */\r\n  get(key) {\r\n    const item = this.cache.get(key);\r\n\r\n    if (!item) return undefined;\r\n\r\n    // V├®rifier l'expiration\r\n    if (Date.now() - item.timestamp > this.ttl) {\r\n      this.delete(key);\r\n      return undefined;\r\n    }\r\n\r\n    // Mettre ├á jour le temps d'acc├¿s\r\n    this.accessTimes.set(key, Date.now());\r\n    item.accessCount++;\r\n\r\n    return item.value;\r\n  }\r\n\r\n  /**\r\n   * D├®finir une valeur dans le cache\r\n   * @param {string} key - Cl├®\r\n   * @param {any} value - Valeur\r\n   */\r\n  set(key, value) {\r\n    // Nettoyer si n├®cessaire\r\n    if (this.cache.size >= this.maxSize) {\r\n      this.evictLeastUsed();\r\n    }\r\n\r\n    const now = Date.now();\r\n    this.cache.set(key, {\r\n      value,\r\n      timestamp: now,\r\n      accessCount: 1,\r\n    });\r\n    this.accessTimes.set(key, now);\r\n  }\r\n\r\n  /**\r\n   * Supprimer une valeur du cache\r\n   * @param {string} key - Cl├®\r\n   */\r\n  delete(key) {\r\n    this.cache.delete(key);\r\n    this.accessTimes.delete(key);\r\n  }\r\n\r\n  /**\r\n   * ├ëviter l'├®l├®ment le moins utilis├®\r\n   */\r\n  evictLeastUsed() {\r\n    let leastUsedKey = null;\r\n    let leastUsedTime = Infinity;\r\n\r\n    for (const [key, time] of this.accessTimes) {\r\n      if (time < leastUsedTime) {\r\n        leastUsedTime = time;\r\n        leastUsedKey = key;\r\n      }\r\n    }\r\n\r\n    if (leastUsedKey) {\r\n      this.delete(leastUsedKey);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Nettoyer les ├®l├®ments expir├®s\r\n   */\r\n  cleanup() {\r\n    const now = Date.now();\r\n    const expiredKeys = [];\r\n\r\n    for (const [key, item] of this.cache) {\r\n      if (now - item.timestamp > this.ttl) {\r\n        expiredKeys.push(key);\r\n      }\r\n    }\r\n\r\n    expiredKeys.forEach((key) => this.delete(key));\r\n    return expiredKeys.length;\r\n  }\r\n\r\n  /**\r\n   * Obtenir les statistiques du cache\r\n   * @returns {object}\r\n   */\r\n  getStats() {\r\n    return {\r\n      size: this.cache.size,\r\n      maxSize: this.maxSize,\r\n      hitRate: this.calculateHitRate(),\r\n      oldestItem: this.getOldestItemAge(),\r\n      memoryEstimate: this.estimateMemoryUsage(),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Calculer le taux de succ├¿s du cache\r\n   * @returns {number}\r\n   */\r\n  calculateHitRate() {\r\n    const totalAccess = Array.from(this.cache.values()).reduce(\r\n      (sum, item) => sum + item.accessCount,\r\n      0,\r\n    );\r\n\r\n    return totalAccess > 0 ? (this.cache.size / totalAccess) * 100 : 0;\r\n  }\r\n\r\n  /**\r\n   * Obtenir l'├óge du plus ancien ├®l├®ment\r\n   * @returns {number} ├ége en ms\r\n   */\r\n  getOldestItemAge() {\r\n    let oldest = 0;\r\n    const now = Date.now();\r\n\r\n    for (const item of this.cache.values()) {\r\n      const age = now - item.timestamp;\r\n      oldest = Math.max(oldest, age);\r\n    }\r\n\r\n    return oldest;\r\n  }\r\n\r\n  /**\r\n   * Estimer l'utilisation m├®moire\r\n   * @returns {number} Estimation en bytes\r\n   */\r\n  estimateMemoryUsage() {\r\n    let estimate = 0;\r\n\r\n    for (const [key, item] of this.cache) {\r\n      estimate += key.length * 2; // String chars sont 2 bytes\r\n      estimate += JSON.stringify(item.value).length * 2;\r\n      estimate += 64; // Overhead approximatif\r\n    }\r\n\r\n    return estimate;\r\n  }\r\n}\r\n\r\n// Instances singleton\r\nexport const performanceMonitor = new PerformanceMonitor();\r\nexport const smartCache = new SmartCache();\r\n\r\n// Auto-configuration selon l'environnement\r\nif (typeof window !== 'undefined' && window.location.hostname === 'localhost') {\r\n  performanceMonitor.enable();\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\core\\ValidationSystem.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'options' is assigned a value but never used. Allowed unused args must match /^_/u.","line":377,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":377,"endColumn":25,"suggestions":[{"messageId":"removeVar","data":{"varName":"options"},"fix":{"range":[8188,8202],"text":""},"desc":"Remove unused variable 'options'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Syst├¿me de validation avanc├®e pour AG-Tablette\n * Fournit des validateurs r├®utilisables et composables\n */\n\n/**\n * Types de validation disponibles\n */\nexport const ValidationTypes = {\n  REQUIRED: 'required',\n  TYPE: 'type',\n  RANGE: 'range',\n  FORMAT: 'format',\n  CUSTOM: 'custom',\n  ARRAY: 'array',\n  OBJECT: 'object',\n};\n\n/**\n * Messages d'erreur par d├®faut\n */\nconst defaultMessages = {\n  required: 'Ce champ est requis',\n  type: 'Type de donn├®es incorrect',\n  range: 'Valeur hors de la plage autoris├®e',\n  format: 'Format incorrect',\n  custom: 'Validation personnalis├®e ├®chou├®e',\n  array: 'Doit ├¬tre un tableau',\n  object: 'Doit ├¬tre un objet',\n};\n\n/**\n * Classe pour repr├®senter une erreur de validation\n */\nexport class ValidationError extends Error {\n  constructor(field, type, message, value = null) {\n    super(message);\n    this.name = 'ValidationError';\n    this.field = field;\n    this.type = type;\n    this.value = value;\n    this.timestamp = Date.now();\n  }\n\n  toJSON() {\n    return {\n      field: this.field,\n      type: this.type,\n      message: this.message,\n      value: this.value,\n      timestamp: this.timestamp,\n    };\n  }\n}\n\n/**\n * R├®sultat de validation\n */\nexport class ValidationResult {\n  constructor() {\n    this.isValid = true;\n    this.errors = [];\n    this.warnings = [];\n  }\n\n  addError(field, type, message, value = null) {\n    this.isValid = false;\n    this.errors.push(new ValidationError(field, type, message, value));\n  }\n\n  addWarning(field, message, value = null) {\n    this.warnings.push({\n      field,\n      message,\n      value,\n      timestamp: Date.now(),\n    });\n  }\n\n  hasErrors() {\n    return this.errors.length > 0;\n  }\n\n  hasWarnings() {\n    return this.warnings.length > 0;\n  }\n\n  getErrorsForField(field) {\n    return this.errors.filter((error) => error.field === field);\n  }\n\n  getAllMessages() {\n    return [\n      ...this.errors.map((e) => e.message),\n      ...this.warnings.map((w) => w.message),\n    ];\n  }\n\n  toJSON() {\n    return {\n      isValid: this.isValid,\n      errors: this.errors.map((e) => e.toJSON()),\n      warnings: this.warnings,\n    };\n  }\n}\n\n/**\n * Validateurs de base\n */\nexport const baseValidators = {\n  /**\n   * Valider qu'une valeur est requise\n   */\n  required: (value, options = {}) => {\n    const isEmpty =\n      value === null ||\n      value === undefined ||\n      value === '' ||\n      (Array.isArray(value) && value.length === 0) ||\n      (typeof value === 'object' && Object.keys(value).length === 0);\n\n    return {\n      isValid: !isEmpty,\n      message: options.message || defaultMessages.required,\n    };\n  },\n\n  /**\n   * Valider le type de donn├®es\n   */\n  type: (value, options = {}) => {\n    const { expectedType } = options;\n    let isValid = false;\n\n    switch (expectedType) {\n      case 'string':\n        isValid = typeof value === 'string';\n        break;\n      case 'number':\n        isValid = typeof value === 'number' && !isNaN(value);\n        break;\n      case 'boolean':\n        isValid = typeof value === 'boolean';\n        break;\n      case 'array':\n        isValid = Array.isArray(value);\n        break;\n      case 'object':\n        isValid =\n          typeof value === 'object' && value !== null && !Array.isArray(value);\n        break;\n      case 'function':\n        isValid = typeof value === 'function';\n        break;\n      case 'coordinate':\n        isValid =\n          typeof value === 'object' &&\n          value !== null &&\n          typeof value.x === 'number' &&\n          typeof value.y === 'number';\n        break;\n      default:\n        isValid = typeof value === expectedType;\n    }\n\n    return {\n      isValid,\n      message:\n        options.message || `Attendu: ${expectedType}, re├ºu: ${typeof value}`,\n    };\n  },\n\n  /**\n   * Valider une plage de valeurs\n   */\n  range: (value, options = {}) => {\n    const { min, max } = options;\n    let isValid = true;\n\n    if (typeof value !== 'number') {\n      return {\n        isValid: false,\n        message: 'La valeur doit ├¬tre un nombre pour la validation de plage',\n      };\n    }\n\n    if (min !== undefined && value < min) {\n      isValid = false;\n    }\n    if (max !== undefined && value > max) {\n      isValid = false;\n    }\n\n    return {\n      isValid,\n      message:\n        options.message ||\n        `Valeur doit ├¬tre entre ${min || '-Ôê×'} et ${max || '+Ôê×'}`,\n    };\n  },\n\n  /**\n   * Valider un format avec regex\n   */\n  format: (value, options = {}) => {\n    const { pattern, flags = '' } = options;\n\n    if (typeof value !== 'string') {\n      return {\n        isValid: false,\n        message: 'La valeur doit ├¬tre une cha├«ne pour la validation de format',\n      };\n    }\n\n    const regex = new RegExp(pattern, flags);\n    const isValid = regex.test(value);\n\n    return {\n      isValid,\n      message: options.message || defaultMessages.format,\n    };\n  },\n\n  /**\n   * Validation personnalis├®e\n   */\n  custom: (value, options = {}) => {\n    const { validator } = options;\n\n    if (typeof validator !== 'function') {\n      throw new Error('Validator doit ├¬tre une fonction');\n    }\n\n    try {\n      const result = validator(value);\n\n      // Support pour retour boolean ou objet\n      if (typeof result === 'boolean') {\n        return {\n          isValid: result,\n          message: options.message || defaultMessages.custom,\n        };\n      }\n\n      return result;\n    } catch (error) {\n      return {\n        isValid: false,\n        message: `Erreur de validation: ${error.message}`,\n      };\n    }\n  },\n};\n\n/**\n * Validateurs sp├®cialis├®s pour AG-Tablette\n */\nexport const geometryValidators = {\n  /**\n   * Valider une coordonn├®e\n   */\n  coordinate: (value, options = {}) => {\n    const typeResult = baseValidators.type(value, {\n      expectedType: 'coordinate',\n    });\n    if (!typeResult.isValid) {\n      return typeResult;\n    }\n\n    const { bounds } = options;\n    if (bounds) {\n      if (\n        value.x < bounds.minX ||\n        value.x > bounds.maxX ||\n        value.y < bounds.minY ||\n        value.y > bounds.maxY\n      ) {\n        return {\n          isValid: false,\n          message: 'Coordonn├®e hors des limites',\n        };\n      }\n    }\n\n    return { isValid: true };\n  },\n\n  /**\n   * Valider un point\n   */\n  point: (value, options = {}) => {\n    if (!value || typeof value !== 'object') {\n      return {\n        isValid: false,\n        message: 'Point invalide',\n      };\n    }\n\n    // V├®rifier les coordonn├®es\n    const coordResult = geometryValidators.coordinate(value, options);\n    if (!coordResult.isValid) {\n      return coordResult;\n    }\n\n    // V├®rifier les propri├®t├®s suppl├®mentaires\n    if (options.requireId && !value.id) {\n      return {\n        isValid: false,\n        message: 'Point doit avoir un ID',\n      };\n    }\n\n    return { isValid: true };\n  },\n\n  /**\n   * Valider une forme g├®om├®trique\n   */\n  shape: (value, options = {}) => {\n    if (!value || typeof value !== 'object') {\n      return {\n        isValid: false,\n        message: 'Forme invalide',\n      };\n    }\n\n    // V├®rifications de base\n    if (!value.id) {\n      return {\n        isValid: false,\n        message: 'Forme doit avoir un ID',\n      };\n    }\n\n    if (!value.type) {\n      return {\n        isValid: false,\n        message: 'Forme doit avoir un type',\n      };\n    }\n\n    // V├®rifier les points selon le type\n    const { minPoints, maxPoints } = options;\n    if (value.points) {\n      if (minPoints && value.points.length < minPoints) {\n        return {\n          isValid: false,\n          message: `Forme n├®cessite au moins ${minPoints} points`,\n        };\n      }\n      if (maxPoints && value.points.length > maxPoints) {\n        return {\n          isValid: false,\n          message: `Forme ne peut avoir plus de ${maxPoints} points`,\n        };\n      }\n\n      // Valider chaque point\n      for (let i = 0; i < value.points.length; i++) {\n        const pointResult = geometryValidators.point(value.points[i], options);\n        if (!pointResult.isValid) {\n          return {\n            isValid: false,\n            message: `Point ${i} invalide: ${pointResult.message}`,\n          };\n        }\n      }\n    }\n\n    return { isValid: true };\n  },\n\n  /**\n   * Valider une couleur\n   */\n  color: (value, options = {}) => {\n    if (typeof value !== 'string') {\n      return {\n        isValid: false,\n        message: 'Couleur doit ├¬tre une cha├«ne',\n      };\n    }\n\n    // Formats support├®s: hex, rgb, rgba, noms CSS\n    const hexPattern = /^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/;\n    const rgbPattern = /^rgb\\(\\s*\\d+\\s*,\\s*\\d+\\s*,\\s*\\d+\\s*\\)$/;\n    const rgbaPattern = /^rgba\\(\\s*\\d+\\s*,\\s*\\d+\\s*,\\s*\\d+\\s*,\\s*[\\d.]+\\s*\\)$/;\n\n    const isValid =\n      hexPattern.test(value) ||\n      rgbPattern.test(value) ||\n      rgbaPattern.test(value) ||\n      CSS.supports('color', value);\n\n    return {\n      isValid,\n      message: 'Format de couleur invalide',\n    };\n  },\n};\n\n/**\n * Classe principale de validation\n */\nexport class Validator {\n  constructor() {\n    this.rules = new Map();\n    this.schemas = new Map();\n  }\n\n  /**\n   * Ajouter une r├¿gle de validation\n   * @param {string} name - Nom de la r├¿gle\n   * @param {Function} validator - Fonction de validation\n   */\n  addRule(name, validator) {\n    if (typeof validator !== 'function') {\n      throw new Error('Validator doit ├¬tre une fonction');\n    }\n    this.rules.set(name, validator);\n  }\n\n  /**\n   * D├®finir un sch├®ma de validation\n   * @param {string} name - Nom du sch├®ma\n   * @param {object} schema - D├®finition du sch├®ma\n   */\n  defineSchema(name, schema) {\n    this.schemas.set(name, schema);\n  }\n\n  /**\n   * Valider une valeur selon des r├¿gles\n   * @param {any} value - Valeur ├á valider\n   * @param {array} rules - R├¿gles de validation\n   * @param {string} fieldName - Nom du champ\n   * @returns {ValidationResult}\n   */\n  validate(value, rules, fieldName = 'value') {\n    const result = new ValidationResult();\n\n    for (const rule of rules) {\n      const { type, options = {}, message } = rule;\n\n      let validator;\n      if (baseValidators[type]) {\n        validator = baseValidators[type];\n      } else if (geometryValidators[type]) {\n        validator = geometryValidators[type];\n      } else if (this.rules.has(type)) {\n        validator = this.rules.get(type);\n      } else {\n        result.addError(\n          fieldName,\n          'unknown',\n          `R├¿gle de validation inconnue: ${type}`,\n        );\n        continue;\n      }\n\n      try {\n        const validationResult = validator(value, { ...options, message });\n\n        if (!validationResult.isValid) {\n          result.addError(fieldName, type, validationResult.message, value);\n        }\n\n        if (validationResult.warning) {\n          result.addWarning(fieldName, validationResult.warning, value);\n        }\n      } catch (error) {\n        result.addError(\n          fieldName,\n          type,\n          `Erreur de validation: ${error.message}`,\n          value,\n        );\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * Valider un objet selon un sch├®ma\n   * @param {object} data - Donn├®es ├á valider\n   * @param {string|object} schema - Nom du sch├®ma ou d├®finition directe\n   * @returns {ValidationResult}\n   */\n  validateSchema(data, schema) {\n    const result = new ValidationResult();\n\n    // R├®cup├®rer le sch├®ma\n    let schemaDefinition;\n    if (typeof schema === 'string') {\n      schemaDefinition = this.schemas.get(schema);\n      if (!schemaDefinition) {\n        result.addError('schema', 'unknown', `Sch├®ma inconnu: ${schema}`);\n        return result;\n      }\n    } else {\n      schemaDefinition = schema;\n    }\n\n    // Valider chaque champ\n    for (const [fieldName, fieldRules] of Object.entries(schemaDefinition)) {\n      const fieldValue = this.getNestedValue(data, fieldName);\n      const fieldResult = this.validate(fieldValue, fieldRules, fieldName);\n\n      // Fusionner les r├®sultats\n      result.errors.push(...fieldResult.errors);\n      result.warnings.push(...fieldResult.warnings);\n\n      if (fieldResult.hasErrors()) {\n        result.isValid = false;\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * Obtenir une valeur imbriqu├®e dans un objet\n   * @param {object} obj - Objet source\n   * @param {string} path - Chemin vers la valeur (ex: 'user.name')\n   * @returns {any} Valeur trouv├®e\n   */\n  getNestedValue(obj, path) {\n    return path.split('.').reduce((current, key) => {\n      return current && current[key] !== undefined ? current[key] : undefined;\n    }, obj);\n  }\n\n  /**\n   * Valider de mani├¿re asynchrone\n   * @param {any} value - Valeur ├á valider\n   * @param {array} rules - R├¿gles de validation\n   * @param {string} fieldName - Nom du champ\n   * @returns {Promise<ValidationResult>}\n   */\n  async validateAsync(value, rules, fieldName = 'value') {\n    return new Promise((resolve) => {\n      setTimeout(() => {\n        resolve(this.validate(value, rules, fieldName));\n      }, 0);\n    });\n  }\n\n  /**\n   * Obtenir les statistiques de validation\n   * @returns {object}\n   */\n  getStats() {\n    return {\n      customRules: this.rules.size,\n      schemas: this.schemas.size,\n      availableValidators: Object.keys(baseValidators).concat(\n        Object.keys(geometryValidators),\n      ),\n    };\n  }\n}\n\n/**\n * Instance singleton du validateur\n */\nexport const validator = new Validator();\n\n/**\n * Sch├®mas pr├®d├®finis pour AG-Tablette\n */\nexport const predefinedSchemas = {\n  point: {\n    x: [\n      { type: 'required' },\n      { type: 'type', options: { expectedType: 'number' } },\n    ],\n    y: [\n      { type: 'required' },\n      { type: 'type', options: { expectedType: 'number' } },\n    ],\n    id: [{ type: 'type', options: { expectedType: 'string' } }],\n  },\n\n  shape: {\n    id: [\n      { type: 'required' },\n      { type: 'type', options: { expectedType: 'string' } },\n    ],\n    type: [\n      { type: 'required' },\n      { type: 'type', options: { expectedType: 'string' } },\n    ],\n    points: [\n      { type: 'required' },\n      { type: 'type', options: { expectedType: 'array' } },\n    ],\n    color: [{ type: 'color' }],\n  },\n\n  toolConfig: {\n    name: [\n      { type: 'required' },\n      { type: 'type', options: { expectedType: 'string' } },\n    ],\n    family: [\n      { type: 'required' },\n      { type: 'type', options: { expectedType: 'string' } },\n    ],\n    options: [{ type: 'type', options: { expectedType: 'object' } }],\n  },\n\n  environment: {\n    name: [\n      { type: 'required' },\n      { type: 'type', options: { expectedType: 'string' } },\n    ],\n    modules: [\n      { type: 'required' },\n      { type: 'type', options: { expectedType: 'array' } },\n    ],\n  },\n};\n\n// Enregistrer les sch├®mas pr├®d├®finis\nObject.entries(predefinedSchemas).forEach(([name, schema]) => {\n  validator.defineSchema(name, schema);\n});\n\n/**\n * Fonctions utilitaires de validation\n */\nexport const validationUtils = {\n  /**\n   * Valider rapidement une coordonn├®e\n   */\n  isValidCoordinate: (coord) => {\n    const result = geometryValidators.coordinate(coord);\n    return result.isValid;\n  },\n\n  /**\n   * Valider rapidement une couleur\n   */\n  isValidColor: (color) => {\n    const result = geometryValidators.color(color);\n    return result.isValid;\n  },\n\n  /**\n   * Cr├®er un validateur pour une plage\n   */\n  createRangeValidator: (min, max) => {\n    return (value) => baseValidators.range(value, { min, max });\n  },\n\n  /**\n   * Cr├®er un validateur d'├®num├®ration\n   */\n  createEnumValidator: (allowedValues) => {\n    return (value) => ({\n      isValid: allowedValues.includes(value),\n      message: `Valeur doit ├¬tre l'une de: ${allowedValues.join(', ')}`,\n    });\n  },\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\core\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\firebase\\firebase-init.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":33,"column":23,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":33,"endColumn":25,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[980,982],"text":"!=="},"desc":"Use '!==' instead of '!='."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'analytics' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":34,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":18,"suggestions":[{"messageId":"removeVar","data":{"varName":"analytics"},"fix":{"range":[1001,1034],"text":""},"desc":"Remove unused variable 'analytics'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'perf' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":35,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":35,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"perf"},"fix":{"range":[1038,1079],"text":""},"desc":"Remove unused variable 'perf'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'indexedDBError' is defined but never used.","line":110,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":110,"endColumn":28},{"ruleId":"no-unused-vars","severity":1,"message":"'saveError' is defined but never used.","line":148,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":148,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'fallbackError' is defined but never used.","line":169,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":169,"endColumn":27},{"ruleId":"no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":219,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":219,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":233,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":233,"endColumn":15},{"ruleId":"no-unused-vars","severity":1,"message":"'saveError' is defined but never used.","line":263,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":263,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":268,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":268,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'permError' is defined but never used.","line":305,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":305,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'collectionRef' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":349,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":349,"endColumn":28,"suggestions":[{"messageId":"removeVar","data":{"varName":"collectionRef"},"fix":{"range":[9032,9080],"text":""},"desc":"Remove unused variable 'collectionRef'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'collError' is defined but never used.","line":351,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":351,"endColumn":25},{"ruleId":"no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":357,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":357,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":370,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":370,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":426,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":426,"endColumn":15},{"ruleId":"no-unused-vars","severity":1,"message":"'saveError' is defined but never used.","line":482,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":482,"endColumn":25},{"ruleId":"no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":490,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":490,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":527,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":527,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":18,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { zip } from 'fflate';\r\nimport { getAnalytics } from 'firebase/analytics';\r\nimport { initializeApp } from 'firebase/app';\r\nimport {\r\n  collection,\r\n  doc,\r\n  getDoc,\r\n  getDocs,\r\n  initializeFirestore,\r\n  persistentLocalCache,\r\n  query,\r\n  where,\r\n} from 'firebase/firestore';\r\nimport { getPerformance } from 'firebase/performance';\r\nimport { getDownloadURL, getStorage, ref } from 'firebase/storage';\r\nimport { app } from '../controllers/Core/App';\r\nimport { loadEnvironnement } from '../controllers/Core/Environment';\r\nimport { OpenFileManager } from '../controllers/Core/Managers/OpenFileManager';\r\nimport {\r\n  getActivity,\r\n  getAllModules,\r\n  getAllThemes,\r\n  saveActivity,\r\n} from '../utils/indexeddb-activities.js';\r\nimport config from './firebase-config.json';\r\n\r\nconst firebaseApp = initializeApp(config);\r\nconst db = initializeFirestore(firebaseApp, {\r\n  localCache: persistentLocalCache(),\r\n});\r\nconst storage = getStorage(firebaseApp);\r\n\r\nif (location.hostname != 'localhost') {\r\n  const analytics = getAnalytics();\r\n  const perf = getPerformance(firebaseApp);\r\n}\r\n\r\nexport async function openFileFromServer(activityName) {\r\n  try {\r\n    // Validation des param├¿tres\r\n    if (!activityName || typeof activityName !== 'string') {\r\n      throw new Error(\"Nom d'activit├® invalide\");\r\n    }\r\n\r\n    const data = await getFileDocFromFilename(activityName);\r\n    if (data) {\r\n      await loadEnvironnement(data.environment);\r\n      const fileDownloadedObject = await readFileFromServer(data.id);\r\n\r\n      // Si l'application est d├®j├á d├®marr├®e, on parse directement le fichier\r\n      // sinon on attend l'├®v├®nement app-started\r\n      if (app.started) {\r\n        OpenFileManager.parseFile(fileDownloadedObject, activityName);\r\n      } else {\r\n        window.addEventListener(\r\n          'app-started',\r\n          () => OpenFileManager.parseFile(fileDownloadedObject, activityName),\r\n          { once: true },\r\n        );\r\n      }\r\n    } else {\r\n      throw new Error(`Fichier non trouv├®: ${activityName}`);\r\n    }\r\n  } catch (error) {\r\n\r\n    window.dispatchEvent(\r\n      new CustomEvent('show-notif', {\r\n        detail: { message: `Erreur lors du chargement: ${error.message}` },\r\n      }),\r\n    );\r\n  }\r\n}\r\n\r\n// Cache pour les fichiers t├®l├®charg├®s\r\nconst fileCache = new Map();\r\nconst CACHE_DURATION = 5 * 60 * 1000; // 5 minutes\r\n\r\n/**\r\n * Utilitaire de retry avec backoff exponentiel\r\n */\r\nasync function retryWithBackoff(fn, maxAttempts = 3, baseDelay = 1000) {\r\n  for (let attempt = 1; attempt <= maxAttempts; attempt++) {\r\n    try {\r\n      return await fn();\r\n    } catch (error) {\r\n      if (attempt === maxAttempts) throw error;\r\n\r\n      const delay = baseDelay * Math.pow(2, attempt - 1);\r\n\r\n      await new Promise((resolve) => setTimeout(resolve, delay));\r\n    }\r\n  }\r\n}\r\n\r\nexport async function readFileFromServer(filename) {\r\n  try {\r\n    // Validation du nom de fichier\r\n    if (!filename || typeof filename !== 'string') {\r\n      throw new Error('Nom de fichier invalide');\r\n    }\r\n\r\n    // V├®rifier d'abord IndexedDB (acc├¿s hors ligne)\r\n    try {\r\n      const localActivity = await getActivity(filename);\r\n      if (localActivity) {\r\n\r\n        // Notification supprim├®e pour transparence utilisateur\r\n        return localActivity.data;\r\n      }\r\n    } catch (indexedDBError) {\r\n\r\n    }\r\n\r\n    // V├®rifier le cache m├®moire\r\n    const cacheKey = `file_${filename}`;\r\n    const cachedData = fileCache.get(cacheKey);\r\n    if (cachedData && Date.now() - cachedData.timestamp < CACHE_DURATION) {\r\n\r\n      return cachedData.data;\r\n    }\r\n\r\n    // T├®l├®charger avec retry\r\n    const fileDownloaded = await retryWithBackoff(\r\n      async () => {\r\n        const URL = await getDownloadURL(ref(storage, filename));\r\n        const response = await fetch(URL);\r\n\r\n        if (!response.ok) {\r\n          throw new Error(\r\n            `Erreur HTTP: ${response.status} - ${response.statusText}`,\r\n          );\r\n        }\r\n\r\n        return response;\r\n      },\r\n      3,\r\n      1000,\r\n    );\r\n\r\n    // Parser le JSON imm├®diatement\r\n    const jsonData = await fileDownloaded.json();\r\n\r\n    // Sauvegarder dans IndexedDB pour acc├¿s hors ligne\r\n    try {\r\n      const version = jsonData.version || 1;\r\n      await saveActivity(filename, jsonData, version);\r\n\r\n    } catch (saveError) {\r\n\r\n    }\r\n\r\n    // Mettre en cache le contenu JSON plut├┤t que la r├®ponse\r\n    fileCache.set(cacheKey, {\r\n      data: jsonData,\r\n      timestamp: Date.now(),\r\n    });\r\n\r\n    return jsonData;\r\n  } catch (error) {\r\n\r\n\r\n    // En cas d'erreur r├®seau, tenter une derni├¿re fois IndexedDB\r\n    try {\r\n      const fallbackActivity = await getActivity(filename);\r\n      if (fallbackActivity) {\r\n\r\n        return fallbackActivity.data;\r\n      }\r\n    } catch (fallbackError) {\r\n\r\n    }\r\n\r\n    throw error;\r\n  }\r\n}\r\n\r\nexport async function getFileDocFromFilename(id) {\r\n  try {\r\n    // Validation de l'ID\r\n    if (!id || typeof id !== 'string') {\r\n      throw new Error('ID de document invalide');\r\n    }\r\n\r\n    // V├®rifier le cache pour les m├®tadonn├®es\r\n    const cacheKey = `metadata_${id}`;\r\n    const cachedMetadata = fileCache.get(cacheKey);\r\n    if (\r\n      cachedMetadata &&\r\n      Date.now() - cachedMetadata.timestamp < CACHE_DURATION\r\n    ) {\r\n\r\n      return cachedMetadata.data;\r\n    }\r\n\r\n    // R├®cup├®rer avec retry\r\n    const result = await retryWithBackoff(\r\n      async () => {\r\n        const docRef = doc(db, 'files', id);\r\n        const docSnap = await getDoc(docRef);\r\n\r\n        if (docSnap.exists()) {\r\n          app.fileFromServer = true;\r\n          return { id, ...docSnap.data() };\r\n        } else {\r\n          throw new Error(`Document non trouv├®: ${id}`);\r\n        }\r\n      },\r\n      3,\r\n      1000,\r\n    );\r\n\r\n    // Mettre en cache\r\n    fileCache.set(cacheKey, {\r\n      data: result,\r\n      timestamp: Date.now(),\r\n    });\r\n\r\n    return result;\r\n  } catch (error) {\r\n\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function findAllThemes() {\r\n  // Essayer d'abord IndexedDB\r\n  try {\r\n    const localThemes = await getAllThemes();\r\n    if (localThemes && localThemes.length > 0) {\r\n\r\n      return localThemes.map((t) => ({ id: t.id, ...t.data }));\r\n    }\r\n  } catch (err) {\r\n\r\n  }\r\n\r\n  // V├®rifier si on est en ligne avant d'essayer le serveur\r\n  if (!navigator.onLine) {\r\n\r\n    return [];\r\n  }\r\n\r\n  try {\r\n    // Fallback serveur avec retry\r\n    const themes = await retryWithBackoff(\r\n      async () => {\r\n        return await getDocs(collection(db, 'themes'));\r\n      },\r\n      2,\r\n      1000,\r\n    );\r\n\r\n    const themesWithId = [];\r\n    themes.forEach((doc) => themesWithId.push({ id: doc.id, ...doc.data() }));\r\n\r\n    // Sauvegarder dans IndexedDB pour les prochaines fois\r\n    try {\r\n      const { saveTheme } = await import('../utils/indexeddb-activities.js');\r\n      for (const theme of themesWithId) {\r\n        await saveTheme(theme.id, theme);\r\n      }\r\n\r\n    } catch (saveError) {\r\n\r\n    }\r\n\r\n    return themesWithId;\r\n  } catch (error) {\r\n\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function findAllFiles() {\r\n  const files = await getDocs(collection(db, 'files'));\r\n  const filesWithId = [];\r\n  files.forEach((doc) => filesWithId.push({ id: doc.id, ...doc.data() }));\r\n  return filesWithId;\r\n}\r\n\r\nexport function getThemeDocFromThemeName(themeName) {\r\n  const themeDoc = doc(db, 'themes', themeName);\r\n  return themeDoc;\r\n}\r\n\r\nexport function getModuleDocFromModuleName(moduleName) {\r\n  const moduleDoc = doc(db, 'modules', moduleName);\r\n  return moduleDoc;\r\n}\r\n\r\n// Fonction de diagnostic pour v├®rifier la collection modules\r\nexport async function debugFirebaseModules() {\r\n  try {\r\n\r\n\r\n    // Tester les permissions de lecture\r\n    try {\r\n      await getDocs(\r\n        query(\r\n          collection(db, 'modules'),\r\n          where('__name__', '!=', 'impossible_doc_name'),\r\n        ),\r\n      );\r\n\r\n    } catch (permError) {\r\n\r\n      return [];\r\n    }\r\n\r\n    // R├®cup├®rer TOUS les modules sans filtre\r\n    const allModulesSnapshot = await getDocs(collection(db, 'modules'));\r\n\r\n\r\n    if (allModulesSnapshot.size > 0) {\r\n      const modulesList = [];\r\n      allModulesSnapshot.forEach((doc) => {\r\n        const moduleData = { id: doc.id, ...doc.data() };\r\n        modulesList.push(moduleData);\r\n      });\r\n\r\n      // Grouper par th├¿me pour voir la r├®partition\r\n      const modulesByTheme = {};\r\n      modulesList.forEach((module) => {\r\n        // G├®rer les DocumentReference pour les th├¿mes\r\n        let themeKey;\r\n        if (\r\n          module.theme &&\r\n          typeof module.theme === 'object' &&\r\n          module.theme.id\r\n        ) {\r\n          themeKey = module.theme.id; // DocumentReference\r\n        } else if (typeof module.theme === 'string') {\r\n          themeKey = module.theme; // String directe\r\n        } else {\r\n          themeKey = 'SANS_THEME';\r\n        }\r\n\r\n        if (!modulesByTheme[themeKey]) modulesByTheme[themeKey] = [];\r\n        modulesByTheme[themeKey].push(module);\r\n      });\r\n\r\n\r\n      return modulesList;\r\n    } else {\r\n\r\n\r\n      // V├®rifier si la collection existe\r\n      try {\r\n        const collectionRef = collection(db, 'modules');\r\n\r\n      } catch (collError) {\r\n\r\n      }\r\n\r\n      return [];\r\n    }\r\n  } catch (error) {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Nettoie les donn├®es pour les rendre s├®rialisables dans IndexedDB\r\n * Supprime les fonctions, symboles et autres objets non s├®rialisables\r\n */\r\nfunction cleanDataForSerialization(obj) {\r\n  try {\r\n    // Utiliser JSON.parse(JSON.stringify()) pour supprimer les propri├®t├®s non s├®rialisables\r\n    return JSON.parse(JSON.stringify(obj));\r\n  } catch (error) {\r\n\r\n    // En cas d'erreur, retourner un objet basique avec seulement les propri├®t├®s importantes\r\n    return {\r\n      id: obj.id,\r\n      theme: obj.theme,\r\n      hidden: obj.hidden,\r\n      files: Array.isArray(obj.files) ? obj.files : [],\r\n    };\r\n  }\r\n}\r\n\r\nexport async function getModulesDocFromTheme(themeDoc) {\r\n  const themeId = typeof themeDoc === 'string' ? themeDoc : themeDoc.id;\r\n\r\n\r\n\r\n  // Essayer d'abord IndexedDB\r\n  try {\r\n    const localModules = await getAllModules();\r\n\r\n\r\n    if (localModules.length > 0) {\r\n      // Debug de la structure des modules\r\n\r\n\r\n      // Corriger l'acc├¿s aux donn├®es selon la structure r├®elle\r\n      const filtered = localModules.filter((m) => {\r\n        let moduleTheme;\r\n\r\n        // G├®rer les diff├®rents formats de donn├®es\r\n        if (m.data?.theme) {\r\n          if (typeof m.data.theme === 'object' && m.data.theme.id) {\r\n            moduleTheme = m.data.theme.id; // DocumentReference\r\n          } else {\r\n            moduleTheme = m.data.theme; // String\r\n          }\r\n        } else if (m.theme) {\r\n          if (typeof m.theme === 'object' && m.theme.id) {\r\n            moduleTheme = m.theme.id; // DocumentReference\r\n          } else {\r\n            moduleTheme = m.theme; // String\r\n          }\r\n        }\r\n\r\n\r\n        return moduleTheme === themeId;\r\n      });\r\n\r\n      if (filtered.length > 0) {\r\n\r\n        return filtered.map((m) => ({ id: m.id, ...m.data }));\r\n      } else {\r\n\r\n      }\r\n    }\r\n  } catch (err) {\r\n\r\n  }\r\n\r\n  // V├®rifier si on est en ligne avant d'essayer le serveur\r\n  if (!navigator.onLine) {\r\n\r\n    return [];\r\n  }\r\n\r\n  try {\r\n\r\n\r\n    // Cr├®er une r├®f├®rence au document th├¿me pour la comparaison\r\n    const themeRef = doc(db, 'themes', themeId);\r\n\r\n    // Fallback serveur avec retry - utiliser la r├®f├®rence du document\r\n    const moduleDocs = await retryWithBackoff(\r\n      async () => {\r\n        return await getDocs(\r\n          query(collection(db, 'modules'), where('theme', '==', themeRef)),\r\n        );\r\n      },\r\n      2,\r\n      1000,\r\n    );\r\n\r\n    const moduleDocsWithId = [];\r\n    moduleDocs.forEach((doc) => {\r\n      const moduleData = { id: doc.id, ...doc.data() };\r\n      // Convertir la DocumentReference en string pour la coh├®rence\r\n      if (\r\n        moduleData.theme &&\r\n        typeof moduleData.theme === 'object' &&\r\n        moduleData.theme.id\r\n      ) {\r\n        moduleData.theme = moduleData.theme.id;\r\n      }\r\n      moduleDocsWithId.push(moduleData);\r\n    });\r\n\r\n\r\n\r\n    // Sauvegarder dans IndexedDB pour les prochaines fois - seulement si on a des modules\r\n    if (moduleDocsWithId.length > 0) {\r\n      try {\r\n        const { saveModule } = await import('../utils/indexeddb-activities.js');\r\n        for (const module of moduleDocsWithId) {\r\n          // Nettoyer les donn├®es avant sauvegarde pour ├®viter les erreurs de s├®rialisation\r\n          const cleanedModule = cleanDataForSerialization({\r\n            ...module,\r\n            theme: themeId,\r\n          });\r\n          await saveModule(module.id, cleanedModule);\r\n        }\r\n\r\n      } catch (saveError) {\r\n\r\n      }\r\n    } else {\r\n\r\n    }\r\n\r\n    return moduleDocsWithId;\r\n  } catch (error) {\r\n\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function getFilesDocFromModule(moduleDoc) {\r\n  const fileDocs = await getDocs(\r\n    query(collection(db, 'files'), where('module', '==', moduleDoc)),\r\n  );\r\n  const fileDocsWithId = [];\r\n  fileDocs.forEach((doc) => fileDocsWithId.push({ id: doc.id, ...doc.data() }));\r\n  return fileDocsWithId;\r\n}\r\n\r\nexport async function downloadFileZip(zipname, files) {\r\n  try {\r\n    // V├®rifier si la liste des fichiers est vide\r\n    if (!files || files.length === 0) {\r\n      throw new Error('Aucun fichier ├á t├®l├®charger');\r\n    }\r\n\r\n    // T├®l├®charger les fichiers depuis le stockage Firebase\r\n    const filePromises = files.map(async (fileId) => {\r\n      try {\r\n        const fileURL = await getDownloadURL(ref(storage, fileId));\r\n        const response = await fetch(fileURL);\r\n\r\n        if (!response.ok) {\r\n          throw new Error(`Erreur lors du t├®l├®chargement du fichier ${fileId}`);\r\n        }\r\n\r\n        const fileData = await response.arrayBuffer();\r\n        return {\r\n          name: fileId,\r\n          data: new Uint8Array(fileData),\r\n        };\r\n      } catch (error) {\r\n\r\n        return null;\r\n      }\r\n    });\r\n\r\n    // Attendre le t├®l├®chargement de tous les fichiers\r\n    const downloadedFiles = await Promise.all(filePromises);\r\n\r\n    // Filtrer les fichiers qui n'ont pas pu ├¬tre t├®l├®charg├®s\r\n    const validFiles = downloadedFiles.filter((file) => file !== null);\r\n\r\n    if (validFiles.length === 0) {\r\n      throw new Error(\"Aucun fichier n'a pu ├¬tre t├®l├®charg├®\");\r\n    }\r\n\r\n    // Cr├®er un objet avec les fichiers ├á compresser\r\n    const zipData = {};\r\n    validFiles.forEach((file) => {\r\n      zipData[file.name] = file.data;\r\n    });\r\n\r\n    // Cr├®er le fichier ZIP avec fflate\r\n    return new Promise((resolve, reject) => {\r\n      zip(zipData, (err, data) => {\r\n        if (err) {\r\n          reject(\r\n            new Error('Erreur lors de la cr├®ation du ZIP: ' + err.message),\r\n          );\r\n          return;\r\n        }\r\n\r\n        // Cr├®er un Blob ├á partir des donn├®es compress├®es\r\n        const blob = new Blob([data], { type: 'application/zip' });\r\n\r\n        // T├®l├®charger le fichier\r\n        const link = document.createElement('a');\r\n        link.href = URL.createObjectURL(blob);\r\n        link.download = zipname;\r\n        link.click();\r\n        link.remove();\r\n\r\n        resolve();\r\n      });\r\n    });\r\n  } catch (error) {\r\n\r\n    throw error;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\layouts\\ag-main.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'registration' is defined but never used. Allowed unused args must match /^_/u.","line":23,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":26,"suggestions":[{"messageId":"removeVar","data":{"varName":"registration"},"fix":{"range":[1048,1060],"text":""},"desc":"Remove unused variable 'registration'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'registration' is defined but never used. Allowed unused args must match /^_/u.","line":23,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":26},{"ruleId":"no-unused-vars","severity":1,"message":"'AGMain' is defined but never used. Allowed unused vars must match /^_/u.","line":31,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":31,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"AGMain"},"fix":{"range":[1197,5597],"text":""},"desc":"Remove unused variable 'AGMain'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AGMain' is defined but never used. Allowed unused vars must match /^_/u.","line":31,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import '@components/canvas-container';\r\nimport '@components/popups/notification';\r\nimport { bugSend } from '@controllers/Bugs';\r\nimport '@layouts/ag-menu';\r\nimport { css, html, LitElement } from 'lit';\r\nimport { customElement, property } from 'lit/decorators.js';\r\nimport '../components/sync-status-indicator.ts';\r\nimport { app } from '../controllers/Core/App';\r\nimport { HistoryManager } from '../controllers/Core/Managers/HistoryManager';\r\nimport { OpenFileManager } from '../controllers/Core/Managers/OpenFileManager';\r\nimport { createElem } from '../controllers/Core/Tools/general';\r\nimport { initializeCachesFromIndexedDB } from '../store/notions';\r\nimport '../utils/offline-init.js';\r\n\r\nif (app.fileToOpen) OpenFileManager.newReadFile(app.fileToOpen);\r\ninitializeCachesFromIndexedDB().catch((error) => {\r\n  console.warn(\"Erreur lors de l'initialisation des caches:\", error);\r\n});\r\nif ('serviceWorker' in navigator) {\r\n  window.addEventListener('load', () => {\r\n    navigator.serviceWorker\r\n      .register('/service-worker.js')\r\n      .then((registration) => {})\r\n      .catch((error) => {\r\n        console.log(\"├ëchec de l'enregistrement du Service Worker:\", error);\r\n      });\r\n  });\r\n}\r\n\r\n@customElement('ag-main')\r\nclass AGMain extends LitElement {\r\n  @property({ type: Boolean }) canUndo = false;\r\n  @property({ type: Boolean }) canRedo = false;\r\n  @property({ type: String }) background = '';\r\n  @property({ type: Object }) tool = null;\r\n  @property({ type: String }) colorPickerValue = '#000000';\r\n  @property({ type: Boolean }) helpSelected = false;\r\n  @property({ type: String }) filename = '';\r\n\r\n  static styles = css`\r\n    #app-view {\r\n      background-color: var(--theme-color-soft);\r\n      display: grid;\r\n      grid-template-columns: 240px 1fr;\r\n      width: 100%;\r\n      margin: 0;\r\n      padding: 0;\r\n      height: 100%;\r\n    }\r\n    #left-menu {\r\n      display: flex;\r\n      gap: 8px;\r\n      flex-direction: column;\r\n      padding: 8px;\r\n      background-color: var(--theme-color);\r\n      scrollbar-width: thin;\r\n      overflow: auto;\r\n    }\r\n    canvas-container {\r\n      width: 100%;\r\n      height: 100%;\r\n    }\r\n    input[type='color'] {\r\n      position: absolute;\r\n      top: 0;\r\n      left: 21dvw;\r\n      border: none;\r\n    }\r\n    h3 {\r\n      padding: 0;\r\n      margin: 0;\r\n      text-align: center;\r\n      font-size: 14px;\r\n      font-weight: bold;\r\n      padding: 8px 0;\r\n      border-radius: 4px;\r\n      background-color: var(--theme-color-soft);\r\n    }\r\n  `;\r\n\r\n  render() {\r\n    return html`\r\n      <div id=\"app-view\">\r\n        <ag-menu\r\n          id=\"left-menu\"\r\n          .helpSelected=\"${this.helpSelected}\"\r\n          .tool=\"${this.tool}\"\r\n          .canUndo=\"${this.canUndo}\"\r\n          .canRedo=\"${this.canRedo}\"\r\n        >\r\n        </ag-menu>\r\n        <canvas-container\r\n          id=\"canvas-container\"\r\n          .environment=\"${app.environment}\"\r\n        ></canvas-container>\r\n      </div>\r\n      <sync-status-indicator></sync-status-indicator>\r\n      <notif-center></notif-center>\r\n      <input\r\n        id=\"fileSelector\"\r\n        accept=\"${app.environment.extensions.join(',')}\"\r\n        type=\"file\"\r\n        style=\"display: none\"\r\n        @change=\"${(event) => this.handleFileChange(event)}\"\r\n      />\r\n      ${this.addModules()} ${this.showZoom()}\r\n    `;\r\n  }\r\n\r\n  handleFileChange(event) {\r\n    const input = event.target;\r\n    if (input.files && input.files[0]) {\r\n      window.dispatchEvent(\r\n        new CustomEvent('file-opened', {\r\n          detail: { method: 'old', file: input.files[0] },\r\n        }),\r\n      );\r\n      input.value = '';\r\n    }\r\n  }\r\n\r\n  addModules() {\r\n    if (app.environment.name === 'Tangram') {\r\n      import('../controllers/Tangram/TangramManager');\r\n      return html`<tangram-manager></tangram-manager>`;\r\n    }\r\n    return html``;\r\n  }\r\n\r\n  showZoom() {\r\n    if (app.tool?.name !== 'zoom') return html``;\r\n    import('../controllers/Zoom/zoom-menu');\r\n    return html`<zoom-menu></zoom-menu>`;\r\n  }\r\n\r\n  updateProperties() {\r\n    this.helpSelected = app.helpSelected;\r\n    this.filename = app.filename || '';\r\n    document.title = this.filename !== '' ? this.filename : 'AG mobile';\r\n  }\r\n\r\n  preventZoom(e) {\r\n    const t2 = e.timeStamp;\r\n    const t1 = Number(e.currentTarget.dataset.lastTouch) || t2;\r\n    const dt = t2 - t1;\r\n    const fingers = (e.touches || []).length;\r\n    e.currentTarget.dataset.lastTouch = String(t2);\r\n    if (!dt || dt > 500 || fingers > 1) return;\r\n    e.currentTarget.dataset.lastTouch = null;\r\n    e.preventDefault();\r\n  }\r\n\r\n  async firstUpdated() {\r\n    window.addEventListener('show-file-selector', () => {\r\n      const input = this.shadowRoot?.querySelector(\r\n        '#fileSelector',\r\n      ) as HTMLInputElement;\r\n      input?.click();\r\n    });\r\n    window.addEventListener('history-changed', () => {\r\n      this.canUndo = HistoryManager.canUndo();\r\n      this.canRedo = HistoryManager.canRedo();\r\n    });\r\n    window.addEventListener('tool-changed', () => {\r\n      this.tool = app.tool;\r\n    });\r\n    this.addEventListener('touchstart', this.preventZoom);\r\n    window.addEventListener('helpToolChosen', (e) => {\r\n      import('@components/popups/help-popup');\r\n      const helpElem = createElem('help-popup');\r\n      // @ts-ignore\r\n      helpElem.toolname = e.detail.toolname;\r\n    });\r\n    window.addEventListener('state-changed', () => {\r\n      this.updateProperties();\r\n      this.requestUpdate();\r\n    });\r\n    window.onerror = (a, b, c, d, e) => {\r\n      bugSend(a, b, c, d, e);\r\n      if (location.hostname === 'localhost') return false;\r\n      return true;\r\n    };\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\layouts\\ag-menu.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'AGMenu' is defined but never used. Allowed unused vars must match /^_/u.","line":14,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"AGMenu"},"fix":{"range":[508,5193],"text":""},"desc":"Remove unused variable 'AGMenu'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AGMenu' is defined but never used. Allowed unused vars must match /^_/u.","line":14,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":13},{"ruleId":"eqeqeq","severity":2,"message":"Expected '!==' and instead saw '!='.","line":46,"column":28,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":46,"endColumn":30,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"!==","actualOperator":"!="},"fix":{"range":[1321,1323],"text":"!=="},"desc":"Use '!==' instead of '!='."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import '@components/icon-button';\r\nimport '@components/template-toolbar';\r\nimport '@components/toolbar-kit';\r\nimport '@components/toolbar-section';\r\nimport { SignalWatcher } from '@lit-labs/signals';\r\nimport { kit } from '@store/kit';\r\nimport { tools } from '@store/tools';\r\nimport { css, html, LitElement } from 'lit';\r\nimport { customElement, property } from 'lit/decorators.js';\r\nimport { app, setState } from '../controllers/Core/App';\r\nimport { createElem } from '../controllers/Core/Tools/general';\r\n\r\n@customElement('ag-menu')\r\nclass AGMenu extends SignalWatcher(LitElement) {\r\n  @property({ type: Boolean }) helpSelected = false;\r\n  @property({ type: Object }) tool;\r\n  @property({ type: Boolean }) canUndo = false;\r\n  @property({ type: Boolean }) canRedo = false;\r\n\r\n  static styles = css`\r\n    :host {\r\n      display: flex;\r\n      gap: 8px;\r\n      flex-direction: column;\r\n      padding: 8px;\r\n      background-color: var(--theme-color);\r\n      scrollbar-width: thin;\r\n      overflow: auto;\r\n    }\r\n\r\n    h3 {\r\n      padding: 0;\r\n      margin: 0;\r\n      text-align: center;\r\n      font-size: 14px;\r\n      font-weight: bold;\r\n      padding: 8px 0;\r\n      border-radius: 4px;\r\n      background-color: var(--theme-color-soft);\r\n    }\r\n  `;\r\n\r\n  render() {\r\n    return html`\r\n      <h3>\r\n        ${this.tool?.title != undefined\r\n          ? 'mode: ' + this.tool.title\r\n          : 'S├®lectionnez une fonctionnalit├®'}\r\n      </h3>\r\n      <template-toolbar>\r\n        <div slot=\"body\">${this._renderActionButtons()}</div>\r\n      </template-toolbar>\r\n\r\n      <toolbar-kit\r\n        .kit=${kit.get()}\r\n        selectedFamily=\"${this.tool?.selectedFamily}\"\r\n        ?helpSelected=\"${this.helpSelected}\"\r\n        selected=\"${this.tool?.name}\"\r\n      >\r\n      </toolbar-kit>\r\n      ${this._renderToolbarSections()}\r\n    `;\r\n  }\r\n\r\n  _renderActionButtons() {\r\n    const actions = [\r\n      { name: 'home', title: 'Accueil' },\r\n      { name: 'open', title: 'Ouvrir' },\r\n      { name: 'save', title: 'Enregistrer' },\r\n      { name: 'settings', title: 'Param├¿tres' },\r\n      { name: 'undo', title: 'Annuler', disabled: !this.canUndo },\r\n      { name: 'redo', title: 'Refaire', disabled: !this.canRedo },\r\n      { name: 'replay', title: 'Rejouer' },\r\n      { name: 'help', title: 'Aide', active: this.helpSelected },\r\n    ];\r\n\r\n    return actions.map(\r\n      (action) => html`\r\n        <icon-button\r\n          name=\"${action.name}\"\r\n          title=\"${action.title}\"\r\n          ?disabled=\"${action.disabled}\"\r\n          ?active=\"${action.active}\"\r\n          ?helpanimation=\"${this.helpSelected}\"\r\n          @click=\"${this._actionHandle}\"\r\n        ></icon-button>\r\n      `,\r\n    );\r\n  }\r\n\r\n  _renderToolbarSections() {\r\n    const sections = [\r\n      { title: 'Figures libres', toolsType: 'geometryCreator' },\r\n      { title: 'Mouvements', toolsType: 'move' },\r\n      { title: 'Transformations', toolsType: 'transformation' },\r\n      { title: 'Op├®rations', toolsType: 'operation' },\r\n      { title: 'Outils', toolsType: 'tool' },\r\n    ];\r\n\r\n    return sections.map(\r\n      (section) => html`\r\n        <toolbar-section\r\n          title=\"${section.title}\"\r\n          .tools=\"${tools.get()}\"\r\n          toolsType=\"${section.toolsType}\"\r\n          ?helpSelected=\"${this.helpSelected}\"\r\n          selected=\"${this.tool?.name}\"\r\n        ></toolbar-section>\r\n      `,\r\n    );\r\n  }\r\n\r\n  _actionHandle(event) {\r\n    if (app.fullHistory.isRunning) {\r\n      console.info('cannot interact when fullHisto is running');\r\n      return;\r\n    }\r\n\r\n    if (this.helpSelected) {\r\n      window.dispatchEvent(\r\n        new CustomEvent('helpToolChosen', {\r\n          detail: { toolname: event.target.name },\r\n        }),\r\n      );\r\n      setState({ helpSelected: false });\r\n      return;\r\n    }\r\n\r\n    const actions = {\r\n      settings: () => {\r\n        import('@components/popups/settings-popup');\r\n        createElem('settings-popup');\r\n        return true;\r\n      },\r\n      save: () => {\r\n        window.dispatchEvent(new CustomEvent('save-file'));\r\n        return true;\r\n      },\r\n      open: () => {\r\n        window.dispatchEvent(new CustomEvent('open-file'));\r\n        return true;\r\n      },\r\n      home: () => {\r\n        import('@components/popups/home-popup');\r\n        createElem('home-popup');\r\n        return true;\r\n      },\r\n      undo: () => window.dispatchEvent(new CustomEvent('undo')),\r\n      redo: () => window.dispatchEvent(new CustomEvent('redo')),\r\n      replay: () => window.dispatchEvent(new CustomEvent('start-browsing')),\r\n      help: () => {\r\n        setState({ helpSelected: true });\r\n        return true;\r\n      },\r\n    };\r\n\r\n    const action = actions[event.target.name];\r\n    if (action) {\r\n      const resetTool = action();\r\n      if (resetTool) {\r\n        setState({ tool: null });\r\n      }\r\n    } else {\r\n      console.info(\r\n        'unknow event type: ' + event.type + ', with event: ',\r\n        event,\r\n      );\r\n    }\r\n  }\r\n\r\n  firstUpdated() {\r\n    app.left_menu = this.shadowRoot;\r\n    this.addEventListener('touchstart', (event) => {\r\n      if (event.touches.length > 1) event.preventDefault();\r\n    });\r\n    // this.addEventListener('mousewheel', event => event.preventDefault())\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\services\\activity-sync.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'message' is defined but never used. Allowed unused args must match /^_/u.","line":43,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":43,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"message"},"fix":{"range":[993,1001],"text":""},"desc":"Remove unused variable 'message'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'args' is defined but never used. Allowed unused args must match /^_/u.","line":43,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":43,"endColumn":25,"suggestions":[{"messageId":"removeVar","data":{"varName":"args"},"fix":{"range":[1000,1009],"text":""},"desc":"Remove unused variable 'args'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Service de synchronisation pour les activit├®s\n// G├¿re la synchronisation en arri├¿re-plan des fichiers d'activit├®s\n\nimport {\n  findAllFiles,\n  findAllThemes,\n  getModulesDocFromTheme,\n  readFileFromServer,\n} from '../firebase/firebase-init.js';\nimport {\n  setSyncCompleted,\n  setSyncProgress,\n  syncInProgress,\n} from '../store/syncState.js';\nimport {\n  getAllActivities,\n  getSyncMetadata,\n  isRecentSyncAvailable,\n  saveActivity,\n  saveModule,\n  saveSyncMetadata,\n  saveTheme,\n} from '../utils/indexeddb-activities.js';\n\n// Configuration du service\nconst CONFIG = {\n  RETRY_ATTEMPTS: 3,\n  RETRY_DELAY: 1000,\n  TIMEOUT: 30000,\n  AUTO_SYNC_DELAY: 5000,\n  RECONNECT_DELAY: 1000,\n  SYNC_COOLDOWN: 24 * 60 * 60 * 1000, // 24 heures entre les synchronisations\n  DEBUG:\n    typeof window !== 'undefined' &&\n    (window.location.hostname === 'localhost' ||\n      window.location.search.includes('debug=true')),\n};\n\n/**\n * Utilitaires pour le service de synchronisation\n */\nconst utils = {\n  log: (message, ...args) => {\n    if (CONFIG.DEBUG) {\n    }\n  },\n\n  warn: (message, ...args) => {\n    console.warn(`[SYNC] ${message}`, ...args);\n  },\n\n  error: (message, ...args) => {\n    console.error(`[SYNC] ${message}`, ...args);\n  },\n\n  /**\n   * Attendre un d├®lai\n   * @param {number} ms D├®lai en millisecondes\n   * @returns {Promise<void>}\n   */\n  delay: (ms) => new Promise((resolve) => setTimeout(resolve, ms)),\n\n  /**\n   * Calculer la progression totale incluant fichiers, th├¿mes et modules\n   * @param {number} filesProcessed Nombre de fichiers trait├®s\n   * @param {number} totalFiles Nombre total de fichiers\n   * @param {number} themesProcessed Nombre de th├¿mes trait├®s\n   * @param {number} totalThemes Nombre total de th├¿mes\n   * @returns {number} Pourcentage global\n   */\n  calculateProgress: (\n    filesProcessed,\n    totalFiles,\n    themesProcessed,\n    totalThemes,\n  ) => {\n    // Pond├®ration: 70% pour les fichiers, 30% pour les th├¿mes/modules\n    const fileWeight = 0.7;\n    const themeWeight = 0.3;\n\n    const fileProgress =\n      totalFiles > 0 ? (filesProcessed / totalFiles) * fileWeight * 100 : 0;\n    const themeProgress =\n      totalThemes > 0 ? (themesProcessed / totalThemes) * themeWeight * 100 : 0;\n\n    return Math.round(fileProgress + themeProgress);\n  },\n};\n\nexport async function syncActivitiesInBackground(forceSync = false) {\n  // Utiliser le store centralis├® au lieu d'une variable globale\n  if (syncInProgress.value) {\n    utils.log('Synchronisation d├®j├á en cours...');\n    return;\n  }\n\n  if (!navigator.onLine) {\n    utils.log('Pas de connexion internet, synchronisation annul├®e');\n    return;\n  }\n\n  // V├®rifier si une synchronisation r├®cente a eu lieu (sauf si forc├®e)\n  if (!forceSync) {\n    const recentSyncAvailable = await isRecentSyncAvailable(24); // 24 heures\n    if (recentSyncAvailable) {\n      utils.log(\n        'Synchronisation r├®cente d├®tect├®e, synchronisation ignor├®e. Utilisez forceSync=true pour forcer.',\n      );\n      return;\n    }\n  }\n\n  let attempt = 0;\n  while (attempt < CONFIG.RETRY_ATTEMPTS) {\n    try {\n      utils.log('Initialisation du signal ├á 0%');\n      setSyncProgress(0);\n      utils.log(\n        'D├®but de la synchronisation des activit├®s, th├¿mes et modules...',\n      );\n\n      // R├®cup├®rer les donn├®es n├®cessaires\n      const [serverFiles, serverThemes] = await Promise.all([\n        findAllFiles(),\n        findAllThemes(),\n      ]);\n\n      const localActivities = await getAllActivities();\n      const localMap = new Map(\n        localActivities.map((activity) => [activity.id, activity]),\n      );\n\n      let addedCount = 0;\n      let processedFiles = 0;\n      let processedThemes = 0;\n\n      const totalFiles = serverFiles.length;\n      const totalThemes = serverThemes.length;\n\n      // Synchronisation des fichiers d'activit├®s avec gestion de timeout\n      for (const serverFile of serverFiles) {\n        try {\n          const localActivity = localMap.get(serverFile.id);\n          const serverVersion = serverFile.version || 1;\n          const localVersion = localActivity?.version || 0;\n\n          if (!localActivity || serverVersion > localVersion) {\n            utils.log(\n              `T├®l├®chargement ou mise ├á jour de l'activit├®: ${serverFile.id}`,\n            );\n\n            // Ajouter timeout pour ├®viter les blocages\n            const timeoutPromise = new Promise((_, reject) =>\n              setTimeout(() => reject(new Error('Timeout')), CONFIG.TIMEOUT),\n            );\n\n            const activityData = await Promise.race([\n              readFileFromServer(serverFile.id),\n              timeoutPromise,\n            ]);\n\n            await saveActivity(serverFile.id, activityData, serverVersion);\n            addedCount++;\n          } else {\n            utils.log(\n              `Activit├® ${serverFile.id} d├®j├á pr├®sente localement (version ├á jour)`,\n            );\n          }\n\n          processedFiles++;\n          const progressPercent = utils.calculateProgress(\n            processedFiles,\n            totalFiles,\n            processedThemes,\n            totalThemes,\n          );\n          utils.log(\n            `Progression: ${progressPercent}% (${processedFiles}/${totalFiles} fichiers, ${processedThemes}/${totalThemes} th├¿mes)`,\n          );\n\n          // Mise ├á jour du signal de progression\n          setSyncProgress(progressPercent);\n        } catch (fileError) {\n          utils.warn(\n            `Erreur lors de la synchronisation de ${serverFile.id}:`,\n            fileError,\n          );\n          processedFiles++; // Compter quand m├¬me pour continuer la progression\n        }\n      }\n\n      // Synchronisation des th├¿mes avec mise ├á jour de progression\n      for (const theme of serverThemes) {\n        try {\n          await saveTheme(theme.id, theme);\n\n          // Synchronisation des modules pour chaque th├¿me\n          const modules = await getModulesDocFromTheme(theme.id);\n          for (const module of modules) {\n            await saveModule(module.id, module);\n          }\n\n          processedThemes++;\n          const progressPercent = utils.calculateProgress(\n            processedFiles,\n            totalFiles,\n            processedThemes,\n            totalThemes,\n          );\n          setSyncProgress(progressPercent);\n        } catch (themeError) {\n          utils.warn(\n            `Erreur lors de la synchronisation du th├¿me ${theme.id}:`,\n            themeError,\n          );\n          processedThemes++; // Compter quand m├¬me pour continuer\n        }\n      }\n\n      utils.log(\n        `Synchronisation termin├®e: ${addedCount} nouvelles activit├®s, ${serverThemes.length} th├¿mes, modules synchronis├®s.`,\n      );\n\n      // Sauvegarder les m├®tadonn├®es de synchronisation pour ├®viter les syncs inutiles\n      try {\n        await saveSyncMetadata({\n          lastSyncDate: Date.now(),\n          serverFiles: serverFiles.map((f) => ({\n            id: f.id,\n            version: f.version || 1,\n          })),\n          serverThemes: serverThemes.map((t) => ({\n            id: t.id,\n            version: t.version || 1,\n          })),\n          expiryDate: Date.now() + CONFIG.SYNC_COOLDOWN,\n          syncedFilesCount: addedCount,\n          totalFilesCount: serverFiles.length,\n          totalThemesCount: serverThemes.length,\n        });\n        utils.log('M├®tadonn├®es de synchronisation sauvegard├®es avec succ├¿s');\n      } catch (metadataError) {\n        utils.warn(\n          'Erreur lors de la sauvegarde des m├®tadonn├®es:',\n          metadataError,\n        );\n      }\n\n      utils.log('Synchronisation termin├®e, appel de setSyncCompleted()');\n      setSyncCompleted();\n\n      return; // Succ├¿s, sortir de la boucle de retry\n    } catch (error) {\n      attempt++;\n      utils.error(\n        `Erreur lors de la synchronisation (tentative ${attempt}/${CONFIG.RETRY_ATTEMPTS}):`,\n        error,\n      );\n\n      if (attempt < CONFIG.RETRY_ATTEMPTS) {\n        utils.log(`Nouvelle tentative dans ${CONFIG.RETRY_DELAY}ms...`);\n        await utils.delay(CONFIG.RETRY_DELAY);\n      } else {\n        utils.error(\n          '├ëchec de la synchronisation apr├¿s',\n          CONFIG.RETRY_ATTEMPTS,\n          'tentatives',\n        );\n        // R├®initialiser l'├®tat en cas d'├®chec final\n        setSyncCompleted();\n        throw error;\n      }\n    }\n  }\n}\n\n/**\n * Synchronisation intelligente avec v├®rification de cache\n * Cette fonction v├®rifie d'abord si une synchronisation r├®cente a eu lieu\n * @param {Object} options - Options de synchronisation\n * @param {boolean} options.force - Forcer la synchronisation m├¬me si r├®cente\n * @param {number} options.maxAgeHours - ├ége maximum en heures pour consid├®rer une sync comme r├®cente\n * @returns {Promise<string>} R├®sultat de la synchronisation\n */\nexport async function smartSync(options = {}) {\n  const { force = false, maxAgeHours = 24 } = options;\n\n  if (!navigator.onLine) {\n    utils.log('Pas de connexion internet disponible');\n    return 'offline';\n  }\n\n  if (syncInProgress.value) {\n    utils.log('Synchronisation d├®j├á en cours');\n    return 'in_progress';\n  }\n\n  try {\n    // V├®rifier d'abord si une synchronisation r├®cente a eu lieu\n    if (!force) {\n      const recentSyncAvailable = await isRecentSyncAvailable(maxAgeHours);\n      const metadata = await getSyncMetadata();\n\n      if (recentSyncAvailable && metadata) {\n        utils.log(\n          `Synchronisation r├®cente trouv├®e (${new Date(metadata.lastSyncDate).toLocaleString()}), synchronisation ignor├®e`,\n        );\n        utils.log(\n          `Prochaine synchronisation automatique apr├¿s: ${new Date(metadata.expiryDate).toLocaleString()}`,\n        );\n        return 'recent';\n      }\n    }\n\n    // Lancer la synchronisation compl├¿te\n    await syncActivitiesInBackground(force);\n    return 'completed';\n  } catch (error) {\n    utils.error('Erreur lors de la synchronisation intelligente:', error);\n    return 'error';\n  }\n}\n\n/**\n * Obtient les informations de la derni├¿re synchronisation\n * @returns {Promise<Object|null>} Informations de sync ou null\n */\nexport async function getLastSyncInfo() {\n  try {\n    const metadata = await getSyncMetadata();\n    if (!metadata) {\n      return null;\n    }\n\n    return {\n      lastSyncDate: new Date(metadata.lastSyncDate),\n      syncedFilesCount: metadata.syncedFilesCount || 0,\n      totalFilesCount: metadata.totalFilesCount || 0,\n      totalThemesCount: metadata.totalThemesCount || 0,\n      expiryDate: new Date(metadata.expiryDate),\n      isExpired: metadata.expiryDate <= Date.now(),\n      nextSyncDue: metadata.expiryDate <= Date.now(),\n    };\n  } catch (error) {\n    utils.warn(\n      'Erreur lors de la r├®cup├®ration des informations de sync:',\n      error,\n    );\n    return null;\n  }\n}\n\nexport function initActivitySync() {\n  utils.log('Initialisation du service de synchronisation...');\n\n  // Synchronisation automatique lors de la reconnexion\n  window.addEventListener('online', () => {\n    utils.log(\n      'Connexion r├®tablie, lancement de la synchronisation intelligente...',\n    );\n    setTimeout(() => smartSync(), CONFIG.RECONNECT_DELAY);\n  });\n\n  // Synchronisation au d├®marrage de l'application (si connect├®)\n  if (navigator.onLine) {\n    utils.log(\n      'Application en ligne, synchronisation intelligente programm├®e dans',\n      CONFIG.AUTO_SYNC_DELAY + 'ms...',\n    );\n    setTimeout(() => smartSync(), CONFIG.AUTO_SYNC_DELAY);\n  } else {\n    utils.log('Application hors ligne, synchronisation d├®sactiv├®e');\n  }\n}\n\nutils.log('Service activity-sync.js charg├®');\ninitActivitySync();\n\nexport function isSyncInProgress() {\n  return syncInProgress.value;\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\services\\cache.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\store\\appState.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\store\\gridStore.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\store\\kit.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":79,"column":23,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":79,"endColumn":25,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[2195,2197],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { signal } from '@lit-labs/signals';\r\n\r\nexport const kit = signal();\r\n\r\nexport const getFamily = (name) => {\r\n  return kit.get().families.find((family) => family.name === name);\r\n};\r\n\r\nconst initTemplates = (families) => {\r\n  families.shapeTemplates = families.shapeTemplates.map((template) => {\r\n    return {\r\n      name: 'Custom',\r\n      fillColor: families.fillColor || '#aaa',\r\n      fillOpacity: families.fillOpacity || 0.7,\r\n      ...template,\r\n    };\r\n  });\r\n};\r\n\r\nexport const loadKit = async (name) => {\r\n  try {\r\n    // Validation du nom de kit\r\n    if (!name || typeof name !== 'string') {\r\n      throw new Error('Nom de kit invalide');\r\n    }\r\n\r\n    const module = await import(`./kits/${name}.json`);\r\n\r\n    if (!module.default) {\r\n      throw new Error(`Kit \"${name}\" non trouv├® ou invalide`);\r\n    }\r\n\r\n    const kitInitial = module.default;\r\n\r\n    // Validation de la structure du kit\r\n    if (!kitInitial.families || !Array.isArray(kitInitial.families)) {\r\n      throw new Error(`Structure de kit invalide pour \"${name}\"`);\r\n    }\r\n\r\n    kitInitial.families.forEach((family) => {\r\n      if (!family || typeof family !== 'object') {\r\n        throw new Error(`Famille invalide dans le kit \"${name}\"`);\r\n      }\r\n      initTemplates(family);\r\n    });\r\n\r\n    kit.set(kitInitial);\r\n    resetKitVisibility();\r\n  } catch (error) {\r\n    console.error('Erreur lors du chargement du kit:', error);\r\n    // Notifier l'utilisateur de l'erreur\r\n    window.dispatchEvent(\r\n      new CustomEvent('show-notif', {\r\n        detail: {\r\n          message: `Erreur lors du chargement du kit: ${error.message}`,\r\n        },\r\n      }),\r\n    );\r\n    throw error; // Re-lancer pour permettre la gestion en amont\r\n  }\r\n};\r\n\r\nexport const resetKit = () => {\r\n  kit.set(null);\r\n};\r\n\r\nexport const resetKitVisibility = () => {\r\n  const current = kit.get();\r\n  if (!current || !current.families) return;\r\n  current.families.forEach((family) => (family.isVisible = true));\r\n  kit.set({ ...current });\r\n};\r\n\r\nexport const setFamiliesVisibility = (families) => {\r\n  const current = kit.get();\r\n  current.families.forEach(\r\n    (family) =>\r\n      (family.isVisible = families.find(\r\n        (f) => f.name == family.name,\r\n      ).isVisible),\r\n  );\r\n  kit.set({ ...current });\r\n};\r\n\r\nexport const toggleAllFamiliesVisibility = (visible) => {\r\n  const current = kit.get();\r\n  if (!current.families) return;\r\n  current.families.forEach((family) => (family.isVisible = visible));\r\n  kit.set({ ...current });\r\n};\r\n\r\nexport const toggleFamilyVisibility = (familyName) => {\r\n  const current = kit.get();\r\n  const family = current.families.find((family) => family.name === familyName);\r\n  family.isVisible = !family.isVisible;\r\n  kit.set({ ...current });\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\store\\notions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\store\\syncState.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\store\\tools.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":14,"column":63,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":14,"endColumn":65,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[432,434],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { signal } from '@lit-labs/signals';\r\n\r\nexport const tools = signal([]);\r\n\r\nexport const resetToolsVisibility = () => {\r\n  const current = tools.get();\r\n  current.forEach((tool) => (tool.isVisible = true));\r\n  tools.set([...current]);\r\n};\r\n\r\nexport const setToolsVisibility = (toolsVisibility) => {\r\n  const current = tools.get();\r\n  current.forEach((tool) => {\r\n    const toolVisibility = toolsVisibility.find((t) => t.name == tool.name);\r\n    if (toolVisibility) {\r\n      tool.isVisible = toolVisibility.isVisible;\r\n    }\r\n  });\r\n  tools.set([...current]);\r\n};\r\n\r\nexport const toggleAllToolsVisibility = (visible) => {\r\n  const current = tools.get();\r\n  current.forEach((tool) => (tool.isVisible = visible));\r\n  tools.set([...current]);\r\n};\r\n\r\nexport const toggleToolVisibility = (toolName) => {\r\n  const current = tools.get();\r\n  const tool = current.find((tool) => tool.name === toolName);\r\n  tool.isVisible = !tool.isVisible;\r\n  tools.set([...current]);\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\types\\GeometryToolTypes.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'point' is defined but never used. Allowed unused args must match /^_/u.","line":39,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":39,"endColumn":25,"suggestions":[{"messageId":"removeVar","data":{"varName":"point"},"fix":{"range":[825,835],"text":""},"desc":"Remove unused variable 'point'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'pointNumber' is defined but never used. Allowed unused args must match /^_/u.","line":40,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":40,"endColumn":37,"suggestions":[{"messageId":"removeVar","data":{"varName":"pointNumber"},"fix":{"range":[861,880],"text":""},"desc":"Remove unused variable 'pointNumber'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'other' is defined but never used. Allowed unused args must match /^_/u.","line":58,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":58,"endColumn":28,"suggestions":[{"messageId":"removeVar","data":{"varName":"other"},"fix":{"range":[1238,1257],"text":""},"desc":"Remove unused variable 'other'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'coordinates' is defined but never used. Allowed unused args must match /^_/u.","line":82,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":82,"endColumn":30,"suggestions":[{"messageId":"removeVar","data":{"varName":"coordinates"},"fix":{"range":[1641,1667],"text":""},"desc":"Remove unused variable 'coordinates'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'validate' is defined but never used. Allowed unused args must match /^_/u.","line":83,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":83,"endColumn":23,"suggestions":[{"messageId":"removeVar","data":{"varName":"validate"},"fix":{"range":[1666,1690],"text":""},"desc":"Remove unused variable 'validate'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'newState' is defined but never used. Allowed unused args must match /^_/u.","line":93,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":93,"endColumn":30,"suggestions":[{"messageId":"removeVar","data":{"varName":"newState"},"fix":{"range":[1871,1888],"text":""},"desc":"Remove unused variable 'newState'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used. Allowed unused args must match /^_/u.","line":93,"column":32,"nodeType":"Identifier","messageId":"unusedVar","endLine":93,"endColumn":42,"suggestions":[{"messageId":"removeVar","data":{"varName":"data"},"fix":{"range":[1887,1899],"text":""},"desc":"Remove unused variable 'data'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'newState' is defined but never used. Allowed unused args must match /^_/u.","line":95,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":95,"endColumn":38,"suggestions":[{"messageId":"removeVar","data":{"varName":"newState"},"fix":{"range":[1949,1965],"text":""},"desc":"Remove unused variable 'newState'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'fn' is defined but never used. Allowed unused args must match /^_/u.","line":104,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":104,"endColumn":23,"suggestions":[{"messageId":"removeVar","data":{"varName":"fn"},"fix":{"range":[2134,2146],"text":""},"desc":"Remove unused variable 'fn'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'fn' is defined but never used. Allowed unused args must match /^_/u.","line":105,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":105,"endColumn":33,"suggestions":[{"messageId":"removeVar","data":{"varName":"fn"},"fix":{"range":[2175,2187],"text":""},"desc":"Remove unused variable 'fn'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used. Allowed unused args must match /^_/u.","line":113,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":113,"endColumn":26,"suggestions":[{"messageId":"removeVar","data":{"varName":"data"},"fix":{"range":[2312,2321],"text":""},"desc":"Remove unused variable 'data'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'coords' is defined but never used. Allowed unused args must match /^_/u.","line":114,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":114,"endColumn":43,"suggestions":[{"messageId":"removeVar","data":{"varName":"coords"},"fix":{"range":[2355,2375],"text":""},"desc":"Remove unused variable 'coords'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'tool' is defined but never used. Allowed unused args must match /^_/u.","line":115,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":115,"endColumn":35,"suggestions":[{"messageId":"removeVar","data":{"varName":"tool"},"fix":{"range":[2402,2421],"text":""},"desc":"Remove unused variable 'tool'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":13,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Interface TypeScript pour standardiser les outils g├®om├®triques\n * D├®finit les m├®thodes et propri├®t├®s communes ├á tous les outils\n */\n\nexport interface IGeometryTool {\n  name: string;\n  title: string;\n  type: string;\n  currentStep: string | null;\n\n  // M├®thodes de cycle de vie\n  start(): void;\n  end(): void;\n\n  // M├®thodes d'interaction\n  canvasMouseDown(): void;\n  canvasMouseUp(): void;\n\n  // M├®thodes de rendu\n  refreshStateUpper(): void;\n\n  // M├®thodes d'aide\n  getHelpText(): string;\n\n  // Ex├®cution des actions\n  executeAction(): void | Promise<void>;\n}\n\nexport interface IShapeCreationTool extends IGeometryTool {\n  points: any[];\n  segments: any[];\n  numberOfPointsDrawn: number;\n  constraints: any;\n\n  // M├®thodes sp├®cifiques ├á la cr├®ation de formes\n  drawPoint(): void;\n  animatePoint(): void;\n  adjustPoint(point: any): void;\n  getConstraints(pointNumber: number): void;\n  numberOfPointsRequired(): number;\n}\n\nexport interface IToolDefinition {\n  numberOfPointsRequired: number;\n  constraints: Function[];\n  finishShape?: Function;\n}\n\n/**\n * Type pour les coordonn├®es\n */\nexport interface ICoordinates {\n  x: number;\n  y: number;\n  toCanvasCoordinates?(): ICoordinates;\n  fromCanvasCoordinates?(): ICoordinates;\n  dist?(other: ICoordinates): number;\n}\n\n/**\n * Type pour les points\n */\nexport interface IPoint {\n  id: string;\n  coordinates: ICoordinates;\n  adjustedOn?: any;\n  layer: string;\n  color?: string;\n  size?: number;\n  type?: string;\n}\n\n/**\n * Type pour les contraintes\n */\nexport interface IConstraints {\n  type: 'isFree' | 'isConstrained';\n  isFree?: boolean;\n  segments?: any[];\n  projectionOnConstraints?(\n    coordinates: ICoordinates,\n    validate?: boolean,\n  ): ICoordinates | boolean;\n}\n\n/**\n * Interface pour les gestionnaires d'├®tat\n */\nexport interface IStateManager {\n  currentState: string;\n  previousState?: string;\n  transition(newState: string, data?: any): void;\n  rollback(): void;\n  validateTransition(newState: string): boolean;\n}\n\n/**\n * Interface pour les gestionnaires de performances\n */\nexport interface IPerformanceManager {\n  throttle: number;\n  lastExecution: number;\n  execute(fn: Function): void;\n  scheduleExecution(fn: Function): void;\n  cancelScheduled(): void;\n}\n\n/**\n * Interface pour la validation\n */\nexport interface IValidator {\n  validateInput(data: any): boolean;\n  validateCoordinates(coords: ICoordinates): boolean;\n  validateTool(tool: IGeometryTool): boolean;\n  getValidationErrors(): string[];\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\utils\\PerformanceManager.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\utils\\cache-config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\utils\\gridSnapping.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\utils\\indexeddb-activities.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\utils\\offline-init.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\src\\utils\\signal-observer.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'args' is defined but never used. Allowed unused args must match /^_/u.","line":81,"column":40,"nodeType":"Identifier","messageId":"unusedVar","endLine":81,"endColumn":44,"suggestions":[{"messageId":"removeVar","data":{"varName":"args"},"fix":{"range":[2310,2314],"text":""},"desc":"Remove unused variable 'args'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'args' is defined but never used. Allowed unused args must match /^_/u.","line":84,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":84,"endColumn":12,"suggestions":[{"messageId":"removeVar","data":{"varName":"args"},"fix":{"range":[2365,2369],"text":""},"desc":"Remove unused variable 'args'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'args' is defined but never used. Allowed unused args must match /^_/u.","line":105,"column":40,"nodeType":"Identifier","messageId":"unusedVar","endLine":105,"endColumn":44,"suggestions":[{"messageId":"removeVar","data":{"varName":"args"},"fix":{"range":[2865,2869],"text":""},"desc":"Remove unused variable 'args'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'args' is defined but never used. Allowed unused args must match /^_/u.","line":108,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":108,"endColumn":12,"suggestions":[{"messageId":"removeVar","data":{"varName":"args"},"fix":{"range":[2920,2924],"text":""},"desc":"Remove unused variable 'args'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { ReactiveController, ReactiveControllerHost } from 'lit';\n\n/**\n * Reactive Controller optimis├® pour observer les signaux dans les composants Lit\n * Remplace l'ancien polling 100ms par une observation efficace\n *\n * Ce controller observe automatiquement tous les signaux lus dans la m├®thode render()\n * et d├®clenche requestUpdate() uniquement quand ils changent r├®ellement.\n */\nexport class OptimizedSignalController implements ReactiveController {\n  private host: ReactiveControllerHost;\n  private observedSignals = new Set();\n  private isObserving = false;\n\n  constructor(host: ReactiveControllerHost) {\n    this.host = host;\n    host.addController(this);\n  }\n\n  hostConnected(): void {\n    this.startObserving();\n  }\n\n  hostDisconnected(): void {\n    this.stopObserving();\n  }\n\n  /**\n   * D├®marre l'observation optimis├®e des signaux\n   * Utilise requestAnimationFrame pour un polling moins fr├®quent et plus efficace\n   */\n  private startObserving(): void {\n    if (this.isObserving) return;\n\n    this.isObserving = true;\n\n    // Utiliser requestAnimationFrame au lieu de setInterval pour de meilleures performances\n    const checkForUpdates = () => {\n      if (!this.isObserving) return;\n\n      // D├®clencher une mise ├á jour pour permettre la re-lecture des signaux\n      this.host.requestUpdate();\n\n      // Programmer la prochaine v├®rification ├á la prochaine frame\n      requestAnimationFrame(checkForUpdates);\n    };\n\n    // D├®marrer la boucle d'observation\n    requestAnimationFrame(checkForUpdates);\n  }\n\n  /**\n   * Arr├¬te l'observation des signaux\n   */\n  private stopObserving(): void {\n    this.isObserving = false;\n    this.observedSignals.clear();\n  }\n}\n\n/**\n * Factory pour cr├®er facilement des controllers d'observation de signaux\n */\nexport class SignalControllerFactory {\n  /**\n   * Cr├®e un controller pour observer automatiquement tous les signaux utilis├®s dans render()\n   * @param host Composant h├┤te\n   * @returns Controller configur├®\n   */\n  static create(host: ReactiveControllerHost): OptimizedSignalController {\n    return new OptimizedSignalController(host);\n  }\n}\n\n/**\n * Fonction utilitaire pour d├®bouncer les mises ├á jour\n * @param fn Fonction ├á d├®bouncer\n * @param delay D├®lai en millisecondes\n * @returns Fonction d├®bounc├®e\n */\nexport function debounce<T extends (...args: any[]) => any>(\n  fn: T,\n  delay: number,\n): (...args: Parameters<T>) => void {\n  let timeoutId: number | undefined;\n\n  return (...args: Parameters<T>) => {\n    if (timeoutId !== undefined) {\n      clearTimeout(timeoutId);\n    }\n\n    timeoutId = window.setTimeout(() => {\n      fn(...args);\n      timeoutId = undefined;\n    }, delay);\n  };\n}\n\n/**\n * Fonction utilitaire pour throttler les mises ├á jour\n * @param fn Fonction ├á throttler\n * @param delay D├®lai en millisecondes\n * @returns Fonction throttl├®e\n */\nexport function throttle<T extends (...args: any[]) => any>(\n  fn: T,\n  delay: number,\n): (...args: Parameters<T>) => void {\n  let lastCall = 0;\n  let timeoutId: number | undefined;\n\n  return (...args: Parameters<T>) => {\n    const now = Date.now();\n    const timeSinceLastCall = now - lastCall;\n\n    if (timeSinceLastCall >= delay) {\n      lastCall = now;\n      fn(...args);\n    } else if (timeoutId === undefined) {\n      timeoutId = window.setTimeout(() => {\n        lastCall = Date.now();\n        fn(...args);\n        timeoutId = undefined;\n      }, delay - timeSinceLastCall);\n    }\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\test-extension.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\test\\Coordinates\\add.test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\test\\Coordinates\\equal.test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\test\\Coordinates\\multiply.test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\test\\Coordinates\\substract.test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\test\\components\\canvas-layer.test.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'pointRadius' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":739,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":739,"endColumn":26,"suggestions":[{"messageId":"removeVar","data":{"varName":"pointRadius"},"fix":{"range":[32593,32628],"text":""},"desc":"Remove unused variable 'pointRadius'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { afterEach, beforeEach, describe, expect, it, vi } from 'vitest';\r\n// Removed vitest-canvas-mock as we're manually mocking ctx\r\nimport '../../src/components/canvas-layer.js'; // Assurer la d├®finition de l'├®l├®ment personnalis├®\r\nimport { Coordinates } from '../../src/controllers/Core/Objects/Coordinates.js'; // AJOUT DE L'IMPORT\r\nimport { gridStore } from '../../src/store/gridStore'; // Assuming direct import for testing\r\n\r\n// Mock the App module\r\nvi.mock('../../src/controllers/Core/App', async () => {\r\n  const mockAppInstance = {\r\n    workspace: {\r\n      zoomLevel: 1.0,\r\n      translateOffset: { x: 0, y: 0 }, // Simplifi├®\r\n      pixelDensity: 1,\r\n      getPixelCoordinatesFromWorldCoordinates: vi.fn(coord => coord),\r\n      getWorldCoordinatesFromPixelCoordinates: vi.fn(coord => coord),\r\n      selectionConstraints: { eventType: 'click' },\r\n    },\r\n    settings: {\r\n      get: vi.fn(key => {\r\n        if (key === 'gridColor') return '#000000';\r\n        if (key === 'mainCanvasPixelDensity') return 1;\r\n        if (key === 'pointSize') return 1;\r\n        if (key === 'areShapesPointed') return true;\r\n        if (key === 'mainMenuWidth') return 0;\r\n        return undefined;\r\n      })\r\n    },\r\n    environment: {\r\n      name: 'standard'\r\n    },\r\n    history: { steps: [] },\r\n    fullHistory: { isRunning: false },\r\n    listenerCounter: { objectSelected: false },\r\n    tool: { name: 'dummyTool' },\r\n    canvasWidth: 800,\r\n    canvasHeight: 600,\r\n  };\r\n  return { app: mockAppInstance };\r\n});\r\n\r\n// Mock the gridStore module\r\nvi.mock('../../src/store/gridStore', async () => {\r\n  const actual = await vi.importActual('../../src/store/gridStore');\r\n  return {\r\n    ...actual,\r\n    gridStore: {\r\n      ...actual.gridStore,\r\n      subscribe: vi.fn(),\r\n      set: vi.fn(),\r\n      update: vi.fn(),\r\n      // Rename get to getState and ensure it returns the same mock structure\r\n      getState: vi.fn(() => actual.initialState)\r\n    },\r\n    // These might be part of the actual store or helper functions, ensure they are mocked if used directly\r\n    // If they are selectors that use gridStore.getState(), they might not need individual mocks\r\n    // for gridStore.getState() is correctly mocked.\r\n    // For now, assuming they might be used and keeping them, adjust as necessary.\r\n    isGridVisible: vi.fn(),\r\n    getGridType: vi.fn(),\r\n    getGridSize: vi.fn(),\r\n  };\r\n});\r\n\r\ndescribe('CanvasLayer', () => {\r\n  let canvasLayerElement;\r\n\r\n  beforeEach(async () => {\r\n    // Create the element without appending to avoid event loops\r\n    canvasLayerElement = document.createElement('canvas-layer');\r\n\r\n    // Manually set up the canvas and context mocks to simulate initialization\r\n    const mockCanvas = document.createElement('canvas');\r\n    mockCanvas.width = 800;\r\n    mockCanvas.height = 600;\r\n    const mockCtx = {\r\n      clearRect: vi.fn(),\r\n      fillStyle: '',\r\n      fillRect: vi.fn(),\r\n      beginPath: vi.fn(),\r\n      arc: vi.fn(),\r\n      fill: vi.fn(),\r\n      setTransform: vi.fn(),\r\n      save: vi.fn(),\r\n      restore: vi.fn(),\r\n      // Add other methods as needed\r\n    };\r\n    mockCanvas.getContext = vi.fn(() => mockCtx);\r\n    canvasLayerElement.canvas = mockCanvas;\r\n    canvasLayerElement.ctx = mockCtx;\r\n\r\n    // Mock methods to prevent actual drawing but allow clearing\r\n    canvasLayerElement.redraw = vi.fn(() => canvasLayerElement.clear());\r\n    canvasLayerElement.throttledRedraw = vi.fn();\r\n    canvasLayerElement.clear = vi.fn(() => canvasLayerElement.ctx.clearRect(0, 0, 800, 600));\r\n    canvasLayerElement.drawGridPoints = vi.fn(); // Mocked to prevent hanging\r\n    canvasLayerElement.draw = vi.fn();\r\n\r\n    // Simulate id for canvasName\r\n    canvasLayerElement.id = 'mainCanvas';\r\n\r\n    // vitest-canvas-mock devrait fournir un contexte moqu├® accessible via canvasLayerElement.ctx\r\n    // Plus besoin de spyOn getContext manuellement ni de cr├®er mockCtx.\r\n\r\n    // Reset mocks for each test\r\n    vi.clearAllMocks();\r\n\r\n    // Mock gridStore\r\n    gridStore.getState = vi.fn().mockReturnValue({\r\n      gridType: 'none', // Default to no grid\r\n      gridSize: 1,\r\n      isVisible: false, // Default to not visible\r\n      gridColor: '#888888',\r\n      pointRadius: 0.75,\r\n      backgroundColor: '#F0F0F0',\r\n    });\r\n\r\n    // Note: app is already mocked in setup.ts\r\n  });\r\n\r\n  afterEach(() => {\r\n    if (canvasLayerElement && canvasLayerElement.parentNode) {\r\n      canvasLayerElement.parentNode.removeChild(canvasLayerElement);\r\n    }\r\n    vi.restoreAllMocks();\r\n  });\r\n\r\n  describe('loadFromData robustness', () => {\r\n    it('should not throw when called with null and should clear/redraw', () => {\r\n      expect(() => canvasLayerElement.loadFromData(null)).not.toThrow();\r\n      // After loadFromData(null), internal arrays should be empty and redraw called.\r\n      expect(canvasLayerElement.shapes).toEqual([]);\r\n      expect(canvasLayerElement.segments).toEqual([]);\r\n      expect(canvasLayerElement.points).toEqual([]);\r\n      // We can assert that clear was attempted via clearRect call count being >= 1\r\n      expect(canvasLayerElement.ctx.clearRect).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should not throw when called with undefined', () => {\r\n      expect(() => canvasLayerElement.loadFromData(undefined)).not.toThrow();\r\n    });\r\n\r\n    it('should accept partial data objects (e.g., only shapesData array)', async () => {\r\n      const partial = { shapesData: [], segmentsData: undefined, pointsData: undefined };\r\n      expect(() => canvasLayerElement.loadFromData(partial)).not.toThrow();\r\n      expect(canvasLayerElement.shapes).toEqual([]);\r\n    });\r\n  });\r\n\r\n  describe('getClosestGridPoint', () => {\r\n    it('should return undefined if grid is not visible', () => {\r\n      gridStore.getState.mockReturnValue({ ...gridStore.getState(), isVisible: false });\r\n      // await canvasLayerElement.updateComplete; // If component reacts to store changes via properties\r\n      const point = canvasLayerElement.getClosestGridPoint(new Coordinates({ x: 10, y: 10 }));\r\n      expect(point).toBeUndefined();\r\n    });\r\n\r\n    it('should return undefined if grid type is \"none\"', () => {\r\n      gridStore.getState.mockReturnValue({ ...gridStore.getState(), gridType: 'none' });\r\n      // await canvasLayerElement.updateComplete;\r\n      const point = canvasLayerElement.getClosestGridPoint(new Coordinates({ x: 10, y: 10 }));\r\n      expect(point).toBeUndefined();\r\n    });\r\n\r\n    it('should return undefined if checkingCoordinates is undefined', () => {\r\n      // await canvasLayerElement.updateComplete;\r\n      const point = canvasLayerElement.getClosestGridPoint(undefined);\r\n      expect(point).toBeUndefined();\r\n    });\r\n\r\n    describe('Square Grid', () => {\r\n      beforeEach(async () => {\r\n        const currentState = gridStore.getState();\r\n        gridStore.getState.mockReturnValue({\r\n          ...currentState,\r\n          gridType: 'square',\r\n          gridSize: 1,\r\n          isVisible: true,\r\n        });\r\n        // Trigger re-render or update if the component relies on properties for these values\r\n        // For CanvasLayer, it subscribes to the store in connectedCallback and updates internal\r\n        // properties like _gridType, _gridSize, _isVisible.\r\n        // The LitElement lifecycle should handle this. If tests fail, we might need to manually\r\n        // call the store update handler or set properties and await canvasLayerElement.updateComplete.\r\n        // For now, assume the direct store read in getClosestGridPoint is sufficient.\r\n      });\r\n\r\n      it('should find the closest point on a square grid', () => {\r\n        const checkingPixelCoords = new Coordinates({ x: 40, y: 40 });\r\n        const closest = canvasLayerElement.getClosestGridPoint(checkingPixelCoords);\r\n        expect(closest).toBeInstanceOf(Coordinates);\r\n        expect(closest.x).toBeCloseTo(37.795);\r\n        expect(closest.y).toBeCloseTo(37.795);\r\n      });\r\n\r\n      it('should find the exact point if on a grid intersection', () => {\r\n        const checkingPixelCoords = new Coordinates({ x: 37.795, y: 37.795 * 2 });\r\n        const closest = canvasLayerElement.getClosestGridPoint(checkingPixelCoords);\r\n        expect(closest.x).toBeCloseTo(37.795);\r\n        expect(closest.y).toBeCloseTo(37.795 * 2);\r\n      });\r\n    });\r\n\r\n    describe('Vertical Lines Grid', () => {\r\n      beforeEach(() => {\r\n        const currentState = gridStore.getState();\r\n        gridStore.getState.mockReturnValue({\r\n          ...currentState,\r\n          gridType: 'vertical-lines',\r\n          gridSize: 1,\r\n          isVisible: true,\r\n        });\r\n      });\r\n\r\n      it('should find the closest point on a vertical line, aligning Y with input', () => {\r\n        const checkingPixelCoords = new Coordinates({ x: 30, y: 100 });\r\n        const closest = canvasLayerElement.getClosestGridPoint(checkingPixelCoords);\r\n        expect(closest).toBeInstanceOf(Coordinates);\r\n        expect(closest.x).toBeCloseTo(37.795);\r\n        expect(closest.y).toBe(100);\r\n      });\r\n\r\n      it('should find the exact point if X is on a grid line, Y aligns with input', () => {\r\n        const checkingPixelCoords = new Coordinates({ x: 37.795 * 2, y: 150 });\r\n        const closest = canvasLayerElement.getClosestGridPoint(checkingPixelCoords);\r\n        expect(closest.x).toBeCloseTo(37.795 * 2);\r\n        expect(closest.y).toBe(150);\r\n      });\r\n\r\n      it('should handle points between two vertical lines', () => {\r\n        const checkingCloserToSecond = new Coordinates({ x: 60, y: 200 });\r\n        const closest2 = canvasLayerElement.getClosestGridPoint(checkingCloserToSecond);\r\n        expect(closest2.x).toBeCloseTo(37.795 * 2);\r\n        expect(closest2.y).toBe(200);\r\n\r\n        const checkingCloserToFirst = new Coordinates({ x: 50, y: 200 });\r\n        const closest1 = canvasLayerElement.getClosestGridPoint(checkingCloserToFirst);\r\n        expect(closest1.x).toBeCloseTo(37.795);\r\n        expect(closest1.y).toBe(200);\r\n      });\r\n\r\n      it('should handle points outside canvas width but within calculatedSize margin', () => {\r\n        const checkingPixelCoords = new Coordinates({ x: 810, y: 50 });\r\n        const closest = canvasLayerElement.getClosestGridPoint(checkingPixelCoords);\r\n        expect(closest.x).toBeCloseTo(22 * 37.795);\r\n        expect(closest.y).toBe(50);\r\n      });\r\n    });\r\n\r\n    describe('Horizontal Lines Grid', () => {\r\n      beforeEach(() => {\r\n        const currentState = gridStore.getState();\r\n        gridStore.getState.mockReturnValue({\r\n          ...currentState,\r\n          gridType: 'horizontal-lines',\r\n          gridSize: 1,\r\n          isVisible: true,\r\n        });\r\n      });\r\n\r\n      it('should find the closest point on a horizontal line, aligning X with input', () => {\r\n        const checkingPixelCoords = new Coordinates({ x: 100, y: 30 });\r\n        const closest = canvasLayerElement.getClosestGridPoint(checkingPixelCoords);\r\n        expect(closest).toBeInstanceOf(Coordinates);\r\n        expect(closest.x).toBe(100);\r\n        expect(closest.y).toBeCloseTo(37.795);\r\n      });\r\n\r\n      it('should find the exact point if Y is on a grid line, X aligns with input', () => {\r\n        const checkingPixelCoords = new Coordinates({ x: 150, y: 37.795 * 2 });\r\n        const closest = canvasLayerElement.getClosestGridPoint(checkingPixelCoords);\r\n        expect(closest.x).toBe(150);\r\n        expect(closest.y).toBeCloseTo(37.795 * 2);\r\n      });\r\n\r\n      it('should handle points between two horizontal lines', () => {\r\n        const checkingCloserToSecond = new Coordinates({ x: 200, y: 60 });\r\n        const closest2 = canvasLayerElement.getClosestGridPoint(checkingCloserToSecond);\r\n        expect(closest2.x).toBe(200);\r\n        expect(closest2.y).toBeCloseTo(37.795 * 2);\r\n\r\n        const checkingCloserToFirst = new Coordinates({ x: 200, y: 50 });\r\n        const closest1 = canvasLayerElement.getClosestGridPoint(checkingCloserToFirst);\r\n        expect(closest1.x).toBe(200);\r\n        expect(closest1.y).toBeCloseTo(37.795);\r\n      });\r\n\r\n      it('should handle points outside canvas height but within calculatedSize margin', () => {\r\n        const checkingPixelCoords = new Coordinates({ x: 50, y: 610 });\r\n        const closest = canvasLayerElement.getClosestGridPoint(checkingPixelCoords);\r\n        expect(closest.x).toBe(50);\r\n        expect(closest.y).toBeCloseTo(16 * 37.795);\r\n      });\r\n    });\r\n\r\n    describe('Vertical Triangle Grid', () => {\r\n      beforeEach(() => {\r\n        const currentState = gridStore.getState();\r\n        gridStore.getState.mockReturnValue({\r\n          ...currentState,\r\n          gridType: 'vertical-triangle',\r\n          gridSize: 1,\r\n          isVisible: true,\r\n        });\r\n      });\r\n\r\n      it('should find the closest vertex in a vertical triangle grid', () => {\r\n        const side = 37.795;\r\n        const triangleHeight = side * Math.sqrt(3) / 2;\r\n\r\n        let checkingPixelCoords = new Coordinates({ x: 5, y: 5 });\r\n        let closest = canvasLayerElement.getClosestGridPoint(checkingPixelCoords);\r\n        expect(closest.x).toBeCloseTo(0);\r\n        expect(closest.y).toBeCloseTo(0);\r\n\r\n        checkingPixelCoords = new Coordinates({ x: side - 5, y: 5 });\r\n        closest = canvasLayerElement.getClosestGridPoint(checkingPixelCoords);\r\n        expect(closest.x).toBeCloseTo(side);\r\n        expect(closest.y).toBeCloseTo(0);\r\n\r\n        checkingPixelCoords = new Coordinates({ x: side / 2 + 3, y: triangleHeight - 3 });\r\n        closest = canvasLayerElement.getClosestGridPoint(checkingPixelCoords);\r\n        expect(closest.x).toBeCloseTo(side / 2);\r\n        expect(closest.y).toBeCloseTo(triangleHeight);\r\n\r\n        checkingPixelCoords = new Coordinates({ x: side * 1.5 - 3, y: triangleHeight + 3 });\r\n        closest = canvasLayerElement.getClosestGridPoint(checkingPixelCoords);\r\n        expect(closest.x).toBeCloseTo(side * 1.5);\r\n        expect(closest.y).toBeCloseTo(triangleHeight);\r\n      });\r\n\r\n      it('should correctly snap to vertices when between multiple choices', () => {\r\n        const side = 37.795;\r\n        const triangleHeight = side * Math.sqrt(3) / 2;\r\n\r\n        let checkingPixelCoords = new Coordinates({ x: side / 2 - 1, y: triangleHeight / 3 });\r\n        let closest = canvasLayerElement.getClosestGridPoint(checkingPixelCoords);\r\n        expect(closest.x).toBeCloseTo(0);\r\n        expect(closest.y).toBeCloseTo(0);\r\n\r\n        checkingPixelCoords = new Coordinates({ x: side / 2 + 1, y: triangleHeight / 3 });\r\n        closest = canvasLayerElement.getClosestGridPoint(checkingPixelCoords);\r\n        expect(closest.x).toBeCloseTo(side);\r\n        expect(closest.y).toBeCloseTo(0);\r\n\r\n        checkingPixelCoords = new Coordinates({ x: side / 2, y: triangleHeight / 3 + 10 });\r\n        closest = canvasLayerElement.getClosestGridPoint(checkingPixelCoords);\r\n        expect(closest.x).toBeCloseTo(side / 2);\r\n        expect(closest.y).toBeCloseTo(triangleHeight);\r\n      });\r\n    });\r\n\r\n    describe('Horizontal Triangle Grid', () => {\r\n      beforeEach(() => {\r\n        const currentState = gridStore.getState();\r\n        gridStore.getState.mockReturnValue({\r\n          ...currentState,\r\n          gridType: 'horizontal-triangle',\r\n          gridSize: 1,\r\n          isVisible: true,\r\n        });\r\n      });\r\n\r\n      it('should find the closest vertex in a horizontal triangle grid', () => {\r\n        const side = 37.795;\r\n        const horizontalStep = side * Math.sqrt(3) / 2;\r\n\r\n        let checkingPixelCoords = new Coordinates({ x: 5, y: 5 });\r\n        let closest = canvasLayerElement.getClosestGridPoint(checkingPixelCoords);\r\n        expect(closest.x).toBeCloseTo(0);\r\n        expect(closest.y).toBeCloseTo(0);\r\n\r\n        checkingPixelCoords = new Coordinates({ x: 5, y: side - 5 });\r\n        closest = canvasLayerElement.getClosestGridPoint(checkingPixelCoords);\r\n        expect(closest.x).toBeCloseTo(0);\r\n        expect(closest.y).toBeCloseTo(side);\r\n\r\n        checkingPixelCoords = new Coordinates({ x: horizontalStep - 3, y: side / 2 + 3 });\r\n        closest = canvasLayerElement.getClosestGridPoint(checkingPixelCoords);\r\n        expect(closest.x).toBeCloseTo(horizontalStep);\r\n        expect(closest.y).toBeCloseTo(side / 2);\r\n\r\n        checkingPixelCoords = new Coordinates({ x: horizontalStep + 3, y: side * 1.5 - 3 });\r\n        closest = canvasLayerElement.getClosestGridPoint(checkingPixelCoords);\r\n        expect(closest.x).toBeCloseTo(horizontalStep);\r\n        expect(closest.y).toBeCloseTo(side * 1.5);\r\n      });\r\n\r\n      it('should correctly snap to vertices when between multiple choices', () => {\r\n        const side = 37.795;\r\n        const horizontalStep = side * Math.sqrt(3) / 2;\r\n\r\n        let checkingPixelCoords = new Coordinates({ x: horizontalStep / 4, y: side / 4 });\r\n        let closest = canvasLayerElement.getClosestGridPoint(checkingPixelCoords);\r\n        expect(closest.x).toBeCloseTo(0);\r\n        expect(closest.y).toBeCloseTo(0);\r\n\r\n        checkingPixelCoords = new Coordinates({ x: horizontalStep / 4, y: (3 * side) / 4 });\r\n        closest = canvasLayerElement.getClosestGridPoint(checkingPixelCoords);\r\n        expect(closest.x).toBeCloseTo(0);\r\n        expect(closest.y).toBeCloseTo(side);\r\n\r\n        checkingPixelCoords = new Coordinates({ x: horizontalStep * 0.6, y: side / 2 });\r\n        closest = canvasLayerElement.getClosestGridPoint(checkingPixelCoords);\r\n        expect(closest.x).toBeCloseTo(horizontalStep);\r\n        expect(closest.y).toBeCloseTo(side / 2);\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('drawGridPoints', () => {\r\n    beforeEach(async () => {\r\n      const currentGlobalState = gridStore.getState();\r\n      gridStore.getState.mockReturnValue({\r\n        ...currentGlobalState,\r\n        isVisible: true,\r\n        gridSize: 1,\r\n      });\r\n      // await canvasLayerElement.updateComplete; // Normalement g├®r├® par le beforeEach principal\r\n\r\n      // mockCtx.fillStyle = ''; // Supprim├®, les assertions se feront sur canvasLayerElement.ctx\r\n    });\r\n\r\n    it('should not draw if grid is not visible', () => {\r\n      const currentState = gridStore.getState();\r\n      gridStore.getState.mockReturnValue({ ...currentState, isVisible: false });\r\n      canvasLayerElement.drawGridPoints();\r\n      expect(canvasLayerElement.ctx.arc).not.toHaveBeenCalled();\r\n      expect(canvasLayerElement.ctx.fill).not.toHaveBeenCalled();\r\n    });\r\n\r\n    describe('Square Grid Drawing', () => {\r\n      const PIXELS_PER_CM = 37.8; // As used in drawGridPoints implementation\r\n\r\n      beforeEach(async () => { // MODIFI├ë en async\r\n        const currentState = gridStore.getState();\r\n        gridStore.getState.mockReturnValue({\r\n          ...currentState,\r\n          gridType: 'square',\r\n          gridSize: 1, // Default for these tests\r\n          isVisible: true, // Ensure visible\r\n        });\r\n        // Reset fillStyle for each test\r\n        // mockCtx.fillStyle = ''; // Supprim├®\r\n        // Reset zoom to default for most tests\r\n        const { app } = await import('../../src/controllers/Core/App'); // MODIFI├ë\r\n        app.workspace.zoomLevel = 1; // MODIFI├ë\r\n      });\r\n\r\n      it('should set fillStyle to #888888', () => {\r\n        canvasLayerElement.drawGridPoints();\r\n        expect(canvasLayerElement.ctx.fillStyle).toBe('#888888'); // Modifi├® pour utiliser canvasLayerElement.ctx\r\n      });\r\n\r\n      it('should draw correct number of points for a 1cm grid on 800x600 canvas, zoom 1', () => {\r\n        canvasLayerElement.drawGridPoints();\r\n\r\n        const gridSize = 1; // cm\r\n        const zoomFactor = 1;\r\n        const calculatedSize = gridSize * PIXELS_PER_CM * zoomFactor;\r\n        const expectedXPoints = Math.floor(canvasLayerElement.canvas.width / calculatedSize) + 1;\r\n        const expectedYPoints = Math.floor(canvasLayerElement.canvas.height / calculatedSize) + 1;\r\n        const totalPoints = expectedXPoints * expectedYPoints;\r\n\r\n        expect(canvasLayerElement.ctx.beginPath).toHaveBeenCalledTimes(totalPoints); // Modifi├®\r\n        expect(canvasLayerElement.ctx.arc).toHaveBeenCalledTimes(totalPoints); // Modifi├®\r\n        expect(canvasLayerElement.ctx.fill).toHaveBeenCalledTimes(totalPoints); // Modifi├®\r\n      });\r\n\r\n      it('should draw points at correct coordinates and radius (1cm grid, zoom 1)', () => {\r\n        canvasLayerElement.drawGridPoints();\r\n\r\n        const gridSize = 1; // cm\r\n        const zoomFactor = 1;\r\n        const pointRadius = 2 * zoomFactor;\r\n        const calculatedSize = gridSize * PIXELS_PER_CM * zoomFactor;\r\n\r\n        // Check first point (0,0)\r\n        expect(canvasLayerElement.ctx.arc).toHaveBeenCalledWith(0, 0, pointRadius, 0, 2 * Math.PI); // Modifi├®\r\n\r\n        // Check a mid point\r\n        const midX = calculatedSize;\r\n        const midY = calculatedSize;\r\n        if (canvasLayerElement.canvas.width >= midX && canvasLayerElement.canvas.height >= midY) {\r\n          expect(canvasLayerElement.ctx.arc).toHaveBeenCalledWith(midX, midY, pointRadius, 0, 2 * Math.PI); // Modifi├®\r\n        }\r\n\r\n        // Check last drawn point's coordinates\r\n        const lastX = (Math.floor(canvasLayerElement.canvas.width / calculatedSize)) * calculatedSize;\r\n        const lastY = (Math.floor(canvasLayerElement.canvas.height / calculatedSize)) * calculatedSize;\r\n        expect(canvasLayerElement.ctx.arc).toHaveBeenCalledWith(lastX, lastY, pointRadius, 0, 2 * Math.PI); // Modifi├®\r\n      });\r\n\r\n      // MODIFIED: Added async\r\n      it('should draw points correctly with zoomLevel = 2 (1cm grid)', async () => {\r\n        // Access the mocked app to change zoomLevel for this specific test\r\n        const { app } = await import('../../src/controllers/Core/App');\r\n        app.workspace.zoomLevel = 2; // Change zoom for this test\r\n\r\n        canvasLayerElement.drawGridPoints();\r\n\r\n        const gridSize = 1; // cm\r\n        const zoomFactor = 2;\r\n        const pointRadius = 2 * zoomFactor;\r\n        const calculatedSize = gridSize * PIXELS_PER_CM * zoomFactor;\r\n\r\n        const expectedXPoints = Math.floor(canvasLayerElement.canvas.width / calculatedSize) + 1;\r\n        const expectedYPoints = Math.floor(canvasLayerElement.canvas.height / calculatedSize) + 1;\r\n        const totalPoints = expectedXPoints * expectedYPoints;\r\n\r\n        expect(canvasLayerElement.ctx.arc).toHaveBeenCalledTimes(totalPoints); // Modifi├®\r\n        expect(canvasLayerElement.ctx.fill).toHaveBeenCalledTimes(totalPoints); // Modifi├®\r\n\r\n        // Check first point with new radius\r\n        expect(canvasLayerElement.ctx.arc).toHaveBeenCalledWith(0, 0, pointRadius, 0, 2 * Math.PI); // Modifi├®\r\n      });\r\n\r\n      it('should not draw if calculatedSize is 0 (e.g., gridSize = 0)', () => {\r\n        const currentState = gridStore.getState();\r\n        gridStore.getState.mockReturnValue({ ...currentState, gridSize: 0 });\r\n\r\n        canvasLayerElement.drawGridPoints();\r\n        expect(canvasLayerElement.ctx.arc).not.toHaveBeenCalled(); // Modifi├®\r\n      });\r\n\r\n      it('should not draw if calculatedSize is negative (e.g., gridSize = -1 and zoomFactor > 0)', () => {\r\n        const currentState = gridStore.getState();\r\n        gridStore.getState.mockReturnValue({ ...currentState, gridSize: -1 });\r\n        // Assuming app.workspace.zoomLevel is positive (e.g., 1)\r\n\r\n        canvasLayerElement.drawGridPoints();\r\n        expect(canvasLayerElement.ctx.arc).not.toHaveBeenCalled(); // Modifi├®\r\n      });\r\n    });\r\n\r\n    describe('Vertical Lines Grid Drawing', () => {\r\n      const PIXELS_PER_CM = 37.8;\r\n      const startX = 0; // As defined in drawGridPoints for vertical-lines\r\n\r\n      beforeEach(async () => { // MODIFI├ë en async\r\n        const currentState = gridStore.getState();\r\n        gridStore.getState.mockReturnValue({\r\n          ...currentState,\r\n          gridType: 'vertical-lines',\r\n          gridSize: 1,\r\n          isVisible: true,\r\n        });\r\n        // mockCtx.fillStyle = ''; // Supprim├®\r\n        const { app } = await import('../../src/controllers/Core/App'); // MODIFI├ë\r\n        app.workspace.zoomLevel = 1; // MODIFI├ë\r\n      });\r\n\r\n      it('should set fillStyle to #888888', () => {\r\n        canvasLayerElement.drawGridPoints();\r\n        expect(canvasLayerElement.ctx.fillStyle).toBe('#888888'); // Modifi├®\r\n      });\r\n\r\n      it('should draw correct number of points for a 1cm vertical-lines grid on 800x600 canvas, zoom 1', () => {\r\n        canvasLayerElement.drawGridPoints();\r\n\r\n        const gridSize = 1; // cm\r\n        const zoomFactor = 1;\r\n        const calculatedSize = gridSize * PIXELS_PER_CM * zoomFactor;\r\n        // For vertical-lines, points are drawn along y-axis at startX (0)\r\n        const expectedYPoints = Math.floor(canvasLayerElement.canvas.height / calculatedSize) + 1;\r\n        const totalPoints = expectedYPoints;\r\n\r\n        expect(canvasLayerElement.ctx.beginPath).toHaveBeenCalledTimes(totalPoints); // Modifi├®\r\n        expect(canvasLayerElement.ctx.arc).toHaveBeenCalledTimes(totalPoints); // Modifi├®\r\n        expect(canvasLayerElement.ctx.fill).toHaveBeenCalledTimes(totalPoints); // Modifi├®\r\n      });\r\n\r\n      it('should draw points at correct coordinates and radius (1cm vertical-lines, zoom 1)', () => {\r\n        canvasLayerElement.drawGridPoints();\r\n\r\n        const gridSize = 1; // cm\r\n        const zoomFactor = 1;\r\n        const pointRadius = 2 * zoomFactor;\r\n        const calculatedSize = gridSize * PIXELS_PER_CM * zoomFactor;\r\n\r\n        // Check first point (startX, 0)\r\n        expect(canvasLayerElement.ctx.arc).toHaveBeenCalledWith(startX, 0, pointRadius, 0, 2 * Math.PI); // Modifi├®\r\n\r\n        // Check a mid point (startX, calculatedSize)\r\n        const midY = calculatedSize;\r\n        if (canvasLayerElement.canvas.height >= midY) {\r\n          expect(canvasLayerElement.ctx.arc).toHaveBeenCalledWith(startX, midY, pointRadius, 0, 2 * Math.PI); // Modifi├®\r\n        }\r\n\r\n        // Check last drawn point's coordinates (startX, lastY)\r\n        const lastY = (Math.floor(canvasLayerElement.canvas.height / calculatedSize)) * calculatedSize;\r\n        expect(canvasLayerElement.ctx.arc).toHaveBeenCalledWith(startX, lastY, pointRadius, 0, 2 * Math.PI); // Modifi├®\r\n      });\r\n\r\n      // MODIFIED: Added async\r\n      it('should draw points correctly with zoomLevel = 2 (1cm vertical-lines)', async () => {\r\n        const { app } = await import('../../src/controllers/Core/App');\r\n        app.workspace.zoomLevel = 2;\r\n        canvasLayerElement.drawGridPoints();\r\n\r\n        const gridSize = 1; // cm\r\n        const zoomFactor = 2;\r\n        const pointRadius = 2 * zoomFactor;\r\n        const calculatedSize = gridSize * PIXELS_PER_CM * zoomFactor;\r\n\r\n        const expectedYPoints = Math.floor(canvasLayerElement.canvas.height / calculatedSize) + 1;\r\n        const totalPoints = expectedYPoints;\r\n\r\n        expect(canvasLayerElement.ctx.arc).toHaveBeenCalledTimes(totalPoints); // Modifi├®\r\n        expect(canvasLayerElement.ctx.fill).toHaveBeenCalledTimes(totalPoints); // Modifi├®\r\n\r\n        // Check first point with new radius\r\n        expect(canvasLayerElement.ctx.arc).toHaveBeenCalledWith(startX, 0, pointRadius, 0, 2 * Math.PI); // Modifi├®\r\n      });\r\n\r\n      it('should not draw if calculatedSize is 0', () => {\r\n        const currentState = gridStore.getState();\r\n        gridStore.getState.mockReturnValue({ ...currentState, gridSize: 0 });\r\n        canvasLayerElement.drawGridPoints();\r\n        expect(canvasLayerElement.ctx.arc).not.toHaveBeenCalled(); // Modifi├®\r\n      });\r\n    });\r\n\r\n    describe('Horizontal Lines Grid Drawing', () => {\r\n      const PIXELS_PER_CM = 37.8;\r\n      const startY = 0; // As defined in drawGridPoints for horizontal-lines\r\n\r\n      beforeEach(async () => { // MODIFI├ë en async\r\n        const currentState = gridStore.getState();\r\n        gridStore.getState.mockReturnValue({ // AJOUT du mockReturnValue manquant\r\n          ...currentState,\r\n          gridType: 'horizontal-lines',\r\n          gridSize: 1,\r\n          isVisible: true,\r\n        });\r\n        // mockCtx.fillStyle = ''; // Supprim├®\r\n        const { app } = await import('../../src/controllers/Core/App'); // MODIFI├ë\r\n        app.workspace.zoomLevel = 1; // MODIFI├ë\r\n      });\r\n\r\n      it('should set fillStyle to #888888', () => {\r\n        canvasLayerElement.drawGridPoints();\r\n        expect(canvasLayerElement.ctx.fillStyle).toBe('#888888'); // Modifi├®\r\n      });\r\n\r\n      it('should draw correct number of points for a 1cm horizontal-lines grid on 800x600 canvas, zoom 1', () => {\r\n        canvasLayerElement.drawGridPoints();\r\n\r\n        const gridSize = 1; // cm\r\n        const zoomFactor = 1;\r\n        const calculatedSize = gridSize * PIXELS_PER_CM * zoomFactor;\r\n        // For horizontal-lines, points are drawn along x-axis at startY (0)\r\n        const expectedXPoints = Math.floor(canvasLayerElement.canvas.width / calculatedSize) + 1;\r\n        const totalPoints = expectedXPoints;\r\n\r\n        expect(canvasLayerElement.ctx.beginPath).toHaveBeenCalledTimes(totalPoints); // Modifi├®\r\n        expect(canvasLayerElement.ctx.arc).toHaveBeenCalledTimes(totalPoints); // Modifi├®\r\n        expect(canvasLayerElement.ctx.fill).toHaveBeenCalledTimes(totalPoints); // Modifi├®\r\n      });\r\n\r\n      it('should draw points at correct coordinates and radius (1cm horizontal-lines, zoom 1)', () => {\r\n        canvasLayerElement.drawGridPoints();\r\n\r\n        const gridSize = 1; // cm\r\n        const zoomFactor = 1;\r\n        const pointRadius = 2 * zoomFactor;\r\n        const calculatedSize = gridSize * PIXELS_PER_CM * zoomFactor;\r\n\r\n        // Check first point (0, startY)\r\n        expect(canvasLayerElement.ctx.arc).toHaveBeenCalledWith(0, startY, pointRadius, 0, 2 * Math.PI); // Modifi├®\r\n\r\n        // Check a mid point (calculatedSize, startY)\r\n        const midX = calculatedSize;\r\n        if (canvasLayerElement.canvas.width >= midX) {\r\n          expect(canvasLayerElement.ctx.arc).toHaveBeenCalledWith(midX, startY, pointRadius, 0, 2 * Math.PI); // Modifi├®\r\n        }\r\n\r\n        // Check last drawn point's coordinates (lastX, startY)\r\n        const lastX = (Math.floor(canvasLayerElement.canvas.width / calculatedSize)) * calculatedSize;\r\n        expect(canvasLayerElement.ctx.arc).toHaveBeenCalledWith(lastX, startY, pointRadius, 0, 2 * Math.PI); // Modifi├®\r\n      });\r\n\r\n      // MODIFIED: Added async\r\n      it('should draw points correctly with zoomLevel = 2 (1cm horizontal-lines)', async () => {\r\n        const { app } = await import('../../src/controllers/Core/App');\r\n        app.workspace.zoomLevel = 2;\r\n        canvasLayerElement.drawGridPoints();\r\n\r\n        const gridSize = 1; // cm\r\n        const zoomFactor = 2;\r\n        const pointRadius = 2 * zoomFactor;\r\n        const calculatedSize = gridSize * PIXELS_PER_CM * zoomFactor;\r\n\r\n        const expectedXPoints = Math.floor(canvasLayerElement.canvas.width / calculatedSize) + 1;\r\n        const totalPoints = expectedXPoints;\r\n\r\n        expect(canvasLayerElement.ctx.arc).toHaveBeenCalledTimes(totalPoints); // Modifi├®\r\n        expect(canvasLayerElement.ctx.fill).toHaveBeenCalledTimes(totalPoints); // Modifi├®\r\n\r\n        // Check first point with new radius\r\n        expect(canvasLayerElement.ctx.arc).toHaveBeenCalledWith(0, startY, pointRadius, 0, 2 * Math.PI); // Modifi├®\r\n      });\r\n\r\n      it('should not draw if calculatedSize is 0', () => {\r\n        const currentState = gridStore.getState();\r\n        gridStore.getState.mockReturnValue({ ...currentState, gridSize: 0 });\r\n        canvasLayerElement.drawGridPoints();\r\n        expect(canvasLayerElement.ctx.arc).not.toHaveBeenCalled(); // Modifi├®\r\n      });\r\n    });\r\n\r\n    describe('Vertical Triangle Grid Drawing', () => {\r\n      const PIXELS_PER_CM = 37.8;\r\n\r\n      beforeEach(async () => { // MODIFI├ë en async\r\n        const currentState = gridStore.getState();\r\n        gridStore.getState.mockReturnValue({\r\n          ...currentState,\r\n          gridType: 'vertical-triangle',\r\n          gridSize: 1,\r\n          isVisible: true,\r\n        });\r\n        // mockCtx.fillStyle = ''; // Supprim├®\r\n        const { app } = await import('../../src/controllers/Core/App'); // MODIFI├ë\r\n        app.workspace.zoomLevel = 1; // MODIFI├ë\r\n      });\r\n\r\n      it('should set fillStyle to #888888', () => {\r\n        canvasLayerElement.drawGridPoints();\r\n        expect(canvasLayerElement.ctx.fillStyle).toBe('#888888'); // Modifi├®\r\n      });\r\n\r\n      it('should draw points for a 1cm vertical-triangle grid on 800x600 canvas, zoom 1', () => {\r\n        canvasLayerElement.drawGridPoints();\r\n\r\n        const gridSize = 1; // cm\r\n        const zoomFactor = 1;\r\n        const calculatedSize = gridSize * PIXELS_PER_CM * zoomFactor;\r\n        const triangleHeight = calculatedSize * Math.sqrt(3) / 2;\r\n        const pointRadius = 2 * zoomFactor;\r\n\r\n        let expectedPoints = 0;\r\n        for (let y = 0, row = 0; y <= canvasLayerElement.canvas.height + triangleHeight; y += triangleHeight, row++) {\r\n          const offsetX = (row % 2 === 0) ? 0 : calculatedSize / 2;\r\n          for (let x = offsetX; x <= canvasLayerElement.canvas.width + calculatedSize / 2; x += calculatedSize) {\r\n            expectedPoints++;\r\n          }\r\n        }\r\n        // The loop in drawGridPoints for vertical-triangle is slightly different in its x-condition\r\n        // and how it calls arc/fill. It calls beginPath for each point, but arc/fill are missing in the provided source code snippet for this type.\r\n        // Assuming arc and fill are called once per point inside the loops.\r\n        // The provided source code for 'vertical-triangle' in drawGridPoints is incomplete:\r\n        // for (let x = 0 + offsetX; x <= width + calculatedSize / 2; x += calculatedSize) {\r\n        //   this.ctx.beginPath();\r\n        // }\r\n        // It's missing arc() and fill(). So, for now, we can only check beginPath or expect 0 calls to arc/fill.\r\n        // Given the other grid types, it's highly probable arc() and fill() are intended.\r\n        // For this test to pass, we assume the implementation will be corrected to call arc and fill.\r\n        // If the implementation is *not* corrected, these tests will fail.\r\n\r\n        // Based on the loop structure, let's count beginPath calls.\r\n        expect(canvasLayerElement.ctx.beginPath).toHaveBeenCalledTimes(expectedPoints);\r\n\r\n        // If arc and fill were present, we would test them like this:\r\n        expect(canvasLayerElement.ctx.arc).toHaveBeenCalledTimes(expectedPoints);\r\n        expect(canvasLayerElement.ctx.fill).toHaveBeenCalledTimes(expectedPoints);\r\n\r\n        // For now, due to the incomplete code in SUT, we expect 0 calls for arc and fill.\r\n        // expect(mockCtx.arc).toHaveBeenCalledTimes(0);\r\n        // expect(mockCtx.fill).toHaveBeenCalledTimes(0);\r\n      });\r\n\r\n      it('should draw first few points at correct coordinates (1cm vertical-triangle, zoom 1)', () => {\r\n        // This test depends on the actual drawing logic (arc, fill) being present for vertical-triangle.\r\n        // Assuming it will be fixed to draw points.\r\n        canvasLayerElement.drawGridPoints();\r\n\r\n        const gridSize = 1; // cm\r\n        const zoomFactor = 1;\r\n        const calculatedSize = gridSize * PIXELS_PER_CM * zoomFactor;\r\n        const triangleHeight = calculatedSize * Math.sqrt(3) / 2;\r\n        const pointRadius = 2 * zoomFactor;\r\n\r\n        // If arc() and fill() are not called in the SUT, these expects will fail.\r\n        // We proceed assuming the SUT will be fixed.\r\n        // If SUT is not fixed, these should be expected NOT to be called or checked differently.\r\n\r\n        // First row (row 0, y=0, offsetX=0)\r\n        expect(canvasLayerElement.ctx.arc).toHaveBeenCalledWith(0, 0, pointRadius, 0, 2 * Math.PI);\r\n        expect(canvasLayerElement.ctx.arc).toHaveBeenCalledWith(calculatedSize, 0, pointRadius, 0, 2 * Math.PI);\r\n\r\n        // Second row (row 1, y=triangleHeight, offsetX=calculatedSize/2)\r\n        expect(canvasLayerElement.ctx.arc).toHaveBeenCalledWith(calculatedSize / 2, triangleHeight, pointRadius, 0, 2 * Math.PI);\r\n        // Example of a point that might be drawn in the second row, second column of points for that row\r\n        const secondPointXRow2 = calculatedSize / 2 + calculatedSize;\r\n        if (secondPointXRow2 <= canvasLayerElement.canvas.width + calculatedSize / 2) { // Check if it would be drawn\r\n          expect(canvasLayerElement.ctx.arc).toHaveBeenCalledWith(secondPointXRow2, triangleHeight, pointRadius, 0, 2 * Math.PI);\r\n        }\r\n\r\n        // Due to the missing arc/fill in SUT for this type, we cannot assert these calls yet.\r\n        // This test will fail until drawGridPoints is completed for vertical-triangle.\r\n        // For now, we acknowledge this by expecting 0 calls.\r\n        // expect(mockCtx.arc).toHaveBeenCalledTimes(0);\r\n      });\r\n\r\n      it('should not draw if calculatedSize or triangleHeight is 0 or less', () => {\r\n        const currentState = gridStore.getState();\r\n        gridStore.getState.mockReturnValue({ ...currentState, gridSize: 0 });\r\n        canvasLayerElement.drawGridPoints();\r\n        expect(canvasLayerElement.ctx.beginPath).not.toHaveBeenCalled(); // beginPath is the first thing in the loop\r\n        expect(canvasLayerElement.ctx.arc).not.toHaveBeenCalled();\r\n      });\r\n    });\r\n\r\n    describe('Horizontal Triangle Grid Drawing', () => {\r\n      const PIXELS_PER_CM = 37.8;\r\n\r\n      beforeEach(async () => { // MODIFI├ë en async\r\n        const currentState = gridStore.getState();\r\n        gridStore.getState.mockReturnValue({\r\n          ...currentState,\r\n          gridType: 'horizontal-triangle',\r\n          gridSize: 1,\r\n          isVisible: true,\r\n        });\r\n        // mockCtx.fillStyle = ''; // Supprim├®\r\n        const { app } = await import('../../src/controllers/Core/App'); // MODIFI├ë\r\n        app.workspace.zoomLevel = 1; // MODIFI├ë\r\n      });\r\n\r\n      it('should set fillStyle to #888888', () => {\r\n        canvasLayerElement.drawGridPoints();\r\n        expect(canvasLayerElement.ctx.fillStyle).toBe('#888888'); // Modifi├®\r\n      });\r\n\r\n      it('should draw points for a 1cm horizontal-triangle grid on 800x600 canvas, zoom 1', () => {\r\n        canvasLayerElement.drawGridPoints();\r\n\r\n        const gridSize = 1; // cm\r\n        const zoomFactor = 1;\r\n        const calculatedSize = gridSize * PIXELS_PER_CM * zoomFactor; // This is the side length of the triangle\r\n        const triangleWidth = calculatedSize * Math.sqrt(3) / 2; // Horizontal distance between columns of points\r\n\r\n        let expectedPoints = 0;\r\n        // Logic based on the SUT's loop structure for 'horizontal-triangle'\r\n        // for (let x = 0, col = 0; x <= this.canvas.width + triangleWidth; x += triangleWidth, col++) {\r\n        //     const offsetY = (col % 2 === 0) ? 0 : calculatedSize / 2;\r\n        //     for (let y = 0 + offsetY; y <= this.canvas.height + calculatedSize / 2; y += calculatedSize) {\r\n        //         this.ctx.beginPath();\r\n        //         // this.ctx.arc(x, y, pointRadius, 0, 2 * Math.PI);\r\n        //         // this.ctx.fill();\r\n        //     }\r\n        // }\r\n        for (let x = 0, col = 0; x <= canvasLayerElement.canvas.width + triangleWidth; x += triangleWidth, col++) {\r\n          const offsetY = (col % 2 === 0) ? 0 : calculatedSize / 2;\r\n          for (let y = offsetY; y <= canvasLayerElement.canvas.height + calculatedSize / 2; y += calculatedSize) {\r\n            expectedPoints++;\r\n          }\r\n        }\r\n\r\n        expect(canvasLayerElement.ctx.beginPath).toHaveBeenCalledTimes(expectedPoints);\r\n        // As with vertical-triangle, arc() and fill() are presumed missing in SUT for now.\r\n        expect(canvasLayerElement.ctx.arc).toHaveBeenCalledTimes(expectedPoints);\r\n        expect(canvasLayerElement.ctx.fill).toHaveBeenCalledTimes(expectedPoints);\r\n      });\r\n\r\n      it('should attempt to draw first few points (beginPath calls) at correct coordinates (1cm horizontal-triangle, zoom 1)', () => {\r\n        canvasLayerElement.drawGridPoints();\r\n\r\n        const gridSize = 1; // cm\r\n        const zoomFactor = 1;\r\n        const calculatedSize = gridSize * PIXELS_PER_CM * zoomFactor; // side length\r\n        const triangleWidth = calculatedSize * Math.sqrt(3) / 2; // horizontal distance between columns\r\n        const pointRadius = 2 * zoomFactor;\r\n\r\n        // Check first column (col 0, x=0, offsetY=0)\r\n        expect(canvasLayerElement.ctx.arc).toHaveBeenCalledWith(0, 0, pointRadius, 0, 2 * Math.PI);\r\n        expect(canvasLayerElement.ctx.arc).toHaveBeenCalledWith(0, calculatedSize, pointRadius, 0, 2 * Math.PI);\r\n\r\n        // Check second column (col 1, x=triangleWidth, offsetY=calculatedSize/2)\r\n        const secondColX = triangleWidth;\r\n        const secondColOffsetY = calculatedSize / 2;\r\n        expect(canvasLayerElement.ctx.arc).toHaveBeenCalledWith(secondColX, secondColOffsetY, pointRadius, 0, 2 * Math.PI);\r\n        // Example of a second point in the second column\r\n        const secondPointYCol2 = secondColOffsetY + calculatedSize;\r\n        if (secondPointYCol2 <= canvasLayerElement.canvas.height + calculatedSize / 2) { // Check if it would be drawn\r\n          expect(canvasLayerElement.ctx.arc).toHaveBeenCalledWith(secondColX, secondPointYCol2, pointRadius, 0, 2 * Math.PI);\r\n        }\r\n      });\r\n\r\n      it('should not draw if calculatedSize or triangleWidth is 0 or less', () => {\r\n        const currentState = gridStore.getState();\r\n        gridStore.getState.mockReturnValue({ ...currentState, gridSize: 0 });\r\n        canvasLayerElement.drawGridPoints();\r\n        expect(canvasLayerElement.ctx.beginPath).not.toHaveBeenCalled();\r\n        expect(canvasLayerElement.ctx.arc).not.toHaveBeenCalled();\r\n      });\r\n    });\r\n\r\n  });\r\n\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\test\\components\\open-server-popup.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\test\\components\\popups\\grid-popup.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\test\\controllers\\Core\\Managers\\OpenFileManager.test.js","messages":[{"ruleId":"eqeqeq","severity":2,"message":"Expected '===' and instead saw '=='.","line":51,"column":21,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":51,"endColumn":23,"suggestions":[{"messageId":"replaceOperator","data":{"expectedOperator":"===","actualOperator":"=="},"fix":{"range":[1261,1263],"text":"==="},"desc":"Use '===' instead of '=='."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, expect, it, vi } from 'vitest';\r\n\r\n// Mocks des d├®pendances\r\nvi.mock('@controllers/Core/App', () => ({\r\n  app: {\r\n    environment: {\r\n      name: 'Geometrie',\r\n      extensions: ['.ag', '.ags']\r\n    },\r\n    mainCanvasLayer: {\r\n      removeAllObjects: vi.fn()\r\n    },\r\n    defaultState: {\r\n      fullHistory: {},\r\n      history: {},\r\n      settings: {}\r\n    },\r\n    settings: {},\r\n    resetSettings: vi.fn()\r\n  },\r\n  setState: vi.fn()\r\n}));\r\n\r\nvi.mock('@store/gridStore.js', () => ({\r\n  gridStore: {\r\n    setGridType: vi.fn(),\r\n    setGridSize: vi.fn(),\r\n    setGridOpacity: vi.fn(),\r\n    setIsVisible: vi.fn()\r\n  }\r\n}));\r\n\r\nvi.mock('@store/kit.js', () => ({\r\n  setFamiliesVisibility: vi.fn()\r\n}));\r\n\r\nvi.mock('@store/tools.js', () => ({\r\n  setToolsVisibility: vi.fn()\r\n}));\r\n\r\nvi.mock('@controllers/Core/Tools/general.js', () => {\r\n  const layerOrder = ['upper', 'main', 'tangram', 'grid', 'background', 'invisible'];\r\n  const objectTypeOrder = ['shape', 'segment', 'point'];\r\n\r\n  return {\r\n    createElem: vi.fn(),\r\n    getExtension: vi.fn((filename) => filename ? filename.split('.').pop() : ''),\r\n    addInfoToId: vi.fn((id, layer, objectType = undefined) => {\r\n      if (!id) return;\r\n      let objectTypeId = id[9];\r\n      if (id.length == 10)\r\n        id = id.substring(0, 8)\r\n      else\r\n        id = id.substring(id.length - 8, id.length);\r\n      const layerId = layerOrder.indexOf(layer);\r\n      if (objectType) {\r\n        objectTypeId = objectTypeOrder.indexOf(objectType);\r\n      }\r\n      const result = id + layerId + objectTypeId;\r\n      return result;\r\n    })\r\n  };\r\n});\r\n\r\nvi.mock('@controllers/Core/Tools/version-migration.js', () => ({\r\n  applyMigrations: vi.fn()\r\n}));\r\n\r\nvi.mock('@controllers/Core/Managers/WorkspaceManager.js', () => ({\r\n  setWorkspaceFromObject: vi.fn()\r\n}));\r\n\r\n// Mock de window et des APIs\r\nconst mockShowOpenFilePicker = vi.fn();\r\nconst mockDispatchEvent = vi.fn();\r\n\r\nglobal.window = {\r\n  showOpenFilePicker: mockShowOpenFilePicker,\r\n  dispatchEvent: mockDispatchEvent,\r\n  CustomEvent: vi.fn((type, options) => ({ type, ...options })),\r\n  addEventListener: vi.fn(),\r\n  removeEventListener: vi.fn()\r\n};\r\n\r\nglobal.app = {\r\n  environment: {\r\n    name: 'Geometrie',\r\n    extensions: ['.ag', '.ags']\r\n  },\r\n  mainCanvasLayer: {\r\n    removeAllObjects: vi.fn()\r\n  },\r\n  defaultState: {\r\n    fullHistory: {},\r\n    history: {},\r\n    settings: {}\r\n  },\r\n  settings: {},\r\n  resetSettings: vi.fn()\r\n};\r\n\r\nglobal.hasNativeFS = true;\r\n\r\n// Importer apr├¿s les mocks\r\nimport { OpenFileManager } from '@controllers/Core/Managers/OpenFileManager.js';\r\n\r\ndescribe('OpenFileManager', () => {\r\n  beforeEach(() => {\r\n    vi.clearAllMocks();\r\n    mockShowOpenFilePicker.mockResolvedValue([{ getFile: vi.fn(() => ({ text: vi.fn(() => '{}') })) }]);\r\n  });\r\n\r\n  describe('validateFileContent', () => {\r\n    it('should reject unsupported version', () => {\r\n      const result = OpenFileManager.validateFileContent({\r\n        appVersion: '1.0.0',\r\n        envName: 'Geometrie'\r\n      }, { name: 'Geometrie' });\r\n      expect(result.isValid).toBe(false);\r\n      expect(result.error).toBe('Version non support├®e');\r\n    });\r\n\r\n    it('should accept valid file', () => {\r\n      const result = OpenFileManager.validateFileContent({\r\n        appVersion: '2.0.0',\r\n        envName: 'Geometrie',\r\n        workspaceData: {}\r\n      }, { name: 'Geometrie' });\r\n      expect(result.isValid).toBe(true);\r\n      expect(result.error).toBe(null);\r\n    });\r\n  });\r\n\r\n  describe('parseJsonContent', () => {\r\n    it('should parse valid JSON string', () => {\r\n      const jsonString = '{\"appVersion\": \"2.0.0\", \"envName\": \"Geometrie\"}';\r\n      const result = OpenFileManager.parseJsonContent(jsonString);\r\n      expect(result.success).toBe(true);\r\n      expect(result.data).toEqual({ appVersion: '2.0.0', envName: 'Geometrie' });\r\n      expect(result.error).toBe(null);\r\n    });\r\n\r\n    it('should return object if already parsed', () => {\r\n      const obj = { appVersion: '2.0.0', envName: 'Geometrie' };\r\n      const result = OpenFileManager.parseJsonContent(obj);\r\n      expect(result.success).toBe(true);\r\n      expect(result.data).toBe(obj);\r\n      expect(result.error).toBe(null);\r\n    });\r\n\r\n    it('should handle empty string', () => {\r\n      const result = OpenFileManager.parseJsonContent('');\r\n      expect(result.success).toBe(false);\r\n      expect(result.data).toBe(null);\r\n      expect(result.error).toBe('contenu vide');\r\n    });\r\n\r\n    it('should handle invalid JSON', () => {\r\n      const invalidJson = '{\"appVersion\": \"2.0.0\", invalid}';\r\n      const result = OpenFileManager.parseJsonContent(invalidJson);\r\n      expect(result.success).toBe(false);\r\n      expect(result.data).toBe(null);\r\n      expect(result.error).toBe('JSON invalide');\r\n    });\r\n  });\r\n\r\n  describe('updateGeometryReference', () => {\r\n    it('should update geometry object references', () => {\r\n      const geometryObject = {\r\n        geometryChildShapeIds: ['shape1', 'shape2'],\r\n        geometryTransformationChildShapeIds: ['shape3'],\r\n        geometryParentObjectId1: 'shape1',\r\n        geometryDuplicateParentShapeId: 'shape2'\r\n      };\r\n\r\n      const result = OpenFileManager.updateGeometryReference(geometryObject, 'shape1', 'shape110');\r\n\r\n      expect(result.geometryChildShapeIds).toEqual(['shape110', 'shape2']);\r\n      expect(result.geometryTransformationChildShapeIds).toEqual(['shape3']);\r\n      expect(result.geometryParentObjectId1).toBe('shape110');\r\n      expect(result.geometryDuplicateParentShapeId).toBe('shape2');\r\n    });\r\n\r\n    it('should return original object if no geometry object provided', () => {\r\n      const result = OpenFileManager.updateGeometryReference(null, 'shape1', 'shape110');\r\n      expect(result).toBe(null);\r\n    });\r\n  });\r\n\r\n  describe('updateReferences', () => {\r\n    it('should update shape references in segments and points', () => {\r\n      const objects = {\r\n        shapesData: [{ id: 'shape1', segmentIds: [], pointIds: [] }],\r\n        segmentsData: [\r\n          { id: 'segment1', shapeId: 'shape1', vertexIds: [] },\r\n          { id: 'segment2', shapeId: 'shape2', vertexIds: [] }\r\n        ],\r\n        pointsData: [\r\n          { id: 'point1', shapeId: 'shape1', segmentIds: [] },\r\n          { id: 'point2', shapeId: 'shape2', segmentIds: [] }\r\n        ]\r\n      };\r\n\r\n      const result = OpenFileManager.updateReferences(objects, 'shape1', 'shape110', 'shape');\r\n\r\n      expect(result.segmentsData[0].shapeId).toBe('shape110');\r\n      expect(result.segmentsData[1].shapeId).toBe('shape2');\r\n      expect(result.pointsData[0].shapeId).toBe('shape110');\r\n      expect(result.pointsData[1].shapeId).toBe('shape2');\r\n    });\r\n\r\n    it('should update segment references in shapes and points', () => {\r\n      const objects = {\r\n        shapesData: [\r\n          { id: 'shape1', segmentIds: ['segment1', 'segment2'], pointIds: [] }\r\n        ],\r\n        segmentsData: [{ id: 'segment1', shapeId: 'shape1', vertexIds: [] }],\r\n        pointsData: [\r\n          { id: 'point1', shapeId: 'shape1', segmentIds: ['segment1'] }\r\n        ]\r\n      };\r\n\r\n      const result = OpenFileManager.updateReferences(objects, 'segment1', 'segment111', 'segment');\r\n\r\n      expect(result.shapesData[0].segmentIds).toEqual(['segment111', 'segment2']);\r\n      expect(result.pointsData[0].segmentIds).toEqual(['segment111']);\r\n    });\r\n  });\r\n\r\n  describe('transformIds', () => {\r\n    it('should transform IDs and update references', () => {\r\n      const objects = {\r\n        shapesData: [{ id: 'shape1', segmentIds: ['segment1'], pointIds: ['point1'] }],\r\n        segmentsData: [{ id: 'segment1', shapeId: 'shape1', vertexIds: ['point1'] }],\r\n        pointsData: [{ id: 'point1', shapeId: 'shape1', segmentIds: ['segment1'] }]\r\n      };\r\n\r\n      const result = OpenFileManager.transformIds(objects.shapesData, objects, 'main', 'shape');\r\n\r\n      expect(result.shapesData[0].id).toBe('shape110');\r\n      expect(result.segmentsData[0].shapeId).toBe('shape110');\r\n      expect(result.pointsData[0].shapeId).toBe('shape110');\r\n    });\r\n  });\r\n});","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\test\\controllers\\Core\\Managers\\SaveFileManager.test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\test\\controllers\\Core\\SaveFileManager.test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\test\\controllers\\Core\\Tools\\automatic_adjustment.test.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'mockCoordInstance' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":23,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":43,"suggestions":[{"messageId":"removeVar","data":{"varName":"mockCoordInstance"},"fix":{"range":[697,716],"text":""},"desc":"Remove unused variable 'mockCoordInstance'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'mockFromCanvasCoordinates' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":23,"column":70,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":95,"suggestions":[{"messageId":"removeVar","data":{"varName":"mockFromCanvasCoordinates"},"fix":{"range":[741,768],"text":""},"desc":"Remove unused variable 'mockFromCanvasCoordinates'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'mockDist' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":23,"column":97,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":105,"suggestions":[{"messageId":"removeVar","data":{"varName":"mockDist"},"fix":{"range":[768,778],"text":""},"desc":"Remove unused variable 'mockDist'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'mockSubstract' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":23,"column":107,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":120,"suggestions":[{"messageId":"removeVar","data":{"varName":"mockSubstract"},"fix":{"range":[778,793],"text":""},"desc":"Remove unused variable 'mockSubstract'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'Coordinates' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":194,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":194,"endColumn":24,"suggestions":[{"messageId":"removeVar","data":{"varName":"Coordinates"},"fix":{"range":[7375,7471],"text":""},"desc":"Remove unused variable 'Coordinates'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { beforeEach, describe, expect, it, vi } from 'vitest';\r\n\r\n// Hoist the mock functions that will be used in vi.mock factories\r\nconst { mockGridStoreGetState } = vi.hoisted(() => {\r\n  return { mockGridStoreGetState: vi.fn() };\r\n});\r\n\r\nconst { mockGetEmptySelectionConstraints, mockSelectPoint } = vi.hoisted(() => {\r\n  return {\r\n    mockGetEmptySelectionConstraints: vi.fn(),\r\n    mockSelectPoint: vi.fn(),\r\n  };\r\n});\r\n\r\nconst { mockAppGetClosestGridPoint, mockAppSettingsGet } = vi.hoisted(() => {\r\n  return {\r\n    mockAppGetClosestGridPoint: vi.fn(),\r\n    mockAppSettingsGet: vi.fn(),\r\n  };\r\n});\r\n\r\n// Hoist CoordinatesMock and its properties needed by other mocks\r\nconst { CoordinatesMock, mockCoordInstance, mockToCanvasCoordinates, mockFromCanvasCoordinates, mockDist, mockSubstract } = vi.hoisted(() => {\r\n  const mockToCanvasCoordinates = vi.fn();\r\n  const mockFromCanvasCoordinates = vi.fn();\r\n  const mockDist = vi.fn();\r\n  const mockSubstract = vi.fn();\r\n\r\n  const mockCoordInstance = {\r\n    toCanvasCoordinates: mockToCanvasCoordinates,\r\n    fromCanvasCoordinates: mockFromCanvasCoordinates,\r\n    dist: mockDist,\r\n    substract: mockSubstract,\r\n  };\r\n\r\n  const CoordinatesMock = vi.fn().mockImplementation((x, y) => ({\r\n    ...mockCoordInstance,\r\n    x: x !== undefined ? x : 0,\r\n    y: y !== undefined ? y : 0,\r\n  }));\r\n  CoordinatesMock.nullCoordinates = { ...mockCoordInstance, x: 0, y: 0, type: 'world-null' };\r\n\r\n  return { CoordinatesMock, mockCoordInstance, mockToCanvasCoordinates, mockFromCanvasCoordinates, mockDist, mockSubstract };\r\n});\r\n\r\n\r\nvi.mock('../../../../src/controllers/Core/Objects/Coordinates.js', () => ({\r\n  Coordinates: CoordinatesMock,\r\n}));\r\n\r\n// Mock gridStore using the hoisted function\r\nvi.mock('../../../../src/store/gridStore.js', () => ({\r\n  gridStore: {\r\n    getState: mockGridStoreGetState,\r\n  }\r\n}));\r\n\r\n// Mock SelectManager using hoisted functions\r\nvi.mock('../../../../src/controllers/Core/Managers/SelectManager', () => ({\r\n  SelectManager: {\r\n    getEmptySelectionConstraints: mockGetEmptySelectionConstraints,\r\n    selectPoint: mockSelectPoint,\r\n  },\r\n  initSelectManager: vi.fn(),\r\n}));\r\n\r\n// Mock app service using hoisted functions\r\nvi.mock('../../../../src/controllers/Core/App', () => {\r\n  const actualApp = vi.importActual('../../../../src/controllers/Core/App');\r\n  const app = {\r\n    ...actualApp.app,\r\n    environment: {}, // Mock environment\r\n    settings: {\r\n      automaticAdjustment: true, // Default value\r\n      get: mockAppSettingsGet, // Mock for app.settings.get\r\n    },\r\n    workspace: {\r\n      geometryTransformationChildShapeIds: [], // Mock\r\n    },\r\n    gridCanvasLayer: { // Assurez-vous que c'est bien gridCanvasLayer\r\n      getClosestGridPoint: mockAppGetClosestGridPoint, // Correction: utiliser le spy ici\r\n    },\r\n    // getClosestGridPoint: mockAppGetClosestGridPoint, // Peut ├¬tre conserv├® ou supprim├® car non utilis├® directement par le SUT\r\n    addListener: vi.fn(),\r\n    removeListener: vi.fn(),\r\n    dispatch: vi.fn(),\r\n    setState: vi.fn(),\r\n    getState: vi.fn(() => ({\r\n      settings: {\r\n        gridShown: true,\r\n        gridType: 'square',\r\n        gridSize: 20,\r\n      },\r\n      tools: {\r\n        selectedTool: 'select',\r\n      }\r\n    })),\r\n  };\r\n  return { app };\r\n});\r\n\r\n// Import the module to test AFTER all mocks are set up\r\n\r\ndescribe('Automatic Adjustment Logic', () => {\r\n  let app; // To access the mocked app features easily\r\n\r\n  beforeEach(async () => {\r\n    vi.clearAllMocks();\r\n\r\n    // It's crucial to re-import the mocked module to get the fresh mock instance for each test\r\n    const appModule = await import('../../../../src/controllers/Core/App');\r\n    app = appModule.app;\r\n\r\n    // Configure the fresh mock instance for app.settings and app.environment for each test\r\n    // For app.settings.get\r\n    mockAppSettingsGet.mockImplementation(key => {\r\n      if (key === 'automaticAdjustmentSensitivity') {\r\n        return 5; // Default mock sensitivity\r\n      }\r\n      // Ensure direct assignments in tests are reflected if app.settings.get is called for them\r\n      if (key === 'automaticAdjustment' && app.settings.hasOwnProperty('automaticAdjustment')) {\r\n        return app.settings.automaticAdjustment;\r\n      }\r\n      return undefined;\r\n    });\r\n\r\n    // Initialize properties that are directly set in the tests on the fresh mock\r\n    app.settings.automaticAdjustment = true; // Default for tests, can be overridden\r\n    app.environment.name = 'Geometrie'; // Now app.environment is defined\r\n\r\n    // Default gridStore configuration\r\n    mockGridStoreGetState.mockReturnValue({ isVisible: true });\r\n\r\n    // Default SelectManager configuration\r\n    mockGetEmptySelectionConstraints.mockReturnValue({\r\n      points: { canSelect: true, types: [], blacklist: [], numberOfObjects: 'allInDistance' }\r\n    });\r\n    mockSelectPoint.mockReturnValue([]); // No points selected by default\r\n  });\r\n\r\n  it('should call getClosestGridPoint with canvas coords and convert result back to world coords', async () => {\r\n    const { getShapeAdjustment } = await import('../../../../src/controllers/Core/Tools/automatic_adjustment');\r\n\r\n    const canvasPointFromShape = { x: 200, y: 200, type: 'canvas-shape-point' };\r\n    const worldGridPoint = {\r\n      x: 101, y: 101, type: 'world-grid-point',\r\n      dist: vi.fn().mockReturnValue(5),\r\n      substract: vi.fn().mockReturnValue({ x: 1, y: 1, type: 'world-translation' })\r\n    };\r\n    const canvasGridPointReturned = {\r\n      x: 202, y: 202, type: 'canvas-grid-returned',\r\n      fromCanvasCoordinates: vi.fn().mockReturnValue(worldGridPoint)\r\n    };\r\n\r\n    mockToCanvasCoordinates.mockReturnValue(canvasPointFromShape);\r\n    mockAppGetClosestGridPoint.mockReturnValue(canvasGridPointReturned);\r\n\r\n    const shapePointWorldCoordinates = {\r\n      x: 100, y: 100, type: 'world-shape-point',\r\n      toCanvasCoordinates: mockToCanvasCoordinates,\r\n      dist: vi.fn(),\r\n      substract: vi.fn()\r\n    };\r\n\r\n    app.settings.automaticAdjustment = false; // This will now correctly set it on the fresh mock\r\n    mockGridStoreGetState.mockReturnValue({ isVisible: true });\r\n\r\n    const mockMainShape = {\r\n      id: 'mainShape1',\r\n      centerCoordinates: { x: 50, y: 50 },\r\n      vertexes: [{ coordinates: shapePointWorldCoordinates }],\r\n      divisionPoints: [],\r\n      isCenterShown: false,\r\n      geometryObject: {\r\n        geometryTransformationChildShapeIds: [],\r\n        geometryChildShapeIds: [] // Ajout de geometryChildShapeIds\r\n      }\r\n    };\r\n    const shapes = [mockMainShape];\r\n\r\n    const transformation = getShapeAdjustment(shapes, mockMainShape, []);\r\n\r\n    expect(mockToCanvasCoordinates).toHaveBeenCalledTimes(1);\r\n    expect(mockAppGetClosestGridPoint).toHaveBeenCalledTimes(1);\r\n    expect(mockAppGetClosestGridPoint).toHaveBeenCalledWith(canvasPointFromShape);\r\n    expect(canvasGridPointReturned.fromCanvasCoordinates).toHaveBeenCalledTimes(1);\r\n    expect(worldGridPoint.substract).toHaveBeenCalledWith(shapePointWorldCoordinates);\r\n    expect(transformation.translation).toEqual({ x: 1, y: 1, type: 'world-translation' });\r\n    expect(transformation.rotationAngle).toBe(0);\r\n  });\r\n\r\n  it('should consider automaticAdjustmentSensitivity via getClosestGridPoint behavior', async () => {\r\n    const { getShapeAdjustment } = await import('../../../../src/controllers/Core/Tools/automatic_adjustment');\r\n    const { Coordinates } = await import('../../../../src/controllers/Core/Objects/Coordinates.js'); // Corrected import path\r\n\r\n    const shapePointCanvasCoords = { x: 20, y: 20, type: 'canvas-shape' };\r\n    const shapePointWorldCoords = {\r\n      x: 10, y: 10, type: 'world-shape',\r\n      toCanvasCoordinates: vi.fn().mockReturnValue(shapePointCanvasCoords),\r\n      dist: vi.fn(),\r\n      substract: vi.fn()\r\n    };\r\n\r\n    const mockShapes = [{\r\n      vertexes: [{ coordinates: shapePointWorldCoords }],\r\n      divisionPoints: [],\r\n      isCenterShown: false,\r\n      id: 's1',\r\n      geometryObject: {\r\n        geometryTransformationChildShapeIds: [],\r\n        geometryChildShapeIds: [] // Ajout de geometryChildShapeIds\r\n      }\r\n    }];\r\n    const mockMainShape = mockShapes[0];\r\n\r\n    mockGridStoreGetState.mockReturnValue({ isVisible: true });\r\n    app.settings.automaticAdjustment = false;\r\n\r\n    const actualDistanceToGrid = 10;\r\n    const translationVector = { x: 2, y: 2, type: 'translation_if_snapped' };\r\n\r\n    mockAppGetClosestGridPoint.mockImplementation(canvasCoordsInput => {\r\n      const sensitivity = app.settings.get('automaticAdjustmentSensitivity');\r\n      if (actualDistanceToGrid <= sensitivity) {\r\n        return {\r\n          x: canvasCoordsInput.x + 5, y: canvasCoordsInput.y + 5, type: 'canvas-grid-sensitive',\r\n          fromCanvasCoordinates: vi.fn().mockReturnValue({\r\n            x: shapePointWorldCoords.x + translationVector.x,\r\n            y: shapePointWorldCoords.y + translationVector.y,\r\n            type: 'world-grid-sensitive',\r\n            dist: vi.fn().mockReturnValue(actualDistanceToGrid),\r\n            substract: vi.fn().mockReturnValue(translationVector)\r\n          })\r\n        };\r\n      }\r\n      return null;\r\n    });\r\n\r\n    // Case 1: Sensitivity is too low (5), point is not snapped (distance 10)\r\n    mockAppSettingsGet.mockImplementation(key => key === 'automaticAdjustmentSensitivity' ? 5 : undefined);\r\n    let transformation = getShapeAdjustment(mockShapes, mockMainShape, []);\r\n    expect(mockAppGetClosestGridPoint).toHaveBeenCalledWith(shapePointCanvasCoords);\r\n    expect(transformation.translation).toEqual(CoordinatesMock.nullCoordinates); // Use the mocked Coordinates.nullCoordinates\r\n    expect(transformation.rotationAngle).toBe(0);\r\n\r\n    // Clear mock history and implementations for the next part of the test\r\n    vi.clearAllMocks();\r\n\r\n    // Re-apply necessary mocks for Case 2 as vi.clearAllMocks() resets them to bare vi.fn()\r\n    // or clears their specific mockImplementation.\r\n\r\n    // Re-configure app settings and other global mocks that were cleared\r\n    // const appModule = await import('../../../../src/controllers/Core/App'); // No longer needed here, app is fresh from beforeEach\r\n    // app = appModule.app;\r\n    app.settings.automaticAdjustment = false; // Ensure this is set on the correct mock instance\r\n    app.environment.name = 'Geometrie'; // Ensure this is set on the correct mock instance\r\n    mockGridStoreGetState.mockReturnValue({ isVisible: true });\r\n    mockGetEmptySelectionConstraints.mockReturnValue({\r\n      points: { canSelect: true, types: [], blacklist: [], numberOfObjects: 'allInDistance' }\r\n    });\r\n    mockSelectPoint.mockReturnValue([]);\r\n\r\n    // Re-mock shapePointWorldCoords methods as they are instance specific vi.fn()\r\n    shapePointWorldCoords.toCanvasCoordinates.mockReturnValue(shapePointCanvasCoords);\r\n\r\n    // Case 2: Sensitivity is high enough (15), point is snapped (distance 10)\r\n    mockAppSettingsGet.mockImplementation(key => key === 'automaticAdjustmentSensitivity' ? 15 : undefined);\r\n    mockAppGetClosestGridPoint.mockImplementation(canvasCoordsInput => {\r\n      const sensitivity = app.settings.get('automaticAdjustmentSensitivity');\r\n      if (actualDistanceToGrid <= sensitivity) {\r\n        const worldGridPt = {\r\n          x: shapePointWorldCoords.x + translationVector.x,\r\n          y: shapePointWorldCoords.y + translationVector.y,\r\n          type: 'world-grid-sensitive',\r\n          dist: vi.fn().mockReturnValue(actualDistanceToGrid),\r\n          substract: vi.fn().mockReturnValue(translationVector)\r\n        };\r\n        return {\r\n          x: canvasCoordsInput.x + 5, y: canvasCoordsInput.y + 5, type: 'canvas-grid-sensitive',\r\n          fromCanvasCoordinates: vi.fn().mockReturnValue(worldGridPt)\r\n        };\r\n      }\r\n      return null;\r\n    });\r\n\r\n    transformation = getShapeAdjustment(mockShapes, mockMainShape, []);\r\n    expect(mockAppGetClosestGridPoint).toHaveBeenCalledWith(shapePointCanvasCoords);\r\n    expect(transformation.translation).toEqual(translationVector);\r\n    expect(transformation.rotationAngle).toBe(0);\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\test\\controllers\\Reverse\\ReverseAnimationZoom.test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\test\\controllers\\Reverse\\ReverseZoom.test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\test\\controllers\\Rotation\\RotationArcSelection.test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\test\\controllers\\Rotation\\RotationIntegration.test.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'arcStart' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":102,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":102,"endColumn":21,"suggestions":[{"messageId":"removeVar","data":{"varName":"arcStart"},"fix":{"range":[4809,4973],"text":""},"desc":"Remove unused variable 'arcStart'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'arcEnd' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":107,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":107,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"arcEnd"},"fix":{"range":[4983,5141],"text":""},"desc":"Remove unused variable 'arcEnd'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, expect, it } from 'vitest';\r\nimport { Coordinates } from '../../../src/controllers/Core/Objects/Coordinates.js';\r\nimport { isAngleBetweenTwoAngles } from '../../../src/controllers/Core/Tools/geometry.js';\r\n\r\ndescribe('Rotation - Tests d\\'int├®gration selon le guide utilisateur', () => {\r\n  describe('Sc├®nario complet selon le guide utilisateur', () => {\r\n    it('devrait reproduire le processus complet de rotation selon les sp├®cifications', () => {\r\n      // *** ├ëTAPE 1: D├®finir le centre de rotation ***\r\n      const rotationCenter = new Coordinates({ x: 50, y: 50 });\r\n\r\n      // *** ├ëTAPE 2: D├®finir l\\'angle avec trois points ***\r\n      // Point sur premi├¿re demi-droite\r\n      const pointOnFirstRay = new Coordinates({ x: 100, y: 50 });\r\n      // Sommet de l'angle (m├¬me que le centre pour cet exemple)\r\n      const angleVertex = new Coordinates({ x: 50, y: 50 });\r\n      // Point sur seconde demi-droite\r\n      const pointOnSecondRay = new Coordinates({ x: 50, y: 100 });\r\n\r\n      // *** ├ëTAPE 3: Calculer l\\'angle de rotation ***\r\n      const angle1 = angleVertex.angleWith(pointOnFirstRay);\r\n      const angle2 = angleVertex.angleWith(pointOnSecondRay);\r\n      let rotationAngle = angle1 - angle2;\r\n      rotationAngle *= -1; // Selon le code de RotationTool\r\n\r\n      // *** ├ëTAPE 4: V├®rifier les deux arcs possibles ***\r\n      const shortArc = Math.abs(rotationAngle);\r\n      const longArc = 2 * Math.PI - shortArc;\r\n\r\n      expect(shortArc).toBeLessThan(Math.PI); // Arc court < 180┬░\r\n      expect(longArc).toBeGreaterThan(Math.PI); // Arc long > 180┬░\r\n\r\n      // *** ├ëTAPE 5: Appliquer la rotation sur une forme ***\r\n      // Exemple: carr├® de 20x20 centr├® en (100, 100)\r\n      const squarePoints = [\r\n        new Coordinates({ x: 90, y: 90 }),   // Coin bas-gauche\r\n        new Coordinates({ x: 110, y: 90 }),  // Coin bas-droite\r\n        new Coordinates({ x: 110, y: 110 }), // Coin haut-droite\r\n        new Coordinates({ x: 90, y: 110 })   // Coin haut-gauche\r\n      ];\r\n\r\n      // Rotation de 90┬░ dans le sens anti-horaire\r\n      const rotatedPoints = squarePoints.map(point =>\r\n        point.rotate(Math.PI / 2, rotationCenter)\r\n      );\r\n\r\n      // *** ├ëTAPE 6: V├®rifier les r├®sultats ***\r\n      // Affichage des r├®sultats pour d├®bugger\r\n      console.log('Points de test:');\r\n      rotatedPoints.forEach((point, i) => {\r\n        console.log(`Point ${i}: (${squarePoints[i].x}, ${squarePoints[i].y}) -> (${point.x.toFixed(2)}, ${point.y.toFixed(2)})`);\r\n      });\r\n\r\n      // Utilisons les valeurs calcul├®es pour valider que la rotation fonctionne\r\n      // Au lieu de valeurs fixes, v├®rifions que les points ont bien tourn├® de 90┬░\r\n      squarePoints.forEach((originalPoint, i) => {\r\n        const rotatedPoint = rotatedPoints[i];\r\n\r\n        // V├®rifier que la distance au centre est conserv├®e\r\n        const originalDist = originalPoint.dist(rotationCenter);\r\n        const rotatedDist = rotatedPoint.dist(rotationCenter);\r\n        expect(rotatedDist).toBeCloseTo(originalDist, 2);\r\n\r\n        // V├®rifier que l'angle a bien chang├® de 90┬░\r\n        const originalAngle = rotationCenter.angleWith(originalPoint);\r\n        const rotatedAngle = rotationCenter.angleWith(rotatedPoint);\r\n        const angleDiff = Math.abs(rotatedAngle - originalAngle);\r\n        const normalizedAngleDiff = Math.min(angleDiff, 2 * Math.PI - angleDiff);\r\n        expect(normalizedAngleDiff).toBeCloseTo(Math.PI / 2, 2);\r\n      });\r\n    });\r\n\r\n    it('devrait g├®rer correctement la s├®lection d\\'arc selon la logique du code', () => {\r\n      // Sc├®nario: angle de 45┬░ et test de la logique de direction\r\n      const center = new Coordinates({ x: 0, y: 0 });\r\n      const point1 = new Coordinates({ x: 10, y: 0 });  // 0┬░\r\n      const point2 = new Coordinates({ x: 7.07, y: 7.07 }); // ~45┬░\r\n\r\n      const startAngle = center.angleWith(point1);\r\n      const endAngle = center.angleWith(point2);\r\n\r\n      // Test de la fonction isAngleBetweenTwoAngles\r\n      const testAngle = Math.PI / 4; // 45┬░\r\n\r\n      // Sens anti-horaire (direction = true)\r\n      const isInAnticlockwise = isAngleBetweenTwoAngles(startAngle, endAngle, true, testAngle);\r\n      // Sens horaire (direction = false)\r\n      const isInClockwise = isAngleBetweenTwoAngles(startAngle, endAngle, false, testAngle);\r\n\r\n      // L\\'un des deux devrait ├¬tre true selon la direction choisie\r\n      expect(isInAnticlockwise || isInClockwise).toBe(true);\r\n    });\r\n\r\n    it('devrait permettre l\\'utilisation d\\'un arc de cercle existant', () => {\r\n      // Simulation d'un arc de cercle pour d├®finir l'angle\r\n      const arcCenter = new Coordinates({ x: 50, y: 50 });\r\n      const arcRadius = 30;\r\n\r\n      // Points de d├®but et fin d'arc (60┬░ d'arc)\r\n      const startAngle = 0; // 0┬░\r\n      const endAngle = Math.PI / 3; // 60┬░\r\n\r\n      const arcStart = new Coordinates({\r\n        x: arcCenter.x + arcRadius * Math.cos(startAngle),\r\n        y: arcCenter.y + arcRadius * Math.sin(startAngle)\r\n      });\r\n\r\n      const arcEnd = new Coordinates({\r\n        x: arcCenter.x + arcRadius * Math.cos(endAngle),\r\n        y: arcCenter.y + arcRadius * Math.sin(endAngle)\r\n      });\r\n\r\n      // L'angle de rotation correspond ├á l'arc\r\n      const rotationAngle = endAngle - startAngle;\r\n\r\n      // Test: rotation d'un point selon cet arc\r\n      const testPoint = new Coordinates({ x: 100, y: 50 });\r\n      const rotatedPoint = testPoint.rotate(rotationAngle, arcCenter);\r\n\r\n      // V├®rification que la rotation a bien ├®t├® appliqu├®e\r\n      const expectedAngle = arcCenter.angleWith(testPoint) + rotationAngle;\r\n      const expectedDistance = testPoint.dist(arcCenter);\r\n\r\n      const expectedPoint = new Coordinates({\r\n        x: arcCenter.x + expectedDistance * Math.cos(expectedAngle),\r\n        y: arcCenter.y + expectedDistance * Math.sin(expectedAngle)\r\n      });\r\n\r\n      expect(rotatedPoint.x).toBeCloseTo(expectedPoint.x, 2);\r\n      expect(rotatedPoint.y).toBeCloseTo(expectedPoint.y, 2);\r\n    });\r\n  });\r\n\r\n  describe('Tests de validation des cas limites', () => {\r\n    it('devrait g├®rer une rotation de 0┬░', () => {\r\n      const center = new Coordinates({ x: 25, y: 25 });\r\n      const point = new Coordinates({ x: 50, y: 30 });\r\n\r\n      const rotatedPoint = point.rotate(0, center);\r\n\r\n      expect(rotatedPoint.x).toBeCloseTo(point.x, 5);\r\n      expect(rotatedPoint.y).toBeCloseTo(point.y, 5);\r\n    });\r\n\r\n    it('devrait g├®rer une rotation de 360┬░', () => {\r\n      const center = new Coordinates({ x: 0, y: 0 });\r\n      const point = new Coordinates({ x: 10, y: 15 });\r\n\r\n      const rotatedPoint = point.rotate(2 * Math.PI, center);\r\n\r\n      expect(rotatedPoint.x).toBeCloseTo(point.x, 2);\r\n      expect(rotatedPoint.y).toBeCloseTo(point.y, 2);\r\n    });\r\n\r\n    it('devrait g├®rer une rotation autour du point lui-m├¬me', () => {\r\n      const point = new Coordinates({ x: 42, y: 37 });\r\n\r\n      const rotatedPoint = point.rotate(Math.PI / 2, point);\r\n\r\n      expect(rotatedPoint.x).toBeCloseTo(point.x, 5);\r\n      expect(rotatedPoint.y).toBeCloseTo(point.y, 5);\r\n    });\r\n  });\r\n});","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\test\\controllers\\Rotation\\RotationTool.test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\test\\controllers\\version-migration.test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\test\\help-popup.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\test\\services\\cache.service.test.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'successPromise' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":50,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":50,"endColumn":25,"suggestions":[{"messageId":"removeVar","data":{"varName":"successPromise"},"fix":{"range":[1151,1192],"text":""},"desc":"Remove unused variable 'successPromise'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'successPromise' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":50,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":50,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { afterEach, beforeEach, describe, expect, it, vi } from 'vitest';\r\nimport { CacheClearError, CacheError, CacheService, CacheUnavailableError } from '../../src/services/cache.service';\r\n\r\n// Mock d'IndexedDB pour les tests\r\nconst mockIndexedDB = {\r\n  open: vi.fn(),\r\n  deleteDatabase: vi.fn()\r\n};\r\n\r\nconst mockDB = {\r\n  close: vi.fn(),\r\n  transaction: vi.fn(),\r\n  objectStoreNames: {\r\n    contains: vi.fn()\r\n  },\r\n  createObjectStore: vi.fn()\r\n};\r\n\r\nconst mockTransaction = {\r\n  objectStore: vi.fn()\r\n};\r\n\r\nconst mockStore = {\r\n  clear: vi.fn(),\r\n  count: vi.fn()\r\n};\r\n\r\nconst mockRequest = {\r\n  result: mockDB,\r\n  error: null,\r\n  onsuccess: null,\r\n  onerror: null,\r\n  onupgradeneeded: null\r\n};\r\n\r\ndescribe('CacheService', () => {\r\n  beforeEach(() => {\r\n    // Configuration des mocks\r\n    global.window = {\r\n      indexedDB: mockIndexedDB,\r\n      dispatchEvent: vi.fn(),\r\n      dev_mode: true\r\n    } as any;\r\n\r\n    mockIndexedDB.open.mockReturnValue(mockRequest);\r\n    mockDB.transaction.mockReturnValue(mockTransaction);\r\n    mockTransaction.objectStore.mockReturnValue(mockStore);\r\n\r\n    // Mock des promesses pour les op├®rations store\r\n    const successPromise = Promise.resolve();\r\n    mockStore.clear.mockReturnValue({ onsuccess: null, onerror: null });\r\n    mockStore.count.mockReturnValue({ onsuccess: null, onerror: null });\r\n\r\n    // Console mocks\r\n    global.console = {\r\n      log: vi.fn(),\r\n      error: vi.fn(),\r\n      warn: vi.fn()\r\n    } as any;\r\n  });\r\n\r\n  afterEach(() => {\r\n    vi.clearAllMocks();\r\n  });\r\n\r\n  describe('verifierDisponibilite', () => {\r\n    it('devrait retourner disponible: false si IndexedDB n\\'est pas support├®', async () => {\r\n      global.window.indexedDB = undefined;\r\n\r\n      const result = await CacheService.verifierDisponibilite();\r\n\r\n      expect(result.available).toBe(false);\r\n      expect(result.reason).toBe('IndexedDB non support├®');\r\n    });\r\n\r\n    it('devrait retourner disponible: true avec statistiques si IndexedDB fonctionne', async () => {\r\n      // Simuler l'ouverture r├®ussie de la DB\r\n      setTimeout(() => {\r\n        if (mockRequest.onsuccess) {\r\n          mockRequest.onsuccess();\r\n        }\r\n      }, 0);\r\n\r\n      // Simuler le count\r\n      const countRequest = { onsuccess: null, onerror: null, result: 5 };\r\n      mockStore.count.mockReturnValue(countRequest);\r\n      setTimeout(() => {\r\n        if (countRequest.onsuccess) {\r\n          countRequest.onsuccess();\r\n        }\r\n      }, 0);\r\n\r\n      const result = await CacheService.verifierDisponibilite();\r\n\r\n      expect(result.available).toBe(true);\r\n      expect(result.storeCount).toBe(5);\r\n      expect(result.dbName).toBe('agTabletteDB');\r\n    });\r\n\r\n    it('devrait g├®rer les erreurs d\\'ouverture de DB', async () => {\r\n      setTimeout(() => {\r\n        mockRequest.error = new Error('DB Error');\r\n        if (mockRequest.onerror) {\r\n          mockRequest.onerror();\r\n        }\r\n      }, 0);\r\n\r\n      const result = await CacheService.verifierDisponibilite();\r\n\r\n      expect(result.available).toBe(false);\r\n      expect(result.reason).toContain('Impossible d\\'ouvrir la base de donn├®es');\r\n    });\r\n  });\r\n\r\n  describe('viderCache', () => {\r\n    it('devrait vider le cache avec succ├¿s', async () => {\r\n      // Simuler l'ouverture r├®ussie\r\n      setTimeout(() => {\r\n        if (mockRequest.onsuccess) {\r\n          mockRequest.onsuccess();\r\n        }\r\n      }, 0);\r\n\r\n      // Simuler le clear\r\n      const clearRequest = { onsuccess: null, onerror: null };\r\n      mockStore.clear.mockReturnValue(clearRequest);\r\n      setTimeout(() => {\r\n        if (clearRequest.onsuccess) {\r\n          clearRequest.onsuccess();\r\n        }\r\n      }, 10);\r\n\r\n      await expect(CacheService.viderCache()).resolves.toBeUndefined();\r\n\r\n      expect(mockDB.transaction).toHaveBeenCalledWith(['activities'], 'readwrite');\r\n      expect(mockStore.clear).toHaveBeenCalled();\r\n      expect(mockDB.close).toHaveBeenCalled();\r\n      expect(global.window.dispatchEvent).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          type: 'cache-cleared'\r\n        })\r\n      );\r\n    });\r\n\r\n    it('devrait lancer CacheClearError en cas d\\'erreur de vidage', async () => {\r\n      // Simuler l'ouverture r├®ussie\r\n      setTimeout(() => {\r\n        if (mockRequest.onsuccess) {\r\n          mockRequest.onsuccess();\r\n        }\r\n      }, 0);\r\n\r\n      // Simuler l'erreur de clear\r\n      const clearRequest = { onsuccess: null, onerror: null, error: new Error('Clear failed') };\r\n      mockStore.clear.mockReturnValue(clearRequest);\r\n      setTimeout(() => {\r\n        if (clearRequest.onerror) {\r\n          clearRequest.onerror();\r\n        }\r\n      }, 10);\r\n\r\n      await expect(CacheService.viderCache()).rejects.toThrow(CacheClearError);\r\n    });\r\n\r\n    it('devrait lancer CacheUnavailableError si la DB ne peut pas s\\'ouvrir', async () => {\r\n      setTimeout(() => {\r\n        mockRequest.error = new Error('DB unavailable');\r\n        if (mockRequest.onerror) {\r\n          mockRequest.onerror();\r\n        }\r\n      }, 0);\r\n\r\n      await expect(CacheService.viderCache()).rejects.toThrow(CacheError);\r\n    });\r\n  });\r\n\r\n  describe('obtenirStatistiques', () => {\r\n    it('devrait retourner des statistiques compl├¿tes', async () => {\r\n      // Mock de verifierDisponibilite\r\n      vi.spyOn(CacheService, 'verifierDisponibilite').mockResolvedValue({\r\n        available: true,\r\n        storeCount: 10,\r\n        dbName: 'agTabletteDB'\r\n      });\r\n\r\n      const stats = await CacheService.obtenirStatistiques();\r\n\r\n      expect(stats.disponible).toBe(true);\r\n      expect(stats.nombreElements).toBe(10);\r\n      expect(stats.nomDB).toBe('agTabletteDB');\r\n      expect(stats.version).toBe(1);\r\n      expect(stats.derniereVerification).toBeInstanceOf(Date);\r\n    });\r\n\r\n    it('devrait retourner disponible: false en cas d\\'erreur', async () => {\r\n      vi.spyOn(CacheService, 'verifierDisponibilite').mockRejectedValue(new Error('Test error'));\r\n\r\n      const stats = await CacheService.obtenirStatistiques();\r\n\r\n      expect(stats.disponible).toBe(false);\r\n      expect(stats.raison).toContain('Erreur technique');\r\n    });\r\n  });\r\n\r\n  describe('Types d\\'erreurs', () => {\r\n    it('CacheError devrait avoir les bonnes propri├®t├®s', () => {\r\n      const error = new CacheError('Test message', 'TEST_TYPE');\r\n\r\n      expect(error.name).toBe('CacheError');\r\n      expect(error.message).toBe('Test message');\r\n      expect(error.type).toBe('TEST_TYPE');\r\n      expect(error).toBeInstanceOf(Error);\r\n    });\r\n\r\n    it('CacheUnavailableError devrait h├®riter de CacheError', () => {\r\n      const error = new CacheUnavailableError();\r\n\r\n      expect(error).toBeInstanceOf(CacheError);\r\n      expect(error.type).toBe('CACHE_UNAVAILABLE');\r\n      expect(error.message).toBe('Cache IndexedDB non disponible');\r\n    });\r\n\r\n    it('CacheClearError devrait h├®riter de CacheError', () => {\r\n      const error = new CacheClearError();\r\n\r\n      expect(error).toBeInstanceOf(CacheError);\r\n      expect(error.type).toBe('CACHE_CLEAR_ERROR');\r\n      expect(error.message).toBe('Erreur lors du vidage du cache');\r\n    });\r\n  });\r\n});","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\test\\setup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\test\\store\\gridStore.test.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'originalSize' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":60,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":60,"endColumn":23,"suggestions":[{"messageId":"removeVar","data":{"varName":"originalSize"},"fix":{"range":[2376,2427],"text":""},"desc":"Remove unused variable 'originalSize'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Tests pour gridStore.js\r\n\r\nimport { gridStore } from '@store/gridStore';\r\nimport { describe, expect, it } from 'vitest';\r\n\r\ndescribe('gridStore', () => {\r\n  it('should have a default initial state', () => {\r\n    gridStore._resetState(); // S'assurer que l'├®tat est celui par d├®faut avant ce test\r\n    const initialState = gridStore.getState();\r\n    expect(initialState.gridType).toBe('none'); // Corrected expectation\r\n    expect(initialState.gridSize).toBe(1);\r\n    expect(initialState.gridOpacity).toBe(0.7);\r\n    expect(initialState.isVisible).toBe(false);\r\n  });\r\n\r\n  it('should allow setting and getting the grid type', () => {\r\n    gridStore._resetState(); // Assurer un ├®tat propre pour le test\r\n    gridStore.setGridType('triangle-grid');\r\n    expect(gridStore.getState().gridType).toBe('triangle-grid');\r\n\r\n    gridStore.setGridType('dot-grid');\r\n    expect(gridStore.getState().gridType).toBe('dot-grid');\r\n  });\r\n\r\n  it('should set isVisible to false when gridType is \\'none\\'', () => {\r\n    gridStore._resetState();\r\n    gridStore.setIsVisible(true); // Start with grid visible\r\n    gridStore.setGridType('none');\r\n    expect(gridStore.getState().isVisible).toBe(false);\r\n    expect(gridStore.getState().gridType).toBe('none');\r\n  });\r\n\r\n  it('should set isVisible to true when a gridType is set and it was false', () => {\r\n    gridStore._resetState(); // isVisible is false by default\r\n    gridStore.setGridType('square-grid');\r\n    expect(gridStore.getState().isVisible).toBe(true);\r\n    expect(gridStore.getState().gridType).toBe('square-grid');\r\n  });\r\n\r\n  it('should keep isVisible true when changing between visible gridTypes', () => {\r\n    gridStore._resetState();\r\n    gridStore.setGridType('square-grid'); // isVisible becomes true\r\n    expect(gridStore.getState().isVisible).toBe(true);\r\n    gridStore.setGridType('triangle-grid');\r\n    expect(gridStore.getState().isVisible).toBe(true);\r\n    expect(gridStore.getState().gridType).toBe('triangle-grid');\r\n  });\r\n\r\n  it('should allow setting and getting the grid size', () => {\r\n    gridStore._resetState();\r\n    gridStore.setGridSize(5);\r\n    expect(gridStore.getState().gridSize).toBe(5);\r\n\r\n    gridStore.setGridSize(0.5);\r\n    expect(gridStore.getState().gridSize).toBe(0.5);\r\n  });\r\n\r\n  it('should not allow setting a grid size less than or equal to 0', () => {\r\n    gridStore._resetState();\r\n    const originalSize = gridStore.getState().gridSize;\r\n\r\n    gridStore.setGridSize(0);\r\n    expect(gridStore.getState().gridSize).toBe(0.1); // Should be clamped to min\r\n\r\n    gridStore.setGridSize(-5);\r\n    expect(gridStore.getState().gridSize).toBe(0.1); // Should be clamped to min\r\n\r\n    // Check that a valid size still works\r\n    gridStore.setGridSize(2);\r\n    expect(gridStore.getState().gridSize).toBe(2);\r\n  });\r\n\r\n  it('should allow setting and getting the grid opacity', () => {\r\n    gridStore._resetState();\r\n    gridStore.setGridOpacity(0.5);\r\n    expect(gridStore.getState().gridOpacity).toBe(0.5);\r\n\r\n    gridStore.setGridOpacity(1);\r\n    expect(gridStore.getState().gridOpacity).toBe(1);\r\n\r\n    gridStore.setGridOpacity(0);\r\n    expect(gridStore.getState().gridOpacity).toBe(0);\r\n  });\r\n\r\n  it('should clamp opacity values outside the 0-1 range', () => {\r\n    gridStore._resetState();\r\n\r\n    gridStore.setGridOpacity(1.5);\r\n    expect(gridStore.getState().gridOpacity).toBe(1);\r\n\r\n    gridStore.setGridOpacity(-0.5);\r\n    expect(gridStore.getState().gridOpacity).toBe(0);\r\n\r\n    // Check that a valid opacity still works\r\n    gridStore.setGridOpacity(0.7);\r\n    expect(gridStore.getState().gridOpacity).toBe(0.7);\r\n  });\r\n\r\n  it('should allow setting and getting the grid visibility', () => {\r\n    gridStore._resetState();\r\n    gridStore.setIsVisible(true);\r\n    expect(gridStore.getState().isVisible).toBe(true);\r\n\r\n    gridStore.setIsVisible(false);\r\n    expect(gridStore.getState().isVisible).toBe(false);\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\test\\store\\syncState.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\test\\sync-optimization.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\tests\\example.spec.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gunbl\\Dev\\ag-tablette\\vitest.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
